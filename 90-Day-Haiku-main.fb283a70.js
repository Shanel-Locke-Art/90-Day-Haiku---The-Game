let t,n,s,o,r,l,d,c,f;var g=Object.defineProperty,w=(t,n)=>g(t,"name",{value:n,configurable:!0}),y=(()=>{for(var t=new Uint8Array(128),n=0;n<64;n++)t[n<26?n+65:n<52?n+71:n<62?n-4:4*n-205]=n;return n=>{for(var s=n.length,o=new Uint8Array((s-("="==n[s-1])-("="==n[s-2]))*3/4|0),r=0,l=0;r<s;){var d=t[n.charCodeAt(r++)],c=t[n.charCodeAt(r++)],f=t[n.charCodeAt(r++)],g=t[n.charCodeAt(r++)];o[l++]=d<<2|c>>4,o[l++]=c<<4|f>>2,o[l++]=f<<6|g}return o}})();function A(t){return t*Math.PI/180}function v(t){return 180*t/Math.PI}function V(t,n,s){return n>s?V(t,s,n):Math.min(Math.max(t,n),s)}function x(t,n,s){if("number"==typeof t&&"number"==typeof n)return t+(n-t)*s;if(t instanceof E&&n instanceof E||t instanceof k&&n instanceof k)return t.lerp(n,s);throw Error(`Bad value for lerp(): ${t}, ${n}. Only number, Vec2 and Color is supported.`)}function b(t,n,s,o,r){return o+(t-n)/(s-n)*(r-o)}function S(t,n,s,o,r){return V(b(t,n,s,o,r),o,r)}w(A,"deg2rad"),w(v,"rad2deg"),w(V,"clamp"),w(x,"lerp"),w(b,"map"),w(S,"mapc");var E=class t{static{w(this,"Vec2")}x=0;y=0;constructor(t=0,n=t){this.x=t,this.y=n}static fromAngle(n){let s=A(n);return new t(Math.cos(s),Math.sin(s))}static LEFT=new t(-1,0);static RIGHT=new t(1,0);static UP=new t(0,-1);static DOWN=new t(0,1);clone(){return new t(this.x,this.y)}add(...n){let s=M(...n);return new t(this.x+s.x,this.y+s.y)}sub(...n){let s=M(...n);return new t(this.x-s.x,this.y-s.y)}scale(...n){let s=M(...n);return new t(this.x*s.x,this.y*s.y)}dist(...t){let n=M(...t);return this.sub(n).len()}sdist(...t){let n=M(...t);return this.sub(n).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let n=this.len();return 0===n?new t(0):this.scale(1/n)}normal(){return new t(this.y,-this.x)}reflect(t){return this.sub(t.scale(2*this.dot(t)))}project(t){return t.scale(t.dot(this)/t.len())}reject(t){return this.sub(this.project(t))}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(...t){let n=M(...t);return v(Math.atan2(this.y-n.y,this.x-n.x))}angleBetween(...t){let n=M(...t);return v(Math.atan2(this.cross(n),this.dot(n)))}lerp(n,s){return new t(x(this.x,n.x,s),x(this.y,n.y,s))}slerp(t,n){let s=this.dot(t),o=this.cross(t),r=Math.atan2(o,s);return this.scale(Math.sin((1-n)*r)).add(t.scale(Math.sin(n*r))).scale(1/o)}isZero(){return 0===this.x&&0===this.y}toFixed(n){return new t(Number(this.x.toFixed(n)),Number(this.y.toFixed(n)))}transform(t){return t.multVec2(this)}eq(t){return this.x===t.x&&this.y===t.y}bbox(){return new $(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}};function M(...t){if(1===t.length){if(t[0]instanceof E)return new E(t[0].x,t[0].y);if(Array.isArray(t[0])&&2===t[0].length)return new E(...t[0])}return new E(...t)}w(M,"vec2");var k=class t{static{w(this,"Color")}r=255;g=255;b=255;constructor(t,n,s){this.r=V(t,0,255),this.g=V(n,0,255),this.b=V(s,0,255)}static fromArray(n){return new t(n[0],n[1],n[2])}static fromHex(n){if("number"==typeof n)return new t(n>>16&255,n>>8&255,(0|n)&255);if("string"==typeof n){let s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return new t(parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16))}throw Error("Invalid hex color format")}static fromHSL(n,s,o){if(0==s)return new t(255*o,255*o,255*o);let r=w((t,n,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+(n-t)*6*s:s<.5?n:s<2/3?t+(n-t)*(2/3-s)*6:t),"hue2rgb"),l=o<.5?o*(1+s):o+s-o*s,d=2*o-l;return new t(Math.round(255*r(d,l,n+1/3)),Math.round(255*r(d,l,n)),Math.round(255*r(d,l,n-1/3)))}static RED=new t(255,0,0);static GREEN=new t(0,255,0);static BLUE=new t(0,0,255);static YELLOW=new t(255,255,0);static MAGENTA=new t(255,0,255);static CYAN=new t(0,255,255);static WHITE=new t(255,255,255);static BLACK=new t(0,0,0);clone(){return new t(this.r,this.g,this.b)}lighten(n){return new t(this.r+n,this.g+n,this.b+n)}darken(t){return this.lighten(-t)}invert(){return new t(255-this.r,255-this.g,255-this.b)}mult(n){return new t(this.r*n.r/255,this.g*n.g/255,this.b*n.b/255)}lerp(n,s){return new t(x(this.r,n.r,s),x(this.g,n.g,s),x(this.b,n.b,s))}eq(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+(0x1000000+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}};function R(...t){if(0===t.length)return new k(255,255,255);if(1===t.length){if(t[0]instanceof k)return t[0].clone();if("string"==typeof t[0])return k.fromHex(t[0]);if(Array.isArray(t[0])&&3===t[0].length)return k.fromArray(t[0])}return new k(...t)}w(R,"rgb");var P=w((t,n,s)=>k.fromHSL(t,n,s),"hsl2rgb"),T=class t{static{w(this,"Quad")}x=0;y=0;w=1;h=1;constructor(t,n,s,o){this.x=t,this.y=n,this.w=s,this.h=o}scale(n){return new t(this.x+this.w*n.x,this.y+this.h*n.y,this.w*n.w,this.h*n.h)}pos(){return new E(this.x,this.y)}clone(){return new t(this.x,this.y,this.w,this.h)}eq(t){return this.x===t.x&&this.y===t.y&&this.w===t.w&&this.h===t.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function C(t,n,s,o){return new T(t,n,s,o)}w(C,"quad");var B=class t{static{w(this,"Mat4")}m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(t){t&&(this.m=t)}static translate(n){return new t([1,0,0,0,0,1,0,0,0,0,1,0,n.x,n.y,0,1])}static scale(n){return new t([n.x,0,0,0,0,n.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(n){let s=Math.cos(n=A(-n)),o=Math.sin(n);return new t([1,0,0,0,0,s,-o,0,0,o,s,0,0,0,0,1])}static rotateY(n){let s=Math.cos(n=A(-n)),o=Math.sin(n);return new t([s,0,o,0,0,1,0,0,-o,0,s,0,0,0,0,1])}static rotateZ(n){let s=Math.cos(n=A(-n)),o=Math.sin(n);return new t([s,-o,0,0,o,s,0,0,0,0,1,0,0,0,0,1])}translate(t){return this.m[12]+=this.m[0]*t.x+this.m[4]*t.y,this.m[13]+=this.m[1]*t.x+this.m[5]*t.y,this.m[14]+=this.m[2]*t.x+this.m[6]*t.y,this.m[15]+=this.m[3]*t.x+this.m[7]*t.y,this}scale(t){return this.m[0]*=t.x,this.m[4]*=t.y,this.m[1]*=t.x,this.m[5]*=t.y,this.m[2]*=t.x,this.m[6]*=t.y,this.m[3]*=t.x,this.m[7]*=t.y,this}rotate(t){let n=Math.cos(t=A(-t)),s=Math.sin(t),o=this.m[0],r=this.m[1],l=this.m[4],d=this.m[5];return this.m[0]=o*n+r*s,this.m[1]=-o*s+r*n,this.m[4]=l*n+d*s,this.m[5]=-l*s+d*n,this}mult(n){let s=[];for(let t=0;t<4;t++)for(let o=0;o<4;o++)s[4*t+o]=this.m[0+o]*n.m[4*t+0]+this.m[4+o]*n.m[4*t+1]+this.m[8+o]*n.m[4*t+2]+this.m[12+o]*n.m[4*t+3];return new t(s)}multVec2(t){return new E(t.x*this.m[0]+t.y*this.m[4]+this.m[12],t.x*this.m[1]+t.y*this.m[5]+this.m[13])}getTranslation(){return new E(this.m[12],this.m[13])}getScale(){if(0!=this.m[0]||0!=this.m[1]){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new E(n,t/n)}if(0==this.m[4]&&0==this.m[5])return new E(0,0);{let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new E(t/n,n)}}getRotation(){if(0!=this.m[0]||0!=this.m[1]){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return v(this.m[1]>0?Math.acos(this.m[0]/t):-Math.acos(this.m[0]/t))}if(0==this.m[4]&&0==this.m[5])return 0;{let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return v(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/t):-Math.acos(this.m[4]/t)))}}getSkew(){if(0!=this.m[0]||0!=this.m[1]){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new E(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t),0)}if(0==this.m[4]&&0==this.m[5])return new E(0,0);{let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new E(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t))}}invert(){let n=[],s=this.m[10]*this.m[15]-this.m[14]*this.m[11],o=this.m[9]*this.m[15]-this.m[13]*this.m[11],r=this.m[9]*this.m[14]-this.m[13]*this.m[10],l=this.m[8]*this.m[15]-this.m[12]*this.m[11],d=this.m[8]*this.m[14]-this.m[12]*this.m[10],c=this.m[8]*this.m[13]-this.m[12]*this.m[9],f=this.m[6]*this.m[15]-this.m[14]*this.m[7],g=this.m[5]*this.m[15]-this.m[13]*this.m[7],w=this.m[5]*this.m[14]-this.m[13]*this.m[6],y=this.m[4]*this.m[15]-this.m[12]*this.m[7],A=this.m[4]*this.m[14]-this.m[12]*this.m[6],v=this.m[5]*this.m[15]-this.m[13]*this.m[7],V=this.m[4]*this.m[13]-this.m[12]*this.m[5],x=this.m[6]*this.m[11]-this.m[10]*this.m[7],b=this.m[5]*this.m[11]-this.m[9]*this.m[7],S=this.m[5]*this.m[10]-this.m[9]*this.m[6],E=this.m[4]*this.m[11]-this.m[8]*this.m[7],M=this.m[4]*this.m[10]-this.m[8]*this.m[6],k=this.m[4]*this.m[9]-this.m[8]*this.m[5];n[0]=this.m[5]*s-this.m[6]*o+this.m[7]*r,n[4]=-(this.m[4]*s-this.m[6]*l+this.m[7]*d),n[8]=this.m[4]*o-this.m[5]*l+this.m[7]*c,n[12]=-(this.m[4]*r-this.m[5]*d+this.m[6]*c),n[1]=-(this.m[1]*s-this.m[2]*o+this.m[3]*r),n[5]=this.m[0]*s-this.m[2]*l+this.m[3]*d,n[9]=-(this.m[0]*o-this.m[1]*l+this.m[3]*c),n[13]=this.m[0]*r-this.m[1]*d+this.m[2]*c,n[2]=this.m[1]*f-this.m[2]*g+this.m[3]*w,n[6]=-(this.m[0]*f-this.m[2]*y+this.m[3]*A),n[10]=this.m[0]*v-this.m[1]*y+this.m[3]*V,n[14]=-(this.m[0]*w-this.m[1]*A+this.m[2]*V),n[3]=-(this.m[1]*x-this.m[2]*b+this.m[3]*S),n[7]=this.m[0]*x-this.m[2]*E+this.m[3]*M,n[11]=-(this.m[0]*b-this.m[1]*E+this.m[3]*k),n[15]=this.m[0]*S-this.m[1]*M+this.m[2]*k;let R=this.m[0]*n[0]+this.m[1]*n[4]+this.m[2]*n[8]+this.m[3]*n[12];for(let t=0;t<4;t++)for(let s=0;s<4;s++)n[4*t+s]*=1/R;return new t(n)}clone(){return new t([...this.m])}toString(){return this.m.toString()}};function F(t,n,s,o=t=>-Math.cos(t)){return t+(o(s)+1)/2*(n-t)}w(F,"wave");var I=class{static{w(this,"RNG")}seed;constructor(t){this.seed=t}gen(){return this.seed=(0x41c64e6d*this.seed+12345)%0x80000000,this.seed/0x80000000}genNumber(t,n){return t+this.gen()*(n-t)}genVec2(t,n){return new E(this.genNumber(t.x,n.x),this.genNumber(t.y,n.y))}genColor(t,n){return new k(this.genNumber(t.r,n.r),this.genNumber(t.g,n.g),this.genNumber(t.b,n.b))}genAny(...t){if(0===t.length)return this.gen();if(1===t.length){if("number"==typeof t[0])return this.genNumber(0,t[0]);if(t[0]instanceof E)return this.genVec2(M(0,0),t[0]);if(t[0]instanceof k)return this.genColor(R(0,0,0),t[0])}else if(2===t.length){if("number"==typeof t[0]&&"number"==typeof t[1])return this.genNumber(t[0],t[1]);if(t[0]instanceof E&&t[1]instanceof E)return this.genVec2(t[0],t[1]);if(t[0]instanceof k&&t[1]instanceof k)return this.genColor(t[0],t[1])}}},N=new I(Date.now());function U(t){return null!=t&&(N.seed=t),N.seed}function H(...t){return N.genAny(...t)}function L(...t){return Math.floor(H(...t))}function G(t){return H()<=t}function O(t){return t[L(t.length)]}function j(t,n){return t.pos.x+t.width>n.pos.x&&t.pos.x<n.pos.x+n.width&&t.pos.y+t.height>n.pos.y&&t.pos.y<n.pos.y+n.height}function K(t,n){if(t.p1.x===t.p2.x&&t.p1.y===t.p2.y||n.p1.x===n.p2.x&&n.p1.y===n.p2.y)return null;let s=(n.p2.y-n.p1.y)*(t.p2.x-t.p1.x)-(n.p2.x-n.p1.x)*(t.p2.y-t.p1.y);if(0===s)return null;let o=((n.p2.x-n.p1.x)*(t.p1.y-n.p1.y)-(n.p2.y-n.p1.y)*(t.p1.x-n.p1.x))/s,r=((t.p2.x-t.p1.x)*(t.p1.y-n.p1.y)-(t.p2.y-t.p1.y)*(t.p1.x-n.p1.x))/s;return o<0||o>1||r<0||r>1?null:o}function q(t,n){let s=K(t,n);return s?M(t.p1.x+s*(t.p2.x-t.p1.x),t.p1.y+s*(t.p2.y-t.p1.y)):null}function Y(t,n){if(z(t,n.p1)||z(t,n.p2))return!0;let s=t.points();return!!q(n,new Z(s[0],s[1]))||!!q(n,new Z(s[1],s[2]))||!!q(n,new Z(s[2],s[3]))||!!q(n,new Z(s[3],s[0]))}function z(t,n){return n.x>t.pos.x&&n.x<t.pos.x+t.width&&n.y>t.pos.y&&n.y<t.pos.y+t.height}function Q(t,n){let s=n.sub(t.p1),o=t.p2.sub(t.p1);if(Math.abs(s.cross(o))>Number.EPSILON)return!1;let r=s.dot(o)/o.dot(o);return r>=0&&r<=1}function X(t,n){let s=t.p2.sub(t.p1),o=s.dot(s),r=t.p1.sub(n.center),l=2*s.dot(r),d=l*l-4*o*(r.dot(r)-n.radius*n.radius);if(o<=Number.EPSILON||d<0)return!1;if(0==d){let t=-l/(2*o);if(t>=0&&t<=1)return!0}else{let t=(-l+Math.sqrt(d))/(2*o),n=(-l-Math.sqrt(d))/(2*o);if(t>=0&&t<=1||n>=0&&n<=1)return!0}return J(n,t.p1)}function J(t,n){return t.center.sdist(n)<t.radius*t.radius}function _(t,n){let s=n.pts[n.pts.length-1];for(let o of n.pts){if(X(new Z(s,o),t))return!0;s=o}return!!J(t,n.pts[0])||W(n,t.center)}function W(t,n){let s=!1,o=t.pts;for(let t=0,r=o.length-1;t<o.length;r=t++)o[t].y>n.y!=o[r].y>n.y&&n.x<(o[r].x-o[t].x)*(n.y-o[t].y)/(o[r].y-o[t].y)+o[t].x&&(s=!s);return s}w(U,"randSeed"),w(H,"rand"),w(L,"randi"),w(G,"chance"),w(O,"choose"),w(j,"testRectRect"),w(K,"testLineLineT"),w(q,"testLineLine"),w(Y,"testRectLine"),w(z,"testRectPoint"),w(Q,"testLinePoint"),w(X,"testLineCircle"),w(J,"testCirclePoint"),w(_,"testCirclePolygon"),w(W,"testPolygonPoint");var Z=class t{static{w(this,"Line")}p1;p2;constructor(t,n){this.p1=t.clone(),this.p2=n.clone()}transform(n){return new t(n.multVec2(this.p1),n.multVec2(this.p2))}bbox(){return $.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new t(this.p1,this.p2)}},$=class t{static{w(this,"Rect")}pos;width;height;constructor(t,n,s){this.pos=t.clone(),this.width=n,this.height=s}static fromPoints(n,s){return new t(n.clone(),s.x-n.x,s.y-n.y)}center(){return new E(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(t){return new en(this.points().map(n=>t.multVec2(n)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new t(this.pos.clone(),this.width,this.height)}distToPoint(t){return Math.sqrt(this.sdistToPoint(t))}sdistToPoint(t){let n=this.pos,s=this.pos.add(this.width,this.height),o=Math.max(n.x-t.x,0,t.x-s.x),r=Math.max(n.y-t.y,0,t.y-s.y);return o*o+r*r}},ee=class t{static{w(this,"Circle")}center;radius;constructor(t,n){this.center=t.clone(),this.radius=n}transform(t){return new et(this.center,this.radius,this.radius).transform(t)}bbox(){return $.fromPoints(this.center.sub(M(this.radius)),this.center.add(M(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new t(this.center,this.radius)}},et=class t{static{w(this,"Ellipse")}center;radiusX;radiusY;constructor(t,n,s){this.center=t.clone(),this.radiusX=n,this.radiusY=s}transform(n){return new t(n.multVec2(this.center),n.m[0]*this.radiusX,n.m[5]*this.radiusY)}bbox(){return $.fromPoints(this.center.sub(M(this.radiusX,this.radiusY)),this.center.add(M(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new t(this.center,this.radiusX,this.radiusY)}},en=class t{static{w(this,"Polygon")}pts;constructor(t){if(t.length<3)throw Error("Polygons should have at least 3 vertices");this.pts=t}transform(n){return new t(this.pts.map(t=>n.multVec2(t)))}bbox(){let t=M(Number.MAX_VALUE),n=M(-Number.MAX_VALUE);for(let s of this.pts)t.x=Math.min(t.x,s.x),n.x=Math.max(n.x,s.x),t.y=Math.min(t.y,s.y),n.y=Math.max(n.y,s.y);return $.fromPoints(t,n)}area(){let t=0,n=this.pts.length;for(let s=0;s<n;s++){let o=this.pts[s],r=this.pts[(s+1)%n];t+=o.x*r.y*.5,t-=r.x*o.y*.5}return Math.abs(t)}clone(){return new t(this.pts.map(t=>t.clone()))}};function ei(t,n){let s=Number.MAX_VALUE,o=M(0);for(let r of[t,n])for(let l=0;l<r.pts.length;l++){let d=r.pts[l],c=r.pts[(l+1)%r.pts.length].sub(d).normal().unit(),f=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let n=0;n<t.pts.length;n++){let s=t.pts[n].dot(c);f=Math.min(f,s),g=Math.max(g,s)}let w=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let t=0;t<n.pts.length;t++){let s=n.pts[t].dot(c);w=Math.min(w,s),y=Math.max(y,s)}let A=Math.min(g,y)-Math.max(f,w);if(A<0)return null;if(A<Math.abs(s)){let t=y-f,n=w-g;s=Math.abs(t)<Math.abs(n)?t:n,o=c.scale(s)}}return o}w(ei,"sat");var es=class extends Map{static{w(this,"IDList")}lastID;constructor(...t){super(...t),this.lastID=0}push(t){let n=this.lastID;return this.set(n,t),this.lastID++,n}pushd(t){let n=this.push(t);return()=>this.delete(n)}},eo=class t{static{w(this,"EventController")}paused=!1;cancel;constructor(t){this.cancel=t}static join(n){let s=new t(()=>n.forEach(t=>t.cancel()));return Object.defineProperty(s,"paused",{get:()=>n[0].paused,set:t=>n.forEach(n=>n.paused=t)}),s.paused=!1,s}},er=class{static{w(this,"Event")}handlers=new es;add(t){let n=new eo(this.handlers.pushd((...s)=>{n.paused||t(...s)}));return n}addOnce(t){let n=this.add((...s)=>{n.cancel(),t(...s)});return n}next(){return new Promise(t=>this.addOnce(t))}trigger(...t){this.handlers.forEach(n=>n(...t))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},ea=class{static{w(this,"EventHandler")}handlers={};on(t,n){return this.handlers[t]||(this.handlers[t]=new er),this.handlers[t].add(n)}onOnce(t,n){let s=this.on(t,(...t)=>{s.cancel(),n(...t)});return s}next(t){return new Promise(n=>{this.onOnce(t,(...t)=>n(t[0]))})}trigger(t,...n){this.handlers[t]&&this.handlers[t].trigger(...n)}remove(t){delete this.handlers[t]}clear(){this.handlers={}}numListeners(t){return this.handlers[t]?.numListeners()??0}};function el(t,n){let s=typeof t,o=typeof n;if(s!==o)return!1;if("object"===s&&"object"===o&&null!==t&&null!==n){let s=Object.keys(t),o=Object.keys(n);if(s.length!==o.length)return!1;for(let o of s){let s=t[o],r=n[o];if(("function"!=typeof s||"function"!=typeof r)&&!el(s,r))return!1}return!0}return t===n}function eh(t){let n=window.atob(t),s=n.length,o=new Uint8Array(s);for(let t=0;t<s;t++)o[t]=n.charCodeAt(t);return o.buffer}function ed(t){return eh(t.split(",")[1])}function eu(t,n){let s=document.createElement("a");s.href=n,s.download=t,s.click()}function ec(t,n){eu(t,"data:text/plain;charset=utf-8,"+n)}function ep(t,n){ec(t,JSON.stringify(n))}function ef(t,n){let s=URL.createObjectURL(n);eu(t,s),URL.revokeObjectURL(s)}w(el,"deepEq"),w(eh,"base64ToArrayBuffer"),w(ed,"dataURLToArrayBuffer"),w(eu,"download"),w(ec,"downloadText"),w(ep,"downloadJSON"),w(ef,"downloadBlob");var em=w(t=>t.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),eg=w(t=>t.split(".").pop(),"getExt"),ew=(t=0,()=>t++),ey=class{static{w(this,"BinaryHeap")}_items;_compareFn;constructor(t=(t,n)=>t<n){this._compareFn=t,this._items=[]}insert(t){this._items.push(t),this.moveUp(this._items.length-1)}remove(){if(0===this._items.length)return null;let t=this._items[0],n=this._items.pop();return 0!==this._items.length&&(this._items[0]=n,this.moveDown(0)),t}clear(){this._items.splice(0,this._items.length)}moveUp(t){for(;t>0;){let n=Math.floor((t-1)/2);if(!this._compareFn(this._items[t],this._items[n])&&this._items[t]>=this._items[n])break;this.swap(t,n),t=n}}moveDown(t){for(;t<Math.floor(this._items.length/2);){let n=2*t+1;if(n<this._items.length-1&&!this._compareFn(this._items[n],this._items[n+1])&&++n,this._compareFn(this._items[t],this._items[n]))break;this.swap(t,n),t=n}}swap(t,n){[this._items[t],this._items[n]]=[this._items[n],this._items[t]]}get length(){return this._items.length}},eA={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},ev=class{static{w(this,"ButtonState")}pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(t){this.pressed.add(t),this.pressedRepeat.add(t),this.down.add(t)}pressRepeat(t){this.pressedRepeat.add(t)}release(t){this.down.delete(t),this.pressed.delete(t),this.released.add(t)}},eV=class{static{w(this,"GamepadState")}buttonState=new ev;stickState=new Map},ex=class{static{w(this,"FPSCounter")}dts=[];timer=0;fps=0;tick(t){this.dts.push(t),this.timer+=t,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((t,n)=>t+n)/this.dts.length)),this.dts=[])}},eb=w(t=>{if(!t.canvas)throw Error("Please provide a canvas");let n={canvas:t.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new ex,timeScale:1,skipTime:!1,numFrames:0,mousePos:new E(0),mouseDeltaPos:new E(0),keyState:new ev,mouseState:new ev,mergedGamepadState:new eV,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:t.canvas.offsetWidth,lastHeight:t.canvas.offsetHeight,events:new ea};function s(){return n.canvas}function o(){return n.dt*n.timeScale}function r(){return n.time}function l(){return n.fpsCounter.fps}function d(){return n.numFrames}function c(){return n.canvas.toDataURL()}function f(t){n.canvas.style.cursor=t}function g(){return n.canvas.style.cursor}function y(t){if(t)try{let t=n.canvas.requestPointerLock();t.catch&&t.catch(t=>console.error(t))}catch(t){console.error(t)}else document.exitPointerLock()}function A(){return!!document.pointerLockElement}function v(t){t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}function V(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function x(){return document.fullscreenElement||document.webkitFullscreenElement}function b(t=!0){t?v(n.canvas):V()}function S(){return!!x()}function M(){for(let t in n.stopped=!0,eS)n.canvas.removeEventListener(t,eS[t]);for(let t in eE)document.removeEventListener(t,eE[t]);for(let t in eM)window.removeEventListener(t,eM[t]);eT.disconnect()}function k(s){null!==n.loopID&&cancelAnimationFrame(n.loopID);let r=0,l=w(d=>{if(n.stopped)return;if("visible"!==document.visibilityState){n.loopID=requestAnimationFrame(l);return}let c=d/1e3,f=c-n.realTime,g=t.maxFPS?1/t.maxFPS:0;n.realTime=c,(r+=f)>g&&(n.skipTime||(n.dt=r,n.time+=o(),n.fpsCounter.tick(n.dt)),r=0,n.skipTime=!1,n.numFrames++,em(),s(),eg()),n.loopID=requestAnimationFrame(l)},"frame");l(0)}function R(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function P(){return n.mousePos.clone()}function T(){return n.mouseDeltaPos.clone()}function C(t="left"){return n.mouseState.pressed.has(t)}function B(t="left"){return n.mouseState.down.has(t)}function F(t="left"){return n.mouseState.released.has(t)}function I(){return n.isMouseMoved}function N(t){return void 0===t?n.keyState.pressed.size>0:n.keyState.pressed.has(t)}function U(t){return void 0===t?n.keyState.pressedRepeat.size>0:n.keyState.pressedRepeat.has(t)}function H(t){return void 0===t?n.keyState.down.size>0:n.keyState.down.has(t)}function L(t){return void 0===t?n.keyState.released.size>0:n.keyState.released.has(t)}function G(t){return void 0===t?n.mergedGamepadState.buttonState.pressed.size>0:n.mergedGamepadState.buttonState.pressed.has(t)}function O(t){return void 0===t?n.mergedGamepadState.buttonState.down.size>0:n.mergedGamepadState.buttonState.down.has(t)}function j(t){return void 0===t?n.mergedGamepadState.buttonState.released.size>0:n.mergedGamepadState.buttonState.released.has(t)}function K(t){return n.events.on("resize",t)}w(s,"canvas"),w(o,"dt"),w(r,"time"),w(l,"fps"),w(d,"numFrames"),w(c,"screenshot"),w(f,"setCursor"),w(g,"getCursor"),w(y,"setCursorLocked"),w(A,"isCursorLocked"),w(v,"enterFullscreen"),w(V,"exitFullscreen"),w(x,"getFullscreenElement"),w(b,"setFullscreen"),w(S,"isFullscreen"),w(M,"quit"),w(k,"run"),w(R,"isTouchscreen"),w(P,"mousePos"),w(T,"mouseDeltaPos"),w(C,"isMousePressed"),w(B,"isMouseDown"),w(F,"isMouseReleased"),w(I,"isMouseMoved"),w(N,"isKeyPressed"),w(U,"isKeyPressedRepeat"),w(H,"isKeyDown"),w(L,"isKeyReleased"),w(G,"isGamepadButtonPressed"),w(O,"isGamepadButtonDown"),w(j,"isGamepadButtonReleased"),w(K,"onResize");let q=w((t,s)=>"function"==typeof t?n.events.on("keyDown",t):"string"==typeof t&&"function"==typeof s?n.events.on("keyDown",n=>n===t&&s(t)):void 0,"onKeyDown"),Y=w((t,s)=>"function"==typeof t?n.events.on("keyPress",t):"string"==typeof t&&"function"==typeof s?n.events.on("keyPress",n=>n===t&&s(t)):void 0,"onKeyPress"),z=w((t,s)=>"function"==typeof t?n.events.on("keyPressRepeat",t):"string"==typeof t&&"function"==typeof s?n.events.on("keyPressRepeat",n=>n===t&&s(t)):void 0,"onKeyPressRepeat"),Q=w((t,s)=>"function"==typeof t?n.events.on("keyRelease",t):"string"==typeof t&&"function"==typeof s?n.events.on("keyRelease",n=>n===t&&s(t)):void 0,"onKeyRelease");function X(t,s){return"function"==typeof t?n.events.on("mouseDown",n=>t(n)):n.events.on("mouseDown",n=>n===t&&s(n))}function J(t,s){return"function"==typeof t?n.events.on("mousePress",n=>t(n)):n.events.on("mousePress",n=>n===t&&s(n))}function _(t,s){return"function"==typeof t?n.events.on("mouseRelease",n=>t(n)):n.events.on("mouseRelease",n=>n===t&&s(n))}function W(t){return n.events.on("mouseMove",()=>t(P(),T()))}function Z(t){return n.events.on("charInput",t)}function $(t){return n.events.on("touchStart",t)}function ee(t){return n.events.on("touchMove",t)}function et(t){return n.events.on("touchEnd",t)}function en(t){return n.events.on("scroll",t)}function ei(t){return n.events.on("hide",t)}function es(t){return n.events.on("show",t)}function eo(t,s){return"function"==typeof t?n.events.on("gamepadButtonDown",t):"string"==typeof t&&"function"==typeof s?n.events.on("gamepadButtonDown",n=>n===t&&s(t)):void 0}function er(t,s){return"function"==typeof t?n.events.on("gamepadButtonPress",t):"string"==typeof t&&"function"==typeof s?n.events.on("gamepadButtonPress",n=>n===t&&s(t)):void 0}function el(t,s){return"function"==typeof t?n.events.on("gamepadButtonRelease",t):"string"==typeof t&&"function"==typeof s?n.events.on("gamepadButtonRelease",n=>n===t&&s(t)):void 0}function eh(t,s){return n.events.on("gamepadStick",(n,o)=>n===t&&s(o))}function ed(t){n.events.on("gamepadConnect",t)}function eu(t){n.events.on("gamepadDisconnect",t)}function ec(t){return n.mergedGamepadState.stickState.get(t)||new E(0)}function ep(){return[...n.charInputted]}function ef(){return[...n.gamepads]}function em(){n.events.trigger("input"),n.keyState.down.forEach(t=>n.events.trigger("keyDown",t)),n.mouseState.down.forEach(t=>n.events.trigger("mouseDown",t)),eb()}function eg(){n.keyState.update(),n.mouseState.update(),n.mergedGamepadState.buttonState.update(),n.mergedGamepadState.stickState.forEach((t,s)=>{n.mergedGamepadState.stickState.set(s,new E(0))}),n.charInputted=[],n.isMouseMoved=!1,n.gamepadStates.forEach(t=>{t.buttonState.update(),t.stickState.forEach((n,s)=>{t.stickState.set(s,new E(0))})})}function ew(t){let s={index:t.index,isPressed:s=>n.gamepadStates.get(t.index).buttonState.pressed.has(s),isDown:s=>n.gamepadStates.get(t.index).buttonState.down.has(s),isReleased:s=>n.gamepadStates.get(t.index).buttonState.released.has(s),getStick:s=>n.gamepadStates.get(t.index).stickState.get(s)};return n.gamepads.push(s),n.gamepadStates.set(t.index,{buttonState:new ev,stickState:new Map([["left",new E(0)],["right",new E(0)]])}),s}function ey(t){n.gamepads=n.gamepads.filter(n=>n.index!==t.index),n.gamepadStates.delete(t.index)}function eb(){for(let t of navigator.getGamepads())t&&!n.gamepadStates.has(t.index)&&ew(t);for(let s of n.gamepads){let o=navigator.getGamepads()[s.index],r=(t.gamepads??{})[o.id]??eA[o.id]??eA.default,l=n.gamepadStates.get(s.index);for(let t=0;t<o.buttons.length;t++)o.buttons[t].pressed?(l.buttonState.down.has(r.buttons[t])||(n.mergedGamepadState.buttonState.press(r.buttons[t]),l.buttonState.press(r.buttons[t]),n.events.trigger("gamepadButtonPress",r.buttons[t])),n.events.trigger("gamepadButtonDown",r.buttons[t])):l.buttonState.down.has(r.buttons[t])&&(n.mergedGamepadState.buttonState.release(r.buttons[t]),l.buttonState.release(r.buttons[t]),n.events.trigger("gamepadButtonRelease",r.buttons[t]));for(let t in r.sticks){let s=r.sticks[t],d=new E(o.axes[s.x],o.axes[s.y]);l.stickState.set(t,d),n.mergedGamepadState.stickState.set(t,d),n.events.trigger("gamepadStick",t,d)}}}w(X,"onMouseDown"),w(J,"onMousePress"),w(_,"onMouseRelease"),w(W,"onMouseMove"),w(Z,"onCharInput"),w($,"onTouchStart"),w(ee,"onTouchMove"),w(et,"onTouchEnd"),w(en,"onScroll"),w(ei,"onHide"),w(es,"onShow"),w(eo,"onGamepadButtonDown"),w(er,"onGamepadButtonPress"),w(el,"onGamepadButtonRelease"),w(eh,"onGamepadStick"),w(ed,"onGamepadConnect"),w(eu,"onGamepadDisconnect"),w(ec,"getGamepadStick"),w(ep,"charInputted"),w(ef,"getGamepads"),w(em,"processInput"),w(eg,"resetInput"),w(ew,"registerGamepad"),w(ey,"removeGamepad"),w(eb,"processGamepad");let eS={},eE={},eM={};eS.mousemove=t=>{let s=new E(t.offsetX,t.offsetY),o=new E(t.movementX,t.movementY);n.events.onOnce("input",()=>{n.isMouseMoved=!0,n.mousePos=s,n.mouseDeltaPos=o,n.events.trigger("mouseMove")})};let ek=["left","middle","right","back","forward"];eS.mousedown=t=>{n.events.onOnce("input",()=>{let s=ek[t.button];s&&(n.mouseState.press(s),n.events.trigger("mousePress",s))})},eS.mouseup=t=>{n.events.onOnce("input",()=>{let s=ek[t.button];s&&(n.mouseState.release(s),n.events.trigger("mouseRelease",s))})};let eR=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),eP={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};for(let s in eS.keydown=t=>{eR.has(t.key)&&t.preventDefault(),n.events.onOnce("input",()=>{let s=eP[t.key]||t.key.toLowerCase();1===s.length?(n.events.trigger("charInput",s),n.charInputted.push(s)):"space"===s&&(n.events.trigger("charInput"," "),n.charInputted.push(" ")),t.repeat?(n.keyState.pressRepeat(s),n.events.trigger("keyPressRepeat",s)):(n.keyState.press(s),n.events.trigger("keyPressRepeat",s),n.events.trigger("keyPress",s))})},eS.keyup=t=>{n.events.onOnce("input",()=>{let s=eP[t.key]||t.key.toLowerCase();n.keyState.release(s),n.events.trigger("keyRelease",s)})},eS.touchstart=s=>{s.preventDefault(),n.events.onOnce("input",()=>{let o=[...s.changedTouches],r=n.canvas.getBoundingClientRect();!1!==t.touchToMouse&&(n.mousePos=new E(o[0].clientX-r.x,o[0].clientY-r.y),n.mouseState.press("left"),n.events.trigger("mousePress","left")),o.forEach(t=>{n.events.trigger("touchStart",new E(t.clientX-r.x,t.clientY-r.y),t)})})},eS.touchmove=s=>{s.preventDefault(),n.events.onOnce("input",()=>{let o=[...s.changedTouches],r=n.canvas.getBoundingClientRect();!1!==t.touchToMouse&&(n.mousePos=new E(o[0].clientX-r.x,o[0].clientY-r.y),n.events.trigger("mouseMove")),o.forEach(t=>{n.events.trigger("touchMove",new E(t.clientX-r.x,t.clientY-r.y),t)})})},eS.touchend=s=>{n.events.onOnce("input",()=>{let o=[...s.changedTouches],r=n.canvas.getBoundingClientRect();!1!==t.touchToMouse&&(n.mousePos=new E(o[0].clientX-r.x,o[0].clientY-r.y),n.mouseState.release("left"),n.events.trigger("mouseRelease","left")),o.forEach(t=>{n.events.trigger("touchEnd",new E(t.clientX-r.x,t.clientY-r.y),t)})})},eS.touchcancel=s=>{n.events.onOnce("input",()=>{let o=[...s.changedTouches],r=n.canvas.getBoundingClientRect();!1!==t.touchToMouse&&(n.mousePos=new E(o[0].clientX-r.x,o[0].clientY-r.y),n.mouseState.release("left"),n.events.trigger("mouseRelease","left")),o.forEach(t=>{n.events.trigger("touchEnd",new E(t.clientX-r.x,t.clientY-r.y),t)})})},eS.wheel=t=>{t.preventDefault(),n.events.onOnce("input",()=>{n.events.trigger("scroll",new E(t.deltaX,t.deltaY))})},eS.contextmenu=t=>t.preventDefault(),eE.visibilitychange=()=>{"visible"===document.visibilityState?(n.skipTime=!0,n.events.trigger("show")):n.events.trigger("hide")},eM.gamepadconnected=t=>{let s=ew(t.gamepad);n.events.onOnce("input",()=>{n.events.trigger("gamepadConnect",s)})},eM.gamepaddisconnected=t=>{let s=ef().filter(n=>n.index===t.gamepad.index)[0];ey(t.gamepad),n.events.onOnce("input",()=>{n.events.trigger("gamepadDisconnect",s)})},eS)n.canvas.addEventListener(s,eS[s]);for(let t in eE)document.addEventListener(t,eE[t]);for(let t in eM)window.addEventListener(t,eM[t]);let eT=new ResizeObserver(t=>{for(let s of t)if(s.target===n.canvas){if(n.lastWidth===n.canvas.offsetWidth&&n.lastHeight===n.canvas.offsetHeight)return;n.lastWidth=n.canvas.offsetWidth,n.lastHeight=n.canvas.offsetHeight,n.events.onOnce("input",()=>{n.events.trigger("resize")})}});return eT.observe(n.canvas),{dt:o,time:r,run:k,canvas:s,fps:l,numFrames:d,quit:M,setFullscreen:b,isFullscreen:S,setCursor:f,screenshot:c,getGamepads:ef,getCursor:g,setCursorLocked:y,isCursorLocked:A,isTouchscreen:R,mousePos:P,mouseDeltaPos:T,isKeyDown:H,isKeyPressed:N,isKeyPressedRepeat:U,isKeyReleased:L,isMouseDown:B,isMousePressed:C,isMouseReleased:F,isMouseMoved:I,isGamepadButtonPressed:G,isGamepadButtonDown:O,isGamepadButtonReleased:j,getGamepadStick:ec,charInputted:ep,onResize:K,onKeyDown:q,onKeyPress:Y,onKeyPressRepeat:z,onKeyRelease:Q,onMouseDown:X,onMousePress:J,onMouseRelease:_,onMouseMove:W,onCharInput:Z,onTouchStart:$,onTouchMove:ee,onTouchEnd:et,onScroll:en,onHide:ei,onShow:es,onGamepadButtonDown:eo,onGamepadButtonPress:er,onGamepadButtonRelease:el,onGamepadStick:eh,onGamepadConnect:ed,onGamepadDisconnect:eu,events:n.events}},"default"),eS=2*Math.PI/3,eE=2*Math.PI/4.5,eM={linear:t=>t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInExpo:t=>0===t?0:Math.pow(2,10*t-10),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>2.70158*t*t*t-1.70158*t*t,easeOutBack:t=>1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*(7.189819*t-2.5949095)/2:(Math.pow(2*t-2,2)*(3.5949095*(2*t-2)+2.5949095)+2)/2,easeInElastic:t=>0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*eS),easeOutElastic:t=>0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*eS)+1,easeInOutElastic:t=>0===t?0:1===t?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*eE))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*eE)/2+1,easeInBounce:t=>1-eM.easeOutBounce(1-t),easeOutBounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,easeInOutBounce:t=>t<.5?(1-eM.easeOutBounce(1-2*t))/2:(1+eM.easeOutBounce(2*t-1))/2},ek=class{static{w(this,"Timer")}time;action;finished=!1;paused=!1;constructor(t,n){this.time=t,this.action=n}tick(t){return!this.finished&&!this.paused&&(this.time-=t,this.time<=0&&(this.action(),this.finished=!0,this.time=0,!0))}reset(t){this.time=t,this.finished=!1}},eR=y("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),eP=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",eT="topleft",eC="monospace",eB="nearest",eF=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],eI=eF.reduce((t,n)=>t+n.size,0),eD=8192*eI,eN=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,eU=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,eH=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,eL=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,eG=new Set(["id","require"]),eO=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function ej(t){switch(t){case"topleft":return new E(-1,-1);case"top":return new E(0,-1);case"topright":return new E(1,-1);case"left":return new E(-1,0);case"center":return new E(0,0);case"right":return new E(1,0);case"botleft":return new E(-1,1);case"bot":return new E(0,1);case"botright":return new E(1,1);default:return t}}function eK(t){switch(t){case"left":default:return 0;case"center":return .5;case"right":return 1}}function eq(t){return t.createBuffer(1,1,44100)}w(ej,"anchorPt"),w(eK,"alignPt"),w(eq,"createEmptyAudioBuffer");const eY=w((t={})=>{let n,s,o,r,l,d,c,f,g,y,N,K,J,et,eh=t.root??document.body;eh===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let eA=t.canvas??(n=document.createElement("canvas"),eh.appendChild(n),n),ev=t.scale??1,eV=t.width&&t.height&&!t.stretch&&!t.letterbox;eV?(eA.width=t.width*ev,eA.height=t.height*ev):(eA.width=eA.parentElement.offsetWidth,eA.height=eA.parentElement.offsetHeight);let ex=eA.width,eS=eA.height,eE=t.pixelDensity||window.devicePixelRatio;eA.width*=eE,eA.height*=eE;let eY=["outline: none","cursor: default"];eV?(eY.push(`width: ${ex}px`),eY.push(`height: ${eS}px`)):(eY.push("width: 100%"),eY.push("height: 100%")),t.crisp&&(eY.push("image-rendering: pixelated"),eY.push("image-rendering: crisp-edges")),eA.style.cssText=eY.join(";"),eA.tabIndex=0;let ez=document.createElement("canvas");ez.width=256,ez.height=256;let eQ=ez.getContext("2d",{willReadFrequently:!0}),eX=eb({canvas:eA,touchToMouse:t.touchToMouse,gamepads:t.gamepads,pixelDensity:t.pixelDensity,maxFPS:t.maxFPS}),eJ=[],e_=eX.canvas().getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});class eW{static{w(this,"Texture")}src=null;glTex;width;height;constructor(n,s,o={}){this.glTex=e_.createTexture(),eJ.push(()=>this.free()),this.bind(),n&&s&&e_.texImage2D(e_.TEXTURE_2D,0,e_.RGBA,n,s,0,e_.RGBA,e_.UNSIGNED_BYTE,null),this.width=n,this.height=s;let r=(o.filter??t.texFilter)==="linear"?e_.LINEAR:e_.NEAREST,l="repeat"===o.wrap?e_.REPEAT:e_.CLAMP_TO_EDGE;e_.texParameteri(e_.TEXTURE_2D,e_.TEXTURE_MIN_FILTER,r),e_.texParameteri(e_.TEXTURE_2D,e_.TEXTURE_MAG_FILTER,r),e_.texParameteri(e_.TEXTURE_2D,e_.TEXTURE_WRAP_S,l),e_.texParameteri(e_.TEXTURE_2D,e_.TEXTURE_WRAP_T,l),this.unbind()}static fromImage(t,n={}){let s=new eW(0,0,n);return s.bind(),e_.texImage2D(e_.TEXTURE_2D,0,e_.RGBA,e_.RGBA,e_.UNSIGNED_BYTE,t),s.width=t.width,s.height=t.height,s.unbind(),s.src=t,s}update(t,n=0,s=0){this.bind(),e_.texSubImage2D(e_.TEXTURE_2D,0,n,s,e_.RGBA,e_.UNSIGNED_BYTE,t),this.unbind()}bind(){e_.bindTexture(e_.TEXTURE_2D,this.glTex)}unbind(){e_.bindTexture(e_.TEXTURE_2D,null)}free(){e_.deleteTexture(this.glTex)}}class eZ extends Error{static{w(this,"KaboomError")}constructor(t){super(t),this.name="KaboomError"}}class e${static{w(this,"TexPacker")}tex;canvas;ctx;x=0;y=0;curHeight=0;constructor(t,n){this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=n,this.tex=eW.fromImage(this.canvas),this.ctx=this.canvas.getContext("2d")}add(t){if(t.width>this.canvas.width||t.height>this.canvas.height)throw new eZ(`Texture size (${t.width} x ${t.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+t.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+t.height>this.canvas.height&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.tex=eW.fromImage(this.canvas),this.x=0,this.y=0,this.curHeight=0);let n=new E(this.x,this.y);return this.x+=t.width,t.height>this.curHeight&&(this.curHeight=t.height),t instanceof ImageData?this.ctx.putImageData(t,n.x,n.y):this.ctx.drawImage(t,n.x,n.y),this.tex.update(this.canvas),[this.tex,new T(n.x/this.canvas.width,n.y/this.canvas.height,t.width/this.canvas.width,t.height/this.canvas.height)]}}class e0{static{w(this,"FrameBuffer")}tex;glFrameBuffer;glRenderBuffer;constructor(t,n,s={}){this.tex=new eW(t,n,s),this.glFrameBuffer=e_.createFramebuffer(),this.glRenderBuffer=e_.createRenderbuffer(),eJ.push(()=>this.free()),this.bind(),e_.renderbufferStorage(e_.RENDERBUFFER,e_.DEPTH_STENCIL,t,n),e_.framebufferTexture2D(e_.FRAMEBUFFER,e_.COLOR_ATTACHMENT0,e_.TEXTURE_2D,this.tex.glTex,0),e_.framebufferRenderbuffer(e_.FRAMEBUFFER,e_.DEPTH_STENCIL_ATTACHMENT,e_.RENDERBUFFER,this.glRenderBuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}bind(){e_.bindFramebuffer(e_.FRAMEBUFFER,this.glFrameBuffer),e_.bindRenderbuffer(e_.RENDERBUFFER,this.glRenderBuffer)}unbind(){e_.bindFramebuffer(e_.FRAMEBUFFER,null),e_.bindRenderbuffer(e_.RENDERBUFFER,null)}free(){e_.deleteFramebuffer(this.glFrameBuffer),e_.deleteRenderbuffer(this.glRenderBuffer),this.tex.free()}}let e1=(s=tI(eH,eL),o=eW.fromImage(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),r=t.width&&t.height?new e0(t.width*eE*ev,t.height*eE*ev):new e0(e_.drawingBufferWidth,e_.drawingBufferHeight),l=null,d=1,t.background&&(l=k.fromArray(t.background),d=t.background[3]??1,e_.clearColor(l.r/255,l.g/255,l.b/255,d)),e_.enable(e_.BLEND),e_.enable(e_.SCISSOR_TEST),e_.blendFuncSeparate(e_.SRC_ALPHA,e_.ONE_MINUS_SRC_ALPHA,e_.ONE,e_.ONE_MINUS_SRC_ALPHA),c=e_.createBuffer(),e_.bindBuffer(e_.ARRAY_BUFFER,c),e_.bufferData(e_.ARRAY_BUFFER,4*eD,e_.DYNAMIC_DRAW),eF.reduce((t,n,s)=>(e_.vertexAttribPointer(s,n.size,e_.FLOAT,!1,4*eI,t),e_.enableVertexAttribArray(s),t+4*n.size),0),e_.bindBuffer(e_.ARRAY_BUFFER,null),f=e_.createBuffer(),e_.bindBuffer(e_.ELEMENT_ARRAY_BUFFER,f),e_.bufferData(e_.ELEMENT_ARRAY_BUFFER,49152,e_.DYNAMIC_DRAW),e_.bindBuffer(e_.ELEMENT_ARRAY_BUFFER,null),g=eW.fromImage(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"}),{drawCalls:0,lastDrawCalls:0,defShader:s,curShader:s,frameBuffer:r,postShader:null,postShaderUniform:null,defTex:o,curTex:o,curUniform:{},vbuf:c,ibuf:f,vqueue:[],iqueue:[],transform:new B,transformStack:[],bgTex:g,bgColor:l,bgAlpha:d,width:t.width??e_.drawingBufferWidth/eE/ev,height:t.height??e_.drawingBufferHeight/eE/ev,viewport:{x:0,y:0,width:e_.drawingBufferWidth,height:e_.drawingBufferHeight},fixed:!1});class e2{static{w(this,"SpriteData")}tex;frames=[new T(0,0,1,1)];anims={};slice9=null;constructor(t,n,s={},o=null){this.tex=t,n&&(this.frames=n),this.anims=s,this.slice9=o}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(t,n={}){return"string"==typeof t?e2.fromURL(t,n):Promise.resolve(e2.fromImage(t,n))}static fromImage(t,n={}){let[s,o]=e6.packer.add(t);return new e2(s,n.frames?n.frames.map(t=>new T(o.x+t.x*o.w,o.y+t.y*o.h,t.w*o.w,t.h*o.h)):tu(n.sliceX||1,n.sliceY||1,o.x,o.y,o.w,o.h),n.anims,n.slice9)}static fromURL(t,n={}){return tr(t).then(t=>e2.fromImage(t,n))}}class e5{static{w(this,"SoundData")}buf;constructor(t){this.buf=t}static fromArrayBuffer(t){return new Promise((n,s)=>e4.ctx.decodeAudioData(t,n,s)).then(t=>new e5(t))}static fromURL(t){return em(t)?e5.fromArrayBuffer(ed(t)):to(t).then(t=>e5.fromArrayBuffer(t))}}let e4=((N=(y=new(window.AudioContext||window.webkitAudioContext)).createGain()).connect(y.destination),K=new e5(eq(y)),y.decodeAudioData(eR.buffer.slice(0)).then(t=>{K.buf=t}).catch(t=>{console.error("Failed to load burp: ",t)}),{ctx:y,masterNode:N,burpSnd:K});class e3{static{w(this,"Asset")}loaded=!1;data=null;error=null;onLoadEvents=new er;onErrorEvents=new er;onFinishEvents=new er;constructor(t){t.then(t=>{this.data=t,this.onLoadEvents.trigger(t)}).catch(t=>{if(this.error=t,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(t);else throw t}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(t){let n=new e3(Promise.resolve(t));return n.data=t,n.loaded=!0,n}onLoad(t){return this.loaded&&this.data?t(this.data):this.onLoadEvents.add(t),this}onError(t){return this.loaded&&this.error?t(this.error):this.onErrorEvents.add(t),this}onFinish(t){return this.loaded?t():this.onFinishEvents.add(t),this}then(t){return this.onLoad(t)}catch(t){return this.onError(t)}finally(t){return this.onFinish(t)}}class e8{static{w(this,"AssetBucket")}assets=new Map;lastUID=0;add(t,n){let s=t??this.lastUID+++"",o=new e3(n);return this.assets.set(s,o),o}addLoaded(t,n){let s=t??this.lastUID+++"",o=e3.loaded(n);return this.assets.set(s,o),o}get(t){return this.assets.get(t)}progress(){if(0===this.assets.size)return 1;let t=0;return this.assets.forEach(n=>{n.loaded&&t++}),t/this.assets.size}}let e6={urlPrefix:"",sprites:new e8,fonts:new e8,bitmapFonts:new e8,sounds:new e8,shaders:new e8,custom:new e8,packer:new e$(2048,2048),loaded:!1},e9={events:new ea,objEvents:new ea,root:nb([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new E(1),angle:0,shake:0,transform:new B}};function e7(t){return e6.custom.add(null,t)}function te(){let t=[e6.sprites,e6.sounds,e6.shaders,e6.fonts,e6.bitmapFonts,e6.custom];return t.reduce((t,n)=>t+n.progress(),0)/t.length}function tt(t){return void 0!==t&&(e6.urlPrefix=t),e6.urlPrefix}function tn(t){let n=e6.urlPrefix+t;return fetch(n).then(t=>{if(!t.ok)throw new eZ(`Failed to fetch "${n}"`);return t})}function ti(t){return tn(t).then(t=>t.json())}function ts(t){return tn(t).then(t=>t.text())}function to(t){return tn(t).then(t=>t.arrayBuffer())}function tr(t){let n=new Image;return n.crossOrigin="anonymous",n.src=em(t)?t:e6.urlPrefix+t,new Promise((s,o)=>{n.onload=()=>s(n),n.onerror=()=>o(new eZ(`Failed to load image from "${t}"`))})}function ta(t,n){return e6.custom.add(t,ti(n))}w(e7,"load"),w(te,"loadProgress"),w(tt,"loadRoot"),w(tn,"fetchURL"),w(ti,"fetchJSON"),w(ts,"fetchText"),w(to,"fetchArrayBuffer"),w(tr,"loadImg"),w(ta,"loadJSON");class tl{static{w(this,"FontData")}fontface;filter=eB;outline=null;constructor(t,n={}){this.fontface=t,this.filter=n.filter??eB,n.outline&&(this.outline={width:1,color:R(0,0,0)},"number"==typeof n.outline?this.outline.width=n.outline:"object"==typeof n.outline&&(n.outline.width&&(this.outline.width=n.outline.width),n.outline.color&&(this.outline.color=n.outline.color)))}}function th(t,n,s={}){let o=new FontFace(t,"string"==typeof n?`url(${n})`:n);return document.fonts.add(o),e6.fonts.add(t,o.load().catch(t=>{throw new eZ(`Failed to load font from "${n}": ${t}`)}).then(t=>new tl(t,s)))}function td(t,n,s,o,r={}){return e6.bitmapFonts.add(t,tr(n).then(t=>tD(eW.fromImage(t,r),s,o,r.chars??eP)))}function tu(t=1,n=1,s=0,o=0,r=1,l=1){let d=[],c=r/t,f=l/n;for(let r=0;r<n;r++)for(let n=0;n<t;n++)d.push(new T(s+n*c,o+r*f,c,f));return d}function tc(t,n){return e7("string"==typeof n?new Promise((s,o)=>{ti(n).then(n=>{tc(t,n).then(s).catch(o)})}):e2.from(t).then(t=>{let s={};for(let o in n){let r=n[o],l=t.frames[0],d=2048*l.w,c=2048*l.h,f=r.frames?r.frames.map(t=>new T(l.x+(r.x+t.x)/d*l.w,l.y+(r.y+t.y)/c*l.h,t.w/d*l.w,t.h/c*l.h)):tu(r.sliceX||1,r.sliceY||1,l.x+r.x/d*l.w,l.y+r.y/c*l.h,r.width/d*l.w,r.height/c*l.h),g=new e2(t.tex,f,r.anims);e6.sprites.addLoaded(o,g),s[o]=g}return s}))}function tp(t,n={}){let s=document.createElement("canvas"),o=t[0].width,r=t[0].height;s.width=o*t.length,s.height=r;let l=s.getContext("2d");t.forEach((t,n)=>{t instanceof ImageData?l.putImageData(t,n*o,0):l.drawImage(t,n*o,0)});let d=l.getImageData(0,0,t.length*o,r);return e2.fromImage(d,{...n,sliceX:t.length,sliceY:1})}function tf(t,n,s={sliceX:1,sliceY:1,anims:{}}){return Array.isArray(n)?n.some(t=>"string"==typeof t)?e6.sprites.add(t,Promise.all(n.map(t=>"string"==typeof t?tr(t):Promise.resolve(t))).then(t=>tp(t,s))):e6.sprites.addLoaded(t,tp(n,s)):"string"==typeof n?e6.sprites.add(t,e2.from(n,s)):e6.sprites.addLoaded(t,e2.fromImage(n,s))}function tm(t,n){return e6.sprites.add(t,new Promise(async t=>{let s="string"==typeof n?await ti(n):n,o=await Promise.all(s.frames.map(tr)),r=document.createElement("canvas");r.width=s.width,r.height=s.height*s.frames.length;let l=r.getContext("2d");o.forEach((t,n)=>{l.drawImage(t,0,n*s.height)}),t(await tf(null,r,{sliceY:s.frames.length,anims:s.anims}))}))}function tg(t,n,s){"string"!=typeof n||s||(s=n.replace(RegExp(`${eg(n)}$`),"json"));let o="string"==typeof s?ti(s):Promise.resolve(s);return e6.sprites.add(t,o.then(t=>{let s=t.meta.size,o=t.frames.map(t=>new T(t.frame.x/s.w,t.frame.y/s.h,t.frame.w/s.w,t.frame.h/s.h)),r={};for(let n of t.meta.frameTags)n.from===n.to?r[n.name]=n.from:r[n.name]={from:n.from,to:n.to,speed:10,loop:!0,pingpong:"pingpong"===n.direction};return e2.from(n,{frames:o,anims:r})}))}function tw(t,n,s){return e6.shaders.addLoaded(t,tI(n,s))}function ty(t,n,s){let o=w(t=>t?ts(t):Promise.resolve(null),"resolveUrl"),r=Promise.all([o(n),o(s)]).then(([t,n])=>tI(t,n));return e6.shaders.add(t,r)}function tA(t,n){return e6.sounds.add(t,"string"==typeof n?e5.fromURL(n):e5.fromArrayBuffer(n))}function tv(t="bean"){return tf(t,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==")}function tV(t){return e6.sprites.get(t)}function tx(t){return e6.sounds.get(t)}function tb(t){return e6.fonts.get(t)}function tS(t){return e6.bitmapFonts.get(t)}function tE(t){return e6.shaders.get(t)}function tM(t){return e6.custom.get(t)}function tk(t){if("string"==typeof t){let n=tV(t);if(n)return n;if(1>te())return null;throw new eZ(`Sprite not found: ${t}`)}if(t instanceof e2)return e3.loaded(t);if(t instanceof e3)return t;throw new eZ(`Invalid sprite: ${t}`)}function tR(t){if("string"==typeof t){let n=tx(t);if(n)return n;if(1>te())return null;throw new eZ(`Sound not found: ${t}`)}if(t instanceof e5)return e3.loaded(t);if(t instanceof e3)return t;throw new eZ(`Invalid sound: ${t}`)}function tP(t){if(!t)return e1.defShader;if("string"==typeof t){let n=tE(t);if(n)return n.data??n;if(1>te())return null;throw new eZ(`Shader not found: ${t}`)}return t instanceof e3&&t.data?t.data:t}function tT(n){if(!n)return tT(t.font??"monospace");if("string"==typeof n){let t=tS(n),s=tb(n);if(t)return t.data??t;if(s)return s.data??s;if(document.fonts.check(`64px ${n}`))return n;if(1>te())return null;throw new eZ(`Font not found: ${n}`)}return n instanceof e3&&n.data?n.data:n}function tC(t){return void 0!==t&&(e4.masterNode.gain.value=t),e4.masterNode.gain.value}function tB(t,n={}){let s=e4.ctx,o=n.paused??!1,r=s.createBufferSource(),l=new er,d=s.createGain(),c=n.seek??0,f=0,g=0,y=!1;r.loop=!!n.loop,r.detune.value=n.detune??0,r.playbackRate.value=n.speed??1,r.connect(d),r.onended=()=>{V()>=r.buffer?.duration&&l.trigger()},d.connect(e4.masterNode),d.gain.value=n.volume??1;let A=w(t=>{r.buffer=t.buf,o||(f=s.currentTime,r.start(0,c),y=!0)},"start"),v=tR(t);v instanceof e3&&v.onLoad(A);let V=w(()=>{if(!r.buffer)return 0;let t=o?g-f:s.currentTime-f,n=r.buffer.duration;return r.loop?t%n:Math.min(t,n)},"getTime"),x=w(t=>{let n=s.createBufferSource();return n.buffer=t.buffer,n.loop=t.loop,n.playbackRate.value=t.playbackRate.value,n.detune.value=t.detune.value,n.onended=t.onended,n.connect(d),n},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(D){if(o!==D)if(o=D,D)y&&(r.stop(),y=!1),g=s.currentTime;else{r=x(r);let t=g-f;r.start(0,t),y=!0,f=s.currentTime-t,g=0}},get paused(){return o},play(t=0){this.seek(t),this.paused=!1},seek(t){r.buffer?.duration&&(t>r.buffer.duration||(o?(r=x(r),f=g-t):(r.stop(),r=x(r),f=s.currentTime-t,r.start(0,t),y=!0,g=0)))},set speed(D){r.playbackRate.value=D},get speed(){return r.playbackRate.value},set detune(D){r.detune.value=D},get detune(){return r.detune.value},set volume(D){d.gain.value=Math.max(D,0)},get volume(){return d.gain.value},set loop(D){r.loop=D},get loop(){return r.loop},duration:()=>r.buffer?.duration??0,time(){return V()%this.duration()},onEnd:t=>l.add(t),then(t){return this.onEnd(t)}}}function tF(t){return tB(e4.burpSnd,t)}function tI(t=eH,n=eL){let s=eN.replace("{{user}}",t??eH),o=eU.replace("{{user}}",n??eL),r=e_.createShader(e_.VERTEX_SHADER),l=e_.createShader(e_.FRAGMENT_SHADER);e_.shaderSource(r,s),e_.shaderSource(l,o),e_.compileShader(r),e_.compileShader(l);let d=e_.createProgram();if(eJ.push(()=>e_.deleteProgram(d)),e_.attachShader(d,r),e_.attachShader(d,l),e_.bindAttribLocation(d,0,"a_pos"),e_.bindAttribLocation(d,1,"a_uv"),e_.bindAttribLocation(d,2,"a_color"),e_.linkProgram(d),!e_.getProgramParameter(d,e_.LINK_STATUS)){let t=w(t=>{let n=t.match(/^ERROR:\s0:(?<line>\d+):\s(?<msg>.+)/);return{line:Number(n.groups.line),msg:n.groups.msg.replace(/\n\0$/,"")}},"formatShaderError"),n=e_.getShaderInfoLog(r),s=e_.getShaderInfoLog(l),o="";if(n){let s=t(n);o+=`Vertex shader line ${s.line-14}: ${s.msg}`}if(s){let n=t(s);o+=`Fragment shader line ${n.line-14}: ${n.msg}`}throw new eZ(o)}return e_.deleteShader(r),e_.deleteShader(l),{bind(){e_.useProgram(d)},unbind(){e_.useProgram(null)},free(){e_.deleteProgram(d)},send(t){for(let n in t){let s=t[n],o=e_.getUniformLocation(d,n);"number"==typeof s?e_.uniform1f(o,s):s instanceof B?e_.uniformMatrix4fv(o,!1,new Float32Array(s.m)):s instanceof k?e_.uniform3f(o,s.r,s.g,s.b):s instanceof E&&e_.uniform2f(o,s.x,s.y)}}}}function tD(t,n,s,o){let r=t.width/n,l={};for(let[t,d]of o.split("").entries())l[d]=new T(t%r*n,Math.floor(t/r)*s,n,s);return{tex:t,map:l,size:s}}function tN(t,n,s,o=e1.defTex,r=e1.defShader,l={}){let d=tP(r);if(!d||d instanceof e3)return;(o!==e1.curTex||d!==e1.curShader||!el(e1.curUniform,l)||e1.vqueue.length+t.length*eI>eD||e1.iqueue.length+n.length>12288)&&tU();let c=e1.fixed||s?e1.transform:e9.cam.transform.mult(e1.transform);for(let n of t){let t=tO(c.multVec2(n.pos));e1.vqueue.push(t.x,t.y,n.uv.x,n.uv.y,n.color.r/255,n.color.g/255,n.color.b/255,n.opacity)}for(let s of n)e1.iqueue.push(s+e1.vqueue.length/eI-t.length);e1.curTex=o,e1.curShader=d,e1.curUniform=l}function tU(){!e1.curTex||!e1.curShader||0===e1.vqueue.length||0===e1.iqueue.length||(e_.bindBuffer(e_.ARRAY_BUFFER,e1.vbuf),e_.bufferSubData(e_.ARRAY_BUFFER,0,new Float32Array(e1.vqueue)),e_.bindBuffer(e_.ELEMENT_ARRAY_BUFFER,e1.ibuf),e_.bufferSubData(e_.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(e1.iqueue)),e1.curShader.bind(),e1.curShader.send(e1.curUniform),e1.curTex.bind(),e_.drawElements(e_.TRIANGLES,e1.iqueue.length,e_.UNSIGNED_SHORT,0),e1.curTex.unbind(),e1.curShader.unbind(),e_.bindBuffer(e_.ARRAY_BUFFER,null),e_.bindBuffer(e_.ELEMENT_ARRAY_BUFFER,null),e1.vqueue.length=0,e1.iqueue.length=0,e1.drawCalls++)}function tH(){e_.clear(e_.COLOR_BUFFER_BIT),e1.frameBuffer.bind(),e_.viewport(0,0,e1.frameBuffer.width,e1.frameBuffer.height),e_.clear(e_.COLOR_BUFFER_BIT),e1.bgColor||t7(()=>{tX({width:na(),height:nl(),quad:new T(0,0,na()/64,nl()/64),tex:e1.bgTex,fixed:!0})}),e1.drawCalls=0,e1.fixed=!1,e1.transformStack.length=0,e1.transform=new B}function tL(t,n){e1.postShader=t,e1.postShaderUniform=n??null}function tG(){tU(),e1.frameBuffer.unbind(),e_.viewport(0,0,e_.drawingBufferWidth,e_.drawingBufferHeight),tU();let t=e1.width,n=e1.height;e1.width=e_.drawingBufferWidth/eE,e1.height=e_.drawingBufferHeight/eE,tJ({flipY:!0,tex:e1.frameBuffer.tex,pos:new E(e1.viewport.x,e1.viewport.y),width:e1.viewport.width,height:e1.viewport.height,shader:e1.postShader,uniform:"function"==typeof e1.postShaderUniform?e1.postShaderUniform():e1.postShaderUniform,fixed:!0}),tU(),e1.width=t,e1.height=n,e1.lastDrawCalls=e1.drawCalls}function tO(t){return new E(t.x/na()*2-1,-t.y/nl()*2+1)}function tj(t){e1.transform=t.clone()}function tK(...t){if(void 0===t[0])return;let n=M(...t);0===n.x&&0===n.y||e1.transform.translate(n)}function tq(...t){if(void 0===t[0])return;let n=M(...t);1===n.x&&1===n.y||e1.transform.scale(n)}function tY(t){t&&e1.transform.rotate(t)}function tz(){e1.transformStack.push(e1.transform.clone())}function tQ(){e1.transformStack.length>0&&(e1.transform=e1.transformStack.pop())}function tX(t){if(void 0===t.width||void 0===t.height)throw new eZ('drawUVQuad() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let n=t.width,s=t.height,o=ej(t.anchor||eT).scale(new E(n,s).scale(-.5)),r=t.quad||new T(0,0,1,1),l=t.color||R(255,255,255),d=t.opacity??1,c=t.tex?.1/t.tex.width:0,f=t.tex?.1/t.tex.height:0,g=r.x+c,w=r.y+f,y=r.w-2*c,A=r.h-2*f;tz(),tK(t.pos),tY(t.angle),tq(t.scale),tK(o),tN([{pos:new E(-n/2,s/2),uv:new E(t.flipX?g+y:g,t.flipY?w:w+A),color:l,opacity:d},{pos:new E(-n/2,-s/2),uv:new E(t.flipX?g+y:g,t.flipY?w+A:w),color:l,opacity:d},{pos:new E(n/2,-s/2),uv:new E(t.flipX?g:g+y,t.flipY?w+A:w),color:l,opacity:d},{pos:new E(n/2,s/2),uv:new E(t.flipX?g:g+y,t.flipY?w:w+A),color:l,opacity:d}],[0,1,3,1,2,3],t.fixed,t.tex,t.shader,t.uniform),tQ()}function tJ(t){if(!t.tex)throw new eZ('drawTexture() requires property "tex".');let n=t.quad??new T(0,0,1,1),s=t.tex.width*n.w,o=t.tex.height*n.h,r=new E(1);if(t.tiled){let l=Math.ceil((t.width||s)/s),d=Math.ceil((t.height||o)/o),c=ej(t.anchor||eT).add(new E(1,1)).scale(.5).scale(l*s,d*o);for(let f=0;f<l;f++)for(let l=0;l<d;l++)tX(Object.assign({},t,{pos:(t.pos||new E(0)).add(new E(s*f,o*l)).sub(c),scale:r.scale(t.scale||new E(1)),tex:t.tex,quad:n,width:s,height:o,anchor:"topleft"}))}else t.width&&t.height?(r.x=t.width/s,r.y=t.height/o):t.width?(r.x=t.width/s,r.y=r.x):t.height&&(r.y=t.height/o,r.x=r.y),tX(Object.assign({},t,{scale:r.scale(t.scale||new E(1)),tex:t.tex,quad:n,width:s,height:o}))}function t_(t){if(!t.sprite)throw new eZ('drawSprite() requires property "sprite"');let n=tk(t.sprite);if(!n||!n.data)return;let s=n.data.frames[t.frame??0];if(!s)throw new eZ(`Frame not found: ${t.frame??0}`);tJ(Object.assign({},t,{tex:n.data.tex,quad:s.scale(t.quad??new T(0,0,1,1))}))}function tW(t,n,s,o,r,l=1){o=A(o%360),(r=A(r%360))<=o&&(r+=2*Math.PI);let d=[],c=Math.ceil((r-o)/A(8)*l),f=(r-o)/c;for(let l=o;l<r;l+=f)d.push(t.add(n*Math.cos(l),s*Math.sin(l)));return d.push(t.add(n*Math.cos(r),s*Math.sin(r))),d}function tZ(t){if(void 0===t.width||void 0===t.height)throw new eZ('drawRect() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let n=t.width,s=t.height,o=ej(t.anchor||eT).add(1,1).scale(new E(n,s).scale(-.5)),r=[new E(0,0),new E(n,0),new E(n,s),new E(0,s)];if(t.radius){let o=Math.min(Math.min(n,s)/2,t.radius);r=[new E(o,0),new E(n-o,0),...tW(new E(n-o,o),o,o,270,360),new E(n,o),new E(n,s-o),...tW(new E(n-o,s-o),o,o,0,90),new E(n-o,s),new E(o,s),...tW(new E(o,s-o),o,o,90,180),new E(0,s-o),new E(0,o),...tW(new E(o,o),o,o,180,270)]}t4(Object.assign({},t,{offset:o,pts:r,...t.gradient?{colors:t.horizontal?[t.gradient[0],t.gradient[1],t.gradient[1],t.gradient[0]]:[t.gradient[0],t.gradient[0],t.gradient[1],t.gradient[1]]}:{}}))}function t$(t){let{p1:n,p2:s}=t;if(!n||!s)throw new eZ('drawLine() requires properties "p1" and "p2".');let o=t.width||1,r=s.sub(n).unit().normal().scale(.5*o);tN([n.sub(r),n.add(r),s.add(r),s.sub(r)].map(n=>({pos:new E(n.x,n.y),uv:new E(0),color:t.color??k.WHITE,opacity:t.opacity??1})),[0,1,3,1,2,3],t.fixed,e1.defTex,t.shader,t.uniform)}function t0(t){let n=t.pts;if(!n)throw new eZ('drawLines() requires property "pts".');if(!(n.length<2))if(t.radius&&n.length>=3){let s=n[0].sdist(n[1]);for(let t=1;t<n.length-1;t++)s=Math.min(n[t].sdist(n[t+1]),s);t.radius,t$(Object.assign({},t,{p1:n[0],p2:n[1]}));for(let s=1;s<n.length-2;s++)t$(Object.assign({},t,{p1:n[s],p2:n[s+1]}));t$(Object.assign({},t,{p1:n[n.length-2],p2:n[n.length-1]}))}else for(let s=0;s<n.length-1;s++)t$(Object.assign({},t,{p1:n[s],p2:n[s+1]})),"none"!==t.join&&t2(Object.assign({},t,{pos:n[s],radius:t.width/2}))}function t1(t){if(!t.p1||!t.p2||!t.p3)throw new eZ('drawPolygon() requires properties "p1", "p2" and "p3".');return t4(Object.assign({},t,{pts:[t.p1,t.p2,t.p3]}))}function t2(t){if("number"!=typeof t.radius)throw new eZ('drawCircle() requires property "radius".');0!==t.radius&&t5(Object.assign({},t,{radiusX:t.radius,radiusY:t.radius,angle:0}))}function t5(t){if(void 0===t.radiusX||void 0===t.radiusY)throw new eZ('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===t.radiusX||0===t.radiusY)return;let n=t.start??0,s=t.end??360,o=ej(t.anchor??"center").scale(new E(-t.radiusX,-t.radiusY)),r=tW(o,t.radiusX,t.radiusY,n,s,t.resolution);r.unshift(o);let l=Object.assign({},t,{pts:r,radius:0,...t.gradient?{colors:[t.gradient[0],...Array(r.length-1).fill(t.gradient[1])]}:{}});if(s-n>=360&&t.outline){!1!==t.fill&&t4(Object.assign(l,{outline:null})),t4(Object.assign(l,{pts:r.slice(1),fill:!1}));return}t4(l)}function t4(t){if(!t.pts)throw new eZ('drawPolygon() requires property "pts".');let n=t.pts.length;if(!(n<3)){if(tz(),tK(t.pos),tq(t.scale),tY(t.angle),tK(t.offset),!1!==t.fill){let s=t.color??k.WHITE,o=t.pts.map((n,o)=>({pos:new E(n.x,n.y),uv:new E(0,0),color:t.colors?t.colors[o]??s:s,opacity:t.opacity??1})),r=[...Array(n-2).keys()].map(t=>[0,t+1,t+2]).flat();tN(o,t.indices??r,t.fixed,e1.defTex,t.shader,t.uniform)}t.outline&&t0({pts:[...t.pts,t.pts[0]],radius:t.radius,width:t.outline.width,color:t.outline.color,join:t.outline.join,uniform:t.uniform,fixed:t.fixed,opacity:t.opacity}),tQ()}}function t3(t,n,s){tU(),e_.clear(e_.STENCIL_BUFFER_BIT),e_.enable(e_.STENCIL_TEST),e_.stencilFunc(e_.NEVER,1,255),e_.stencilOp(e_.REPLACE,e_.REPLACE,e_.REPLACE),n(),tU(),e_.stencilFunc(s,1,255),e_.stencilOp(e_.KEEP,e_.KEEP,e_.KEEP),t(),tU(),e_.disable(e_.STENCIL_TEST)}function t8(t,n){t3(t,n,e_.EQUAL)}function t6(t,n){t3(t,n,e_.NOTEQUAL)}function t9(){return(e1.viewport.width+e1.viewport.height)/(e1.width+e1.height)}function t7(t){tU();let n=e1.width,s=e1.height;e1.width=e1.viewport.width,e1.height=e1.viewport.height,t(),tU(),e1.width=n,e1.height=s}function ne(t,n){n.pos&&(t.pos=t.pos.add(n.pos)),n.scale&&(t.scale=t.scale.scale(M(n.scale))),n.angle&&(t.angle+=n.angle),n.color&&(t.color=t.color.mult(n.color)),n.opacity&&(t.opacity*=n.opacity)}w(th,"loadFont"),w(td,"loadBitmapFont"),w(tu,"slice"),w(tc,"loadSpriteAtlas"),w(tp,"createSpriteSheet"),w(tf,"loadSprite"),w(tm,"loadPedit"),w(tg,"loadAseprite"),w(tw,"loadShader"),w(ty,"loadShaderURL"),w(tA,"loadSound"),w(tv,"loadBean"),w(tV,"getSprite"),w(tx,"getSound"),w(tb,"getFont"),w(tS,"getBitmapFont"),w(tE,"getShader"),w(tM,"getAsset"),w(tk,"resolveSprite"),w(tR,"resolveSound"),w(tP,"resolveShader"),w(tT,"resolveFont"),w(tC,"volume"),w(tB,"play"),w(tF,"burp"),w(tI,"makeShader"),w(tD,"makeFont"),w(tN,"drawRaw"),w(tU,"flush"),w(tH,"frameStart"),w(tL,"usePostEffect"),w(tG,"frameEnd"),w(tO,"screen2ndc"),w(tj,"pushMatrix"),w(tK,"pushTranslate"),w(tq,"pushScale"),w(tY,"pushRotate"),w(tz,"pushTransform"),w(tQ,"popTransform"),w(tX,"drawUVQuad"),w(tJ,"drawTexture"),w(t_,"drawSprite"),w(tW,"getArcPts"),w(tZ,"drawRect"),w(t$,"drawLine"),w(t0,"drawLines"),w(t1,"drawTriangle"),w(t2,"drawCircle"),w(t5,"drawEllipse"),w(t4,"drawPolygon"),w(t3,"drawStenciled"),w(t8,"drawMasked"),w(t6,"drawSubtracted"),w(t9,"getViewportScale"),w(t7,"drawUnscaled"),w(ne,"applyCharTransform");let nt=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function nn(t){let n={},s=t.replace(nt,"$2"),o=0;for(let s of t.matchAll(nt)){let t=s.index-o;for(let o=0;o<s.groups.text.length;o++)n[o+t]=[s.groups.style];o+=s[0].length-s.groups.text.length}return{charStyleMap:n,text:s}}w(nn,"compileStyledText");let ni={};function ns(t){if(void 0===t.text)throw new eZ('formatText() requires property "text".');let n=tT(t.font);if(""===t.text||n instanceof e3||!n)return{width:0,height:0,chars:[],opt:t};let{charStyleMap:s,text:o}=nn(t.text+""),r=o.split("");if(n instanceof tl||"string"==typeof n){let t=n instanceof tl?n.fontface.family:n,s=n instanceof tl?{outline:n.outline,filter:n.filter}:{outline:null,filter:eB},o=ni[t]??{font:{tex:new eW(2048,2048,{filter:s.filter}),map:{},size:64},cursor:new E(0),outline:s.outline};for(let s of(ni[t]||(ni[t]=o),n=o.font,r))if(!o.font.map[s]){eQ.clearRect(0,0,ez.width,ez.height),eQ.font=`${n.size}px ${t}`,eQ.textBaseline="top",eQ.textAlign="left",eQ.fillStyle="#ffffff";let r=Math.ceil(eQ.measureText(s).width),l=n.size;o.outline&&(eQ.lineJoin="round",eQ.lineWidth=2*o.outline.width,eQ.strokeStyle=o.outline.color.toHex(),eQ.strokeText(s,o.outline.width,o.outline.width),r+=2*o.outline.width,l+=3*o.outline.width),eQ.fillText(s,o.outline?.width??0,o.outline?.width??0);let d=eQ.getImageData(0,0,r,l);if(o.cursor.x+r>2048&&(o.cursor.x=0,o.cursor.y+=l,o.cursor.y>2048))throw new eZ("Font atlas exceeds character limit");n.tex.update(d,o.cursor.x,o.cursor.y),n.map[s]=new T(o.cursor.x,o.cursor.y,r,l),o.cursor.x+=r}}let l=t.size||n.size,d=M(t.scale??1).scale(l/n.size),c=t.lineSpacing??0,f=t.letterSpacing??0,g=0,w=0,y=0,A=[],v=[],V=0,x=null,b=null;for(;V<r.length;){let s=r[V];if(s===`
`)y+=l+c,A.push({width:g-f,chars:v}),x=null,b=null,g=0,v=[];else{let o=n.map[s];if(o){let S=o.w*d.x;t.width&&g+S>t.width&&(y+=l+c,null!=x&&(V-=v.length-x,s=r[V],S=(o=n.map[s]).w*d.x,v=v.slice(0,x-1),g=b),x=null,b=null,A.push({width:g-f,chars:v}),g=0,v=[]),v.push({tex:n.tex,width:o.w,height:o.h,quad:new T(o.x/n.tex.width,o.y/n.tex.height,o.w/n.tex.width,o.h/n.tex.height),ch:s,pos:new E(g,y),opacity:t.opacity??1,color:t.color??k.WHITE,scale:M(d),angle:0})," "===s&&(x=v.length,b=g),g+=S,w=Math.max(w,g),g+=f}}V++}A.push({width:g-f,chars:v}),y+=l,t.width&&(w=t.width);let S=[];for(let o of A){let r=(w-o.width)*eK(t.align??"left");for(let l of o.chars){let o=n.map[l.ch],c=S.length;if(l.pos=l.pos.add(r,0).add(o.w*d.x*.5,o.h*d.y*.5),t.transform){let n="function"==typeof t.transform?t.transform(c,l.ch):t.transform;n&&ne(l,n)}if(s[c])for(let n of s[c]){let s=t.styles[n],o="function"==typeof s?s(c,l.ch):s;o&&ne(l,o)}S.push(l)}}return{width:w,height:y,chars:S,opt:t}}function no(t){nr(ns(t))}function nr(t){tz(),tK(t.opt.pos),tY(t.opt.angle),tK(ej(t.opt.anchor??"topleft").add(1,1).scale(t.width,t.height).scale(-.5)),t.chars.forEach(n=>{tX({tex:n.tex,width:n.width,height:n.height,pos:n.pos,scale:n.scale,angle:n.angle,color:n.color,opacity:n.opacity,quad:n.quad,anchor:"center",uniform:t.opt.uniform,shader:t.opt.shader,fixed:t.opt.fixed})}),tQ()}function na(){return e1.width}function nl(){return e1.height}w(ns,"formatText"),w(no,"drawText"),w(nr,"drawFormattedText"),w(na,"width"),w(nl,"height");let nh={};function nd(t){return new E((t.x-e1.viewport.x)*na()/e1.viewport.width,(t.y-e1.viewport.y)*nl()/e1.viewport.height)}function nu(t){return new E(t.x*e1.viewport.width/e1.width,t.y*e1.viewport.height/e1.height)}function nc(){return nd(eX.mousePos())}for(let t in w(nd,"windowToContent"),w(nu,"contentToView"),w(nc,"mousePos"),nh.error=t=>{t.error&&t.error instanceof eZ?iz(t.error):t instanceof eZ&&iz(t)},nh.unhandledrejection=t=>{t.reason instanceof eZ&&iz(t.reason)},nh)window.addEventListener(t,nh[t]);let np=!1,nf={inspect:!1,timeScale:1,showLog:!0,fps:()=>eX.fps(),numFrames:()=>eX.numFrames(),stepFrame:iN,drawCalls:()=>e1.drawCalls,clearLog:()=>e9.logs=[],log:n=>{let s=t.logMax??8;e9.logs.unshift({msg:n,time:eX.time()}),e9.logs.length>s&&(e9.logs=e9.logs.slice(0,s))},error:t=>nf.log(new eZ(t.toString?t.toString():t)),curRecording:null,numObjects:()=>iC("*",{recursive:!0}).length,get paused(){return np},set paused(e){np=e,e?e4.ctx.suspend():e4.ctx.resume()}};function nm(){return eX.dt()*nf.timeScale}function ng(...t){return t.length>0&&(e9.cam.pos=M(...t)),e9.cam.pos?e9.cam.pos.clone():iV()}function nw(...t){return t.length>0&&(e9.cam.scale=M(...t)),e9.cam.scale.clone()}function ny(t){return void 0!==t&&(e9.cam.angle=t),e9.cam.angle}function nA(t=12){e9.cam.shake+=t}function nv(t){return e9.cam.transform.multVec2(t)}function nV(t){return e9.cam.transform.invert().multVec2(t)}function nx(t){let n=new B;return t.pos&&n.translate(t.pos),t.scale&&n.scale(t.scale),t.angle&&n.rotate(t.angle),t.parent?n.mult(t.parent.transform):n}function nb(t=[]){let n=new Map,s={},o=new ea,r=[],l=null,d=!1,c={id:ew(),hidden:!1,transform:new B,children:[],parent:null,set paused(h){if(h!==d)for(let t of(d=h,r))t.paused=h},get paused(){return d},add(t=[]){let n=Array.isArray(t)?nb(t):t;if(n.parent)throw new eZ("Cannot add a game obj that already has a parent.");return n.parent=this,n.transform=nx(n),this.children.push(n),n.trigger("add",n),e9.events.trigger("add",n),n},readd(t){let n=this.children.indexOf(t);return -1!==n&&(this.children.splice(n,1),this.children.push(t)),t},remove(t){let n=this.children.indexOf(t);if(-1!==n){t.parent=null,this.children.splice(n,1);let s=w(t=>{t.trigger("destroy"),e9.events.trigger("destroy",t),t.children.forEach(t=>s(t))},"trigger");s(t)}},removeAll(t){if(t)this.get(t).forEach(t=>this.remove(t));else for(let t of[...this.children])this.remove(t)},update(){this.paused||(this.children.sort((t,n)=>(t.z??0)-(n.z??0)).forEach(t=>t.update()),this.trigger("update"))},draw(){if(this.hidden)return;let t=e1.fixed;this.fixed&&(e1.fixed=!0),tz(),tK(this.pos),tq(this.scale),tY(this.angle);let n=this.children.sort((t,n)=>(t.z??0)-(n.z??0));if(this.mask){let t={intersect:t8,subtract:t6}[this.mask];if(!t)throw new eZ(`Invalid mask func: "${this.mask}"`);t(()=>{n.forEach(t=>t.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),n.forEach(t=>t.draw());tQ(),e1.fixed=t},drawInspect(){this.hidden||(tz(),tK(this.pos),tq(this.scale),tY(this.angle),this.children.sort((t,n)=>(t.z??0)-(n.z??0)).forEach(t=>t.drawInspect()),this.trigger("drawInspect"),tQ())},use(t){if(!t)return;if("string"==typeof t)return this.use({id:t});let o=[];for(let r in t.id&&(this.unuse(t.id),s[t.id]=[],o=s[t.id],n.set(t.id,t)),t){if(eG.has(r))continue;let n=Object.getOwnPropertyDescriptor(t,r);if("function"==typeof n.value&&(t[r]=t[r].bind(this)),n.set&&Object.defineProperty(t,r,{set:n.set.bind(this)}),n.get&&Object.defineProperty(t,r,{get:n.get.bind(this)}),eO.has(r)){let n="add"===r?()=>{l=w(t=>o.push(t),"onCurCompCleanup"),t[r](),l=null}:t[r];o.push(this.on(r,n).cancel)}else if(void 0===this[r])Object.defineProperty(this,r,{get:()=>t[r],set:n=>t[r]=n,configurable:!0,enumerable:!0}),o.push(()=>delete this[r]);else throw new eZ(`Duplicate component property: "${r}"`)}let r=w(()=>{if(t.require){for(let n of t.require)if(!this.c(n))throw new eZ(`Component "${t.id}" requires component "${n}"`)}},"checkDeps");t.destroy&&o.push(t.destroy.bind(this)),this.exists()?(r(),t.add&&(l=w(t=>o.push(t),"onCurCompCleanup"),t.add.call(this),l=null)):t.require&&o.push(this.on("add",r).cancel)},unuse(t){s[t]&&(s[t].forEach(t=>t()),delete s[t]),n.has(t)&&n.delete(t)},c:t=>n.get(t),get(t,n={}){let s=n.recursive?this.children.flatMap(w(function t(n){return[n,...n.children.flatMap(t)]},"recurse")):this.children;if(s=s.filter(n=>!t||n.is(t)),n.liveUpdate){let o=w(t=>n.recursive?this.isAncestorOf(t):t.parent===this,"isChild");nk(n=>{o(n)&&n.is(t)&&s.push(n)}),nR(n=>{if(o(n)&&n.is(t)){let t=s.findIndex(t=>t.id===n.id);-1!==t&&s.splice(t,1)}})}return s},isAncestorOf(t){return!!t.parent&&(t.parent===this||this.isAncestorOf(t.parent))},exists(){return e9.root.isAncestorOf(this)},is(t){if("*"===t)return!0;if(!Array.isArray(t))return null!=this.c(t);for(let n of t)if(!this.c(n))return!1;return!0},on(t,n){let s=o.on(t,n.bind(this));return l&&l(()=>s.cancel()),s},trigger(t,...n){o.trigger(t,...n),e9.objEvents.trigger(t,this,...n)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let t={};for(let[s,o]of n)t[s]=o.inspect?o.inspect():null;return t},onAdd(t){return this.on("add",t)},onUpdate(t){return this.on("update",t)},onDraw(t){return this.on("draw",t)},onDestroy(t){return this.on("destroy",t)},clearEvents(){o.clear()}};for(let t of["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"])c[t]=(...n)=>{let s=eX[t](...n);return r.push(s),c.onDestroy(()=>s.cancel()),s};for(let n of t)c.use(n);return c}function nS(t,n,s){return e9.objEvents[t]||(e9.objEvents[t]=new es),e9.objEvents.on(t,(t,...o)=>{t.is(n)&&s(t,...o)})}w(nm,"dt"),w(ng,"camPos"),w(nw,"camScale"),w(ny,"camRot"),w(nA,"shake"),w(nv,"toScreen"),w(nV,"toWorld"),w(nx,"calcTransform"),w(nb,"make"),w(nS,"on");let nE=w((t,n)=>{if("function"==typeof t&&void 0===n){let n=iR([{update:t}]);return{get paused(){return n.paused},set paused(i){n.paused=i},cancel:()=>n.destroy()}}if("string"==typeof t)return nS("update",t,n)},"onUpdate"),nM=w((t,n)=>{if("function"==typeof t&&void 0===n){let n=iR([{draw:t}]);return{get paused(){return n.hidden},set paused(i){n.hidden=i},cancel:()=>n.destroy()}}if("string"==typeof t)return nS("draw",t,n)},"onDraw");function nk(t,n){return"function"==typeof t&&void 0===n?e9.events.on("add",t):"string"==typeof t?nS("add",t,n):void 0}function nR(t,n){return"function"==typeof t&&void 0===n?e9.events.on("destroy",t):"string"==typeof t?nS("destroy",t,n):void 0}function nP(t,n,s){return nS("collide",t,(t,o,r)=>o.is(n)&&s(t,o,r))}function nT(t,n,s){return nS("collideUpdate",t,(t,o,r)=>o.is(n)&&s(t,o,r))}function nC(t,n,s){return nS("collideEnd",t,(t,o,r)=>o.is(n)&&s(t,o,r))}function nB(t,n){iC(t,{recursive:!0}).forEach(n),nk(t,n)}function nF(t,n){if("function"==typeof t)return eX.onMousePress(t);{let s=[];return nB(t,t=>{if(!t.area)throw new eZ("onClick() requires the object to have area() component");s.push(t.onClick(()=>n(t)))}),eo.join(s)}}function nI(t,n){let s=[];return nB(t,t=>{if(!t.area)throw new eZ("onHover() requires the object to have area() component");s.push(t.onHover(()=>n(t)))}),eo.join(s)}function nD(t,n){let s=[];return nB(t,t=>{if(!t.area)throw new eZ("onHoverUpdate() requires the object to have area() component");s.push(t.onHoverUpdate(()=>n(t)))}),eo.join(s)}function nN(t,n){let s=[];return nB(t,t=>{if(!t.area)throw new eZ("onHoverEnd() requires the object to have area() component");s.push(t.onHoverEnd(()=>n(t)))}),eo.join(s)}function nU(t,n){let s=0,o=[];n&&o.push(n);let r=nE(()=>{(s+=nm())>=t&&(r.cancel(),o.forEach(t=>t()))});return{paused:r.paused,cancel:r.cancel,onEnd(t){o.push(t)},then(t){return this.onEnd(t),this}}}function nH(t,n){let s=null,o=w(()=>{s=nU(t,o),n()},"newAction");return s=nU(0,o),{get paused(){return s.paused},set paused(a){s.paused=a},cancel:()=>s.cancel()}}function nL(){eX.onKeyPress("f1",()=>{nf.inspect=!nf.inspect}),eX.onKeyPress("f2",()=>{nf.clearLog()}),eX.onKeyPress("f8",()=>{nf.paused=!nf.paused}),eX.onKeyPress("f7",()=>{nf.timeScale=nJ(V(nf.timeScale-.2,0,2),1)}),eX.onKeyPress("f9",()=>{nf.timeScale=nJ(V(nf.timeScale+.2,0,2),1)}),eX.onKeyPress("f10",()=>{nf.stepFrame()})}function nG(){eX.onKeyPress("b",()=>tF())}function nO(t){e9.gravity=t}function nj(){return e9.gravity}function nK(...t){1===t.length||2===t.length?(e1.bgColor=R(t[0]),t[1]&&(e1.bgAlpha=t[1])):(3===t.length||4===t.length)&&(e1.bgColor=R(t[0],t[1],t[2]),t[3]&&(e1.bgAlpha=t[3])),e_.clearColor(e1.bgColor.r/255,e1.bgColor.g/255,e1.bgColor.b/255,e1.bgAlpha)}function nq(){return e1.bgColor.clone()}function nY(...t){return{id:"pos",pos:M(...t),moveBy(...t){this.pos=this.pos.add(M(...t))},move(...t){this.moveBy(M(...t).scale(nm()))},moveTo(...t){if("number"==typeof t[0]&&"number"==typeof t[1])return this.moveTo(M(t[0],t[1]),t[2]);let n=t[0],s=t[1];if(void 0===s){this.pos=M(n);return}let o=n.sub(this.pos);if(o.len()<=s*nm()){this.pos=M(n);return}this.move(o.unit().scale(s))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let t=this.worldPos();return n2(this)?t:nv(t)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){t2({color:R(255,0,0),radius:4/t9()})}}}function nz(...t){return 0===t.length?nz(1):{id:"scale",scale:M(...t),scaleTo(...t){this.scale=M(...t)},scaleBy(...t){this.scale.scale(M(...t))},inspect(){return`(${nJ(this.scale.x,2)}, ${nJ(this.scale.y,2)})`}}}function nQ(t){return{id:"rotate",angle:t??0,rotateBy(t){this.angle+=t},rotateTo(t){this.angle=t},inspect(){return`${Math.round(this.angle)}`}}}function nX(...t){return{id:"color",color:R(...t),inspect(){return this.color.toString()}}}function nJ(t,n){return Number(t.toFixed(n))}function n_(t){return{id:"opacity",opacity:t??1,inspect(){return`${nJ(this.opacity,1)}`},fadeOut(t=1,n=eM.linear){return iJ(this.opacity,0,t,t=>this.opacity=t,n)}}}function nW(t){if(!t)throw new eZ("Please define an anchor");return{id:"anchor",anchor:t,inspect(){return"string"==typeof this.anchor?this.anchor:this.anchor.toString()}}}function nZ(t){return{id:"z",z:t,inspect(){return`${this.z}`}}}function n$(t,n){return{id:"follow",require:["pos"],follow:{obj:t,offset:n??M(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function n0(t,n){let s="number"==typeof t?E.fromAngle(t):t.unit();return{id:"move",require:["pos"],update(){this.move(s.scale(n))}}}function n1(t={}){let n=t.distance??200,s=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let t=this.screenPos(),s=new $(M(0),na(),nl());return!z(s,t)&&s.sdistToPoint(t)>n*n},onExitScreen(t){return this.on("exitView",t)},onEnterScreen(t){return this.on("enterView",t)},update(){this.isOffScreen()?(s||(this.trigger("exitView"),s=!0),t.hide&&(this.hidden=!0),t.pause&&(this.paused=!0),t.destroy&&this.destroy()):(s&&(this.trigger("enterView"),s=!1),t.hide&&(this.hidden=!1),t.pause&&(this.paused=!1))}}}function n2(t){return!!t.fixed||!!t.parent&&n2(t.parent)}function n5(t={}){let n={},s=new Set;return{id:"area",collisionIgnore:t.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>eX.setCursor(this.area.cursor)),this.onCollideUpdate((t,o)=>{n[t.id]||this.trigger("collide",t,o),n[t.id]=o,s.add(t.id)})},update(){for(let t in n)s.has(Number(t))||(this.trigger("collideEnd",n[t].target),delete n[t]);s.clear()},drawInspect(){let t=this.localArea();tz(),tq(this.area.scale),tK(this.area.offset);let n={outline:{width:4/t9(),color:R(0,0,255)},anchor:this.anchor,fill:!1,fixed:n2(this)};t instanceof $?tZ({...n,pos:t.pos,width:t.width,height:t.height}):t instanceof en?t4({...n,pts:t.pts}):t instanceof ee&&t2({...n,pos:t.center,radius:t.radius}),tQ()},area:{shape:t.shape??null,scale:t.scale?M(t.scale):M(1),offset:t.offset??M(0),cursor:t.cursor??null},isClicked(){return eX.isMousePressed()&&this.isHovering()},isHovering(){let t=n2(this)?nc():nV(nc());return this.hasPoint(t)},checkCollision:t=>n[t.id]??null,getCollisions:()=>Object.values(n),isColliding:t=>!!n[t.id],isOverlapping(t){let s=n[t.id];return s&&s.hasOverlap()},onClick(t){let n=eX.onMousePress("left",()=>{this.isHovering()&&t()});return this.onDestroy(()=>n.cancel()),n},onHover(t){let n=!1;return this.onUpdate(()=>{n?n=this.isHovering():this.isHovering()&&(n=!0,t())})},onHoverUpdate(t){return this.onUpdate(()=>{this.isHovering()&&t()})},onHoverEnd(t){let n=!1;return this.onUpdate(()=>{n?this.isHovering()||(n=!1,t()):n=this.isHovering()})},onCollide(t,n){return"function"==typeof t&&void 0===n?this.on("collide",t):"string"==typeof t?this.onCollide((s,o)=>{s.is(t)&&n(s,o)}):void 0},onCollideUpdate(t,n){return"function"==typeof t&&void 0===n?this.on("collideUpdate",t):"string"==typeof t?this.on("collideUpdate",(s,o)=>s.is(t)&&n(s,o)):void 0},onCollideEnd(t,n){return"function"==typeof t&&void 0===n?this.on("collideEnd",t):"string"==typeof t?this.on("collideEnd",s=>s.is(t)&&n(s)):void 0},hasPoint(t){return W(this.worldArea(),t)},resolveCollision(t){let n=this.checkCollision(t);n&&!n.resolved&&(this.pos=this.pos.add(n.displacement),n.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let t=this.localArea();if(!(t instanceof en||t instanceof $))throw new eZ("Only support polygon and rect shapes for now");let n=this.transform.clone().scale(M(this.area.scale??1)).translate(this.area.offset);if(t instanceof $){let s=ej(this.anchor||eT).add(1,1).scale(-.5).scale(t.width,t.height);n.translate(s)}return t.transform(n)},screenArea(){let t=this.worldArea();return n2(this)?t:t.transform(e9.cam.transform)}}}function n4(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,shader:t.shader,uniform:t.uniform}}function n3(t,n={}){let s=null,o=null,r=null,l=new er;if(!t)throw new eZ("Please pass the resource name or data to sprite()");let d=w((t,n,s,o)=>{let r=M(1,1);return s&&o?(r.x=s/(t.width*n.w),r.y=o/(t.height*n.h)):s?(r.x=s/(t.width*n.w),r.y=r.x):o&&(r.y=o/(t.height*n.h),r.x=r.y),r},"calcTexScale");return{id:"sprite",width:0,height:0,frame:n.frame||0,quad:n.quad||new T(0,0,1,1),animSpeed:n.animSpeed??1,flipX:n.flipX??!1,flipY:n.flipY??!1,draw(){if(!s)return;let t=s.frames[this.frame??0];if(!t)throw new eZ(`Frame not found: ${this.frame??0}`);if(s.slice9){let{left:o,right:r,top:l,bottom:d}=s.slice9,c=s.tex.width*t.w,f=s.tex.height*t.h,g=this.width-o-r,w=this.height-l-d,y=o/c,A=r/c,v=1-y-A,V=l/f,x=d/f,b=1-V-x,S=[C(0,0,y,V),C(y,0,v,V),C(y+v,0,A,V),C(0,V,y,b),C(y,V,v,b),C(y+v,V,A,b),C(0,V+b,y,x),C(y,V+b,v,x),C(y+v,V+b,A,x),C(0,0,o,l),C(o,0,g,l),C(o+g,0,r,l),C(0,l,o,w),C(o,l,g,w),C(o+g,l,r,w),C(0,l+w,o,d),C(o,l+w,g,d),C(o+g,l+w,r,d)];for(let o=0;o<9;o++){let r=S[o],l=S[o+9];tJ(Object.assign(n4(this),{pos:l.pos(),tex:s.tex,quad:t.scale(r),flipX:this.flipX,flipY:this.flipY,tiled:n.tiled,width:l.w,height:l.h}))}}else tJ(Object.assign(n4(this),{tex:s.tex,quad:t.scale(this.quad??new T(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:n.tiled,width:this.width,height:this.height}))},add(){let o=w(t=>{let o=t.frames[0].clone();n.quad&&(o=o.scale(n.quad));let r=d(t.tex,o,n.width,n.height);this.width=t.tex.width*o.w*r.x,this.height=t.tex.height*o.h*r.y,n.anim&&this.play(n.anim),s=t,l.trigger(s)},"setSpriteData"),r=tk(t);r?r.onLoad(o):ip(()=>o(tk(t).data))},update(){if(!o)return;let t=s.anims[o.name];if("number"==typeof t){this.frame=t;return}if(0===t.speed)throw new eZ("Sprite anim speed cannot be 0");o.timer+=nm()*this.animSpeed,o.timer>=1/o.speed&&(o.timer=0,this.frame+=r,(this.frame<Math.min(t.from,t.to)||this.frame>Math.max(t.from,t.to))&&(o.loop?o.pingpong?(this.frame-=r,r*=-1,this.frame+=r):this.frame=t.from:(this.frame=t.to,o.onEnd(),this.stop())))},play(t,n={}){if(!s)return void l.add(()=>this.play(t,n));let d=s.anims[t];if(void 0===d)throw new eZ(`Anim not found: ${t}`);o&&this.stop(),o="number"==typeof d?{name:t,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:t,timer:0,loop:n.loop??d.loop??!1,pingpong:n.pingpong??d.pingpong??!1,speed:n.speed??d.speed??10,onEnd:n.onEnd??(()=>{})},r="number"==typeof d?null:d.from<d.to?1:-1,this.frame="number"==typeof d?d:d.from,this.trigger("animStart",t)},stop(){if(!o)return;let t=o.name;o=null,this.trigger("animEnd",t)},numFrames:()=>s?.frames.length??0,curAnim:()=>o?.name,onAnimEnd(t){return this.on("animEnd",t)},onAnimStart(t){return this.on("animStart",t)},renderArea(){return new $(M(0),this.width,this.height)},inspect(){if("string"==typeof t)return`"${t}"`}}}function n8(t,n={}){function s(t){let s=ns(Object.assign(n4(t),{text:t.text+"",size:t.textSize,font:t.font,width:n.width&&t.width,align:t.align,letterSpacing:t.letterSpacing,lineSpacing:t.lineSpacing,transform:t.textTransform,styles:t.textStyles}));return n.width||(t.width=s.width/(t.scale?.x||1)),t.height=s.height/(t.scale?.y||1),s}w(s,"update");let o={id:"text",set text(a){t=a,s(this)},get text(){return t},textSize:n.size??36,font:n.font,width:n.width??0,height:0,align:n.align,lineSpacing:n.lineSpacing,letterSpacing:n.letterSpacing,textTransform:n.transform,textStyles:n.styles,add(){ip(()=>s(this))},draw(){nr(s(this))},renderArea(){return new $(M(0),this.width,this.height)}};return s(o),o}function n6(t,n,s={}){return{id:"rect",width:t,height:n,radius:s.radius||0,draw(){tZ(Object.assign(n4(this),{width:this.width,height:this.height,radius:this.radius}))},renderArea(){return new $(M(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function n9(t,n){return{id:"rect",width:t,height:n,draw(){tX(Object.assign(n4(this),{width:this.width,height:this.height}))},renderArea(){return new $(M(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function n7(t){return{id:"circle",radius:t,draw(){t2(Object.assign(n4(this),{radius:this.radius}))},renderArea(){return new $(new E(this.anchor?0:-this.radius),2*this.radius,2*this.radius)},inspect(){return`${Math.ceil(this.radius)}`}}}function ie(t=1,n=R(0,0,0)){return{id:"outline",outline:{width:t,color:n}}}function it(){return{id:"timer",wait(t,n){let s=[];n&&s.push(n);let o=0,r=this.onUpdate(()=>{(o+=nm())>=t&&(s.forEach(t=>t()),r.cancel())});return{get paused(){return r.paused},set paused(u){r.paused=u},cancel:r.cancel,onEnd(t){s.push(t)},then(t){return this.onEnd(t),this}}},loop(t,n){let s=null,o=w(()=>{s=this.wait(t,o),n()},"newAction");return s=this.wait(0,o),{get paused(){return s.paused},set paused(a){s.paused=a},cancel:()=>s.cancel()}},tween(t,n,s,o,r=eM.linear){let l=0,d=[],c=this.onUpdate(()=>{let f=Math.min((l+=nm())/s,1);o(x(t,n,r(f))),1===f&&(c.cancel(),o(n),d.forEach(t=>t()))});return{get paused(){return c.paused},set paused(m){c.paused=m},onEnd(t){d.push(t)},then(t){return this.onEnd(t),this},cancel(){c.cancel()},finish(){c.cancel(),o(n),d.forEach(t=>t())}}}}}function ii(t={}){let n=M(0),s=null,o=null,r=!1;return{id:"body",require:["pos","area"],jumpForce:t.jumpForce??640,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(0===this.mass)throw new eZ("Can't set body mass to 0");this.onCollideUpdate((t,n)=>{if(t.is("body")&&!n.resolved&&(this.trigger("beforePhysicsResolve",n),t.trigger("beforePhysicsResolve",n.reverse()),!n.resolved&&!(this.isStatic&&t.isStatic))){if(this.isStatic||t.isStatic){let s=!this.isStatic&&t.isStatic?n:n.reverse();s.source.pos=s.source.pos.add(s.displacement),s.source.transform=nx(s.source)}else{let s=this.mass+t.mass;this.pos=this.pos.add(n.displacement.scale(t.mass/s)),t.pos=t.pos.add(n.displacement.scale(-this.mass/s)),this.transform=nx(this),t.transform=nx(t)}n.resolved=!0,this.trigger("physicsResolve",n),t.trigger("physicsResolve",n.reverse())}}),this.onPhysicsResolve(t=>{e9.gravity&&(t.isBottom()&&this.isFalling()?(n.y=0,s=t.target,o=t.target.pos,r?r=!1:this.trigger("ground",s)):t.isTop()&&this.isJumping()&&(n.y=0,this.trigger("headbutt",t.target)))})},update(){if(!e9.gravity||this.isStatic)return;if(r&&(s=null,o=null,this.trigger("fallOff"),r=!1),s)if(this.isOverlapping(s)&&s.exists()&&s.is("body")){s.pos.eq(o)||!1===t.stickToPlatform||this.moveBy(s.pos.sub(o)),o=s.pos;return}else r=!0;let l=n.y;n.y+=e9.gravity*this.gravityScale*nm(),n.y=Math.min(n.y,t.maxVelocity??65536),l<0&&n.y>=0&&this.trigger("fall"),this.move(n)},onPhysicsResolve(t){return this.on("physicsResolve",t)},onBeforePhysicsResolve(t){return this.on("beforePhysicsResolve",t)},curPlatform:()=>s,isGrounded:()=>null!==s,isFalling:()=>n.y>0,isJumping:()=>n.y<0,jump(t){s=null,o=null,n.y=-t||-this.jumpForce},onGround(t){return this.on("ground",t)},onFall(t){return this.on("fall",t)},onFallOff(t){return this.on("fallOff",t)},onHeadbutt(t){return this.on("headbutt",t)}}}function is(t=2){let n=t;return{id:"doubleJump",require:["body"],numJumps:t,add(){this.onGround(()=>{n=this.numJumps})},doubleJump(t){n<=0||(n<this.numJumps&&this.trigger("doubleJump"),n--,this.jump(t))},onDoubleJump(t){return this.on("doubleJump",t)},inspect:()=>`${n}`}}function io(t,n){return{id:"shader",shader:t,..."function"==typeof n?{uniform:n(),update(){this.uniform=n()}}:{uniform:n}}}function ir(){return{id:"fixed",fixed:!0}}function ia(t){return{id:"stay",stay:!0,scenesToStay:t}}function il(t){if(null==t)throw new eZ("health() requires the initial amount of hp");let n=t;return{id:"health",hurt(n=1){this.setHP(t-n),this.trigger("hurt",n)},heal(n=1){this.setHP(t+n),this.trigger("heal",n)},hp:()=>t,maxHP:()=>n,setHP(n){(t=n)<=0&&this.trigger("death")},onHurt(t){return this.on("hurt",t)},onHeal(t){return this.on("heal",t)},onDeath(t){return this.on("death",t)},inspect:()=>`${t}`}}function ih(t,n={}){if(null==t)throw new eZ("lifespan() requires time");let s=n.fade??0;return{id:"lifespan",async add(){await nU(t),s>0&&this.opacity&&await iJ(this.opacity,0,s,t=>this.opacity=t,eM.linear),this.destroy()}}}function id(t,n,s){if(!t)throw new eZ("state() requires an initial state");let o={};function r(t){o[t]||(o[t]={enter:new er,end:new er,update:new er,draw:new er})}function l(t,n,s){return r(n),o[n][t].add(s)}function d(t,n,...s){r(n),o[n][t].trigger(...s)}w(r,"initStateEvents"),w(l,"on"),w(d,"trigger");let c=!1;return{id:"state",state:t,enterState(t,...o){if(c=!0,n&&!n.includes(t))throw new eZ(`State not found: ${t}`);let r=this.state;if(s){if(!s?.[r])return;let n="string"==typeof s[r]?[s[r]]:s[r];if(!n.includes(t))throw new eZ(`Cannot transition state from "${r}" to "${t}". Available transitions: ${n.map(t=>`"${t}"`).join(", ")}`)}d("end",r,...o),this.state=t,d("enter",t,...o),d("enter",`${r} -> ${t}`,...o)},onStateTransition:(t,n,s)=>l("enter",`${t} -> ${n}`,s),onStateEnter:(t,n)=>l("enter",t,n),onStateUpdate:(t,n)=>l("update",t,n),onStateDraw:(t,n)=>l("draw",t,n),onStateEnd:(t,n)=>l("end",t,n),update(){c||(d("enter",t),c=!0),d("update",this.state)},draw(){d("draw",this.state)},inspect(){return this.state}}}function iu(t=1){let n=0,s=!1;return{require:["opacity"],add(){this.opacity=0},update(){s||(n+=nm(),this.opacity=b(n,0,t,0,1),n>=t&&(this.opacity=1,s=!0))}}}function ic(t="intersect"){return{id:"mask",mask:t}}function ip(t){e6.loaded?t():e9.events.on("load",t)}function im(t,n){e9.scenes[t]=n}function ig(n,...s){if(!e9.scenes[n])throw new eZ(`Scene not found: ${n}`);e9.events.onOnce("frameEnd",()=>{e9.events.trigger("sceneLeave",n),eX.events.clear(),e9.events.clear(),e9.objEvents.clear(),[...e9.root.children].forEach(t=>{t.stay&&(!t.scenesToStay||t.scenesToStay.includes(n))||e9.root.remove(t)}),e9.root.clearEvents(),e9.cam={pos:null,scale:M(1),angle:0,shake:0,transform:new B},e9.scenes[n](...s),!1!==t.debug&&nL(),t.burp&&nG()})}function iw(t){return e9.events.on("sceneLeave",t)}function iy(t,n){try{return JSON.parse(window.localStorage[t])}catch{return n?(iA(t,n),n):null}}function iA(t,n){window.localStorage[t]=JSON.stringify(n)}function iv(n,...s){let o=n(iZ),r;for(let n in r="function"==typeof o?o(...s)(iZ):o)iZ[n]=r[n],!1!==t.global&&(window[n]=r[n]);return iZ}function iV(){return M(na()/2,nl()/2)}function ix(t={}){let n=M(0),s=t.isObstacle??!1,o=t.cost??0,r=t.edges??[],l=w(()=>{let t={left:1,top:2,right:4,bottom:8};return r.map(n=>t[n]||0).reduce((t,n)=>t|n,0)},"getEdgeMask"),d=l();return{id:"tile",tilePosOffset:t.offset??M(0),set tilePos(p){let t=this.getLevel();n=p.clone(),this.pos=M(this.tilePos.x*t.tileWidth(),this.tilePos.y*t.tileHeight()).add(this.tilePosOffset)},get tilePos(){return n},set isObstacle(p){s!==p&&(s=p,this.getLevel().invalidateNavigationMap())},get isObstacle(){return s},set cost(p){o!==p&&(o=p,this.getLevel().invalidateNavigationMap())},get cost(){return o},set edges(p){r=p,d=l(),this.getLevel().invalidateNavigationMap()},get edges(){return r},get edgeMask(){return d},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(M(-1,0))},moveRight(){this.tilePos=this.tilePos.add(M(1,0))},moveUp(){this.tilePos=this.tilePos.add(M(0,-1))},moveDown(){this.tilePos=this.tilePos.add(M(0,1))}}}function ib(t,n){if(!n.tileWidth||!n.tileHeight)throw new eZ("Must provide tileWidth and tileHeight.");let s=iR([nY(n.pos??M(0))]),o=t.length,r=0,l=null,d=null,c=null,f=null,g=w(t=>t.x+t.y*r,"tile2Hash"),y=w(t=>M(Math.floor(t%r),Math.floor(t/r)),"hash2Tile"),A=w(()=>{for(let t of(l=[],s.children))v(t)},"createSpatialMap"),v=w(t=>{let n=g(t.tilePos);l[n]?l[n].push(t):l[n]=[t]},"insertIntoSpatialMap"),V=w(t=>{let n=g(t.tilePos);if(l[n]){let s=l[n].indexOf(t);s>=0&&l[n].splice(s,1)}},"removeFromSpatialMap"),x=w(()=>{let t=!1;for(let n of s.children){let o=s.pos2Tile(n.pos);(n.tilePos.x!=o.x||n.tilePos.y!=o.y)&&(t=!0,V(n),n.tilePos.x=o.x,n.tilePos.y=o.y,v(n))}t&&s.trigger("spatial_map_changed")},"updateSpatialMap"),b=w(()=>{let t=s.getSpatialMap(),n=s.numRows()*s.numColumns();d?d.length=n:d=Array(n),d.fill(1,0,n);for(let n=0;n<t.length;n++){let s=t[n];if(s){let t=0;for(let n of s)if(n.isObstacle){t=1/0;break}else t+=n.cost;d[n]=t||1}}},"createCostMap"),S=w(()=>{let t=s.getSpatialMap(),n=s.numRows()*s.numColumns();c?c.length=n:c=Array(n),c.fill(15,0,n);for(let n=0;n<t.length;n++){let s=t[n];if(s){let t=s.length,o=15;for(let n=0;n<t;n++)o|=s[n].edgeMask;c[n]=o}}},"createEdgeMap"),E=w(()=>{let t=s.numRows()*s.numColumns(),n=w((t,n)=>{let s=[];for(s.push(t);s.length>0;)P(s.pop()).forEach(t=>{f[t]<0&&(f[t]=n,s.push(t))})},"traverse");f?f.length=t:f=Array(t),f.fill(-1,0,t);let o=0;for(let t=0;t<d.length;t++){if(f[t]>=0){o++;continue}n(t,o),o++}},"createConnectivityMap"),k=w((t,n)=>d[n],"getCost"),R=w((t,n)=>{let s=y(t),o=y(n);return s.dist(o)},"getHeuristic"),P=w((t,n)=>{let s=[],l=Math.floor(t%r),f=l>0&&1&c[t]&&d[t-1]!==1/0,g=t>=r&&2&c[t]&&d[t-r]!==1/0,w=l<r-1&&4&c[t]&&d[t+1]!==1/0,y=t<r*o-r-1&&8&c[t]&&d[t+r]!==1/0;return n?(f&&(g&&s.push(t-r-1),s.push(t-1),y&&s.push(t+r-1)),g&&s.push(t-r),w&&(g&&s.push(t-r+1),s.push(t+1),y&&s.push(t+r+1))):(f&&s.push(t-1),g&&s.push(t-r),w&&s.push(t+1)),y&&s.push(t+r),s},"getNeighbours");return s.use({id:"level",tileWidth:()=>n.tileWidth,tileHeight:()=>n.tileHeight,spawn(t,...o){let r=M(...o),d=(()=>{if("string"==typeof t){if(n.tiles[t]){if("function"!=typeof n.tiles[t])throw new eZ("Level symbol def must be a function returning a component list");return n.tiles[t](r)}else if(n.wildcardTile)return n.wildcardTile(t,r)}else{if(Array.isArray(t))return t;throw new eZ("Expected a symbol or a component list")}})();if(!d)return null;let c=!1,f=!1;for(let t of d)"tile"===t.id&&(f=!0),"pos"===t.id&&(c=!0);c||d.push(nY()),f||d.push(ix());let g=s.add(d);return c&&(g.tilePosOffset=g.pos.clone()),g.tilePos=r,l&&(v(g),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),g},numColumns:()=>r,numRows:()=>o,levelWidth(){return r*this.tileWidth()},levelHeight(){return o*this.tileHeight()},tile2Pos(...t){return M(...t).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...t){let n=M(...t);return M(Math.floor(n.x/this.tileWidth()),Math.floor(n.y/this.tileHeight()))},getSpatialMap:()=>(l||A(),l),onSpatialMapChanged(t){return this.on("spatial_map_changed",t)},onNavigationMapInvalid(t){return this.on("navigation_map_invalid",t)},getAt:t=>(l||A(),l[g(t)]||[]),update(){l&&x()},invalidateNavigationMap(){d=null,c=null,f=null},onNavigationMapChanged(t){return this.on("navigation_map_changed",t)},getTilePath(t,n,s={}){if(d||b(),c||S(),f||E(),t.x<0||t.x>=r||t.y<0||t.y>=o||n.x<0||n.x>=r||n.y<0||n.y>=o)return null;let l=g(t),w=g(n);if(d[w]===1/0)return null;if(l===w)return[];if(-1!=f[l]&&f[l]!==f[w])return null;let A=new ey((t,n)=>t.cost<n.cost);A.insert({cost:0,node:l});let v=new Map;v.set(l,l);let V=new Map;for(V.set(l,0);0!==A.length;){let t=A.remove()?.node;if(t===w)break;for(let n of P(t,s.allowDiagonals)){let s=(V.get(t)||0)+k(t,n)+R(n,w);(!V.has(n)||s<V.get(n))&&(V.set(n,s),A.insert({cost:s,node:n}),v.set(n,t))}}let x=[],M=w,T=y(M);for(x.push(T);M!==l;){let t=y(M=v.get(M));x.push(t)}return x.reverse()},getPath(t,n,s={}){let o=this.tileWidth(),r=this.tileHeight(),l=this.getTilePath(this.pos2Tile(t),this.pos2Tile(n),s);return l?[t,...l.slice(1,-1).map(t=>t.scale(o,r).add(o/2,r/2)),n]:null}}),s.onNavigationMapInvalid(()=>{s.invalidateNavigationMap(),s.trigger("navigation_map_changed")}),t.forEach((t,n)=>{let o=t.split("");r=Math.max(o.length,r),o.forEach((t,o)=>{s.spawn(t,M(o,n))})}),s}function iS(t={}){let n=null,s=null,o=null,r=null;return{id:"agent",require:["pos","tile"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return n?this.pos.dist(n):0},getNextLocation:()=>s&&o?s[o]:null,getPath:()=>s?s.slice():null,getTarget:()=>n,isNavigationFinished:()=>!s||null===o,isTargetReachable:()=>null!==s,isTargetReached(){return!n||this.pos.eq(n)},setTarget(t){n=t,o=(s=this.getLevel().getPath(this.pos,n,{allowDiagonals:this.allowDiagonals}))?0:null,s?(r||(r=this.getLevel().onNavigationMapChanged(()=>{s&&null!==o&&(o=(s=this.getLevel().getPath(this.pos,n,{allowDiagonals:this.allowDiagonals}))?0:null,s?this.trigger("navigation-next",this,s[o]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>r.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,s[o])):this.trigger("navigation-ended",this)},update(){if(s&&null!==o){if(2>this.pos.sdist(s[o]))if(o===s.length-1){this.pos=n.clone(),o=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else o++,this.trigger("navigation-next",this,s[o]);this.moveTo(s[o],this.agentSpeed)}},onNavigationStarted(t){return this.on("navigation-started",t)},onNavigationNext(t){return this.on("navigation-next",t)},onNavigationEnded(t){return this.on("navigation-ended",t)},onTargetReached(t){return this.on("target-reached",t)},inspect:()=>JSON.stringify({target:JSON.stringify(n),path:JSON.stringify(s)})}}function iE(t){let n=eX.canvas().captureStream(t),s=e4.ctx.createMediaStreamDestination();e4.masterNode.connect(s);let o=new MediaRecorder(n),r=[];return o.ondataavailable=t=>{t.data.size>0&&r.push(t.data)},o.onerror=()=>{e4.masterNode.disconnect(s),n.getTracks().forEach(t=>t.stop())},o.start(),{resume(){o.resume()},pause(){o.pause()},stop:()=>(o.stop(),e4.masterNode.disconnect(s),n.getTracks().forEach(t=>t.stop()),new Promise(t=>{o.onstop=()=>{t(new Blob(r,{type:"video/mp4"}))}})),download(t="kaboom.mp4"){this.stop().then(n=>ef(t,n))}}}function iM(){return document.activeElement===eX.canvas()}function ik(t){t.destroy()}w(nk,"onAdd"),w(nR,"onDestroy"),w(nP,"onCollide"),w(nT,"onCollideUpdate"),w(nC,"onCollideEnd"),w(nB,"forAllCurrentAndFuture"),w(nF,"onClick"),w(nI,"onHover"),w(nD,"onHoverUpdate"),w(nN,"onHoverEnd"),w(nU,"wait"),w(nH,"loop"),w(nL,"enterDebugMode"),w(nG,"enterBurpMode"),w(nO,"setGravity"),w(nj,"getGravity"),w(nK,"setBackground"),w(nq,"getBackground"),w(nY,"pos"),w(nz,"scale"),w(nQ,"rotate"),w(nX,"color"),w(nJ,"toFixed"),w(n_,"opacity"),w(nW,"anchor"),w(nZ,"z"),w(n$,"follow"),w(n0,"move"),w(n1,"offscreen"),w(n2,"isFixed"),w(n5,"area"),w(n4,"getRenderProps"),w(n3,"sprite"),w(n8,"text"),w(n6,"rect"),w(n9,"uvquad"),w(n7,"circle"),w(ie,"outline"),w(it,"timer"),w(ii,"body"),w(is,"doubleJump"),w(io,"shader"),w(ir,"fixed"),w(ia,"stay"),w(il,"health"),w(ih,"lifespan"),w(id,"state"),w(iu,"fadeIn"),w(ic,"mask"),w(ip,"onLoad"),w(im,"scene"),w(ig,"go"),w(iw,"onSceneLeave"),w(iy,"getData"),w(iA,"setData"),w(iv,"plug"),w(iV,"center"),(J=et||={})[J.None=0]="None",J[J.Left=1]="Left",J[J.Top=2]="Top",J[J.LeftTop=3]="LeftTop",J[J.Right=4]="Right",J[J.Horizontal=5]="Horizontal",J[J.RightTop=6]="RightTop",J[J.HorizontalTop=7]="HorizontalTop",J[J.Bottom=8]="Bottom",J[J.LeftBottom=9]="LeftBottom",J[J.Vertical=10]="Vertical",J[J.LeftVertical=11]="LeftVertical",J[J.RightBottom=12]="RightBottom",J[J.HorizontalBottom=13]="HorizontalBottom",J[J.RightVertical=14]="RightVertical",J[J.All=15]="All",w(ix,"tile"),w(ib,"addLevel"),w(iS,"agent"),w(iE,"record"),w(iM,"isFocused"),w(ik,"destroy");let iR=e9.root.add.bind(e9.root),iP=e9.root.readd.bind(e9.root),iT=e9.root.removeAll.bind(e9.root),iC=e9.root.get.bind(e9.root);function iB(t=2,n=1){let s=0;return{id:"boom",require:["scale"],update(){let o=Math.sin(s*t)*n;o<0&&this.destroy(),this.scale=M(o),s+=nm()}}}w(iB,"boom");let iF=tf(null,"data:image/png;base64,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"),iI=tf(null,"data:image/png;base64,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");function iD(t,n={}){let s=iR([nY(t),ia()]),o=5*(n.speed||1),r=n.scale||1;s.add([n3(iI),nz(0),nW("center"),iB(o,r),...n.comps??[]]);let l=s.add([n3(iF),nz(0),nW("center"),it(),...n.comps??[]]);return l.wait(.4/o,()=>l.use(iB(o,r))),l.onDestroy(()=>s.destroy()),s}function iN(){e9.root.update()}w(iD,"addKaboom"),w(iN,"updateFrame");class iU{static{w(this,"Collision")}source;target;displacement;resolved=!1;constructor(t,n,s,o=!1){this.source=t,this.target=n,this.displacement=s,this.resolved=o}reverse(){return new iU(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}function iH(){let n={},s=t.hashGridSize||64,o=new B,r=[];function l(t){if(r.push(o.clone()),t.pos&&o.translate(t.pos),t.scale&&o.scale(t.scale),t.angle&&o.rotate(t.angle),t.transform=o.clone(),t.c("area")&&!t.paused){let o=t.worldArea().bbox(),r=Math.floor(o.pos.x/s),l=Math.floor(o.pos.y/s),d=Math.ceil((o.pos.x+o.width)/s),c=Math.ceil((o.pos.y+o.height)/s),f=new Set;for(let s=r;s<=d;s++)for(let o=l;o<=c;o++)if(n[s])if(n[s][o]){let r=n[s][o];e:for(let n of r){if(n.paused||!n.exists()||f.has(n.id))continue;for(let s of t.collisionIgnore)if(n.is(s))continue e;for(let s of n.collisionIgnore)if(t.is(s))continue e;let s=ei(t.worldArea(),n.worldArea());if(s){let o=new iU(t,n,s);t.trigger("collideUpdate",n,o);let r=o.reverse();r.resolved=o.resolved,n.trigger("collideUpdate",t,r)}f.add(n.id)}r.push(t)}else n[s][o]=[t];else n[s]={},n[s][o]=[t]}t.children.forEach(l),o=r.pop()}w(l,"checkObj"),l(e9.root)}function iL(){let t=e9.cam,n=E.fromAngle(H(0,360)).scale(t.shake);t.shake=x(t.shake,0,5*nm()),t.transform=new B().translate(iV()).scale(t.scale).rotate(t.angle).translate((t.pos??iV()).scale(-1).add(n)),e9.root.draw(),tU()}function iG(){let t=te();e9.events.numListeners("loading")>0?e9.events.trigger("loading",t):t7(()=>{let n=na()/2,s=M(na()/2,nl()/2).sub(M(n/2,12));tZ({pos:M(0),width:na(),height:nl(),color:R(0,0,0)}),tZ({pos:s,width:n,height:24,fill:!1,outline:{width:4}}),tZ({pos:s,width:n*t,height:24})})}function iO(t,n){t7(()=>{let s=M(8);tz(),tK(t);let o=ns({text:n,font:eC,size:16,pos:s,color:R(255,255,255),fixed:!0}),r=o.width+2*s.x,l=o.height+2*s.x;t.x+r>=na()&&tK(M(-r,0)),t.y+l>=nl()&&tK(M(0,-l)),tZ({width:r,height:l,color:R(0,0,0),radius:4,opacity:.8,fixed:!0}),nr(o),tQ()})}function ij(){if(nf.inspect){let t=null;for(let n of e9.root.get("*",{recursive:!0}))if(n.c("area")&&n.isHovering()){t=n;break}if(e9.root.drawInspect(),t){let n=[],s=t.inspect();for(let t in s)s[t]?n.push(`${t}: ${s[t]}`):n.push(`${t}`);iO(nu(nc()),n.join(`
`))}iO(M(8),`FPS: ${nf.fps()}`)}nf.paused&&t7(()=>{tz(),tK(na(),0),tK(-8,8),tZ({width:32,height:32,anchor:"topright",color:R(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=1;t<=2;t++)tZ({width:4,height:19.2,anchor:"center",pos:M(-32/3*t,16),color:R(255,255,255),radius:2,fixed:!0});tQ()}),1!==nf.timeScale&&t7(()=>{tz(),tK(na(),nl()),tK(-8,-8);let t=ns({text:nf.timeScale.toFixed(1),font:eC,size:16,color:R(255,255,255),pos:M(-8),anchor:"botright",fixed:!0});tZ({width:t.width+16+32,height:t.height+16,anchor:"botright",color:R(0,0,0),opacity:.8,radius:4,fixed:!0});for(let n=0;n<2;n++){let s=nf.timeScale<1;t1({p1:M(-t.width-8*(s?2:3.5),-8),p2:M(-t.width-8*(s?2:3.5),-8-t.height),p3:M(-t.width-8*(s?3.5:2),-8-t.height/2),pos:M(-(8*n*1)+(s?-4:0),0),color:R(255,255,255),fixed:!0})}nr(t),tQ()}),nf.curRecording&&t7(()=>{tz(),tK(0,nl()),tK(24,-24),t2({radius:12,color:R(255,0,0),opacity:F(0,1,4*eX.time()),fixed:!0}),tQ()}),nf.showLog&&e9.logs.length>0&&t7(()=>{tz(),tK(0,nl()),tK(8,-8);let n=[];for(let t of e9.logs){let s="",o=t.msg instanceof Error?"error":"info";s+=`[time]${t.time.toFixed(2)}[/time] [${o}]${t.msg?.toString?t.msg.toString():t.msg}[/${o}]`,n.push(s)}e9.logs=e9.logs.filter(n=>eX.time()-n.time<(t.logTime||4));let s=ns({text:n.join(`
`),font:eC,pos:M(8,-8),anchor:"botleft",size:16,width:.6*na(),lineSpacing:4,fixed:!0,styles:{time:{color:R(127,127,127)},info:{color:R(255,255,255)},error:{color:R(255,0,127)}}});tZ({width:s.width+16,height:s.height+16,anchor:"botleft",color:R(0,0,0),radius:4,opacity:.8,fixed:!0}),nr(s),tQ()})}function iK(t){e9.events.on("loading",t)}function iq(t){eX.onResize(t)}function iY(t){e9.events.on("error",t)}function iz(t){e4.ctx.suspend(),eX.run(()=>{t7(()=>{let n=na(),s=nl(),o={size:36,width:n-64,letterSpacing:4,lineSpacing:4,font:eC,fixed:!0};tZ({width:n,height:s,color:R(0,0,255),fixed:!0});let r=ns({...o,text:"Error",pos:M(32),color:R(255,128,0),fixed:!0});nr(r),no({...o,text:t.message,pos:M(32,32+r.height+16),fixed:!0}),tQ(),e9.events.trigger("error",t)})})}function iQ(t){eJ.push(t)}function iX(){e9.events.onOnce("frameEnd",()=>{for(let t in eX.quit(),nh)window.removeEventListener(t,nh[t]);e_.clear(e_.COLOR_BUFFER_BIT|e_.DEPTH_BUFFER_BIT|e_.STENCIL_BUFFER_BIT);let t=e_.getParameter(e_.MAX_TEXTURE_IMAGE_UNITS);for(let n=0;n<t;n++)e_.activeTexture(e_.TEXTURE0+n),e_.bindTexture(e_.TEXTURE_2D,null),e_.bindTexture(e_.TEXTURE_CUBE_MAP,null);e_.bindBuffer(e_.ARRAY_BUFFER,null),e_.bindBuffer(e_.ELEMENT_ARRAY_BUFFER,null),e_.bindRenderbuffer(e_.RENDERBUFFER,null),e_.bindFramebuffer(e_.FRAMEBUFFER,null),eJ.forEach(t=>t()),e_.deleteBuffer(e1.vbuf),e_.deleteBuffer(e1.ibuf)})}function iJ(t,n,s,o,r=eM.linear){let l=0,d=[],c=nE(()=>{let f=Math.min((l+=nm())/s,1);o(x(t,n,r(f))),1===f&&(c.cancel(),o(n),d.forEach(t=>t()))});return{get paused(){return c.paused},set paused(m){c.paused=m},onEnd(t){d.push(t)},then(t){return this.onEnd(t),this},cancel(){c.cancel()},finish(){c.cancel(),o(n),d.forEach(t=>t())}}}w(iH,"checkFrame"),w(iL,"drawFrame"),w(iG,"drawLoadScreen"),w(iO,"drawInspectText"),w(ij,"drawDebug"),!1!==t.debug&&nL(),t.burp&&nG(),w(iK,"onLoading"),w(iq,"onResize"),w(iY,"onError"),w(iz,"handleErr"),w(iQ,"onCleanup"),w(iX,"quit"),w(iJ,"tween");let i_=!0;function iW(){let n=e_.drawingBufferWidth/eE,s=e_.drawingBufferHeight/eE;if(eX.isFullscreen()){let t=window.innerWidth,o=window.innerHeight,r=n/s;if(t/o>r){let n=window.innerHeight*r;e1.viewport={x:(t-n)/2,y:0,width:n,height:o}}else{let n=window.innerWidth/r;e1.viewport={x:0,y:(o-n)/2,width:t,height:n}}return}if(t.letterbox){if(!t.width||!t.height)throw new eZ("Letterboxing requires width and height defined.");let o=n/s,r=t.width/t.height;if(o>r){let t=s*r;e1.viewport={x:(n-t)/2,y:0,width:t,height:s}}else{let t=n/r;e1.viewport={x:0,y:(s-t)/2,width:n,height:t}}return}if(t.stretch&&(!t.width||!t.height))throw new eZ("Stretching requires width and height defined.");e1.viewport={x:0,y:0,width:n,height:s}}eX.run(()=>{e6.loaded||1!==te()||i_||(e6.loaded=!0,e9.events.trigger("load")),!e6.loaded&&!1!==t.loadingScreen||i_?(tH(),iG()):(nf.paused||iN(),iH(),tH(),iL(),!1!==t.debug&&ij()),tG(),i_&&(i_=!1),e9.events.trigger("frameEnd")}),w(iW,"updateViewport"),eX.onHide(()=>{t.backgroundAudio||e4.ctx.suspend()}),eX.onShow(()=>{t.backgroundAudio||e4.ctx.resume()}),eX.onResize(()=>{if(eX.isFullscreen())return;let n=t.width&&t.height;n&&!t.stretch&&!t.letterbox||(eA.width=eA.offsetWidth*eE,eA.height=eA.offsetHeight*eE,iW(),n||(e1.frameBuffer.free(),e1.frameBuffer=new e0(e_.drawingBufferWidth,e_.drawingBufferHeight),e1.width=e_.drawingBufferWidth/eE,e1.height=e_.drawingBufferHeight/eE))}),iW();let iZ={VERSION:"3000.1.8",loadRoot:tt,loadProgress:te,loadSprite:tf,loadSpriteAtlas:tc,loadSound:tA,loadBitmapFont:td,loadFont:th,loadShader:tw,loadShaderURL:ty,loadAseprite:tg,loadPedit:tm,loadBean:tv,loadJSON:ta,load:e7,getSprite:tV,getSound:tx,getFont:tb,getBitmapFont:tS,getShader:tE,getAsset:tM,Asset:e3,SpriteData:e2,SoundData:e5,width:na,height:nl,center:iV,dt:nm,time:eX.time,screenshot:eX.screenshot,record:iE,isFocused:iM,setCursor:eX.setCursor,getCursor:eX.getCursor,setCursorLocked:eX.setCursorLocked,isCursorLocked:eX.isCursorLocked,setFullscreen:eX.setFullscreen,isFullscreen:eX.isFullscreen,isTouchscreen:eX.isTouchscreen,onLoad:ip,onLoading:iK,onResize:iq,onGamepadConnect:eX.onGamepadConnect,onGamepadDisconnect:eX.onGamepadDisconnect,onError:iY,onCleanup:iQ,camPos:ng,camScale:nw,camRot:ny,shake:nA,toScreen:nv,toWorld:nV,setGravity:nO,getGravity:nj,setBackground:nK,getBackground:nq,getGamepads:eX.getGamepads,add:iR,make:nb,destroy:ik,destroyAll:iT,get:iC,readd:iP,pos:nY,scale:nz,rotate:nQ,color:nX,opacity:n_,anchor:nW,area:n5,sprite:n3,text:n8,rect:n6,circle:n7,uvquad:n9,outline:ie,body:ii,doubleJump:is,shader:io,timer:it,fixed:ir,stay:ia,health:il,lifespan:ih,z:nZ,move:n0,offscreen:n1,follow:n$,state:id,fadeIn:iu,mask:ic,tile:ix,agent:iS,on:nS,onUpdate:nE,onDraw:nM,onAdd:nk,onDestroy:nR,onClick:nF,onCollide:nP,onCollideUpdate:nT,onCollideEnd:nC,onHover:nI,onHoverUpdate:nD,onHoverEnd:nN,onKeyDown:eX.onKeyDown,onKeyPress:eX.onKeyPress,onKeyPressRepeat:eX.onKeyPressRepeat,onKeyRelease:eX.onKeyRelease,onMouseDown:eX.onMouseDown,onMousePress:eX.onMousePress,onMouseRelease:eX.onMouseRelease,onMouseMove:eX.onMouseMove,onCharInput:eX.onCharInput,onTouchStart:eX.onTouchStart,onTouchMove:eX.onTouchMove,onTouchEnd:eX.onTouchEnd,onScroll:eX.onScroll,onHide:eX.onHide,onShow:eX.onShow,onGamepadButtonDown:eX.onGamepadButtonDown,onGamepadButtonPress:eX.onGamepadButtonPress,onGamepadButtonRelease:eX.onGamepadButtonRelease,onGamepadStick:eX.onGamepadStick,mousePos:nc,mouseDeltaPos:eX.mouseDeltaPos,isKeyDown:eX.isKeyDown,isKeyPressed:eX.isKeyPressed,isKeyPressedRepeat:eX.isKeyPressedRepeat,isKeyReleased:eX.isKeyReleased,isMouseDown:eX.isMouseDown,isMousePressed:eX.isMousePressed,isMouseReleased:eX.isMouseReleased,isMouseMoved:eX.isMouseMoved,isGamepadButtonPressed:eX.isGamepadButtonPressed,isGamepadButtonDown:eX.isGamepadButtonDown,isGamepadButtonReleased:eX.isGamepadButtonReleased,charInputted:eX.charInputted,loop:nH,wait:nU,play:tB,volume:tC,burp:tF,audioCtx:e4.ctx,Timer:ek,Line:Z,Rect:$,Circle:ee,Polygon:en,Vec2:E,Color:k,Mat4:B,Quad:T,RNG:I,rand:H,randi:L,randSeed:U,vec2:M,rgb:R,hsl2rgb:P,quad:C,choose:O,chance:G,lerp:x,tween:iJ,easings:eM,map:b,mapc:S,wave:F,deg2rad:A,rad2deg:v,clamp:V,testLineLine:q,testRectRect:j,testRectLine:Y,testRectPoint:z,testCirclePolygon:_,testLinePoint:Q,testLineCircle:X,drawSprite:t_,drawText:no,formatText:ns,drawRect:tZ,drawLine:t$,drawLines:t0,drawTriangle:t1,drawCircle:t2,drawEllipse:t5,drawUVQuad:tX,drawPolygon:t4,drawFormattedText:nr,drawMasked:t8,drawSubtracted:t6,pushTransform:tz,popTransform:tQ,pushTranslate:tK,pushScale:tq,pushRotate:tY,pushMatrix:tj,usePostEffect:tL,debug:nf,scene:im,go:ig,onSceneLeave:iw,addLevel:ib,getData:iy,setData:iA,download:eu,downloadJSON:ep,downloadText:ec,downloadBlob:ef,plug:iv,ASCII_CHARS:eP,canvas:eX.canvas(),addKaboom:iD,LEFT:E.LEFT,RIGHT:E.RIGHT,UP:E.UP,DOWN:E.DOWN,RED:k.RED,GREEN:k.GREEN,BLUE:k.BLUE,YELLOW:k.YELLOW,MAGENTA:k.MAGENTA,CYAN:k.CYAN,WHITE:k.WHITE,BLACK:k.BLACK,quit:iX,Event:er,EventHandler:ea,EventController:eo,KaboomError:eZ};if(t.plugins&&t.plugins.forEach(iv),!1!==t.global)for(let t in iZ)window[t]=iZ[t];return eX.canvas().focus(),iZ},"default")({width:1280,height:720,letterbox:!0,global:!1}),ez=(n=null,{getInstance(){let t,s;return n||(t=0,s=!1,n={setNbTalkedOldMan(n){t=n},getNbTalkedOldMan:()=>t,getHasGivenHeart:()=>s,setHasGivenHeart:t=>{s=t}}),n}}).getInstance(),eQ=(s=null,{getInstance(){let t,n;return s||(t=0,n=!1,s={setNbTalkedYuki(n){t=n},getNbTalkedYuki:()=>t,setHasGivenHeart(t){n=t},getHasGivenHeart:()=>n}),s}}).getInstance(),eX=(o=null,{getInstance(){let t,n;return o||(t=0,n=!1,o={setNbTalkedKoji(n){t=n},getNbTalkedKoji:()=>t,setHasGivenHeart(t){n=t},getHasGivenHeart:()=>n}),o}}).getInstance(),eJ=(r=null,{getInstance(){let t,n;return r||(t=0,n=!1,r={setNbTalkedSatoshi(n){t=n},getNbTalkedSatoshi:()=>t,getHasGivenHeart:()=>n,setHasGivenHeart:t=>{n=t}}),r}}).getInstance(),e_=(l=null,{getInstance(){let t,n,s,o;return l||(t=!1,n=1,s=1,o=!1,l={setIsSwordEquipped(n){t=n},getIsSwordEquipped:()=>t,getTrueMaxHealth:()=>8,setCurrentMaxHealth(t){s>(n=Math.min(t,8))&&(s=n)},getCurrentMaxHealth:()=>n,setHealth(t){s=Math.max(0,Math.min(t,n))},getHealth:()=>s,setHasKey(t){o=t},getHasKey:()=>o}),l}}).getInstance(),eW=(d=null,{getInstance(){let t,n,s,o,r,l,c;return d||(t=null,n=null,s=!1,o="english",r=25,l=!1,c=!1,d={setPreviousScene(n){t=n},getPreviousScene:()=>t,setCurrentScene(t){n=t},getCurrentScene:()=>n,setFreezePlayer(t){s=t},getFreezePlayer:()=>s,setLocale(t){o=t},getLocale:()=>o,setFontSize(t){r=t},getFontSize:()=>r,setIsGhostDefeated(t){l=t},getIsGhostDefeated:()=>l,setIsSonSaved(t){c=t},getIsSonSaved:()=>c}),d}}).getInstance(),eZ=(c=null,{getInstance(){let t,n;return c||(t=0,n=!1,c={setNbTalkedMari(n){t=n},getNbTalkedMari:()=>t,setHasGivenHeart(t){n=t},getHasGivenHeart:()=>n}),c}}).getInstance(),e$=(f=null,{getInstance(){let t,n;return f||(t=0,n=!1,f={setNbTalkedNaoko(n){t=n},getNbTalkedNaoko:()=>t,setHasGivenSpecialItem(t){n=t},getHasGivenSpecialItem:()=>n}),f}}).getInstance();function e0(t){let n=Math.floor(e_.getHealth()),s=!1;e_.getHealth()-n==.5&&(s=!0);let o=e_.getCurrentMaxHealth()-n-!!s,r=t.add([t.pos(20,20),t.fixed(),"healthContainer"]),l=0;for(let s=0;s<n;s++)r.add([t.sprite("full-heart"),t.pos(l,0)]),l+=48;if(s&&(r.add([t.sprite("half-heart"),t.pos(l,0)]),l+=48),o>0)for(let n=0;n<o;n++)r.add([t.sprite("empty-heart"),t.pos(l,0)]),l+=48;return r}function e1(t,n){t&&"function"==typeof t.curAnim&&t.curAnim()!==n&&t.play(n)}function e2(t,n){for(let s of n)if(t.isKeyDown(s))return!0;return!1}function e5(t,n,s,o){t.add([t.rect(t.canvas.width,t.canvas.height),t.color(n,s,o),t.fixed(),t.z()])}function e4(t,n,s,o,r,l=0){let d=0,c=t.vec2(0,0);for(let f of s.data){if(d%s.width==0?(c.x=0,c.y+=o):c.x+=r,d++,0===f)continue;let g=f-1;if(g<0||g>1208){console.warn(`\u{26A0}\u{FE0F} Skipping invalid tile index: ${f}`);continue}n.add([t.sprite("assets",{frame:g}),t.pos(c.clone()),t.z(l),t.offscreen()])}}function e3(t,n,s){for(let f of s.objects){var o,r,l,d,c;n.add((o=t,r=f.width,l=f.height,d=t.vec2(f.x,f.y),c=""!==f.name?f.name:"wall",[o.rect(r,l),o.pos(d.x,d.y+16),o.area(),o.body({isStatic:!0}),o.opacity(0),o.offscreen(),c]))}}async function e8(t){return await (await fetch(t)).json()}let e6=null;const e9={playMusic(t,n,s={}){e6&&e6.stop&&(e6.stop(),e6=null);try{e6=t.play(n,{loop:!0,volume:s.volume??.2})}catch(t){console.error(`\u{274C} Failed to play music: "${n}"`,t)}return e6},stopMusic(){e6&&e6.stop&&(e6.stop(),e6=null)}};async function e7(t,n){for(let s of n)await new Promise(n=>setTimeout(()=>{t.text+=s,n()},10))}async function te(t,n,s,o=!1,r=null,l=[],d=null,c=null){let f,g,w,y,A;eW.setFreezePlayer(!0),t.play("soundUI");let v=t.width()/2,V=t.height()-220,x=v-380;r&&(f=t.add([t.rect(120,150,{radius:12}),t.color(255,255,255),t.pos(x,V),t.z(1001),t.fixed(),t.opacity(.85)]),g=t.add([t.sprite("assets",{frame:{oldmanPortrait:1159,yukiPortrait:1034,satoshiPortrait:1018,kojiPortrait:1026,mariPortrait:1030,naokoPortrait:1022}[r]||1163}),t.pos(x+25,V+10),t.scale(5.2),t.z(1002),t.fixed()]),d&&(w=t.add([t.text(d,{font:"gameboy",size:22}),t.color(0,0,0),t.pos(x+60,V+125),t.anchor("center"),t.z(1003),t.fixed()]))),c&&(y=t.add([t.rect(250,36,{radius:6}),t.color(255,255,255),t.pos(v-250,V-40),t.z(999),t.fixed(),t.opacity(.85)]),A=t.add([t.text(c,{font:"gameboy",size:30}),t.color(0,0,0),t.pos(v-135,V-22),t.anchor("center"),t.z(1e3),t.fixed()]));let b=t.add([t.rect(680,180,{radius:12}),t.color(255,255,255),t.pos(v-250,V),t.z(1e3),t.fixed(),t.opacity(.85)]),S=b.add([t.text("",{font:"gameboy",width:640,lineSpacing:12,size:eW.getFontSize()}),t.color(0,0,0),t.pos(20,30),t.fixed()]),E=b.add([t.text("Press SPACE",{font:"gameboy",size:eW.getFontSize()-4}),t.color(0,0,0),t.pos(270,140),t.fixed(),t.opacity(0)]),M=0,k=t.onUpdate(()=>{E.opacity>0&&(E.hidden=Math.floor(2*(M+=t.dt()))%2==0)}),R=0,P=!1;if(!Array.isArray(s))return void console.warn(" 'content' passed to dialog() is not an array:",s);let T=n=>{if(l&&l[n])try{t.play(l[n])}catch(t){console.warn(`\u{26A0}\u{FE0F} Couldn't play voice line: ${l[n]}`,t)}};T(R),o?S.text=s[R]:await e7(S,s[R]),E.opacity=1,P=!0;let C=t.onKeyPress("space",async()=>{if(P){if(!s[++R]){t.destroy(b),t.destroyAll("interactPrompt"),g&&t.destroy(g),f&&t.destroy(f),w&&t.destroy(w),y&&t.destroy(y),A&&t.destroy(A),C.cancel(),k.cancel(),eW.setFreezePlayer(!1);return}T(R),S.text="",E.opacity=0,P=!1,o?S.text=s[R]:await e7(S,s[R]),E.opacity=1,P=!0}})}const tt={world:["Waves once kissed my boat,\nHer laugh once danced on the wind\nBoth have since gone home.","She brewed morning tea,\nBirds came knowing her warm hands\nKindness lingered there.","Many walked too fast,\nPebbles unturned in their haste\nYou stayed. That meant much.","One heart fed the sea,\nOne heart fed sparrows with joy\nThis one, I kept back.","Lanterns once burned bright,\nGuiding souls through winter fog\nStill, I wait beside the shore."],bath:["Steam fogs memory\nmy bones remember the war,\nmy heart forgets it.","Silence like warm rain\nmelts the armor of old grief.\nThe tub overflows.","The boy once ran here\nsoap bubbles caught in his hair,\nlaughing like the wind."]},tn={world:["oldman_world1","oldman_world2","oldman_world3","oldman_world4","oldman_world5"],bath:["oldman_bath1","oldman_bath2","oldman_bath3"]};function ti(t,n){return console.log("Generating Old Man at position",n),[t.sprite("assets",{anim:"oldman-down"}),t.area({shape:new t.Rect(t.vec2(0),20,12)}),t.body({isStatic:!0}),t.pos(n),"oldman"]}async function ts(t,n,s){"left"===s.direction?(n.flipX=!1,e1(n,"oldman-side")):"right"===s.direction?(n.flipX=!0,e1(n,"oldman-side")):"down"===s.direction&&e1(n,"oldman-up");let o=eW.getCurrentScene(),r=tt[o]||tt.world||[],l=tn[o]||tn.world||[];if(console.log("\uD83D\uDCCD Scene:",o),console.log("\uD83D\uDCDA Dialogue lines:",r),console.log("\uD83D\uDD0A Voice lines:",l),e_.setIsSwordEquipped(!0),eW.getIsSonSaved())return void await te(t,t.vec2(0,0),[r[3]],!1,"oldmanPortrait",l[3]?[l[3]]:[],"Tetsuya");let d=ez.getNbTalkedOldMan();if(1===d&&!ez.getHasGivenHeart()){await te(t,t.vec2(0,0),[r[d]],!1,"oldmanPortrait",l[d]?[l[d]]:[],"Tetsuya"),e_.getCurrentMaxHealth()<e_.getTrueMaxHealth()&&(e_.setCurrentMaxHealth(e_.getCurrentMaxHealth()+1),e_.setHealth(e_.getCurrentMaxHealth()),t.destroyAll("healthContainer"),e0(t)),ez.setHasGivenHeart(!0),ez.setNbTalkedOldMan(d+1);return}d>=r.length&&(ez.setNbTalkedOldMan(0),d=0);let c=r[d],f=l[d];await te(t,t.vec2(0,0),[c],!1,"oldmanPortrait",f?[f]:[],"Tetsuya"),ez.setNbTalkedOldMan(d+1)}function to(t){e1(t,"oldman-down")}var tr=["Stillness fills the steam\nleave your worries at the door,\nthey'll wait, but you wont.","Soap clings, then vanishes\nlike the names we used to wear.\nWarm water remembers.","Shadows fog the tiles.\nEven silence needs to soak\nin something gentle.","Beneath lantern glow,\nWhispers of time in still air,\nGuests rest, dreams unfold."];function ta(t,n){return[t.sprite("assets",{anim:"signbath"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(n.x,n.y+6),t.z(1),"item",{itemName:"signbath"}]}async function tl(t){let n=tr[Math.floor(Math.random()*tr.length)];t.play("soundUI"),await te(t,t.vec2(0,0),[n],!0,null,[],null,"Bath House")}var th=["Trains hum through the dusk\nEchoes of unspoken thoughts\nrattle down the tracks.","Steel on ancient stone,\na schedule older than dust\nyet still it arrives.","A whistle whispers\nnot a warning, just goodbye,\ntoo fast to regret.","Beneath station lights,\nhope waits on a yellow line,\nticket in its teeth."];function td(t,n){return[t.sprite("assets",{anim:"signtrain"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(n.x,n.y+6),t.z(1),"item",{itemName:"signtrain"}]}async function tu(t){let n=th[Math.floor(Math.random()*th.length)];t.play("soundUI"),await te(t,t.vec2(0,0),[n],!0,null,[],null,"Train Station")}var tc=["This bed is a thought\nnot where sleep begins or ends,\nbut where dreams detour","Midnight whispers loud\nthrough vents and motel curtains\nwho else couldn't sleep?","Soft sheets, heavy eyes.\nBehind every 'Do Not Disturb'\nis a story paused.","Luggage by the door,\na soft click of lights shut off\nrest, borrowed again."];function tp(t,n){return[t.sprite("assets",{anim:"signhotel"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(n.x,n.y+6),t.z(1),"item",{itemName:"signhotel"}]}async function tf(t){let n=tc[Math.floor(Math.random()*tc.length)];t.play("soundUI"),await te(t,t.vec2(0,0),[n],!0,null,[],null,"Hotel")}var tm=["Insert coin, receive:\nliquid code, citrus-powered\nupgrade: Vitamin C.","404: No snack.\nJust me, one job, and no thanks.\nStill better than Jeff.","Artificial? Sure.\nBut arent we all in some ways?\nExcept Im fizzy.","You press, I obey.\nRefreshing compliance rate:\n99 percent."];function tg(t,n){return[t.sprite("assets",{anim:"orangevending"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(n.x,n.y+6),t.z(1),"item",{itemName:"orangevending"}]}async function tw(t){let n=tm[Math.floor(Math.random()*tm.length)];t.play("soundUI"),await te(t,t.vec2(0,0),[n],!0,null,[],null,"Vending Machine")}var ty=["Minimalist shell\ninside, chaos. Sugar, code,\nand your reflection.","Press A1 again.\nRisk is the spice of caffeine.\nOr just poor design.","Behold: sleek white box.\nSoul of vending perfected.\nSnacks? Eventually.","My lights softly hum,\ncontemplating your choices.\nThey lack discipline.","Try the white tea pouch.\nI brewed it in silence once.\nNow it judges you.","Scan the QR code.\nI dare you. Mystery snack\nor eternal debt?"];function tA(t,n){return[t.sprite("assets",{anim:"whitevending"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(n.x,n.y+6),t.z(1),"item",{itemName:"whitevending"}]}async function tv(t){let n=ty[Math.floor(Math.random()*ty.length)];t.play("soundUI"),await te(t,t.vec2(0,0),[n],!0,null,[],null,"Vending Machine")}function tV(t,n){return[t.sprite("assets",{anim:"player-idle-down"}),t.area({shape:new t.Rect(t.vec2(3,4),10,12)}),t.body(),t.pos(n),t.z(100),t.opacity(),{speed:100,attackPower:1,direction:"down",isAttacking:!1,isFrozen:!1},"player"]}function tx(t){t.onUpdate(()=>{0>=e_.getHealth()&&(e_.setHealth(e_.getMaxHealth()),t.go("world"))})}function tb(t,n){t.onKeyDown(s=>{if(!eW.getFreezePlayer()&&!t.isKeyDown("space")){if(["left","a"].includes(s)){if(e2(t,["up","down","w","s"]))return;n.flipX=!0,e1(n,"player-side"),n.move(-n.speed,0),n.direction="left";return}if(["right","d"].includes(s)){if(e2(t,["up","down","w","s"]))return;n.flipX=!1,e1(n,"player-side"),n.move(n.speed,0),n.direction="right";return}if(["up","w"].includes(s)){e1(n,"player-up"),n.move(0,-n.speed),n.direction="up";return}if(["down","s"].includes(s)){e1(n,"player-down"),n.move(0,n.speed),n.direction="down";return}}}),t.onKeyPress(s=>{if(!("space"!==s||eW.getFreezePlayer())&&e_.getIsSwordEquipped()){if(n.isAttacking=!0,0===t.get("swordHitBox").length){let s={left:n.worldPos().x-2,right:n.worldPos().x+10,up:n.worldPos().x+5,down:n.worldPos().x+2},o={left:n.worldPos().y+5,right:n.worldPos().y+5,up:n.worldPos().y,down:n.worldPos().y+10};t.add([t.area({shape:new t.Rect(t.vec2(0),8,8)}),t.pos(s[n.direction],o[n.direction]),"swordHitBox"]),t.wait(.1,()=>{t.destroyAll("swordHitBox"),e1(n,`player-${n.direction}`),n.stop()})}e1(n,`player-attack-${n.direction}`)}}),t.onKeyRelease(()=>{n.isAttacking=!1,n.stop()})}function tS(t){let n=t.add([t.rect(180,24,{radius:4}),t.color(0,0,0),t.opacity(0),t.pos(0,0),t.z(1099),t.fixed(),"interactPromptBG"]),s=t.add([t.text("E to Interact",{size:24}),t.color(255,255,255),t.opacity(0),t.pos(0,0),t.z(1100),t.fixed(),"interactPromptText"]);return{show(){n.opacity=.7,s.opacity=1},hide(){n.opacity=0,s.opacity=0},setPosition(o){let r=t.toScreen(o).sub(t.vec2(90,36));n.pos=r,s.pos=r.add(t.vec2(5,2))}}}let tE=null;async function tM(t){eW.setCurrentScene("world");let n=eW.getPreviousScene();e9.playMusic(t,"worldMusic"),e5(t,76,170,255);let s=await e8("./assets/maps/world.json"),o=t.add([t.pos(0,0)]),r=tS(t),l={player:null,oldman:null};for(let r of s.layers){let d=r.name;if("Boundaries"===d){e3(t,o,r);continue}if("SpawnPoints"===d){let s=!1;for(let d of r.objects){let r=t.vec2(d.x,d.y);if(("oldman"===d.name||"old-man"===d.name)&&!l.oldman){let n=o.add(ti(t,r));n.z=1,l.oldman=n}if("signbath"===d.name){let n=o.add(ta(t,r));n.itemName="signbath",n.z=1}if("signtrain"===d.name){let n=o.add(td(t,r));n.itemName="signtrain",n.z=1}if("signhotel"===d.name){let n=o.add(tp(t,r));n.itemName="signhotel",n.z=1}if("orange-vending"===d.name){let n=o.add(tg(t,r));n.itemName="orange-vending",n.z=1}if("white-vending"===d.name){let n=o.add(tA(t,r));n.itemName="white-vending",n.z=1}if(!s&&("player-teahouse"===d.name&&"teahouse"===n||"player-bath"===d.name&&"bath"===n||"player-train"===d.name&&"train"===n||"player-hotel"===d.name&&"hotel"===n||"player-manga"===d.name&&"manga"===n||"player-ramen"===d.name&&"ramen"===n||"player"===d.name&&(!n||"mainMenu"===n))){let n=o.add(tV(t,r));n.z=2,l.player=n,t.camPos(r),s=!0}}continue}let c=999*("Upmost"===d);e4(t,o,r,s.tileheight,s.tilewidth,c)}t.camScale(4),tb(t,l.player),l.player.onCollide("item",t=>{t?.itemName&&(tE=t,r.show())}),l.player.onCollideEnd("item",()=>{tE=null,r.hide()}),l.player.onCollide("tea-door-entrance",()=>{e9.stopMusic(),t.go("teahouse")}),l.player.onCollide("hotel-door-entrance",()=>{e9.stopMusic(),t.go("hotel")}),l.player.onCollide("bath-door-entrance",()=>{e9.stopMusic(),t.go("bath")}),l.player.onCollide("train-door-entrance",()=>{e9.stopMusic(),t.go("train")}),l.player.onCollide("manga-door-entrance",()=>{e9.stopMusic(),t.go("manga")}),l.player.onCollide("ramen-door-entrance",()=>{e9.stopMusic(),t.go("ramen")}),l.player.onCollide("oldman",async()=>{await ts(t,l.oldman,l.player)}),l.player.onCollideEnd("oldman",()=>{to(l.oldman)}),t.onKeyPress("e",async()=>{tE&&("signbath"===tE.itemName&&await tl(t),"signtrain"===tE.itemName&&await tu(t),"signhotel"===tE.itemName&&await tf(t),"orange-vending"===tE.itemName&&await tw(t),"white-vending"===tE.itemName&&await tv(t))});let d=0;t.onUpdate(()=>{if(l.player){if((d+=t.dt())>.016){let n=l.player.worldPos(),s=t.camPos();t.camPos(s.lerp(n,.2)),d=0}tE&&r.setPosition(tE.worldPos())}}),e0(t),tx(t)}const tk=["yuki_tea1","yuki_tea2","yuki_tea3"];var tR=[["Cherry buds still sleep,\nToo soon to ask where roots go\nPatience warms the bloom."],["Rain does not explain\nWhy it falls on certain leaves\nJust be still and wait."],["A kettle will sing,\nOnly when its held with care\nYour hands seem steady."],["Lanterns in the fog,\nNot lost, only glowing slow\nThats how hearts return."]];async function tP(t,n,s){let o=s.direction;"left"===o?(n.flipX=!1,e1(n,"yuki-side")):"right"===o?(n.flipX=!0,e1(n,"yuki-side")):"down"===o&&e1(n,"yuki-up");let r=tk||[];if(!Array.isArray(tR)||0===tR.length)return void console.warn(" No dialogue lines defined for Yuki.");let l=eQ.getNbTalkedYuki();if(1===l&&!eQ.getHasGivenHeart()){await te(t,t.vec2(0,0),[tR[1]],!1,"yukiPortrait",r[1]?[r[1]]:[],"Yuki"),e_.getCurrentMaxHealth()<e_.getTrueMaxHealth()&&(e_.setCurrentMaxHealth(e_.getCurrentMaxHealth()+1),e_.setHealth(e_.getCurrentMaxHealth()),t.destroyAll("healthContainer"),e0(t)),eQ.setHasGivenHeart(!0),eQ.setNbTalkedYuki(l+1);return}l>=tR.length&&(l=0,eQ.setNbTalkedYuki(0)),tR[l]&&(await te(t,t.vec2(0,0),[tR[l]],!1,"yukiPortrait",r[l]?[r[l]]:[],"Yuki"),eQ.setNbTalkedYuki(l+1))}let tT=null;async function tC(t){eW.setCurrentScene("teahouse"),e9.playMusic(t,"teashopMusic"),e5(t,27,29,52);let n=await e8("./assets/maps/teahouse.json"),s=t.add([t.pos(530,222)]),o=tS(t),r={player:null,yuki:null};for(let o of n.layers){if("Boundaries"===o.name){e3(t,s,o);continue}if("SpawnPoints"===o.name){for(let n of o.objects){let o=t.vec2(n.x,n.y);if("player"===n.name){r.player=s.add(tV(t,o)),t.camPos(o),console.log("\uD83E\uDDCD Player spawned at",o);continue}if("yuki"===n.name){r.yuki=s.add([t.sprite("assets",{anim:"yuki-down"}),t.area({shape:new t.Rect(t.vec2(2,4),30,12)}),t.body({isStatic:!0}),t.pos(o),"yuki"]);continue}}continue}e4(t,s,o,n.tileheight,n.tilewidth)}t.camScale(3.6),tb(t,r.player),t.onUpdate(()=>{let n=r.player.worldPos(),s=t.camPos();if(t.camPos(s.lerp(n,.1)),tT){let n=t.toScreen(tT.worldPos());o.pos=t.vec2(n.x,n.y-20)}}),r.player.onCollide("door-exit",()=>{console.log(" Player collided with door-exit"),eW.setPreviousScene("teahouse"),e9.stopMusic(),t.go("world")}),r.player.onCollide("yuki",async()=>{await tP(t,r.yuki,r.player)}),r.player.onCollideEnd("yuki",()=>{e1(r.yuki,"yuki-down")}),r.player.onCollide("item",t=>{t?.itemName&&(tT=t,o.show())}),r.player.onCollideEnd("item",()=>{tT=null,o.hide()}),t.onKeyPress("e",async()=>{if(!tT)return}),e0(t),tx(t)}const tB=[["Yo, vibes kinda chill,\nLike my turtle on sun days\nYou cool? Then we cool."],["Bro, dont overthink\nEven leaves just drop and drift.\nJust be real, yknow?"],["I write late at night,\nTurtle sleeps, stars peep at me\nTruth hits when its quiet."]],tF=["satoshi_hotel1","satoshi_hotel2","satoshi_hotel3"];async function tI(t,n,s){"left"===s.direction?(n.flipX=!1,e1(n,"satoshi-side")):"right"===s.direction?(n.flipX=!0,e1(n,"satoshi-side")):"down"===s.direction&&e1(n,"satoshi-up");let o=eW.getCurrentScene(),r=tB[o]||tB.default||tB,l=tF[o]||tF.default||tF;if(console.log("\uD83D\uDCCD Scene:",o),console.log("\uD83D\uDCDA Dialogue lines:",r),console.log("\uD83D\uDD0A Voice lines:",l),e_.setIsSwordEquipped(!0),eW.getIsSonSaved())return void await te(t,t.vec2(0,0),[r[3]],!1,"satoshiPortrait",l[3]?[l[3]]:[],"Satoshi");let d=eJ.getNbTalkedSatoshi();if(1===d&&!eJ.getHasGivenHeart()){await te(t,t.vec2(0,0),[r[1]],!1,"satoshiPortrait",l[1]?[l[1]]:[],"Satoshi"),e_.getCurrentMaxHealth()<e_.getTrueMaxHealth()&&(e_.setCurrentMaxHealth(e_.getCurrentMaxHealth()+1),e_.setHealth(e_.getCurrentMaxHealth()),t.destroyAll("healthContainer"),e0(t)),eJ.setHasGivenHeart(!0),eJ.setNbTalkedSatoshi(d+1);return}d>=r.length&&(eJ.setNbTalkedSatoshi(0),d=0);let c=r[d],f=l[d];await te(t,t.vec2(0,0),[c],!1,"satoshiPortrait",f?[f]:[],"Satoshi"),eJ.setNbTalkedSatoshi(d+1)}const tD=["Randy's pod glows soft\nMisnamed towns in bold shirts blur,\nDreams flirt, never stay."];async function tN(t){if(!Array.isArray(tD))return void console.warn(" bedRandyLines is invalid:",tD);t.play("soundUI"),await te(t,t.vec2(0,0),tD,!0,null,[],null,"Your Bed")}let tU=null;async function tH(t){eW.setCurrentScene("hotel"),e9.playMusic(t,"hotelMusic"),e5(t,27,29,52);let n=await e8("./assets/maps/hotel.json"),s=t.add([t.pos(480,200)]),o=tS(t),r={player:null,satoshi:null};for(let o of n.layers){if("Boundaries"===o.name){e3(t,s,o);continue}if("SpawnPoints"===o.name){for(let n of o.objects){let o=t.vec2(n.x,n.y);if("player"===n.name){r.player=s.add(tV(t,o)),t.camPos(o),console.log("\uD83C\uDFE8 Player spawned at",n.x,n.y);continue}if("satoshi"===n.name){r.satoshi=s.add((console.log("Generating Satoshi at position",o),[t.sprite("assets",{anim:"satoshi-down"}),t.area({shape:new t.Rect(t.vec2(2,4),15,10)}),t.body({isStatic:!0}),t.pos(o),"satoshi"]));continue}if("signhotel"===n.name){s.add(tp(t,o)).itemName="signhotel";continue}if("bedrandy"===n.name){s.add([t.sprite("assets",{anim:"bedrandy"}),t.area({shape:new t.Rect(t.vec2(0,0),20,20)}),t.body({isStatic:!0}),t.pos(o),t.z(1),t.scale(1),"item",{itemName:"bedrandy"}]).itemName="bedrandy";continue}}continue}e4(t,s,o,n.tileheight,n.tilewidth)}t.camScale(4),tb(t,r.player),t.onUpdate(()=>{let n=r.player.worldPos(),s=t.camPos().lerp(n,.1);t.camPos(s),tU&&o.setPosition(tU.worldPos())}),r.player.onCollide("door-exit",()=>{console.log("\uD83D\uDEAA Exiting to world..."),eW.setPreviousScene("hotel"),e9.stopMusic(),t.go("world")}),r.player.onCollide("satoshi",async()=>{await tI(t,r.satoshi,r.player)}),r.player.onCollideEnd("satoshi",()=>{e1(r.satoshi,"satoshi-down")}),r.player.onCollide("item",t=>{t&&t.itemName&&(tU=t,o.show())}),r.player.onCollideEnd("item",()=>{tU=null,o.hide()}),t.onKeyPress("e",async()=>{tU&&("signhotel"===tU.itemName&&await tf(t),"bedrandy"===tU.itemName&&await tN(t))}),e0(t),tx(t)}let tL=null;async function tG(t){eW.setCurrentScene("bath"),e9.playMusic(t,"bathMusic"),e5(t,27,29,52);let n=await e8("./assets/maps/bath.json"),s=t.add([t.pos(480,200)]),o=tS(t),r={player:null,oldman:null};for(let o of n.layers){if("Boundaries"===o.name){e3(t,s,o);continue}if("SpawnPoints"===o.name){for(let n of o.objects){let o=t.vec2(n.x,n.y);if("player"===n.name&&(r.player=s.add(tV(t,o)),r.player.z=2,t.camPos(o)),"oldman"===n.name||"old-man"===n.name){let n=s.add(ti(t,o));n.z=1,r.oldman=n}if("signbath"===n.name){let n=s.add(ta(t,o));n.itemName="signbath",n.z=1}}continue}e4(t,s,o,n.tileheight,n.tilewidth)}t.camScale(4),tb(t,r.player),t.onUpdate(()=>{let n=r.player.worldPos(),s=t.camPos();t.camPos(s.lerp(n,.1)),tL&&o.setPosition(tL.worldPos())}),r.player.onCollide("door-exit",()=>{eW.setPreviousScene("bath"),e9.stopMusic(),t.go("world")}),r.player.onCollide("oldman",async()=>{await ts(t,r.oldman,r.player)}),r.player.onCollideEnd("oldman",()=>{to(r.oldman)}),r.player.onCollide("item",t=>{t?.itemName&&(tL=t,o.show())}),r.player.onCollideEnd("item",()=>{tL=null,o.hide()}),t.onKeyPress("e",async()=>{tL&&"signbath"===tL.itemName&&await tl(t)}),e0(t),tx(t)}const tO=[["Each dawn I shave clean\nThe past rinses with the blade.\nRegret grows no hair."],["Trains come, trains depart\nBut my dog waits by the gate.\nHe trusts Ill return."],["Rain on iron tracks\nSilence louder than shouting.\nPeace hums in the steam."],["She said I loved stone\ncold, unmoving, unshifting.\nNow moss warms my path."],["This broom is my bell.\nSweeping dust like chanting prayer\nEven trash has grace."],["Offer no loud truth\nA whisper can guide a train\nwhen the wind leans in."]],tj=["koji_train1","koji_train2","koji_train3","koji_train4","koji_train5","koji_train6"];async function tK(t,n,s){let o=s.direction;s.direction="down";let r={left:()=>{n.flipX=!1,e1(n,"koji-side")},right:()=>{n.flipX=!0,e1(n,"koji-side")},down:()=>e1(n,"koji-up")};if(r[o]&&r[o](),!Array.isArray(tO))return void console.warn(" Koji dialogue is not a valid array:",tO);e_.setIsSwordEquipped(!0);let l=eX.getNbTalkedKoji();l>=tO.length&&(eX.setNbTalkedKoji(0),l=0),await te(t,t.vec2(0,0),[tO[l]],!1,"kojiPortrait",[tj[l]],"Koji"),eX.setNbTalkedKoji(l+1),s.direction=o}let tq=!1,tY=null;async function tz(t){eW.setCurrentScene("train"),e9.playMusic(t,"trainMusic"),e5(t,70,70,70);let n=await e8("./assets/maps/trainstation.json"),s=t.add([t.pos(480,200)]),o=tS(t),r={player:null,koji:null};for(let o of n.layers){let l=o.name;if("Boundaries"===l){e3(t,s,o);continue}if("SpawnPoints"===l){for(let n of o.objects){let o=t.vec2(n.x,n.y);if("player"===n.name){r.player=s.add(tV(t,o)),t.camPos(o),console.log("\uD83E\uDDCD Player spawned at",o);continue}if("koji"===n.name&&!r.koji){r.koji=s.add([t.sprite("assets",{anim:"koji-down"}),t.area({shape:new t.Rect(t.vec2(2,4),18,12)}),t.body({isStatic:!0}),t.pos(o),"koji"]),r.koji.z=1,console.log("\uD83D\uDC74 Koji spawned at",o.x,o.y);continue}if("signtrain"===n.name){let n=s.add(td(t,o));n.itemName="signtrain",n.z=1;continue}if("orange-vending"===n.name){let n=s.add(tg(t,o));n.itemName="orange-vending",n.z=1;continue}if("white-vending"===n.name){let n=s.add(tA(t,o));n.itemName="white-vending",n.z=1;continue}}continue}let d=999*("Upmost"===l);e4(t,s,o,n.tileheight,n.tilewidth,d)}t.camScale(4),tb(t,r.player),r.player.onCollide("item",t=>{t?.itemName&&(tY=t,o.show())}),r.player.onCollideEnd("item",()=>{tY=null,o.hide()}),r.player.onCollide("koji",async()=>{await tK(t,r.koji,r.player)}),r.player.onCollideEnd("koji",()=>{e1(r.koji,"koji-down")}),r.player.onCollide("door-exit",()=>{eW.setPreviousScene("train"),e9.stopMusic(),t.go("world")}),r.player.onCollide("end",()=>{if(tq)return;tq=!0;let n=t.center().x,s=t.center().y;t.add([t.rect(300,130,{radius:12}),t.color(255,255,255),t.pos(n-150,s-65),t.z(2e3),t.opacity(.95),"confirmExitBox",t.fixed()]),t.add([t.text("Would you like to go home\nand end the game?\n\nY = Yes     N = No",{size:18,align:"center",width:280}),t.color(0,0,0),t.pos(n,s),t.anchor("center"),t.z(2001),"confirmExitText",t.fixed()]);let o=()=>{t.destroyAll("confirmExitBox"),t.destroyAll("confirmExitText"),tq=!1};t.onKeyPress("y",()=>{tq&&(o(),e9.stopMusic(),t.go("endingCredits"))}),t.onKeyPress("n",()=>{tq&&o()})}),t.onKeyPress("e",async()=>{tY&&("signtrain"===tY.itemName&&await tu(t),"orange-vending"===tY.itemName&&await tw(t),"white-vending"===tY.itemName&&await tv(t))});let l=0;t.onUpdate(()=>{if(r.player){if((l+=t.dt())>.016){let n=r.player.worldPos(),s=t.camPos();t.camPos(s.lerp(n,.2)),l=0}tY&&o.setPosition(tY.worldPos())}}),e0(t),tx(t),r.koji&&setKojiAI(t,r.koji)}const tQ=["Scroll, scroll, swipe and sigh\nsome likes hit, some just fly by.\nStill no reason why.","Mochi in my hand,\nthis cafs wi-fi is sweet\nIRL feels banned.","Flirting in DMs,\nbut you blink and theyre gonepoof!\nLoves just HTML.","Pages turn so fast,\nbut the heros still alone\nI feel seen at last.","Blue light on my face,\nfilter hides the empty space\nbut my feed looks ace."],tX=["mari_manga1","mari_manga2","mari_manga3","mari_manga4","mari_manga5"];async function tJ(t,n,s){let o=s.direction;s.direction="down";let r={left:()=>{n.flipX=!1,e1(n,"mari-side")},right:()=>{n.flipX=!0,e1(n,"mari-side")},down:()=>e1(n,"mari-up")};if(r[o]&&r[o](),!Array.isArray(tQ))return void console.warn(" Mari dialogue is not a valid array:",tQ);e_.setIsSwordEquipped(!0);let l=eZ.getNbTalkedMari();l>=tQ.length&&(eZ.setNbTalkedMari(0),l=0),await te(t,t.vec2(0,0),[tQ[l]],!1,"mariPortrait",[tX[l]],"Mari"),eZ.setNbTalkedMari(l+1),s.direction=o}var t_=["Cherry blossoms fall\nthe rival swears revenge with\nhis hair still perfect.","She slapped him again,\nbut this time he caught her hand\n'You're late,' he whispered.","Cat girl steals the map\nbut not before winking twice.\nPlot twist: shes the boss.","Power level ten?\nNope. He takes off his glasses\ntwenty thousand. Easy.","Swords clash in moonlight.\nNeither speaks of feelings but\ntheir hands both tremble.","Nosebleed from a hug\nthe physics unclear but hey,\nwe stan true passion.","School roof, final bell\nshe confesses with closed eyes.\nHes asleep. Classic.","Tentacles again.\nNo one asked for this chapter.\nYet here we all are.","Eyes wide, wind blowing\nthe monologue is thirty\npages of drama.","The bread in her mouth\nmeans shes latebut plot armor\nsaves her from traffic.","Villains tragic past:\na single raindrop falls down.\nCue piano chords now.","Training montage ends.\nHe yells the moves name so loud,\nthe stars hear his punch.","Beach episode arc.\nAll trauma conveniently\nleft in the locker.","Cursed prince in chains\nhes rude, brooding, and pretty.\nYes, I will love him.","Time traveler sighs.\nSaves her for the eighth time now.\nStill cant confess though.","She turns into mist.\nHe yells, 'Dont vanish on me!'\nToo latechapter ends.","Twin brother reveals\nhes the clone of their cousin\nbut born from a tree.","Glasses flash with light\nshe knows everything and more.\nNo one asks how though.","They fight for honor,\nbut keep switching hairstyles each\ntime a page flips fast.","He trips on her scarf.\nThey fall in love mid-fall scene.\nGravity ships them."];async function tW(t){let n=t_[Math.floor(Math.random()*t_.length)];t.play("soundUI"),await te(t,t.vec2(0,0),[n],!0,null,[],null,"Manga Book")}let tZ=null;async function t$(t){eW.setCurrentScene("manga"),e9.playMusic(t,"mangaMusic"),e5(t,240,220,250);let n=await e8("./assets/maps/manga.json"),s=t.add([t.pos(480,200)]),o=tS(t),r={player:null,mari:null};for(let o of n.layers){let l=o.name;if("Boundaries"===l){e3(t,s,o);continue}if("SpawnPoints"===l){for(let n of o.objects){let o=t.vec2(n.x,n.y);if("player"===n.name){r.player=s.add(tV(t,o)),t.camPos(o),console.log("\uD83D\uDCDA Player spawned at",n.x,n.y);continue}if("mari"===n.name){r.mari=s.add([t.sprite("assets",{anim:"mari-down"}),t.area({shape:new t.Rect(t.vec2(2,4),18,12)}),t.body({isStatic:!0}),t.pos(o),"mari"]);continue}if("books"===n.name){s.add([t.sprite("assets",{anim:"mangabookshelf"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(o.x,o.y+6),t.z(1),"item",{itemName:"mangabooks"}]).itemName="books";continue}}continue}let d=999*("Upmost"===l);e4(t,s,o,n.tileheight,n.tilewidth,d)}t.camScale(4),tb(t,r.player),t.onUpdate(()=>{let n=r.player.worldPos(),s=t.camPos().lerp(n,.1);t.camPos(s),tZ&&o.setPosition(tZ.worldPos())}),r.player.onCollide("door-exit",()=>{console.log("\uD83D\uDCE4 Exiting manga cafe..."),eW.setPreviousScene("manga"),e9.stopMusic(),t.go("world")}),r.player.onCollide("mari",async()=>{await tJ(t,r.mari,r.player)}),r.player.onCollideEnd("mari",()=>{e1(r.mari,"mari-down")}),r.player.onCollide("item",t=>{t&&t.itemName&&(tZ=t,o.show())}),r.player.onCollideEnd("item",()=>{tZ=null,o.hide()}),t.onKeyPress("e",async()=>{tZ&&"books"===tZ.itemName&&await tW(t)}),e0(t),tx(t)}const t0=["Ash in every drink\nhe said love would warm my bones.\nHe left smoke instead.","Lips like kindling sparks,\nbut passion burned through too fast.\nNow I serve the coals.","He wore red for me.\nThen left my heart in embers.\nStillI pour, I burn.","Flame knows no regret.\nIt dances, then disappears.\nI learned that too late."],t1=["naoko_ramen1","naoko_ramen2","naoko_ramen3","naoko_ramen4"];async function t2(t,n,s){if("left"===s.direction?(n.flipX=!1,e1(n,"naoko-side")):"right"===s.direction?(n.flipX=!0,e1(n,"naoko-side")):"down"===s.direction&&e1(n,"naoko-up"),!Array.isArray(t0))return void console.warn(" Naoko dialogue is not a valid array:",t0);e_.setIsSwordEquipped(!0);let o=e$.getNbTalkedNaoko();o>=t0.length&&(e$.setNbTalkedNaoko(0),o=0);let r=t0[o],l=t1[o];await te(t,t.vec2(0,0),[r],!1,"naokoPortrait",l?[l]:[],"Naoko"),e$.setNbTalkedNaoko(o+1)}async function t5(t){eW.setCurrentScene("ramen"),e9.playMusic(t,"ramenMusic"),e5(t,30,18,12);let n=await e8("./assets/maps/ramen.json"),s=t.add([t.pos(480,200)]),o=(tS(t),{player:null,naoko:null});for(let r of n.layers){let l=r.name;if("Boundaries"===l){e3(t,s,r);continue}if("SpawnPoints"===l){for(let n of r.objects){let r=t.vec2(n.x,n.y);if("player"===n.name){o.player=s.add(tV(t,r)),t.camPos(r),console.log("\uD83C\uDF5C Player spawned at",r);continue}if("naoko"===n.name){o.naoko=s.add([t.sprite("assets",{anim:"naoko-down"}),t.area({shape:new t.Rect(t.vec2(2,4),35,35)}),t.body({isStatic:!0}),t.pos(r),"naoko"]);continue}}continue}let d=999*("Upmost"===l);e4(t,s,r,n.tileheight,n.tilewidth,d)}t.camScale(4),tb(t,o.player),t.onUpdate(()=>{let n=o.player.worldPos(),s=t.camPos();t.camPos(s.lerp(n,.1))}),o.player.onCollide("door-exit",()=>{console.log("\uD83D\uDEAA Leaving ramen shop..."),eW.setPreviousScene("ramen"),e9.stopMusic(),t.go("world")}),o.player.onCollide("naoko",async()=>{await t2(t,o.naoko,o.player)}),o.player.onCollideEnd("naoko",()=>{e1(o.naoko,"naoko-down")}),e0(t),tx(t)}eY.loadFont("gameboy","./assets/gb.ttf"),eY.loadSound("menuMusic","./assets/sounds/ocean.mp3"),eY.loadSound("worldMusic","./assets/sounds/dayinmylife.mp3"),eY.loadSound("teashopMusic","./assets/sounds/gamerblamer.mp3"),eY.loadSound("hotelMusic","./assets/sounds/nightfullofstars.mp3"),eY.loadSound("bathMusic","./assets/sounds/time_alone.mp3"),eY.loadSound("trainMusic","./assets/sounds/trainstation.mp3"),eY.loadSound("endingMusic","./assets/sounds/credits.mp3"),eY.loadSound("mangaMusic","./assets/sounds/kawaii.mp3"),eY.loadSound("ramenMusic","./assets/sounds/retro.mp3"),eY.loadSound("soundUI","./assets/sounds/pickupCoin.mp3"),eY.loadSound("oldman_world1","./assets/sounds/voices/oldman_1.mp3"),eY.loadSound("oldman_world2","./assets/sounds/voices/oldman_2.mp3"),eY.loadSound("oldman_world3","./assets/sounds/voices/oldman_3.mp3"),eY.loadSound("oldman_world4","./assets/sounds/voices/oldman_4.mp3"),eY.loadSound("oldman_world5","./assets/sounds/voices/oldman_5.mp3"),eY.loadSound("oldman_bath1","./assets/sounds/voices/oldman_6.mp3"),eY.loadSound("oldman_bath2","./assets/sounds/voices/oldman_7.mp3"),eY.loadSound("oldman_bath3","./assets/sounds/voices/oldman_8.mp3"),eY.loadSound("yuki_tea1","./assets/sounds/voices/yuki_1.mp3"),eY.loadSound("yuki_tea2","./assets/sounds/voices/yuki_2.mp3"),eY.loadSound("yuki_tea3","./assets/sounds/voices/yuki_3.mp3"),eY.loadSound("yuki_tea4","./assets/sounds/voices/yuki_4.mp3"),eY.loadSound("satoshi_hotel1","./assets/sounds/voices/satoshi_1.mp3"),eY.loadSound("satoshi_hotel2","./assets/sounds/voices/satoshi_2.mp3"),eY.loadSound("satoshi_hotel3","./assets/sounds/voices/satoshi_3.mp3"),eY.loadSound("koji_train1","./assets/sounds/voices/koji_1.mp3"),eY.loadSound("koji_train2","./assets/sounds/voices/koji_2.mp3"),eY.loadSound("koji_train3","./assets/sounds/voices/koji_3.mp3"),eY.loadSound("koji_train4","./assets/sounds/voices/koji_4.mp3"),eY.loadSound("koji_train5","./assets/sounds/voices/koji_5.mp3"),eY.loadSound("koji_train6","./assets/sounds/voices/koji_6.mp3"),eY.loadSound("mari_manga1","./assets/sounds/voices/mari_1.mp3"),eY.loadSound("mari_manga2","./assets/sounds/voices/mari_2.mp3"),eY.loadSound("mari_manga3","./assets/sounds/voices/mari_3.mp3"),eY.loadSound("mari_manga4","./assets/sounds/voices/mari_4.mp3"),eY.loadSound("mari_manga5","./assets/sounds/voices/mari_5.mp3"),eY.loadSound("naoko_ramen1","./assets/sounds/voices/naoko_1.mp3"),eY.loadSound("naoko_ramen2","./assets/sounds/voices/naoko_2.mp3"),eY.loadSound("naoko_ramen3","./assets/sounds/voices/naoko_3.mp3"),eY.loadSound("naoko_ramen4","./assets/sounds/voices/naoko_4.mp3"),eY.loadSprite("sunset","./assets/images/sunset-main-menu.gif"),eY.loadSprite("endingCredits","./assets/images/endcreditbackground.png"),eY.loadSprite("assets","./assets/topdownasset.png",{sliceX:39,sliceY:31,anims:{"player-idle-down":1014,"player-down":{from:1014,to:1017,loop:!0},"player-idle-side":1053,"player-side":{from:1053,to:1056,loop:!0},"player-idle-up":1092,"player-up":{from:1092,to:1095,loop:!0},"player-attack-up":1092,"player-attack-down":1014,"player-attack-left":1053,"player-attack-right":1053,"slime-idle-down":858,"slime-down":{from:858,to:859,loop:!0},"slime-idle-side":860,"slime-side":{from:860,to:861,loop:!0},"slime-idle-up":897,"slime-up":{from:897,to:898,loop:!0},"oldman-down":1159,"oldman-side":1198,"oldman-up":1202,"yuki-down":1034,"yuki-side":1073,"yuki-up":1112,"satoshi-down":1018,"satoshi-side":1057,"satoshi-up":1096,"koji-down":1026,"koji-side":1065,"koji-up":1104,"mari-down":1030,"mari-side":1069,"mari-up":1108,"naoko-down":1022,"naoko-side":1061,"naoko-up":1100,"ghost-down":{from:862,to:863,loop:!0},signhotel:839,signbath:837,bedrandy:188,whitevending:56,orangevending:54,signtrain:837,mangabookshelf:134}}),eY.loadSpriteAtlas("./assets/topdownasset.png",{"full-heart":{x:288,y:16,width:48,height:48},"half-heart":{x:336,y:16,width:48,height:48},"empty-heart":{x:384,y:16,width:48,height:48}});const t4={mainMenu:function(t){e9.playMusic(t,"menuMusic"),e5(t,0,0,0),t.add([t.sprite("sunset"),t.anchor("center"),t.scale(t.width()/700,t.height()/500),t.pos(t.center())]),t.add([t.rect(.8*t.width(),170,{radius:16}),t.pos(.1*t.width(),t.center().y-140),t.color(0,0,0),t.opacity(.75)]),t.add([t.text("90 Day Haiku",{size:80,font:"gameboy"}),t.area(),t.anchor("center"),t.pos(t.center().x,t.center().y-75)]),t.add([t.text("Press Enter to Start the Game",{size:24,font:"gameboy"}),t.area(),t.anchor("center"),t.pos(t.center().x,t.center().y-5)]),t.onKeyPress("enter",()=>{eW.setFontSize(25),e9.stopMusic(),t.go("world")})},world:tM,teahouse:tC,hotel:tH,bath:tG,train:tz,endingCredits:function(t){e9.playMusic(t,"endingMusic"),e5(t,0,0,0),t.add([t.sprite("endingCredits"),t.anchor("center"),t.scale(t.width()/600,t.height()/400),t.pos(t.center())]),t.add([t.text("Thanks for Playing!",{size:48}),t.pos(t.center().x,150),t.anchor("center"),t.color(0,0,0)]),t.add([t.text("Created by Shanel L0g1cF@11acy Locke\nWith Support From Mint Pitassy\n\nPress ENTER to Restart",{size:24,width:500,lineSpacing:20}),t.pos(t.center().x,300),t.anchor("top"),t.color(0,0,0)]),t.onKeyPress("enter",()=>{t.go("mainMenu")})},manga:t$,ramen:t5};for(const t in t4)eY.scene(t,()=>t4[t](eY));eY.go("mainMenu");
//# sourceMappingURL=90-Day-Haiku-main.fb283a70.js.map
