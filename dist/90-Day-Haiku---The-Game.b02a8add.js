let t,n,o,s;var r=Object.defineProperty,l=(t,n)=>r(t,"name",{value:n,configurable:!0}),d=(()=>{for(var t=new Uint8Array(128),n=0;n<64;n++)t[n<26?n+65:n<52?n+71:n<62?n-4:4*n-205]=n;return n=>{for(var o=n.length,s=new Uint8Array((o-("="==n[o-1])-("="==n[o-2]))*3/4|0),r=0,l=0;r<o;){var d=t[n.charCodeAt(r++)],c=t[n.charCodeAt(r++)],f=t[n.charCodeAt(r++)],g=t[n.charCodeAt(r++)];s[l++]=d<<2|c>>4,s[l++]=c<<4|f>>2,s[l++]=f<<6|g}return s}})();function c(t){return t*Math.PI/180}function f(t){return 180*t/Math.PI}function g(t,n,o){return n>o?g(t,o,n):Math.min(Math.max(t,n),o)}function y(t,n,o){if("number"==typeof t&&"number"==typeof n)return t+(n-t)*o;if(t instanceof A&&n instanceof A||t instanceof k&&n instanceof k)return t.lerp(n,o);throw Error(`Bad value for lerp(): ${t}, ${n}. Only number, Vec2 and Color is supported.`)}function w(t,n,o,s,r){return s+(t-n)/(o-n)*(r-s)}function v(t,n,o,s,r){return g(w(t,n,o,s,r),s,r)}l(c,"deg2rad"),l(f,"rad2deg"),l(g,"clamp"),l(y,"lerp"),l(w,"map"),l(v,"mapc");var A=class t{static{l(this,"Vec2")}x=0;y=0;constructor(t=0,n=t){this.x=t,this.y=n}static fromAngle(n){let o=c(n);return new t(Math.cos(o),Math.sin(o))}static LEFT=new t(-1,0);static RIGHT=new t(1,0);static UP=new t(0,-1);static DOWN=new t(0,1);clone(){return new t(this.x,this.y)}add(...n){let o=x(...n);return new t(this.x+o.x,this.y+o.y)}sub(...n){let o=x(...n);return new t(this.x-o.x,this.y-o.y)}scale(...n){let o=x(...n);return new t(this.x*o.x,this.y*o.y)}dist(...t){let n=x(...t);return this.sub(n).len()}sdist(...t){let n=x(...t);return this.sub(n).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let n=this.len();return 0===n?new t(0):this.scale(1/n)}normal(){return new t(this.y,-this.x)}reflect(t){return this.sub(t.scale(2*this.dot(t)))}project(t){return t.scale(t.dot(this)/t.len())}reject(t){return this.sub(this.project(t))}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(...t){let n=x(...t);return f(Math.atan2(this.y-n.y,this.x-n.x))}angleBetween(...t){let n=x(...t);return f(Math.atan2(this.cross(n),this.dot(n)))}lerp(n,o){return new t(y(this.x,n.x,o),y(this.y,n.y,o))}slerp(t,n){let o=this.dot(t),s=this.cross(t),r=Math.atan2(s,o);return this.scale(Math.sin((1-n)*r)).add(t.scale(Math.sin(n*r))).scale(1/s)}isZero(){return 0===this.x&&0===this.y}toFixed(n){return new t(Number(this.x.toFixed(n)),Number(this.y.toFixed(n)))}transform(t){return t.multVec2(this)}eq(t){return this.x===t.x&&this.y===t.y}bbox(){return new W(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}};function x(...t){if(1===t.length){if(t[0]instanceof A)return new A(t[0].x,t[0].y);if(Array.isArray(t[0])&&2===t[0].length)return new A(...t[0])}return new A(...t)}l(x,"vec2");var k=class t{static{l(this,"Color")}r=255;g=255;b=255;constructor(t,n,o){this.r=g(t,0,255),this.g=g(n,0,255),this.b=g(o,0,255)}static fromArray(n){return new t(n[0],n[1],n[2])}static fromHex(n){if("number"==typeof n)return new t(n>>16&255,n>>8&255,(0|n)&255);if("string"==typeof n){let o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return new t(parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16))}throw Error("Invalid hex color format")}static fromHSL(n,o,s){if(0==o)return new t(255*s,255*s,255*s);let r=l((t,n,o)=>(o<0&&(o+=1),o>1&&(o-=1),o<1/6?t+(n-t)*6*o:o<.5?n:o<2/3?t+(n-t)*(2/3-o)*6:t),"hue2rgb"),d=s<.5?s*(1+o):s+o-s*o,c=2*s-d;return new t(Math.round(255*r(c,d,n+1/3)),Math.round(255*r(c,d,n)),Math.round(255*r(c,d,n-1/3)))}static RED=new t(255,0,0);static GREEN=new t(0,255,0);static BLUE=new t(0,0,255);static YELLOW=new t(255,255,0);static MAGENTA=new t(255,0,255);static CYAN=new t(0,255,255);static WHITE=new t(255,255,255);static BLACK=new t(0,0,0);clone(){return new t(this.r,this.g,this.b)}lighten(n){return new t(this.r+n,this.g+n,this.b+n)}darken(t){return this.lighten(-t)}invert(){return new t(255-this.r,255-this.g,255-this.b)}mult(n){return new t(this.r*n.r/255,this.g*n.g/255,this.b*n.b/255)}lerp(n,o){return new t(y(this.r,n.r,o),y(this.g,n.g,o),y(this.b,n.b,o))}eq(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+(0x1000000+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}};function b(...t){if(0===t.length)return new k(255,255,255);if(1===t.length){if(t[0]instanceof k)return t[0].clone();if("string"==typeof t[0])return k.fromHex(t[0]);if(Array.isArray(t[0])&&3===t[0].length)return k.fromArray(t[0])}return new k(...t)}l(b,"rgb");var S=l((t,n,o)=>k.fromHSL(t,n,o),"hsl2rgb"),V=class t{static{l(this,"Quad")}x=0;y=0;w=1;h=1;constructor(t,n,o,s){this.x=t,this.y=n,this.w=o,this.h=s}scale(n){return new t(this.x+this.w*n.x,this.y+this.h*n.y,this.w*n.w,this.h*n.h)}pos(){return new A(this.x,this.y)}clone(){return new t(this.x,this.y,this.w,this.h)}eq(t){return this.x===t.x&&this.y===t.y&&this.w===t.w&&this.h===t.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function M(t,n,o,s){return new V(t,n,o,s)}l(M,"quad");var E=class t{static{l(this,"Mat4")}m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(t){t&&(this.m=t)}static translate(n){return new t([1,0,0,0,0,1,0,0,0,0,1,0,n.x,n.y,0,1])}static scale(n){return new t([n.x,0,0,0,0,n.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(n){let o=Math.cos(n=c(-n)),s=Math.sin(n);return new t([1,0,0,0,0,o,-s,0,0,s,o,0,0,0,0,1])}static rotateY(n){let o=Math.cos(n=c(-n)),s=Math.sin(n);return new t([o,0,s,0,0,1,0,0,-s,0,o,0,0,0,0,1])}static rotateZ(n){let o=Math.cos(n=c(-n)),s=Math.sin(n);return new t([o,-s,0,0,s,o,0,0,0,0,1,0,0,0,0,1])}translate(t){return this.m[12]+=this.m[0]*t.x+this.m[4]*t.y,this.m[13]+=this.m[1]*t.x+this.m[5]*t.y,this.m[14]+=this.m[2]*t.x+this.m[6]*t.y,this.m[15]+=this.m[3]*t.x+this.m[7]*t.y,this}scale(t){return this.m[0]*=t.x,this.m[4]*=t.y,this.m[1]*=t.x,this.m[5]*=t.y,this.m[2]*=t.x,this.m[6]*=t.y,this.m[3]*=t.x,this.m[7]*=t.y,this}rotate(t){let n=Math.cos(t=c(-t)),o=Math.sin(t),s=this.m[0],r=this.m[1],l=this.m[4],d=this.m[5];return this.m[0]=s*n+r*o,this.m[1]=-s*o+r*n,this.m[4]=l*n+d*o,this.m[5]=-l*o+d*n,this}mult(n){let o=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)o[4*t+s]=this.m[0+s]*n.m[4*t+0]+this.m[4+s]*n.m[4*t+1]+this.m[8+s]*n.m[4*t+2]+this.m[12+s]*n.m[4*t+3];return new t(o)}multVec2(t){return new A(t.x*this.m[0]+t.y*this.m[4]+this.m[12],t.x*this.m[1]+t.y*this.m[5]+this.m[13])}getTranslation(){return new A(this.m[12],this.m[13])}getScale(){if(0!=this.m[0]||0!=this.m[1]){let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new A(n,t/n)}if(0==this.m[4]&&0==this.m[5])return new A(0,0);{let t=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new A(t/n,n)}}getRotation(){if(0!=this.m[0]||0!=this.m[1]){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return f(this.m[1]>0?Math.acos(this.m[0]/t):-Math.acos(this.m[0]/t))}if(0==this.m[4]&&0==this.m[5])return 0;{let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return f(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/t):-Math.acos(this.m[4]/t)))}}getSkew(){if(0!=this.m[0]||0!=this.m[1]){let t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new A(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t),0)}if(0==this.m[4]&&0==this.m[5])return new A(0,0);{let t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new A(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(t*t))}}invert(){let n=[],o=this.m[10]*this.m[15]-this.m[14]*this.m[11],s=this.m[9]*this.m[15]-this.m[13]*this.m[11],r=this.m[9]*this.m[14]-this.m[13]*this.m[10],l=this.m[8]*this.m[15]-this.m[12]*this.m[11],d=this.m[8]*this.m[14]-this.m[12]*this.m[10],c=this.m[8]*this.m[13]-this.m[12]*this.m[9],f=this.m[6]*this.m[15]-this.m[14]*this.m[7],g=this.m[5]*this.m[15]-this.m[13]*this.m[7],y=this.m[5]*this.m[14]-this.m[13]*this.m[6],w=this.m[4]*this.m[15]-this.m[12]*this.m[7],v=this.m[4]*this.m[14]-this.m[12]*this.m[6],A=this.m[5]*this.m[15]-this.m[13]*this.m[7],x=this.m[4]*this.m[13]-this.m[12]*this.m[5],k=this.m[6]*this.m[11]-this.m[10]*this.m[7],b=this.m[5]*this.m[11]-this.m[9]*this.m[7],S=this.m[5]*this.m[10]-this.m[9]*this.m[6],V=this.m[4]*this.m[11]-this.m[8]*this.m[7],M=this.m[4]*this.m[10]-this.m[8]*this.m[6],E=this.m[4]*this.m[9]-this.m[8]*this.m[5];n[0]=this.m[5]*o-this.m[6]*s+this.m[7]*r,n[4]=-(this.m[4]*o-this.m[6]*l+this.m[7]*d),n[8]=this.m[4]*s-this.m[5]*l+this.m[7]*c,n[12]=-(this.m[4]*r-this.m[5]*d+this.m[6]*c),n[1]=-(this.m[1]*o-this.m[2]*s+this.m[3]*r),n[5]=this.m[0]*o-this.m[2]*l+this.m[3]*d,n[9]=-(this.m[0]*s-this.m[1]*l+this.m[3]*c),n[13]=this.m[0]*r-this.m[1]*d+this.m[2]*c,n[2]=this.m[1]*f-this.m[2]*g+this.m[3]*y,n[6]=-(this.m[0]*f-this.m[2]*w+this.m[3]*v),n[10]=this.m[0]*A-this.m[1]*w+this.m[3]*x,n[14]=-(this.m[0]*y-this.m[1]*v+this.m[2]*x),n[3]=-(this.m[1]*k-this.m[2]*b+this.m[3]*S),n[7]=this.m[0]*k-this.m[2]*V+this.m[3]*M,n[11]=-(this.m[0]*b-this.m[1]*V+this.m[3]*E),n[15]=this.m[0]*S-this.m[1]*M+this.m[2]*E;let T=this.m[0]*n[0]+this.m[1]*n[4]+this.m[2]*n[8]+this.m[3]*n[12];for(let t=0;t<4;t++)for(let o=0;o<4;o++)n[4*t+o]*=1/T;return new t(n)}clone(){return new t([...this.m])}toString(){return this.m.toString()}};function T(t,n,o,s=t=>-Math.cos(t)){return t+(s(o)+1)/2*(n-t)}l(T,"wave");var R=class{static{l(this,"RNG")}seed;constructor(t){this.seed=t}gen(){return this.seed=(0x41c64e6d*this.seed+12345)%0x80000000,this.seed/0x80000000}genNumber(t,n){return t+this.gen()*(n-t)}genVec2(t,n){return new A(this.genNumber(t.x,n.x),this.genNumber(t.y,n.y))}genColor(t,n){return new k(this.genNumber(t.r,n.r),this.genNumber(t.g,n.g),this.genNumber(t.b,n.b))}genAny(...t){if(0===t.length)return this.gen();if(1===t.length){if("number"==typeof t[0])return this.genNumber(0,t[0]);if(t[0]instanceof A)return this.genVec2(x(0,0),t[0]);if(t[0]instanceof k)return this.genColor(b(0,0,0),t[0])}else if(2===t.length){if("number"==typeof t[0]&&"number"==typeof t[1])return this.genNumber(t[0],t[1]);if(t[0]instanceof A&&t[1]instanceof A)return this.genVec2(t[0],t[1]);if(t[0]instanceof k&&t[1]instanceof k)return this.genColor(t[0],t[1])}}},P=new R(Date.now());function C(t){return null!=t&&(P.seed=t),P.seed}function I(...t){return P.genAny(...t)}function B(...t){return Math.floor(I(...t))}function H(t){return I()<=t}function N(t){return t[B(t.length)]}function F(t,n){return t.pos.x+t.width>n.pos.x&&t.pos.x<n.pos.x+n.width&&t.pos.y+t.height>n.pos.y&&t.pos.y<n.pos.y+n.height}function _(t,n){if(t.p1.x===t.p2.x&&t.p1.y===t.p2.y||n.p1.x===n.p2.x&&n.p1.y===n.p2.y)return null;let o=(n.p2.y-n.p1.y)*(t.p2.x-t.p1.x)-(n.p2.x-n.p1.x)*(t.p2.y-t.p1.y);if(0===o)return null;let s=((n.p2.x-n.p1.x)*(t.p1.y-n.p1.y)-(n.p2.y-n.p1.y)*(t.p1.x-n.p1.x))/o,r=((t.p2.x-t.p1.x)*(t.p1.y-n.p1.y)-(t.p2.y-t.p1.y)*(t.p1.x-n.p1.x))/o;return s<0||s>1||r<0||r>1?null:s}function U(t,n){let o=_(t,n);return o?x(t.p1.x+o*(t.p2.x-t.p1.x),t.p1.y+o*(t.p2.y-t.p1.y)):null}function z(t,n){if(L(t,n.p1)||L(t,n.p2))return!0;let o=t.points();return!!U(n,new Y(o[0],o[1]))||!!U(n,new Y(o[1],o[2]))||!!U(n,new Y(o[2],o[3]))||!!U(n,new Y(o[3],o[0]))}function L(t,n){return n.x>t.pos.x&&n.x<t.pos.x+t.width&&n.y>t.pos.y&&n.y<t.pos.y+t.height}function j(t,n){let o=n.sub(t.p1),s=t.p2.sub(t.p1);if(Math.abs(o.cross(s))>Number.EPSILON)return!1;let r=o.dot(s)/s.dot(s);return r>=0&&r<=1}function O(t,n){let o=t.p2.sub(t.p1),s=o.dot(o),r=t.p1.sub(n.center),l=2*o.dot(r),d=l*l-4*s*(r.dot(r)-n.radius*n.radius);if(s<=Number.EPSILON||d<0)return!1;if(0==d){let t=-l/(2*s);if(t>=0&&t<=1)return!0}else{let t=(-l+Math.sqrt(d))/(2*s),n=(-l-Math.sqrt(d))/(2*s);if(t>=0&&t<=1||n>=0&&n<=1)return!0}return G(n,t.p1)}function G(t,n){return t.center.sdist(n)<t.radius*t.radius}function q(t,n){let o=n.pts[n.pts.length-1];for(let s of n.pts){if(O(new Y(o,s),t))return!0;o=s}return!!G(t,n.pts[0])||K(n,t.center)}function K(t,n){let o=!1,s=t.pts;for(let t=0,r=s.length-1;t<s.length;r=t++)s[t].y>n.y!=s[r].y>n.y&&n.x<(s[r].x-s[t].x)*(n.y-s[t].y)/(s[r].y-s[t].y)+s[t].x&&(o=!o);return o}l(C,"randSeed"),l(I,"rand"),l(B,"randi"),l(H,"chance"),l(N,"choose"),l(F,"testRectRect"),l(_,"testLineLineT"),l(U,"testLineLine"),l(z,"testRectLine"),l(L,"testRectPoint"),l(j,"testLinePoint"),l(O,"testLineCircle"),l(G,"testCirclePoint"),l(q,"testCirclePolygon"),l(K,"testPolygonPoint");var Y=class t{static{l(this,"Line")}p1;p2;constructor(t,n){this.p1=t.clone(),this.p2=n.clone()}transform(n){return new t(n.multVec2(this.p1),n.multVec2(this.p2))}bbox(){return W.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new t(this.p1,this.p2)}},W=class t{static{l(this,"Rect")}pos;width;height;constructor(t,n,o){this.pos=t.clone(),this.width=n,this.height=o}static fromPoints(n,o){return new t(n.clone(),o.x-n.x,o.y-n.y)}center(){return new A(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(t){return new J(this.points().map(n=>t.multVec2(n)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new t(this.pos.clone(),this.width,this.height)}distToPoint(t){return Math.sqrt(this.sdistToPoint(t))}sdistToPoint(t){let n=this.pos,o=this.pos.add(this.width,this.height),s=Math.max(n.x-t.x,0,t.x-o.x),r=Math.max(n.y-t.y,0,t.y-o.y);return s*s+r*r}},Q=class t{static{l(this,"Circle")}center;radius;constructor(t,n){this.center=t.clone(),this.radius=n}transform(t){return new X(this.center,this.radius,this.radius).transform(t)}bbox(){return W.fromPoints(this.center.sub(x(this.radius)),this.center.add(x(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new t(this.center,this.radius)}},X=class t{static{l(this,"Ellipse")}center;radiusX;radiusY;constructor(t,n,o){this.center=t.clone(),this.radiusX=n,this.radiusY=o}transform(n){return new t(n.multVec2(this.center),n.m[0]*this.radiusX,n.m[5]*this.radiusY)}bbox(){return W.fromPoints(this.center.sub(x(this.radiusX,this.radiusY)),this.center.add(x(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new t(this.center,this.radiusX,this.radiusY)}},J=class t{static{l(this,"Polygon")}pts;constructor(t){if(t.length<3)throw Error("Polygons should have at least 3 vertices");this.pts=t}transform(n){return new t(this.pts.map(t=>n.multVec2(t)))}bbox(){let t=x(Number.MAX_VALUE),n=x(-Number.MAX_VALUE);for(let o of this.pts)t.x=Math.min(t.x,o.x),n.x=Math.max(n.x,o.x),t.y=Math.min(t.y,o.y),n.y=Math.max(n.y,o.y);return W.fromPoints(t,n)}area(){let t=0,n=this.pts.length;for(let o=0;o<n;o++){let s=this.pts[o],r=this.pts[(o+1)%n];t+=s.x*r.y*.5,t-=r.x*s.y*.5}return Math.abs(t)}clone(){return new t(this.pts.map(t=>t.clone()))}};function Z(t,n){let o=Number.MAX_VALUE,s=x(0);for(let r of[t,n])for(let l=0;l<r.pts.length;l++){let d=r.pts[l],c=r.pts[(l+1)%r.pts.length].sub(d).normal().unit(),f=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let n=0;n<t.pts.length;n++){let o=t.pts[n].dot(c);f=Math.min(f,o),g=Math.max(g,o)}let y=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let t=0;t<n.pts.length;t++){let o=n.pts[t].dot(c);y=Math.min(y,o),w=Math.max(w,o)}let v=Math.min(g,w)-Math.max(f,y);if(v<0)return null;if(v<Math.abs(o)){let t=w-f,n=y-g;o=Math.abs(t)<Math.abs(n)?t:n,s=c.scale(o)}}return s}l(Z,"sat");var $=class extends Map{static{l(this,"IDList")}lastID;constructor(...t){super(...t),this.lastID=0}push(t){let n=this.lastID;return this.set(n,t),this.lastID++,n}pushd(t){let n=this.push(t);return()=>this.delete(n)}},ee=class t{static{l(this,"EventController")}paused=!1;cancel;constructor(t){this.cancel=t}static join(n){let o=new t(()=>n.forEach(t=>t.cancel()));return Object.defineProperty(o,"paused",{get:()=>n[0].paused,set:t=>n.forEach(n=>n.paused=t)}),o.paused=!1,o}},et=class{static{l(this,"Event")}handlers=new $;add(t){let n=new ee(this.handlers.pushd((...o)=>{n.paused||t(...o)}));return n}addOnce(t){let n=this.add((...o)=>{n.cancel(),t(...o)});return n}next(){return new Promise(t=>this.addOnce(t))}trigger(...t){this.handlers.forEach(n=>n(...t))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},en=class{static{l(this,"EventHandler")}handlers={};on(t,n){return this.handlers[t]||(this.handlers[t]=new et),this.handlers[t].add(n)}onOnce(t,n){let o=this.on(t,(...t)=>{o.cancel(),n(...t)});return o}next(t){return new Promise(n=>{this.onOnce(t,(...t)=>n(t[0]))})}trigger(t,...n){this.handlers[t]&&this.handlers[t].trigger(...n)}remove(t){delete this.handlers[t]}clear(){this.handlers={}}numListeners(t){return this.handlers[t]?.numListeners()??0}};function ea(t,n){let o=typeof t,s=typeof n;if(o!==s)return!1;if("object"===o&&"object"===s&&null!==t&&null!==n){let o=Object.keys(t),s=Object.keys(n);if(o.length!==s.length)return!1;for(let s of o){let o=t[s],r=n[s];if(("function"!=typeof o||"function"!=typeof r)&&!ea(o,r))return!1}return!0}return t===n}function ei(t){let n=window.atob(t),o=n.length,s=new Uint8Array(o);for(let t=0;t<o;t++)s[t]=n.charCodeAt(t);return s.buffer}function eo(t){return ei(t.split(",")[1])}function es(t,n){let o=document.createElement("a");o.href=n,o.download=t,o.click()}function er(t,n){es(t,"data:text/plain;charset=utf-8,"+n)}function el(t,n){er(t,JSON.stringify(n))}function ed(t,n){let o=URL.createObjectURL(n);es(t,o),URL.revokeObjectURL(o)}l(ea,"deepEq"),l(ei,"base64ToArrayBuffer"),l(eo,"dataURLToArrayBuffer"),l(es,"download"),l(er,"downloadText"),l(el,"downloadJSON"),l(ed,"downloadBlob");var eh=l(t=>t.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),eu=l(t=>t.split(".").pop(),"getExt"),ec=(t=0,()=>t++),ep=class{static{l(this,"BinaryHeap")}_items;_compareFn;constructor(t=(t,n)=>t<n){this._compareFn=t,this._items=[]}insert(t){this._items.push(t),this.moveUp(this._items.length-1)}remove(){if(0===this._items.length)return null;let t=this._items[0],n=this._items.pop();return 0!==this._items.length&&(this._items[0]=n,this.moveDown(0)),t}clear(){this._items.splice(0,this._items.length)}moveUp(t){for(;t>0;){let n=Math.floor((t-1)/2);if(!this._compareFn(this._items[t],this._items[n])&&this._items[t]>=this._items[n])break;this.swap(t,n),t=n}}moveDown(t){for(;t<Math.floor(this._items.length/2);){let n=2*t+1;if(n<this._items.length-1&&!this._compareFn(this._items[n],this._items[n+1])&&++n,this._compareFn(this._items[t],this._items[n]))break;this.swap(t,n),t=n}}swap(t,n){[this._items[t],this._items[n]]=[this._items[n],this._items[t]]}get length(){return this._items.length}},em={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},ef=class{static{l(this,"ButtonState")}pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(t){this.pressed.add(t),this.pressedRepeat.add(t),this.down.add(t)}pressRepeat(t){this.pressedRepeat.add(t)}release(t){this.down.delete(t),this.pressed.delete(t),this.released.add(t)}},eg=class{static{l(this,"GamepadState")}buttonState=new ef;stickState=new Map},ey=class{static{l(this,"FPSCounter")}dts=[];timer=0;fps=0;tick(t){this.dts.push(t),this.timer+=t,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((t,n)=>t+n)/this.dts.length)),this.dts=[])}},ew=l(t=>{if(!t.canvas)throw Error("Please provide a canvas");let n={canvas:t.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new ey,timeScale:1,skipTime:!1,numFrames:0,mousePos:new A(0),mouseDeltaPos:new A(0),keyState:new ef,mouseState:new ef,mergedGamepadState:new eg,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:t.canvas.offsetWidth,lastHeight:t.canvas.offsetHeight,events:new en};function o(){return n.canvas}function s(){return n.dt*n.timeScale}function r(){return n.time}function d(){return n.fpsCounter.fps}function c(){return n.numFrames}function f(){return n.canvas.toDataURL()}function g(t){n.canvas.style.cursor=t}function y(){return n.canvas.style.cursor}function w(t){if(t)try{let t=n.canvas.requestPointerLock();t.catch&&t.catch(t=>console.error(t))}catch(t){console.error(t)}else document.exitPointerLock()}function v(){return!!document.pointerLockElement}function x(t){t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}function k(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function b(){return document.fullscreenElement||document.webkitFullscreenElement}function S(t=!0){t?x(n.canvas):k()}function V(){return!!b()}function M(){for(let t in n.stopped=!0,eS)n.canvas.removeEventListener(t,eS[t]);for(let t in eV)document.removeEventListener(t,eV[t]);for(let t in eM)window.removeEventListener(t,eM[t]);eP.disconnect()}function E(o){null!==n.loopID&&cancelAnimationFrame(n.loopID);let r=0,d=l(l=>{if(n.stopped)return;if("visible"!==document.visibilityState){n.loopID=requestAnimationFrame(d);return}let c=l/1e3,f=c-n.realTime,g=t.maxFPS?1/t.maxFPS:0;n.realTime=c,(r+=f)>g&&(n.skipTime||(n.dt=r,n.time+=s(),n.fpsCounter.tick(n.dt)),r=0,n.skipTime=!1,n.numFrames++,ev(),o(),eA()),n.loopID=requestAnimationFrame(d)},"frame");d(0)}function T(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function R(){return n.mousePos.clone()}function P(){return n.mouseDeltaPos.clone()}function C(t="left"){return n.mouseState.pressed.has(t)}function I(t="left"){return n.mouseState.down.has(t)}function B(t="left"){return n.mouseState.released.has(t)}function H(){return n.isMouseMoved}function N(t){return void 0===t?n.keyState.pressed.size>0:n.keyState.pressed.has(t)}function F(t){return void 0===t?n.keyState.pressedRepeat.size>0:n.keyState.pressedRepeat.has(t)}function _(t){return void 0===t?n.keyState.down.size>0:n.keyState.down.has(t)}function U(t){return void 0===t?n.keyState.released.size>0:n.keyState.released.has(t)}function z(t){return void 0===t?n.mergedGamepadState.buttonState.pressed.size>0:n.mergedGamepadState.buttonState.pressed.has(t)}function L(t){return void 0===t?n.mergedGamepadState.buttonState.down.size>0:n.mergedGamepadState.buttonState.down.has(t)}function j(t){return void 0===t?n.mergedGamepadState.buttonState.released.size>0:n.mergedGamepadState.buttonState.released.has(t)}function O(t){return n.events.on("resize",t)}l(o,"canvas"),l(s,"dt"),l(r,"time"),l(d,"fps"),l(c,"numFrames"),l(f,"screenshot"),l(g,"setCursor"),l(y,"getCursor"),l(w,"setCursorLocked"),l(v,"isCursorLocked"),l(x,"enterFullscreen"),l(k,"exitFullscreen"),l(b,"getFullscreenElement"),l(S,"setFullscreen"),l(V,"isFullscreen"),l(M,"quit"),l(E,"run"),l(T,"isTouchscreen"),l(R,"mousePos"),l(P,"mouseDeltaPos"),l(C,"isMousePressed"),l(I,"isMouseDown"),l(B,"isMouseReleased"),l(H,"isMouseMoved"),l(N,"isKeyPressed"),l(F,"isKeyPressedRepeat"),l(_,"isKeyDown"),l(U,"isKeyReleased"),l(z,"isGamepadButtonPressed"),l(L,"isGamepadButtonDown"),l(j,"isGamepadButtonReleased"),l(O,"onResize");let G=l((t,o)=>"function"==typeof t?n.events.on("keyDown",t):"string"==typeof t&&"function"==typeof o?n.events.on("keyDown",n=>n===t&&o(t)):void 0,"onKeyDown"),q=l((t,o)=>"function"==typeof t?n.events.on("keyPress",t):"string"==typeof t&&"function"==typeof o?n.events.on("keyPress",n=>n===t&&o(t)):void 0,"onKeyPress"),K=l((t,o)=>"function"==typeof t?n.events.on("keyPressRepeat",t):"string"==typeof t&&"function"==typeof o?n.events.on("keyPressRepeat",n=>n===t&&o(t)):void 0,"onKeyPressRepeat"),Y=l((t,o)=>"function"==typeof t?n.events.on("keyRelease",t):"string"==typeof t&&"function"==typeof o?n.events.on("keyRelease",n=>n===t&&o(t)):void 0,"onKeyRelease");function W(t,o){return"function"==typeof t?n.events.on("mouseDown",n=>t(n)):n.events.on("mouseDown",n=>n===t&&o(n))}function Q(t,o){return"function"==typeof t?n.events.on("mousePress",n=>t(n)):n.events.on("mousePress",n=>n===t&&o(n))}function X(t,o){return"function"==typeof t?n.events.on("mouseRelease",n=>t(n)):n.events.on("mouseRelease",n=>n===t&&o(n))}function J(t){return n.events.on("mouseMove",()=>t(R(),P()))}function Z(t){return n.events.on("charInput",t)}function $(t){return n.events.on("touchStart",t)}function ee(t){return n.events.on("touchMove",t)}function et(t){return n.events.on("touchEnd",t)}function ea(t){return n.events.on("scroll",t)}function ei(t){return n.events.on("hide",t)}function eo(t){return n.events.on("show",t)}function es(t,o){return"function"==typeof t?n.events.on("gamepadButtonDown",t):"string"==typeof t&&"function"==typeof o?n.events.on("gamepadButtonDown",n=>n===t&&o(t)):void 0}function er(t,o){return"function"==typeof t?n.events.on("gamepadButtonPress",t):"string"==typeof t&&"function"==typeof o?n.events.on("gamepadButtonPress",n=>n===t&&o(t)):void 0}function el(t,o){return"function"==typeof t?n.events.on("gamepadButtonRelease",t):"string"==typeof t&&"function"==typeof o?n.events.on("gamepadButtonRelease",n=>n===t&&o(t)):void 0}function ed(t,o){return n.events.on("gamepadStick",(n,s)=>n===t&&o(s))}function eh(t){n.events.on("gamepadConnect",t)}function eu(t){n.events.on("gamepadDisconnect",t)}function ec(t){return n.mergedGamepadState.stickState.get(t)||new A(0)}function ep(){return[...n.charInputted]}function ew(){return[...n.gamepads]}function ev(){n.events.trigger("input"),n.keyState.down.forEach(t=>n.events.trigger("keyDown",t)),n.mouseState.down.forEach(t=>n.events.trigger("mouseDown",t)),eb()}function eA(){n.keyState.update(),n.mouseState.update(),n.mergedGamepadState.buttonState.update(),n.mergedGamepadState.stickState.forEach((t,o)=>{n.mergedGamepadState.stickState.set(o,new A(0))}),n.charInputted=[],n.isMouseMoved=!1,n.gamepadStates.forEach(t=>{t.buttonState.update(),t.stickState.forEach((n,o)=>{t.stickState.set(o,new A(0))})})}function ex(t){let o={index:t.index,isPressed:o=>n.gamepadStates.get(t.index).buttonState.pressed.has(o),isDown:o=>n.gamepadStates.get(t.index).buttonState.down.has(o),isReleased:o=>n.gamepadStates.get(t.index).buttonState.released.has(o),getStick:o=>n.gamepadStates.get(t.index).stickState.get(o)};return n.gamepads.push(o),n.gamepadStates.set(t.index,{buttonState:new ef,stickState:new Map([["left",new A(0)],["right",new A(0)]])}),o}function ek(t){n.gamepads=n.gamepads.filter(n=>n.index!==t.index),n.gamepadStates.delete(t.index)}function eb(){for(let t of navigator.getGamepads())t&&!n.gamepadStates.has(t.index)&&ex(t);for(let o of n.gamepads){let s=navigator.getGamepads()[o.index],r=(t.gamepads??{})[s.id]??em[s.id]??em.default,l=n.gamepadStates.get(o.index);for(let t=0;t<s.buttons.length;t++)s.buttons[t].pressed?(l.buttonState.down.has(r.buttons[t])||(n.mergedGamepadState.buttonState.press(r.buttons[t]),l.buttonState.press(r.buttons[t]),n.events.trigger("gamepadButtonPress",r.buttons[t])),n.events.trigger("gamepadButtonDown",r.buttons[t])):l.buttonState.down.has(r.buttons[t])&&(n.mergedGamepadState.buttonState.release(r.buttons[t]),l.buttonState.release(r.buttons[t]),n.events.trigger("gamepadButtonRelease",r.buttons[t]));for(let t in r.sticks){let o=r.sticks[t],d=new A(s.axes[o.x],s.axes[o.y]);l.stickState.set(t,d),n.mergedGamepadState.stickState.set(t,d),n.events.trigger("gamepadStick",t,d)}}}l(W,"onMouseDown"),l(Q,"onMousePress"),l(X,"onMouseRelease"),l(J,"onMouseMove"),l(Z,"onCharInput"),l($,"onTouchStart"),l(ee,"onTouchMove"),l(et,"onTouchEnd"),l(ea,"onScroll"),l(ei,"onHide"),l(eo,"onShow"),l(es,"onGamepadButtonDown"),l(er,"onGamepadButtonPress"),l(el,"onGamepadButtonRelease"),l(ed,"onGamepadStick"),l(eh,"onGamepadConnect"),l(eu,"onGamepadDisconnect"),l(ec,"getGamepadStick"),l(ep,"charInputted"),l(ew,"getGamepads"),l(ev,"processInput"),l(eA,"resetInput"),l(ex,"registerGamepad"),l(ek,"removeGamepad"),l(eb,"processGamepad");let eS={},eV={},eM={};eS.mousemove=t=>{let o=new A(t.offsetX,t.offsetY),s=new A(t.movementX,t.movementY);n.events.onOnce("input",()=>{n.isMouseMoved=!0,n.mousePos=o,n.mouseDeltaPos=s,n.events.trigger("mouseMove")})};let eE=["left","middle","right","back","forward"];eS.mousedown=t=>{n.events.onOnce("input",()=>{let o=eE[t.button];o&&(n.mouseState.press(o),n.events.trigger("mousePress",o))})},eS.mouseup=t=>{n.events.onOnce("input",()=>{let o=eE[t.button];o&&(n.mouseState.release(o),n.events.trigger("mouseRelease",o))})};let eT=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),eR={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};for(let o in eS.keydown=t=>{eT.has(t.key)&&t.preventDefault(),n.events.onOnce("input",()=>{let o=eR[t.key]||t.key.toLowerCase();1===o.length?(n.events.trigger("charInput",o),n.charInputted.push(o)):"space"===o&&(n.events.trigger("charInput"," "),n.charInputted.push(" ")),t.repeat?(n.keyState.pressRepeat(o),n.events.trigger("keyPressRepeat",o)):(n.keyState.press(o),n.events.trigger("keyPressRepeat",o),n.events.trigger("keyPress",o))})},eS.keyup=t=>{n.events.onOnce("input",()=>{let o=eR[t.key]||t.key.toLowerCase();n.keyState.release(o),n.events.trigger("keyRelease",o)})},eS.touchstart=o=>{o.preventDefault(),n.events.onOnce("input",()=>{let s=[...o.changedTouches],r=n.canvas.getBoundingClientRect();!1!==t.touchToMouse&&(n.mousePos=new A(s[0].clientX-r.x,s[0].clientY-r.y),n.mouseState.press("left"),n.events.trigger("mousePress","left")),s.forEach(t=>{n.events.trigger("touchStart",new A(t.clientX-r.x,t.clientY-r.y),t)})})},eS.touchmove=o=>{o.preventDefault(),n.events.onOnce("input",()=>{let s=[...o.changedTouches],r=n.canvas.getBoundingClientRect();!1!==t.touchToMouse&&(n.mousePos=new A(s[0].clientX-r.x,s[0].clientY-r.y),n.events.trigger("mouseMove")),s.forEach(t=>{n.events.trigger("touchMove",new A(t.clientX-r.x,t.clientY-r.y),t)})})},eS.touchend=o=>{n.events.onOnce("input",()=>{let s=[...o.changedTouches],r=n.canvas.getBoundingClientRect();!1!==t.touchToMouse&&(n.mousePos=new A(s[0].clientX-r.x,s[0].clientY-r.y),n.mouseState.release("left"),n.events.trigger("mouseRelease","left")),s.forEach(t=>{n.events.trigger("touchEnd",new A(t.clientX-r.x,t.clientY-r.y),t)})})},eS.touchcancel=o=>{n.events.onOnce("input",()=>{let s=[...o.changedTouches],r=n.canvas.getBoundingClientRect();!1!==t.touchToMouse&&(n.mousePos=new A(s[0].clientX-r.x,s[0].clientY-r.y),n.mouseState.release("left"),n.events.trigger("mouseRelease","left")),s.forEach(t=>{n.events.trigger("touchEnd",new A(t.clientX-r.x,t.clientY-r.y),t)})})},eS.wheel=t=>{t.preventDefault(),n.events.onOnce("input",()=>{n.events.trigger("scroll",new A(t.deltaX,t.deltaY))})},eS.contextmenu=t=>t.preventDefault(),eV.visibilitychange=()=>{"visible"===document.visibilityState?(n.skipTime=!0,n.events.trigger("show")):n.events.trigger("hide")},eM.gamepadconnected=t=>{let o=ex(t.gamepad);n.events.onOnce("input",()=>{n.events.trigger("gamepadConnect",o)})},eM.gamepaddisconnected=t=>{let o=ew().filter(n=>n.index===t.gamepad.index)[0];ek(t.gamepad),n.events.onOnce("input",()=>{n.events.trigger("gamepadDisconnect",o)})},eS)n.canvas.addEventListener(o,eS[o]);for(let t in eV)document.addEventListener(t,eV[t]);for(let t in eM)window.addEventListener(t,eM[t]);let eP=new ResizeObserver(t=>{for(let o of t)if(o.target===n.canvas){if(n.lastWidth===n.canvas.offsetWidth&&n.lastHeight===n.canvas.offsetHeight)return;n.lastWidth=n.canvas.offsetWidth,n.lastHeight=n.canvas.offsetHeight,n.events.onOnce("input",()=>{n.events.trigger("resize")})}});return eP.observe(n.canvas),{dt:s,time:r,run:E,canvas:o,fps:d,numFrames:c,quit:M,setFullscreen:S,isFullscreen:V,setCursor:g,screenshot:f,getGamepads:ew,getCursor:y,setCursorLocked:w,isCursorLocked:v,isTouchscreen:T,mousePos:R,mouseDeltaPos:P,isKeyDown:_,isKeyPressed:N,isKeyPressedRepeat:F,isKeyReleased:U,isMouseDown:I,isMousePressed:C,isMouseReleased:B,isMouseMoved:H,isGamepadButtonPressed:z,isGamepadButtonDown:L,isGamepadButtonReleased:j,getGamepadStick:ec,charInputted:ep,onResize:O,onKeyDown:G,onKeyPress:q,onKeyPressRepeat:K,onKeyRelease:Y,onMouseDown:W,onMousePress:Q,onMouseRelease:X,onMouseMove:J,onCharInput:Z,onTouchStart:$,onTouchMove:ee,onTouchEnd:et,onScroll:ea,onHide:ei,onShow:eo,onGamepadButtonDown:es,onGamepadButtonPress:er,onGamepadButtonRelease:el,onGamepadStick:ed,onGamepadConnect:eh,onGamepadDisconnect:eu,events:n.events}},"default"),ev=2*Math.PI/3,eA=2*Math.PI/4.5,ex={linear:t=>t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInExpo:t=>0===t?0:Math.pow(2,10*t-10),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>2.70158*t*t*t-1.70158*t*t,easeOutBack:t=>1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*(7.189819*t-2.5949095)/2:(Math.pow(2*t-2,2)*(3.5949095*(2*t-2)+2.5949095)+2)/2,easeInElastic:t=>0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*ev),easeOutElastic:t=>0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*ev)+1,easeInOutElastic:t=>0===t?0:1===t?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*eA))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*eA)/2+1,easeInBounce:t=>1-ex.easeOutBounce(1-t),easeOutBounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,easeInOutBounce:t=>t<.5?(1-ex.easeOutBounce(1-2*t))/2:(1+ex.easeOutBounce(2*t-1))/2},ek=class{static{l(this,"Timer")}time;action;finished=!1;paused=!1;constructor(t,n){this.time=t,this.action=n}tick(t){return!this.finished&&!this.paused&&(this.time-=t,this.time<=0&&(this.action(),this.finished=!0,this.time=0,!0))}reset(t){this.time=t,this.finished=!1}},eb=d("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L5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),eS=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",eV="topleft",eM="monospace",eE="nearest",eT=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],eR=eT.reduce((t,n)=>t+n.size,0),eP=8192*eR,eC=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,eI=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,eB=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,eH=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,eN=new Set(["id","require"]),eF=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function e_(t){switch(t){case"topleft":return new A(-1,-1);case"top":return new A(0,-1);case"topright":return new A(1,-1);case"left":return new A(-1,0);case"center":return new A(0,0);case"right":return new A(1,0);case"botleft":return new A(-1,1);case"bot":return new A(0,1);case"botright":return new A(1,1);default:return t}}function eD(t){switch(t){case"left":default:return 0;case"center":return .5;case"right":return 1}}function eU(t){return t.createBuffer(1,1,44100)}l(e_,"anchorPt"),l(eD,"alignPt"),l(eU,"createEmptyAudioBuffer");const ez=l((t={})=>{let n,o,s,r,d,P,_,G,X,ei,em,ef,eg,ey,ev=t.root??document.body;ev===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let eA=t.canvas??(n=document.createElement("canvas"),ev.appendChild(n),n),ez=t.scale??1,eL=t.width&&t.height&&!t.stretch&&!t.letterbox;eL?(eA.width=t.width*ez,eA.height=t.height*ez):(eA.width=eA.parentElement.offsetWidth,eA.height=eA.parentElement.offsetHeight);let ej=eA.width,eO=eA.height,eG=t.pixelDensity||window.devicePixelRatio;eA.width*=eG,eA.height*=eG;let eq=["outline: none","cursor: default"];eL?(eq.push(`width: ${ej}px`),eq.push(`height: ${eO}px`)):(eq.push("width: 100%"),eq.push("height: 100%")),t.crisp&&(eq.push("image-rendering: pixelated"),eq.push("image-rendering: crisp-edges")),eA.style.cssText=eq.join(";"),eA.tabIndex=0;let eK=document.createElement("canvas");eK.width=256,eK.height=256;let eY=eK.getContext("2d",{willReadFrequently:!0}),eW=ew({canvas:eA,touchToMouse:t.touchToMouse,gamepads:t.gamepads,pixelDensity:t.pixelDensity,maxFPS:t.maxFPS}),eQ=[],eX=eW.canvas().getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});class eJ{static{l(this,"Texture")}src=null;glTex;width;height;constructor(n,o,s={}){this.glTex=eX.createTexture(),eQ.push(()=>this.free()),this.bind(),n&&o&&eX.texImage2D(eX.TEXTURE_2D,0,eX.RGBA,n,o,0,eX.RGBA,eX.UNSIGNED_BYTE,null),this.width=n,this.height=o;let r=(s.filter??t.texFilter)==="linear"?eX.LINEAR:eX.NEAREST,l="repeat"===s.wrap?eX.REPEAT:eX.CLAMP_TO_EDGE;eX.texParameteri(eX.TEXTURE_2D,eX.TEXTURE_MIN_FILTER,r),eX.texParameteri(eX.TEXTURE_2D,eX.TEXTURE_MAG_FILTER,r),eX.texParameteri(eX.TEXTURE_2D,eX.TEXTURE_WRAP_S,l),eX.texParameteri(eX.TEXTURE_2D,eX.TEXTURE_WRAP_T,l),this.unbind()}static fromImage(t,n={}){let o=new eJ(0,0,n);return o.bind(),eX.texImage2D(eX.TEXTURE_2D,0,eX.RGBA,eX.RGBA,eX.UNSIGNED_BYTE,t),o.width=t.width,o.height=t.height,o.unbind(),o.src=t,o}update(t,n=0,o=0){this.bind(),eX.texSubImage2D(eX.TEXTURE_2D,0,n,o,eX.RGBA,eX.UNSIGNED_BYTE,t),this.unbind()}bind(){eX.bindTexture(eX.TEXTURE_2D,this.glTex)}unbind(){eX.bindTexture(eX.TEXTURE_2D,null)}free(){eX.deleteTexture(this.glTex)}}class eZ extends Error{static{l(this,"KaboomError")}constructor(t){super(t),this.name="KaboomError"}}class e${static{l(this,"TexPacker")}tex;canvas;ctx;x=0;y=0;curHeight=0;constructor(t,n){this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=n,this.tex=eJ.fromImage(this.canvas),this.ctx=this.canvas.getContext("2d")}add(t){if(t.width>this.canvas.width||t.height>this.canvas.height)throw new eZ(`Texture size (${t.width} x ${t.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+t.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+t.height>this.canvas.height&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.tex=eJ.fromImage(this.canvas),this.x=0,this.y=0,this.curHeight=0);let n=new A(this.x,this.y);return this.x+=t.width,t.height>this.curHeight&&(this.curHeight=t.height),t instanceof ImageData?this.ctx.putImageData(t,n.x,n.y):this.ctx.drawImage(t,n.x,n.y),this.tex.update(this.canvas),[this.tex,new V(n.x/this.canvas.width,n.y/this.canvas.height,t.width/this.canvas.width,t.height/this.canvas.height)]}}class e0{static{l(this,"FrameBuffer")}tex;glFrameBuffer;glRenderBuffer;constructor(t,n,o={}){this.tex=new eJ(t,n,o),this.glFrameBuffer=eX.createFramebuffer(),this.glRenderBuffer=eX.createRenderbuffer(),eQ.push(()=>this.free()),this.bind(),eX.renderbufferStorage(eX.RENDERBUFFER,eX.DEPTH_STENCIL,t,n),eX.framebufferTexture2D(eX.FRAMEBUFFER,eX.COLOR_ATTACHMENT0,eX.TEXTURE_2D,this.tex.glTex,0),eX.framebufferRenderbuffer(eX.FRAMEBUFFER,eX.DEPTH_STENCIL_ATTACHMENT,eX.RENDERBUFFER,this.glRenderBuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}bind(){eX.bindFramebuffer(eX.FRAMEBUFFER,this.glFrameBuffer),eX.bindRenderbuffer(eX.RENDERBUFFER,this.glRenderBuffer)}unbind(){eX.bindFramebuffer(eX.FRAMEBUFFER,null),eX.bindRenderbuffer(eX.RENDERBUFFER,null)}free(){eX.deleteFramebuffer(this.glFrameBuffer),eX.deleteRenderbuffer(this.glRenderBuffer),this.tex.free()}}let e1=(o=tH(eB,eH),s=eJ.fromImage(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),r=t.width&&t.height?new e0(t.width*eG*ez,t.height*eG*ez):new e0(eX.drawingBufferWidth,eX.drawingBufferHeight),d=null,P=1,t.background&&(d=k.fromArray(t.background),P=t.background[3]??1,eX.clearColor(d.r/255,d.g/255,d.b/255,P)),eX.enable(eX.BLEND),eX.enable(eX.SCISSOR_TEST),eX.blendFuncSeparate(eX.SRC_ALPHA,eX.ONE_MINUS_SRC_ALPHA,eX.ONE,eX.ONE_MINUS_SRC_ALPHA),_=eX.createBuffer(),eX.bindBuffer(eX.ARRAY_BUFFER,_),eX.bufferData(eX.ARRAY_BUFFER,4*eP,eX.DYNAMIC_DRAW),eT.reduce((t,n,o)=>(eX.vertexAttribPointer(o,n.size,eX.FLOAT,!1,4*eR,t),eX.enableVertexAttribArray(o),t+4*n.size),0),eX.bindBuffer(eX.ARRAY_BUFFER,null),G=eX.createBuffer(),eX.bindBuffer(eX.ELEMENT_ARRAY_BUFFER,G),eX.bufferData(eX.ELEMENT_ARRAY_BUFFER,49152,eX.DYNAMIC_DRAW),eX.bindBuffer(eX.ELEMENT_ARRAY_BUFFER,null),X=eJ.fromImage(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"}),{drawCalls:0,lastDrawCalls:0,defShader:o,curShader:o,frameBuffer:r,postShader:null,postShaderUniform:null,defTex:s,curTex:s,curUniform:{},vbuf:_,ibuf:G,vqueue:[],iqueue:[],transform:new E,transformStack:[],bgTex:X,bgColor:d,bgAlpha:P,width:t.width??eX.drawingBufferWidth/eG/ez,height:t.height??eX.drawingBufferHeight/eG/ez,viewport:{x:0,y:0,width:eX.drawingBufferWidth,height:eX.drawingBufferHeight},fixed:!1});class e2{static{l(this,"SpriteData")}tex;frames=[new V(0,0,1,1)];anims={};slice9=null;constructor(t,n,o={},s=null){this.tex=t,n&&(this.frames=n),this.anims=o,this.slice9=s}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(t,n={}){return"string"==typeof t?e2.fromURL(t,n):Promise.resolve(e2.fromImage(t,n))}static fromImage(t,n={}){let[o,s]=e8.packer.add(t);return new e2(o,n.frames?n.frames.map(t=>new V(s.x+t.x*s.w,s.y+t.y*s.h,t.w*s.w,t.h*s.h)):tu(n.sliceX||1,n.sliceY||1,s.x,s.y,s.w,s.h),n.anims,n.slice9)}static fromURL(t,n={}){return ts(t).then(t=>e2.fromImage(t,n))}}class e5{static{l(this,"SoundData")}buf;constructor(t){this.buf=t}static fromArrayBuffer(t){return new Promise((n,o)=>e4.ctx.decodeAudioData(t,n,o)).then(t=>new e5(t))}static fromURL(t){return eh(t)?e5.fromArrayBuffer(eo(t)):to(t).then(t=>e5.fromArrayBuffer(t))}}let e4=((em=(ei=new(window.AudioContext||window.webkitAudioContext)).createGain()).connect(ei.destination),ef=new e5(eU(ei)),ei.decodeAudioData(eb.buffer.slice(0)).then(t=>{ef.buf=t}).catch(t=>{console.error("Failed to load burp: ",t)}),{ctx:ei,masterNode:em,burpSnd:ef});class e3{static{l(this,"Asset")}loaded=!1;data=null;error=null;onLoadEvents=new et;onErrorEvents=new et;onFinishEvents=new et;constructor(t){t.then(t=>{this.data=t,this.onLoadEvents.trigger(t)}).catch(t=>{if(this.error=t,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(t);else throw t}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(t){let n=new e3(Promise.resolve(t));return n.data=t,n.loaded=!0,n}onLoad(t){return this.loaded&&this.data?t(this.data):this.onLoadEvents.add(t),this}onError(t){return this.loaded&&this.error?t(this.error):this.onErrorEvents.add(t),this}onFinish(t){return this.loaded?t():this.onFinishEvents.add(t),this}then(t){return this.onLoad(t)}catch(t){return this.onError(t)}finally(t){return this.onFinish(t)}}class e6{static{l(this,"AssetBucket")}assets=new Map;lastUID=0;add(t,n){let o=t??this.lastUID+++"",s=new e3(n);return this.assets.set(o,s),s}addLoaded(t,n){let o=t??this.lastUID+++"",s=e3.loaded(n);return this.assets.set(o,s),s}get(t){return this.assets.get(t)}progress(){if(0===this.assets.size)return 1;let t=0;return this.assets.forEach(n=>{n.loaded&&t++}),t/this.assets.size}}let e8={urlPrefix:"",sprites:new e6,fonts:new e6,bitmapFonts:new e6,sounds:new e6,shaders:new e6,custom:new e6,packer:new e$(2048,2048),loaded:!1},e9={events:new en,objEvents:new en,root:nb([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new A(1),angle:0,shake:0,transform:new E}};function e7(t){return e8.custom.add(null,t)}function te(){let t=[e8.sprites,e8.sounds,e8.shaders,e8.fonts,e8.bitmapFonts,e8.custom];return t.reduce((t,n)=>t+n.progress(),0)/t.length}function tt(t){return void 0!==t&&(e8.urlPrefix=t),e8.urlPrefix}function tn(t){let n=e8.urlPrefix+t;return fetch(n).then(t=>{if(!t.ok)throw new eZ(`Failed to fetch "${n}"`);return t})}function ta(t){return tn(t).then(t=>t.json())}function ti(t){return tn(t).then(t=>t.text())}function to(t){return tn(t).then(t=>t.arrayBuffer())}function ts(t){let n=new Image;return n.crossOrigin="anonymous",n.src=eh(t)?t:e8.urlPrefix+t,new Promise((o,s)=>{n.onload=()=>o(n),n.onerror=()=>s(new eZ(`Failed to load image from "${t}"`))})}function tr(t,n){return e8.custom.add(t,ta(n))}l(e7,"load"),l(te,"loadProgress"),l(tt,"loadRoot"),l(tn,"fetchURL"),l(ta,"fetchJSON"),l(ti,"fetchText"),l(to,"fetchArrayBuffer"),l(ts,"loadImg"),l(tr,"loadJSON");class tl{static{l(this,"FontData")}fontface;filter=eE;outline=null;constructor(t,n={}){this.fontface=t,this.filter=n.filter??eE,n.outline&&(this.outline={width:1,color:b(0,0,0)},"number"==typeof n.outline?this.outline.width=n.outline:"object"==typeof n.outline&&(n.outline.width&&(this.outline.width=n.outline.width),n.outline.color&&(this.outline.color=n.outline.color)))}}function td(t,n,o={}){let s=new FontFace(t,"string"==typeof n?`url(${n})`:n);return document.fonts.add(s),e8.fonts.add(t,s.load().catch(t=>{throw new eZ(`Failed to load font from "${n}": ${t}`)}).then(t=>new tl(t,o)))}function th(t,n,o,s,r={}){return e8.bitmapFonts.add(t,ts(n).then(t=>tN(eJ.fromImage(t,r),o,s,r.chars??eS)))}function tu(t=1,n=1,o=0,s=0,r=1,l=1){let d=[],c=r/t,f=l/n;for(let r=0;r<n;r++)for(let n=0;n<t;n++)d.push(new V(o+n*c,s+r*f,c,f));return d}function tc(t,n){return e7("string"==typeof n?new Promise((o,s)=>{ta(n).then(n=>{tc(t,n).then(o).catch(s)})}):e2.from(t).then(t=>{let o={};for(let s in n){let r=n[s],l=t.frames[0],d=2048*l.w,c=2048*l.h,f=r.frames?r.frames.map(t=>new V(l.x+(r.x+t.x)/d*l.w,l.y+(r.y+t.y)/c*l.h,t.w/d*l.w,t.h/c*l.h)):tu(r.sliceX||1,r.sliceY||1,l.x+r.x/d*l.w,l.y+r.y/c*l.h,r.width/d*l.w,r.height/c*l.h),g=new e2(t.tex,f,r.anims);e8.sprites.addLoaded(s,g),o[s]=g}return o}))}function tp(t,n={}){let o=document.createElement("canvas"),s=t[0].width,r=t[0].height;o.width=s*t.length,o.height=r;let l=o.getContext("2d");t.forEach((t,n)=>{t instanceof ImageData?l.putImageData(t,n*s,0):l.drawImage(t,n*s,0)});let d=l.getImageData(0,0,t.length*s,r);return e2.fromImage(d,{...n,sliceX:t.length,sliceY:1})}function tm(t,n,o={sliceX:1,sliceY:1,anims:{}}){return Array.isArray(n)?n.some(t=>"string"==typeof t)?e8.sprites.add(t,Promise.all(n.map(t=>"string"==typeof t?ts(t):Promise.resolve(t))).then(t=>tp(t,o))):e8.sprites.addLoaded(t,tp(n,o)):"string"==typeof n?e8.sprites.add(t,e2.from(n,o)):e8.sprites.addLoaded(t,e2.fromImage(n,o))}function tf(t,n){return e8.sprites.add(t,new Promise(async t=>{let o="string"==typeof n?await ta(n):n,s=await Promise.all(o.frames.map(ts)),r=document.createElement("canvas");r.width=o.width,r.height=o.height*o.frames.length;let l=r.getContext("2d");s.forEach((t,n)=>{l.drawImage(t,0,n*o.height)}),t(await tm(null,r,{sliceY:o.frames.length,anims:o.anims}))}))}function tg(t,n,o){"string"!=typeof n||o||(o=n.replace(RegExp(`${eu(n)}$`),"json"));let s="string"==typeof o?ta(o):Promise.resolve(o);return e8.sprites.add(t,s.then(t=>{let o=t.meta.size,s=t.frames.map(t=>new V(t.frame.x/o.w,t.frame.y/o.h,t.frame.w/o.w,t.frame.h/o.h)),r={};for(let n of t.meta.frameTags)n.from===n.to?r[n.name]=n.from:r[n.name]={from:n.from,to:n.to,speed:10,loop:!0,pingpong:"pingpong"===n.direction};return e2.from(n,{frames:s,anims:r})}))}function ty(t,n,o){return e8.shaders.addLoaded(t,tH(n,o))}function tw(t,n,o){let s=l(t=>t?ti(t):Promise.resolve(null),"resolveUrl"),r=Promise.all([s(n),s(o)]).then(([t,n])=>tH(t,n));return e8.shaders.add(t,r)}function tv(t,n){return e8.sounds.add(t,"string"==typeof n?e5.fromURL(n):e5.fromArrayBuffer(n))}function tA(t="bean"){return tm(t,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==")}function tx(t){return e8.sprites.get(t)}function tk(t){return e8.sounds.get(t)}function tb(t){return e8.fonts.get(t)}function tS(t){return e8.bitmapFonts.get(t)}function tV(t){return e8.shaders.get(t)}function tM(t){return e8.custom.get(t)}function tE(t){if("string"==typeof t){let n=tx(t);if(n)return n;if(1>te())return null;throw new eZ(`Sprite not found: ${t}`)}if(t instanceof e2)return e3.loaded(t);if(t instanceof e3)return t;throw new eZ(`Invalid sprite: ${t}`)}function tT(t){if("string"==typeof t){let n=tk(t);if(n)return n;if(1>te())return null;throw new eZ(`Sound not found: ${t}`)}if(t instanceof e5)return e3.loaded(t);if(t instanceof e3)return t;throw new eZ(`Invalid sound: ${t}`)}function tR(t){if(!t)return e1.defShader;if("string"==typeof t){let n=tV(t);if(n)return n.data??n;if(1>te())return null;throw new eZ(`Shader not found: ${t}`)}return t instanceof e3&&t.data?t.data:t}function tP(n){if(!n)return tP(t.font??"monospace");if("string"==typeof n){let t=tS(n),o=tb(n);if(t)return t.data??t;if(o)return o.data??o;if(document.fonts.check(`64px ${n}`))return n;if(1>te())return null;throw new eZ(`Font not found: ${n}`)}return n instanceof e3&&n.data?n.data:n}function tC(t){return void 0!==t&&(e4.masterNode.gain.value=t),e4.masterNode.gain.value}function tI(t,n={}){let o=e4.ctx,s=n.paused??!1,r=o.createBufferSource(),d=new et,c=o.createGain(),f=n.seek??0,g=0,y=0,w=!1;r.loop=!!n.loop,r.detune.value=n.detune??0,r.playbackRate.value=n.speed??1,r.connect(c),r.onended=()=>{x()>=r.buffer?.duration&&d.trigger()},c.connect(e4.masterNode),c.gain.value=n.volume??1;let v=l(t=>{r.buffer=t.buf,s||(g=o.currentTime,r.start(0,f),w=!0)},"start"),A=tT(t);A instanceof e3&&A.onLoad(v);let x=l(()=>{if(!r.buffer)return 0;let t=s?y-g:o.currentTime-g,n=r.buffer.duration;return r.loop?t%n:Math.min(t,n)},"getTime"),k=l(t=>{let n=o.createBufferSource();return n.buffer=t.buffer,n.loop=t.loop,n.playbackRate.value=t.playbackRate.value,n.detune.value=t.detune.value,n.onended=t.onended,n.connect(c),n},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(D){if(s!==D)if(s=D,D)w&&(r.stop(),w=!1),y=o.currentTime;else{r=k(r);let t=y-g;r.start(0,t),w=!0,g=o.currentTime-t,y=0}},get paused(){return s},play(t=0){this.seek(t),this.paused=!1},seek(t){r.buffer?.duration&&(t>r.buffer.duration||(s?(r=k(r),g=y-t):(r.stop(),r=k(r),g=o.currentTime-t,r.start(0,t),w=!0,y=0)))},set speed(D){r.playbackRate.value=D},get speed(){return r.playbackRate.value},set detune(D){r.detune.value=D},get detune(){return r.detune.value},set volume(D){c.gain.value=Math.max(D,0)},get volume(){return c.gain.value},set loop(D){r.loop=D},get loop(){return r.loop},duration:()=>r.buffer?.duration??0,time(){return x()%this.duration()},onEnd:t=>d.add(t),then(t){return this.onEnd(t)}}}function tB(t){return tI(e4.burpSnd,t)}function tH(t=eB,n=eH){let o=eC.replace("{{user}}",t??eB),s=eI.replace("{{user}}",n??eH),r=eX.createShader(eX.VERTEX_SHADER),d=eX.createShader(eX.FRAGMENT_SHADER);eX.shaderSource(r,o),eX.shaderSource(d,s),eX.compileShader(r),eX.compileShader(d);let c=eX.createProgram();if(eQ.push(()=>eX.deleteProgram(c)),eX.attachShader(c,r),eX.attachShader(c,d),eX.bindAttribLocation(c,0,"a_pos"),eX.bindAttribLocation(c,1,"a_uv"),eX.bindAttribLocation(c,2,"a_color"),eX.linkProgram(c),!eX.getProgramParameter(c,eX.LINK_STATUS)){let t=l(t=>{let n=t.match(/^ERROR:\s0:(?<line>\d+):\s(?<msg>.+)/);return{line:Number(n.groups.line),msg:n.groups.msg.replace(/\n\0$/,"")}},"formatShaderError"),n=eX.getShaderInfoLog(r),o=eX.getShaderInfoLog(d),s="";if(n){let o=t(n);s+=`Vertex shader line ${o.line-14}: ${o.msg}`}if(o){let n=t(o);s+=`Fragment shader line ${n.line-14}: ${n.msg}`}throw new eZ(s)}return eX.deleteShader(r),eX.deleteShader(d),{bind(){eX.useProgram(c)},unbind(){eX.useProgram(null)},free(){eX.deleteProgram(c)},send(t){for(let n in t){let o=t[n],s=eX.getUniformLocation(c,n);"number"==typeof o?eX.uniform1f(s,o):o instanceof E?eX.uniformMatrix4fv(s,!1,new Float32Array(o.m)):o instanceof k?eX.uniform3f(s,o.r,o.g,o.b):o instanceof A&&eX.uniform2f(s,o.x,o.y)}}}}function tN(t,n,o,s){let r=t.width/n,l={};for(let[t,d]of s.split("").entries())l[d]=new V(t%r*n,Math.floor(t/r)*o,n,o);return{tex:t,map:l,size:o}}function tF(t,n,o,s=e1.defTex,r=e1.defShader,l={}){let d=tR(r);if(!d||d instanceof e3)return;(s!==e1.curTex||d!==e1.curShader||!ea(e1.curUniform,l)||e1.vqueue.length+t.length*eR>eP||e1.iqueue.length+n.length>12288)&&t_();let c=e1.fixed||o?e1.transform:e9.cam.transform.mult(e1.transform);for(let n of t){let t=tL(c.multVec2(n.pos));e1.vqueue.push(t.x,t.y,n.uv.x,n.uv.y,n.color.r/255,n.color.g/255,n.color.b/255,n.opacity)}for(let o of n)e1.iqueue.push(o+e1.vqueue.length/eR-t.length);e1.curTex=s,e1.curShader=d,e1.curUniform=l}function t_(){!e1.curTex||!e1.curShader||0===e1.vqueue.length||0===e1.iqueue.length||(eX.bindBuffer(eX.ARRAY_BUFFER,e1.vbuf),eX.bufferSubData(eX.ARRAY_BUFFER,0,new Float32Array(e1.vqueue)),eX.bindBuffer(eX.ELEMENT_ARRAY_BUFFER,e1.ibuf),eX.bufferSubData(eX.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(e1.iqueue)),e1.curShader.bind(),e1.curShader.send(e1.curUniform),e1.curTex.bind(),eX.drawElements(eX.TRIANGLES,e1.iqueue.length,eX.UNSIGNED_SHORT,0),e1.curTex.unbind(),e1.curShader.unbind(),eX.bindBuffer(eX.ARRAY_BUFFER,null),eX.bindBuffer(eX.ELEMENT_ARRAY_BUFFER,null),e1.vqueue.length=0,e1.iqueue.length=0,e1.drawCalls++)}function tD(){eX.clear(eX.COLOR_BUFFER_BIT),e1.frameBuffer.bind(),eX.viewport(0,0,e1.frameBuffer.width,e1.frameBuffer.height),eX.clear(eX.COLOR_BUFFER_BIT),e1.bgColor||t7(()=>{tW({width:nr(),height:nl(),quad:new V(0,0,nr()/64,nl()/64),tex:e1.bgTex,fixed:!0})}),e1.drawCalls=0,e1.fixed=!1,e1.transformStack.length=0,e1.transform=new E}function tU(t,n){e1.postShader=t,e1.postShaderUniform=n??null}function tz(){t_(),e1.frameBuffer.unbind(),eX.viewport(0,0,eX.drawingBufferWidth,eX.drawingBufferHeight),t_();let t=e1.width,n=e1.height;e1.width=eX.drawingBufferWidth/eG,e1.height=eX.drawingBufferHeight/eG,tQ({flipY:!0,tex:e1.frameBuffer.tex,pos:new A(e1.viewport.x,e1.viewport.y),width:e1.viewport.width,height:e1.viewport.height,shader:e1.postShader,uniform:"function"==typeof e1.postShaderUniform?e1.postShaderUniform():e1.postShaderUniform,fixed:!0}),t_(),e1.width=t,e1.height=n,e1.lastDrawCalls=e1.drawCalls}function tL(t){return new A(t.x/nr()*2-1,-t.y/nl()*2+1)}function tj(t){e1.transform=t.clone()}function tO(...t){if(void 0===t[0])return;let n=x(...t);0===n.x&&0===n.y||e1.transform.translate(n)}function tG(...t){if(void 0===t[0])return;let n=x(...t);1===n.x&&1===n.y||e1.transform.scale(n)}function tq(t){t&&e1.transform.rotate(t)}function tK(){e1.transformStack.push(e1.transform.clone())}function tY(){e1.transformStack.length>0&&(e1.transform=e1.transformStack.pop())}function tW(t){if(void 0===t.width||void 0===t.height)throw new eZ('drawUVQuad() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let n=t.width,o=t.height,s=e_(t.anchor||eV).scale(new A(n,o).scale(-.5)),r=t.quad||new V(0,0,1,1),l=t.color||b(255,255,255),d=t.opacity??1,c=t.tex?.1/t.tex.width:0,f=t.tex?.1/t.tex.height:0,g=r.x+c,y=r.y+f,w=r.w-2*c,v=r.h-2*f;tK(),tO(t.pos),tq(t.angle),tG(t.scale),tO(s),tF([{pos:new A(-n/2,o/2),uv:new A(t.flipX?g+w:g,t.flipY?y:y+v),color:l,opacity:d},{pos:new A(-n/2,-o/2),uv:new A(t.flipX?g+w:g,t.flipY?y+v:y),color:l,opacity:d},{pos:new A(n/2,-o/2),uv:new A(t.flipX?g:g+w,t.flipY?y+v:y),color:l,opacity:d},{pos:new A(n/2,o/2),uv:new A(t.flipX?g:g+w,t.flipY?y:y+v),color:l,opacity:d}],[0,1,3,1,2,3],t.fixed,t.tex,t.shader,t.uniform),tY()}function tQ(t){if(!t.tex)throw new eZ('drawTexture() requires property "tex".');let n=t.quad??new V(0,0,1,1),o=t.tex.width*n.w,s=t.tex.height*n.h,r=new A(1);if(t.tiled){let l=Math.ceil((t.width||o)/o),d=Math.ceil((t.height||s)/s),c=e_(t.anchor||eV).add(new A(1,1)).scale(.5).scale(l*o,d*s);for(let f=0;f<l;f++)for(let l=0;l<d;l++)tW(Object.assign({},t,{pos:(t.pos||new A(0)).add(new A(o*f,s*l)).sub(c),scale:r.scale(t.scale||new A(1)),tex:t.tex,quad:n,width:o,height:s,anchor:"topleft"}))}else t.width&&t.height?(r.x=t.width/o,r.y=t.height/s):t.width?(r.x=t.width/o,r.y=r.x):t.height&&(r.y=t.height/s,r.x=r.y),tW(Object.assign({},t,{scale:r.scale(t.scale||new A(1)),tex:t.tex,quad:n,width:o,height:s}))}function tX(t){if(!t.sprite)throw new eZ('drawSprite() requires property "sprite"');let n=tE(t.sprite);if(!n||!n.data)return;let o=n.data.frames[t.frame??0];if(!o)throw new eZ(`Frame not found: ${t.frame??0}`);tQ(Object.assign({},t,{tex:n.data.tex,quad:o.scale(t.quad??new V(0,0,1,1))}))}function tJ(t,n,o,s,r,l=1){s=c(s%360),(r=c(r%360))<=s&&(r+=2*Math.PI);let d=[],f=Math.ceil((r-s)/c(8)*l),g=(r-s)/f;for(let l=s;l<r;l+=g)d.push(t.add(n*Math.cos(l),o*Math.sin(l)));return d.push(t.add(n*Math.cos(r),o*Math.sin(r))),d}function tZ(t){if(void 0===t.width||void 0===t.height)throw new eZ('drawRect() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let n=t.width,o=t.height,s=e_(t.anchor||eV).add(1,1).scale(new A(n,o).scale(-.5)),r=[new A(0,0),new A(n,0),new A(n,o),new A(0,o)];if(t.radius){let s=Math.min(Math.min(n,o)/2,t.radius);r=[new A(s,0),new A(n-s,0),...tJ(new A(n-s,s),s,s,270,360),new A(n,s),new A(n,o-s),...tJ(new A(n-s,o-s),s,s,0,90),new A(n-s,o),new A(s,o),...tJ(new A(s,o-s),s,s,90,180),new A(0,o-s),new A(0,s),...tJ(new A(s,s),s,s,180,270)]}t4(Object.assign({},t,{offset:s,pts:r,...t.gradient?{colors:t.horizontal?[t.gradient[0],t.gradient[1],t.gradient[1],t.gradient[0]]:[t.gradient[0],t.gradient[0],t.gradient[1],t.gradient[1]]}:{}}))}function t$(t){let{p1:n,p2:o}=t;if(!n||!o)throw new eZ('drawLine() requires properties "p1" and "p2".');let s=t.width||1,r=o.sub(n).unit().normal().scale(.5*s);tF([n.sub(r),n.add(r),o.add(r),o.sub(r)].map(n=>({pos:new A(n.x,n.y),uv:new A(0),color:t.color??k.WHITE,opacity:t.opacity??1})),[0,1,3,1,2,3],t.fixed,e1.defTex,t.shader,t.uniform)}function t0(t){let n=t.pts;if(!n)throw new eZ('drawLines() requires property "pts".');if(!(n.length<2))if(t.radius&&n.length>=3){let o=n[0].sdist(n[1]);for(let t=1;t<n.length-1;t++)o=Math.min(n[t].sdist(n[t+1]),o);t.radius,t$(Object.assign({},t,{p1:n[0],p2:n[1]}));for(let o=1;o<n.length-2;o++)t$(Object.assign({},t,{p1:n[o],p2:n[o+1]}));t$(Object.assign({},t,{p1:n[n.length-2],p2:n[n.length-1]}))}else for(let o=0;o<n.length-1;o++)t$(Object.assign({},t,{p1:n[o],p2:n[o+1]})),"none"!==t.join&&t2(Object.assign({},t,{pos:n[o],radius:t.width/2}))}function t1(t){if(!t.p1||!t.p2||!t.p3)throw new eZ('drawPolygon() requires properties "p1", "p2" and "p3".');return t4(Object.assign({},t,{pts:[t.p1,t.p2,t.p3]}))}function t2(t){if("number"!=typeof t.radius)throw new eZ('drawCircle() requires property "radius".');0!==t.radius&&t5(Object.assign({},t,{radiusX:t.radius,radiusY:t.radius,angle:0}))}function t5(t){if(void 0===t.radiusX||void 0===t.radiusY)throw new eZ('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===t.radiusX||0===t.radiusY)return;let n=t.start??0,o=t.end??360,s=e_(t.anchor??"center").scale(new A(-t.radiusX,-t.radiusY)),r=tJ(s,t.radiusX,t.radiusY,n,o,t.resolution);r.unshift(s);let l=Object.assign({},t,{pts:r,radius:0,...t.gradient?{colors:[t.gradient[0],...Array(r.length-1).fill(t.gradient[1])]}:{}});if(o-n>=360&&t.outline){!1!==t.fill&&t4(Object.assign(l,{outline:null})),t4(Object.assign(l,{pts:r.slice(1),fill:!1}));return}t4(l)}function t4(t){if(!t.pts)throw new eZ('drawPolygon() requires property "pts".');let n=t.pts.length;if(!(n<3)){if(tK(),tO(t.pos),tG(t.scale),tq(t.angle),tO(t.offset),!1!==t.fill){let o=t.color??k.WHITE,s=t.pts.map((n,s)=>({pos:new A(n.x,n.y),uv:new A(0,0),color:t.colors?t.colors[s]??o:o,opacity:t.opacity??1})),r=[...Array(n-2).keys()].map(t=>[0,t+1,t+2]).flat();tF(s,t.indices??r,t.fixed,e1.defTex,t.shader,t.uniform)}t.outline&&t0({pts:[...t.pts,t.pts[0]],radius:t.radius,width:t.outline.width,color:t.outline.color,join:t.outline.join,uniform:t.uniform,fixed:t.fixed,opacity:t.opacity}),tY()}}function t3(t,n,o){t_(),eX.clear(eX.STENCIL_BUFFER_BIT),eX.enable(eX.STENCIL_TEST),eX.stencilFunc(eX.NEVER,1,255),eX.stencilOp(eX.REPLACE,eX.REPLACE,eX.REPLACE),n(),t_(),eX.stencilFunc(o,1,255),eX.stencilOp(eX.KEEP,eX.KEEP,eX.KEEP),t(),t_(),eX.disable(eX.STENCIL_TEST)}function t6(t,n){t3(t,n,eX.EQUAL)}function t8(t,n){t3(t,n,eX.NOTEQUAL)}function t9(){return(e1.viewport.width+e1.viewport.height)/(e1.width+e1.height)}function t7(t){t_();let n=e1.width,o=e1.height;e1.width=e1.viewport.width,e1.height=e1.viewport.height,t(),t_(),e1.width=n,e1.height=o}function ne(t,n){n.pos&&(t.pos=t.pos.add(n.pos)),n.scale&&(t.scale=t.scale.scale(x(n.scale))),n.angle&&(t.angle+=n.angle),n.color&&(t.color=t.color.mult(n.color)),n.opacity&&(t.opacity*=n.opacity)}l(td,"loadFont"),l(th,"loadBitmapFont"),l(tu,"slice"),l(tc,"loadSpriteAtlas"),l(tp,"createSpriteSheet"),l(tm,"loadSprite"),l(tf,"loadPedit"),l(tg,"loadAseprite"),l(ty,"loadShader"),l(tw,"loadShaderURL"),l(tv,"loadSound"),l(tA,"loadBean"),l(tx,"getSprite"),l(tk,"getSound"),l(tb,"getFont"),l(tS,"getBitmapFont"),l(tV,"getShader"),l(tM,"getAsset"),l(tE,"resolveSprite"),l(tT,"resolveSound"),l(tR,"resolveShader"),l(tP,"resolveFont"),l(tC,"volume"),l(tI,"play"),l(tB,"burp"),l(tH,"makeShader"),l(tN,"makeFont"),l(tF,"drawRaw"),l(t_,"flush"),l(tD,"frameStart"),l(tU,"usePostEffect"),l(tz,"frameEnd"),l(tL,"screen2ndc"),l(tj,"pushMatrix"),l(tO,"pushTranslate"),l(tG,"pushScale"),l(tq,"pushRotate"),l(tK,"pushTransform"),l(tY,"popTransform"),l(tW,"drawUVQuad"),l(tQ,"drawTexture"),l(tX,"drawSprite"),l(tJ,"getArcPts"),l(tZ,"drawRect"),l(t$,"drawLine"),l(t0,"drawLines"),l(t1,"drawTriangle"),l(t2,"drawCircle"),l(t5,"drawEllipse"),l(t4,"drawPolygon"),l(t3,"drawStenciled"),l(t6,"drawMasked"),l(t8,"drawSubtracted"),l(t9,"getViewportScale"),l(t7,"drawUnscaled"),l(ne,"applyCharTransform");let nt=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function nn(t){let n={},o=t.replace(nt,"$2"),s=0;for(let o of t.matchAll(nt)){let t=o.index-s;for(let s=0;s<o.groups.text.length;s++)n[s+t]=[o.groups.style];s+=o[0].length-o.groups.text.length}return{charStyleMap:n,text:o}}l(nn,"compileStyledText");let na={};function ni(t){if(void 0===t.text)throw new eZ('formatText() requires property "text".');let n=tP(t.font);if(""===t.text||n instanceof e3||!n)return{width:0,height:0,chars:[],opt:t};let{charStyleMap:o,text:s}=nn(t.text+""),r=s.split("");if(n instanceof tl||"string"==typeof n){let t=n instanceof tl?n.fontface.family:n,o=n instanceof tl?{outline:n.outline,filter:n.filter}:{outline:null,filter:eE},s=na[t]??{font:{tex:new eJ(2048,2048,{filter:o.filter}),map:{},size:64},cursor:new A(0),outline:o.outline};for(let o of(na[t]||(na[t]=s),n=s.font,r))if(!s.font.map[o]){eY.clearRect(0,0,eK.width,eK.height),eY.font=`${n.size}px ${t}`,eY.textBaseline="top",eY.textAlign="left",eY.fillStyle="#ffffff";let r=Math.ceil(eY.measureText(o).width),l=n.size;s.outline&&(eY.lineJoin="round",eY.lineWidth=2*s.outline.width,eY.strokeStyle=s.outline.color.toHex(),eY.strokeText(o,s.outline.width,s.outline.width),r+=2*s.outline.width,l+=3*s.outline.width),eY.fillText(o,s.outline?.width??0,s.outline?.width??0);let d=eY.getImageData(0,0,r,l);if(s.cursor.x+r>2048&&(s.cursor.x=0,s.cursor.y+=l,s.cursor.y>2048))throw new eZ("Font atlas exceeds character limit");n.tex.update(d,s.cursor.x,s.cursor.y),n.map[o]=new V(s.cursor.x,s.cursor.y,r,l),s.cursor.x+=r}}let l=t.size||n.size,d=x(t.scale??1).scale(l/n.size),c=t.lineSpacing??0,f=t.letterSpacing??0,g=0,y=0,w=0,v=[],b=[],S=0,M=null,E=null;for(;S<r.length;){let o=r[S];if(o===`
`)w+=l+c,v.push({width:g-f,chars:b}),M=null,E=null,g=0,b=[];else{let s=n.map[o];if(s){let T=s.w*d.x;t.width&&g+T>t.width&&(w+=l+c,null!=M&&(S-=b.length-M,o=r[S],T=(s=n.map[o]).w*d.x,b=b.slice(0,M-1),g=E),M=null,E=null,v.push({width:g-f,chars:b}),g=0,b=[]),b.push({tex:n.tex,width:s.w,height:s.h,quad:new V(s.x/n.tex.width,s.y/n.tex.height,s.w/n.tex.width,s.h/n.tex.height),ch:o,pos:new A(g,w),opacity:t.opacity??1,color:t.color??k.WHITE,scale:x(d),angle:0})," "===o&&(M=b.length,E=g),g+=T,y=Math.max(y,g),g+=f}}S++}v.push({width:g-f,chars:b}),w+=l,t.width&&(y=t.width);let T=[];for(let s of v){let r=(y-s.width)*eD(t.align??"left");for(let l of s.chars){let s=n.map[l.ch],c=T.length;if(l.pos=l.pos.add(r,0).add(s.w*d.x*.5,s.h*d.y*.5),t.transform){let n="function"==typeof t.transform?t.transform(c,l.ch):t.transform;n&&ne(l,n)}if(o[c])for(let n of o[c]){let o=t.styles[n],s="function"==typeof o?o(c,l.ch):o;s&&ne(l,s)}T.push(l)}}return{width:y,height:w,chars:T,opt:t}}function no(t){ns(ni(t))}function ns(t){tK(),tO(t.opt.pos),tq(t.opt.angle),tO(e_(t.opt.anchor??"topleft").add(1,1).scale(t.width,t.height).scale(-.5)),t.chars.forEach(n=>{tW({tex:n.tex,width:n.width,height:n.height,pos:n.pos,scale:n.scale,angle:n.angle,color:n.color,opacity:n.opacity,quad:n.quad,anchor:"center",uniform:t.opt.uniform,shader:t.opt.shader,fixed:t.opt.fixed})}),tY()}function nr(){return e1.width}function nl(){return e1.height}l(ni,"formatText"),l(no,"drawText"),l(ns,"drawFormattedText"),l(nr,"width"),l(nl,"height");let nd={};function nh(t){return new A((t.x-e1.viewport.x)*nr()/e1.viewport.width,(t.y-e1.viewport.y)*nl()/e1.viewport.height)}function nu(t){return new A(t.x*e1.viewport.width/e1.width,t.y*e1.viewport.height/e1.height)}function nc(){return nh(eW.mousePos())}for(let t in l(nh,"windowToContent"),l(nu,"contentToView"),l(nc,"mousePos"),nd.error=t=>{t.error&&t.error instanceof eZ?aG(t.error):t instanceof eZ&&aG(t)},nd.unhandledrejection=t=>{t.reason instanceof eZ&&aG(t.reason)},nd)window.addEventListener(t,nd[t]);let np=!1,nm={inspect:!1,timeScale:1,showLog:!0,fps:()=>eW.fps(),numFrames:()=>eW.numFrames(),stepFrame:aH,drawCalls:()=>e1.drawCalls,clearLog:()=>e9.logs=[],log:n=>{let o=t.logMax??8;e9.logs.unshift({msg:n,time:eW.time()}),e9.logs.length>o&&(e9.logs=e9.logs.slice(0,o))},error:t=>nm.log(new eZ(t.toString?t.toString():t)),curRecording:null,numObjects:()=>aR("*",{recursive:!0}).length,get paused(){return np},set paused(e){np=e,e?e4.ctx.suspend():e4.ctx.resume()}};function nf(){return eW.dt()*nm.timeScale}function ng(...t){return t.length>0&&(e9.cam.pos=x(...t)),e9.cam.pos?e9.cam.pos.clone():av()}function ny(...t){return t.length>0&&(e9.cam.scale=x(...t)),e9.cam.scale.clone()}function nw(t){return void 0!==t&&(e9.cam.angle=t),e9.cam.angle}function nv(t=12){e9.cam.shake+=t}function nA(t){return e9.cam.transform.multVec2(t)}function nx(t){return e9.cam.transform.invert().multVec2(t)}function nk(t){let n=new E;return t.pos&&n.translate(t.pos),t.scale&&n.scale(t.scale),t.angle&&n.rotate(t.angle),t.parent?n.mult(t.parent.transform):n}function nb(t=[]){let n=new Map,o={},s=new en,r=[],d=null,c=!1,f={id:ec(),hidden:!1,transform:new E,children:[],parent:null,set paused(h){if(h!==c)for(let t of(c=h,r))t.paused=h},get paused(){return c},add(t=[]){let n=Array.isArray(t)?nb(t):t;if(n.parent)throw new eZ("Cannot add a game obj that already has a parent.");return n.parent=this,n.transform=nk(n),this.children.push(n),n.trigger("add",n),e9.events.trigger("add",n),n},readd(t){let n=this.children.indexOf(t);return -1!==n&&(this.children.splice(n,1),this.children.push(t)),t},remove(t){let n=this.children.indexOf(t);if(-1!==n){t.parent=null,this.children.splice(n,1);let o=l(t=>{t.trigger("destroy"),e9.events.trigger("destroy",t),t.children.forEach(t=>o(t))},"trigger");o(t)}},removeAll(t){if(t)this.get(t).forEach(t=>this.remove(t));else for(let t of[...this.children])this.remove(t)},update(){this.paused||(this.children.sort((t,n)=>(t.z??0)-(n.z??0)).forEach(t=>t.update()),this.trigger("update"))},draw(){if(this.hidden)return;let t=e1.fixed;this.fixed&&(e1.fixed=!0),tK(),tO(this.pos),tG(this.scale),tq(this.angle);let n=this.children.sort((t,n)=>(t.z??0)-(n.z??0));if(this.mask){let t={intersect:t6,subtract:t8}[this.mask];if(!t)throw new eZ(`Invalid mask func: "${this.mask}"`);t(()=>{n.forEach(t=>t.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),n.forEach(t=>t.draw());tY(),e1.fixed=t},drawInspect(){this.hidden||(tK(),tO(this.pos),tG(this.scale),tq(this.angle),this.children.sort((t,n)=>(t.z??0)-(n.z??0)).forEach(t=>t.drawInspect()),this.trigger("drawInspect"),tY())},use(t){if(!t)return;if("string"==typeof t)return this.use({id:t});let s=[];for(let r in t.id&&(this.unuse(t.id),o[t.id]=[],s=o[t.id],n.set(t.id,t)),t){if(eN.has(r))continue;let n=Object.getOwnPropertyDescriptor(t,r);if("function"==typeof n.value&&(t[r]=t[r].bind(this)),n.set&&Object.defineProperty(t,r,{set:n.set.bind(this)}),n.get&&Object.defineProperty(t,r,{get:n.get.bind(this)}),eF.has(r)){let n="add"===r?()=>{d=l(t=>s.push(t),"onCurCompCleanup"),t[r](),d=null}:t[r];s.push(this.on(r,n).cancel)}else if(void 0===this[r])Object.defineProperty(this,r,{get:()=>t[r],set:n=>t[r]=n,configurable:!0,enumerable:!0}),s.push(()=>delete this[r]);else throw new eZ(`Duplicate component property: "${r}"`)}let r=l(()=>{if(t.require){for(let n of t.require)if(!this.c(n))throw new eZ(`Component "${t.id}" requires component "${n}"`)}},"checkDeps");t.destroy&&s.push(t.destroy.bind(this)),this.exists()?(r(),t.add&&(d=l(t=>s.push(t),"onCurCompCleanup"),t.add.call(this),d=null)):t.require&&s.push(this.on("add",r).cancel)},unuse(t){o[t]&&(o[t].forEach(t=>t()),delete o[t]),n.has(t)&&n.delete(t)},c:t=>n.get(t),get(t,n={}){let o=n.recursive?this.children.flatMap(l(function t(n){return[n,...n.children.flatMap(t)]},"recurse")):this.children;if(o=o.filter(n=>!t||n.is(t)),n.liveUpdate){let s=l(t=>n.recursive?this.isAncestorOf(t):t.parent===this,"isChild");nE(n=>{s(n)&&n.is(t)&&o.push(n)}),nT(n=>{if(s(n)&&n.is(t)){let t=o.findIndex(t=>t.id===n.id);-1!==t&&o.splice(t,1)}})}return o},isAncestorOf(t){return!!t.parent&&(t.parent===this||this.isAncestorOf(t.parent))},exists(){return e9.root.isAncestorOf(this)},is(t){if("*"===t)return!0;if(!Array.isArray(t))return null!=this.c(t);for(let n of t)if(!this.c(n))return!1;return!0},on(t,n){let o=s.on(t,n.bind(this));return d&&d(()=>o.cancel()),o},trigger(t,...n){s.trigger(t,...n),e9.objEvents.trigger(t,this,...n)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let t={};for(let[o,s]of n)t[o]=s.inspect?s.inspect():null;return t},onAdd(t){return this.on("add",t)},onUpdate(t){return this.on("update",t)},onDraw(t){return this.on("draw",t)},onDestroy(t){return this.on("destroy",t)},clearEvents(){s.clear()}};for(let t of["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"])f[t]=(...n)=>{let o=eW[t](...n);return r.push(o),f.onDestroy(()=>o.cancel()),o};for(let n of t)f.use(n);return f}function nS(t,n,o){return e9.objEvents[t]||(e9.objEvents[t]=new $),e9.objEvents.on(t,(t,...s)=>{t.is(n)&&o(t,...s)})}l(nf,"dt"),l(ng,"camPos"),l(ny,"camScale"),l(nw,"camRot"),l(nv,"shake"),l(nA,"toScreen"),l(nx,"toWorld"),l(nk,"calcTransform"),l(nb,"make"),l(nS,"on");let nV=l((t,n)=>{if("function"==typeof t&&void 0===n){let n=aM([{update:t}]);return{get paused(){return n.paused},set paused(i){n.paused=i},cancel:()=>n.destroy()}}if("string"==typeof t)return nS("update",t,n)},"onUpdate"),nM=l((t,n)=>{if("function"==typeof t&&void 0===n){let n=aM([{draw:t}]);return{get paused(){return n.hidden},set paused(i){n.hidden=i},cancel:()=>n.destroy()}}if("string"==typeof t)return nS("draw",t,n)},"onDraw");function nE(t,n){return"function"==typeof t&&void 0===n?e9.events.on("add",t):"string"==typeof t?nS("add",t,n):void 0}function nT(t,n){return"function"==typeof t&&void 0===n?e9.events.on("destroy",t):"string"==typeof t?nS("destroy",t,n):void 0}function nR(t,n,o){return nS("collide",t,(t,s,r)=>s.is(n)&&o(t,s,r))}function nP(t,n,o){return nS("collideUpdate",t,(t,s,r)=>s.is(n)&&o(t,s,r))}function nC(t,n,o){return nS("collideEnd",t,(t,s,r)=>s.is(n)&&o(t,s,r))}function nI(t,n){aR(t,{recursive:!0}).forEach(n),nE(t,n)}function nB(t,n){if("function"==typeof t)return eW.onMousePress(t);{let o=[];return nI(t,t=>{if(!t.area)throw new eZ("onClick() requires the object to have area() component");o.push(t.onClick(()=>n(t)))}),ee.join(o)}}function nH(t,n){let o=[];return nI(t,t=>{if(!t.area)throw new eZ("onHover() requires the object to have area() component");o.push(t.onHover(()=>n(t)))}),ee.join(o)}function nN(t,n){let o=[];return nI(t,t=>{if(!t.area)throw new eZ("onHoverUpdate() requires the object to have area() component");o.push(t.onHoverUpdate(()=>n(t)))}),ee.join(o)}function nF(t,n){let o=[];return nI(t,t=>{if(!t.area)throw new eZ("onHoverEnd() requires the object to have area() component");o.push(t.onHoverEnd(()=>n(t)))}),ee.join(o)}function n_(t,n){let o=0,s=[];n&&s.push(n);let r=nV(()=>{(o+=nf())>=t&&(r.cancel(),s.forEach(t=>t()))});return{paused:r.paused,cancel:r.cancel,onEnd(t){s.push(t)},then(t){return this.onEnd(t),this}}}function nD(t,n){let o=null,s=l(()=>{o=n_(t,s),n()},"newAction");return o=n_(0,s),{get paused(){return o.paused},set paused(a){o.paused=a},cancel:()=>o.cancel()}}function nU(){eW.onKeyPress("f1",()=>{nm.inspect=!nm.inspect}),eW.onKeyPress("f2",()=>{nm.clearLog()}),eW.onKeyPress("f8",()=>{nm.paused=!nm.paused}),eW.onKeyPress("f7",()=>{nm.timeScale=nQ(g(nm.timeScale-.2,0,2),1)}),eW.onKeyPress("f9",()=>{nm.timeScale=nQ(g(nm.timeScale+.2,0,2),1)}),eW.onKeyPress("f10",()=>{nm.stepFrame()})}function nz(){eW.onKeyPress("b",()=>tB())}function nL(t){e9.gravity=t}function nj(){return e9.gravity}function nO(...t){1===t.length||2===t.length?(e1.bgColor=b(t[0]),t[1]&&(e1.bgAlpha=t[1])):(3===t.length||4===t.length)&&(e1.bgColor=b(t[0],t[1],t[2]),t[3]&&(e1.bgAlpha=t[3])),eX.clearColor(e1.bgColor.r/255,e1.bgColor.g/255,e1.bgColor.b/255,e1.bgAlpha)}function nG(){return e1.bgColor.clone()}function nq(...t){return{id:"pos",pos:x(...t),moveBy(...t){this.pos=this.pos.add(x(...t))},move(...t){this.moveBy(x(...t).scale(nf()))},moveTo(...t){if("number"==typeof t[0]&&"number"==typeof t[1])return this.moveTo(x(t[0],t[1]),t[2]);let n=t[0],o=t[1];if(void 0===o){this.pos=x(n);return}let s=n.sub(this.pos);if(s.len()<=o*nf()){this.pos=x(n);return}this.move(s.unit().scale(o))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let t=this.worldPos();return n2(this)?t:nA(t)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){t2({color:b(255,0,0),radius:4/t9()})}}}function nK(...t){return 0===t.length?nK(1):{id:"scale",scale:x(...t),scaleTo(...t){this.scale=x(...t)},scaleBy(...t){this.scale.scale(x(...t))},inspect(){return`(${nQ(this.scale.x,2)}, ${nQ(this.scale.y,2)})`}}}function nY(t){return{id:"rotate",angle:t??0,rotateBy(t){this.angle+=t},rotateTo(t){this.angle=t},inspect(){return`${Math.round(this.angle)}`}}}function nW(...t){return{id:"color",color:b(...t),inspect(){return this.color.toString()}}}function nQ(t,n){return Number(t.toFixed(n))}function nX(t){return{id:"opacity",opacity:t??1,inspect(){return`${nQ(this.opacity,1)}`},fadeOut(t=1,n=ex.linear){return aY(this.opacity,0,t,t=>this.opacity=t,n)}}}function nJ(t){if(!t)throw new eZ("Please define an anchor");return{id:"anchor",anchor:t,inspect(){return"string"==typeof this.anchor?this.anchor:this.anchor.toString()}}}function nZ(t){return{id:"z",z:t,inspect(){return`${this.z}`}}}function n$(t,n){return{id:"follow",require:["pos"],follow:{obj:t,offset:n??x(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function n0(t,n){let o="number"==typeof t?A.fromAngle(t):t.unit();return{id:"move",require:["pos"],update(){this.move(o.scale(n))}}}function n1(t={}){let n=t.distance??200,o=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let t=this.screenPos(),o=new W(x(0),nr(),nl());return!L(o,t)&&o.sdistToPoint(t)>n*n},onExitScreen(t){return this.on("exitView",t)},onEnterScreen(t){return this.on("enterView",t)},update(){this.isOffScreen()?(o||(this.trigger("exitView"),o=!0),t.hide&&(this.hidden=!0),t.pause&&(this.paused=!0),t.destroy&&this.destroy()):(o&&(this.trigger("enterView"),o=!1),t.hide&&(this.hidden=!1),t.pause&&(this.paused=!1))}}}function n2(t){return!!t.fixed||!!t.parent&&n2(t.parent)}function n5(t={}){let n={},o=new Set;return{id:"area",collisionIgnore:t.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>eW.setCursor(this.area.cursor)),this.onCollideUpdate((t,s)=>{n[t.id]||this.trigger("collide",t,s),n[t.id]=s,o.add(t.id)})},update(){for(let t in n)o.has(Number(t))||(this.trigger("collideEnd",n[t].target),delete n[t]);o.clear()},drawInspect(){let t=this.localArea();tK(),tG(this.area.scale),tO(this.area.offset);let n={outline:{width:4/t9(),color:b(0,0,255)},anchor:this.anchor,fill:!1,fixed:n2(this)};t instanceof W?tZ({...n,pos:t.pos,width:t.width,height:t.height}):t instanceof J?t4({...n,pts:t.pts}):t instanceof Q&&t2({...n,pos:t.center,radius:t.radius}),tY()},area:{shape:t.shape??null,scale:t.scale?x(t.scale):x(1),offset:t.offset??x(0),cursor:t.cursor??null},isClicked(){return eW.isMousePressed()&&this.isHovering()},isHovering(){let t=n2(this)?nc():nx(nc());return this.hasPoint(t)},checkCollision:t=>n[t.id]??null,getCollisions:()=>Object.values(n),isColliding:t=>!!n[t.id],isOverlapping(t){let o=n[t.id];return o&&o.hasOverlap()},onClick(t){let n=eW.onMousePress("left",()=>{this.isHovering()&&t()});return this.onDestroy(()=>n.cancel()),n},onHover(t){let n=!1;return this.onUpdate(()=>{n?n=this.isHovering():this.isHovering()&&(n=!0,t())})},onHoverUpdate(t){return this.onUpdate(()=>{this.isHovering()&&t()})},onHoverEnd(t){let n=!1;return this.onUpdate(()=>{n?this.isHovering()||(n=!1,t()):n=this.isHovering()})},onCollide(t,n){return"function"==typeof t&&void 0===n?this.on("collide",t):"string"==typeof t?this.onCollide((o,s)=>{o.is(t)&&n(o,s)}):void 0},onCollideUpdate(t,n){return"function"==typeof t&&void 0===n?this.on("collideUpdate",t):"string"==typeof t?this.on("collideUpdate",(o,s)=>o.is(t)&&n(o,s)):void 0},onCollideEnd(t,n){return"function"==typeof t&&void 0===n?this.on("collideEnd",t):"string"==typeof t?this.on("collideEnd",o=>o.is(t)&&n(o)):void 0},hasPoint(t){return K(this.worldArea(),t)},resolveCollision(t){let n=this.checkCollision(t);n&&!n.resolved&&(this.pos=this.pos.add(n.displacement),n.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let t=this.localArea();if(!(t instanceof J||t instanceof W))throw new eZ("Only support polygon and rect shapes for now");let n=this.transform.clone().scale(x(this.area.scale??1)).translate(this.area.offset);if(t instanceof W){let o=e_(this.anchor||eV).add(1,1).scale(-.5).scale(t.width,t.height);n.translate(o)}return t.transform(n)},screenArea(){let t=this.worldArea();return n2(this)?t:t.transform(e9.cam.transform)}}}function n4(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,shader:t.shader,uniform:t.uniform}}function n3(t,n={}){let o=null,s=null,r=null,d=new et;if(!t)throw new eZ("Please pass the resource name or data to sprite()");let c=l((t,n,o,s)=>{let r=x(1,1);return o&&s?(r.x=o/(t.width*n.w),r.y=s/(t.height*n.h)):o?(r.x=o/(t.width*n.w),r.y=r.x):s&&(r.y=s/(t.height*n.h),r.x=r.y),r},"calcTexScale");return{id:"sprite",width:0,height:0,frame:n.frame||0,quad:n.quad||new V(0,0,1,1),animSpeed:n.animSpeed??1,flipX:n.flipX??!1,flipY:n.flipY??!1,draw(){if(!o)return;let t=o.frames[this.frame??0];if(!t)throw new eZ(`Frame not found: ${this.frame??0}`);if(o.slice9){let{left:s,right:r,top:l,bottom:d}=o.slice9,c=o.tex.width*t.w,f=o.tex.height*t.h,g=this.width-s-r,y=this.height-l-d,w=s/c,v=r/c,A=1-w-v,x=l/f,k=d/f,b=1-x-k,S=[M(0,0,w,x),M(w,0,A,x),M(w+A,0,v,x),M(0,x,w,b),M(w,x,A,b),M(w+A,x,v,b),M(0,x+b,w,k),M(w,x+b,A,k),M(w+A,x+b,v,k),M(0,0,s,l),M(s,0,g,l),M(s+g,0,r,l),M(0,l,s,y),M(s,l,g,y),M(s+g,l,r,y),M(0,l+y,s,d),M(s,l+y,g,d),M(s+g,l+y,r,d)];for(let s=0;s<9;s++){let r=S[s],l=S[s+9];tQ(Object.assign(n4(this),{pos:l.pos(),tex:o.tex,quad:t.scale(r),flipX:this.flipX,flipY:this.flipY,tiled:n.tiled,width:l.w,height:l.h}))}}else tQ(Object.assign(n4(this),{tex:o.tex,quad:t.scale(this.quad??new V(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:n.tiled,width:this.width,height:this.height}))},add(){let s=l(t=>{let s=t.frames[0].clone();n.quad&&(s=s.scale(n.quad));let r=c(t.tex,s,n.width,n.height);this.width=t.tex.width*s.w*r.x,this.height=t.tex.height*s.h*r.y,n.anim&&this.play(n.anim),o=t,d.trigger(o)},"setSpriteData"),r=tE(t);r?r.onLoad(s):ac(()=>s(tE(t).data))},update(){if(!s)return;let t=o.anims[s.name];if("number"==typeof t){this.frame=t;return}if(0===t.speed)throw new eZ("Sprite anim speed cannot be 0");s.timer+=nf()*this.animSpeed,s.timer>=1/s.speed&&(s.timer=0,this.frame+=r,(this.frame<Math.min(t.from,t.to)||this.frame>Math.max(t.from,t.to))&&(s.loop?s.pingpong?(this.frame-=r,r*=-1,this.frame+=r):this.frame=t.from:(this.frame=t.to,s.onEnd(),this.stop())))},play(t,n={}){if(!o)return void d.add(()=>this.play(t,n));let l=o.anims[t];if(void 0===l)throw new eZ(`Anim not found: ${t}`);s&&this.stop(),s="number"==typeof l?{name:t,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:t,timer:0,loop:n.loop??l.loop??!1,pingpong:n.pingpong??l.pingpong??!1,speed:n.speed??l.speed??10,onEnd:n.onEnd??(()=>{})},r="number"==typeof l?null:l.from<l.to?1:-1,this.frame="number"==typeof l?l:l.from,this.trigger("animStart",t)},stop(){if(!s)return;let t=s.name;s=null,this.trigger("animEnd",t)},numFrames:()=>o?.frames.length??0,curAnim:()=>s?.name,onAnimEnd(t){return this.on("animEnd",t)},onAnimStart(t){return this.on("animStart",t)},renderArea(){return new W(x(0),this.width,this.height)},inspect(){if("string"==typeof t)return`"${t}"`}}}function n6(t,n={}){function o(t){let o=ni(Object.assign(n4(t),{text:t.text+"",size:t.textSize,font:t.font,width:n.width&&t.width,align:t.align,letterSpacing:t.letterSpacing,lineSpacing:t.lineSpacing,transform:t.textTransform,styles:t.textStyles}));return n.width||(t.width=o.width/(t.scale?.x||1)),t.height=o.height/(t.scale?.y||1),o}l(o,"update");let s={id:"text",set text(a){t=a,o(this)},get text(){return t},textSize:n.size??36,font:n.font,width:n.width??0,height:0,align:n.align,lineSpacing:n.lineSpacing,letterSpacing:n.letterSpacing,textTransform:n.transform,textStyles:n.styles,add(){ac(()=>o(this))},draw(){ns(o(this))},renderArea(){return new W(x(0),this.width,this.height)}};return o(s),s}function n8(t,n,o={}){return{id:"rect",width:t,height:n,radius:o.radius||0,draw(){tZ(Object.assign(n4(this),{width:this.width,height:this.height,radius:this.radius}))},renderArea(){return new W(x(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function n9(t,n){return{id:"rect",width:t,height:n,draw(){tW(Object.assign(n4(this),{width:this.width,height:this.height}))},renderArea(){return new W(x(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function n7(t){return{id:"circle",radius:t,draw(){t2(Object.assign(n4(this),{radius:this.radius}))},renderArea(){return new W(new A(this.anchor?0:-this.radius),2*this.radius,2*this.radius)},inspect(){return`${Math.ceil(this.radius)}`}}}function ae(t=1,n=b(0,0,0)){return{id:"outline",outline:{width:t,color:n}}}function at(){return{id:"timer",wait(t,n){let o=[];n&&o.push(n);let s=0,r=this.onUpdate(()=>{(s+=nf())>=t&&(o.forEach(t=>t()),r.cancel())});return{get paused(){return r.paused},set paused(u){r.paused=u},cancel:r.cancel,onEnd(t){o.push(t)},then(t){return this.onEnd(t),this}}},loop(t,n){let o=null,s=l(()=>{o=this.wait(t,s),n()},"newAction");return o=this.wait(0,s),{get paused(){return o.paused},set paused(a){o.paused=a},cancel:()=>o.cancel()}},tween(t,n,o,s,r=ex.linear){let l=0,d=[],c=this.onUpdate(()=>{let f=Math.min((l+=nf())/o,1);s(y(t,n,r(f))),1===f&&(c.cancel(),s(n),d.forEach(t=>t()))});return{get paused(){return c.paused},set paused(m){c.paused=m},onEnd(t){d.push(t)},then(t){return this.onEnd(t),this},cancel(){c.cancel()},finish(){c.cancel(),s(n),d.forEach(t=>t())}}}}}function an(t={}){let n=x(0),o=null,s=null,r=!1;return{id:"body",require:["pos","area"],jumpForce:t.jumpForce??640,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(0===this.mass)throw new eZ("Can't set body mass to 0");this.onCollideUpdate((t,n)=>{if(t.is("body")&&!n.resolved&&(this.trigger("beforePhysicsResolve",n),t.trigger("beforePhysicsResolve",n.reverse()),!n.resolved&&!(this.isStatic&&t.isStatic))){if(this.isStatic||t.isStatic){let o=!this.isStatic&&t.isStatic?n:n.reverse();o.source.pos=o.source.pos.add(o.displacement),o.source.transform=nk(o.source)}else{let o=this.mass+t.mass;this.pos=this.pos.add(n.displacement.scale(t.mass/o)),t.pos=t.pos.add(n.displacement.scale(-this.mass/o)),this.transform=nk(this),t.transform=nk(t)}n.resolved=!0,this.trigger("physicsResolve",n),t.trigger("physicsResolve",n.reverse())}}),this.onPhysicsResolve(t=>{e9.gravity&&(t.isBottom()&&this.isFalling()?(n.y=0,o=t.target,s=t.target.pos,r?r=!1:this.trigger("ground",o)):t.isTop()&&this.isJumping()&&(n.y=0,this.trigger("headbutt",t.target)))})},update(){if(!e9.gravity||this.isStatic)return;if(r&&(o=null,s=null,this.trigger("fallOff"),r=!1),o)if(this.isOverlapping(o)&&o.exists()&&o.is("body")){o.pos.eq(s)||!1===t.stickToPlatform||this.moveBy(o.pos.sub(s)),s=o.pos;return}else r=!0;let l=n.y;n.y+=e9.gravity*this.gravityScale*nf(),n.y=Math.min(n.y,t.maxVelocity??65536),l<0&&n.y>=0&&this.trigger("fall"),this.move(n)},onPhysicsResolve(t){return this.on("physicsResolve",t)},onBeforePhysicsResolve(t){return this.on("beforePhysicsResolve",t)},curPlatform:()=>o,isGrounded:()=>null!==o,isFalling:()=>n.y>0,isJumping:()=>n.y<0,jump(t){o=null,s=null,n.y=-t||-this.jumpForce},onGround(t){return this.on("ground",t)},onFall(t){return this.on("fall",t)},onFallOff(t){return this.on("fallOff",t)},onHeadbutt(t){return this.on("headbutt",t)}}}function aa(t=2){let n=t;return{id:"doubleJump",require:["body"],numJumps:t,add(){this.onGround(()=>{n=this.numJumps})},doubleJump(t){n<=0||(n<this.numJumps&&this.trigger("doubleJump"),n--,this.jump(t))},onDoubleJump(t){return this.on("doubleJump",t)},inspect:()=>`${n}`}}function ai(t,n){return{id:"shader",shader:t,..."function"==typeof n?{uniform:n(),update(){this.uniform=n()}}:{uniform:n}}}function ao(){return{id:"fixed",fixed:!0}}function as(t){return{id:"stay",stay:!0,scenesToStay:t}}function ar(t){if(null==t)throw new eZ("health() requires the initial amount of hp");let n=t;return{id:"health",hurt(n=1){this.setHP(t-n),this.trigger("hurt",n)},heal(n=1){this.setHP(t+n),this.trigger("heal",n)},hp:()=>t,maxHP:()=>n,setHP(n){(t=n)<=0&&this.trigger("death")},onHurt(t){return this.on("hurt",t)},onHeal(t){return this.on("heal",t)},onDeath(t){return this.on("death",t)},inspect:()=>`${t}`}}function al(t,n={}){if(null==t)throw new eZ("lifespan() requires time");let o=n.fade??0;return{id:"lifespan",async add(){await n_(t),o>0&&this.opacity&&await aY(this.opacity,0,o,t=>this.opacity=t,ex.linear),this.destroy()}}}function ad(t,n,o){if(!t)throw new eZ("state() requires an initial state");let s={};function r(t){s[t]||(s[t]={enter:new et,end:new et,update:new et,draw:new et})}function d(t,n,o){return r(n),s[n][t].add(o)}function c(t,n,...o){r(n),s[n][t].trigger(...o)}l(r,"initStateEvents"),l(d,"on"),l(c,"trigger");let f=!1;return{id:"state",state:t,enterState(t,...s){if(f=!0,n&&!n.includes(t))throw new eZ(`State not found: ${t}`);let r=this.state;if(o){if(!o?.[r])return;let n="string"==typeof o[r]?[o[r]]:o[r];if(!n.includes(t))throw new eZ(`Cannot transition state from "${r}" to "${t}". Available transitions: ${n.map(t=>`"${t}"`).join(", ")}`)}c("end",r,...s),this.state=t,c("enter",t,...s),c("enter",`${r} -> ${t}`,...s)},onStateTransition:(t,n,o)=>d("enter",`${t} -> ${n}`,o),onStateEnter:(t,n)=>d("enter",t,n),onStateUpdate:(t,n)=>d("update",t,n),onStateDraw:(t,n)=>d("draw",t,n),onStateEnd:(t,n)=>d("end",t,n),update(){f||(c("enter",t),f=!0),c("update",this.state)},draw(){c("draw",this.state)},inspect(){return this.state}}}function ah(t=1){let n=0,o=!1;return{require:["opacity"],add(){this.opacity=0},update(){o||(n+=nf(),this.opacity=w(n,0,t,0,1),n>=t&&(this.opacity=1,o=!0))}}}function au(t="intersect"){return{id:"mask",mask:t}}function ac(t){e8.loaded?t():e9.events.on("load",t)}function ap(t,n){e9.scenes[t]=n}function am(n,...o){if(!e9.scenes[n])throw new eZ(`Scene not found: ${n}`);e9.events.onOnce("frameEnd",()=>{e9.events.trigger("sceneLeave",n),eW.events.clear(),e9.events.clear(),e9.objEvents.clear(),[...e9.root.children].forEach(t=>{t.stay&&(!t.scenesToStay||t.scenesToStay.includes(n))||e9.root.remove(t)}),e9.root.clearEvents(),e9.cam={pos:null,scale:x(1),angle:0,shake:0,transform:new E},e9.scenes[n](...o),!1!==t.debug&&nU(),t.burp&&nz()})}function af(t){return e9.events.on("sceneLeave",t)}function ag(t,n){try{return JSON.parse(window.localStorage[t])}catch{return n?(ay(t,n),n):null}}function ay(t,n){window.localStorage[t]=JSON.stringify(n)}function aw(n,...o){let s=n(aX),r;for(let n in r="function"==typeof s?s(...o)(aX):s)aX[n]=r[n],!1!==t.global&&(window[n]=r[n]);return aX}function av(){return x(nr()/2,nl()/2)}function aA(t={}){let n=x(0),o=t.isObstacle??!1,s=t.cost??0,r=t.edges??[],d=l(()=>{let t={left:1,top:2,right:4,bottom:8};return r.map(n=>t[n]||0).reduce((t,n)=>t|n,0)},"getEdgeMask"),c=d();return{id:"tile",tilePosOffset:t.offset??x(0),set tilePos(p){let t=this.getLevel();n=p.clone(),this.pos=x(this.tilePos.x*t.tileWidth(),this.tilePos.y*t.tileHeight()).add(this.tilePosOffset)},get tilePos(){return n},set isObstacle(p){o!==p&&(o=p,this.getLevel().invalidateNavigationMap())},get isObstacle(){return o},set cost(p){s!==p&&(s=p,this.getLevel().invalidateNavigationMap())},get cost(){return s},set edges(p){r=p,c=d(),this.getLevel().invalidateNavigationMap()},get edges(){return r},get edgeMask(){return c},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(x(-1,0))},moveRight(){this.tilePos=this.tilePos.add(x(1,0))},moveUp(){this.tilePos=this.tilePos.add(x(0,-1))},moveDown(){this.tilePos=this.tilePos.add(x(0,1))}}}function ax(t,n){if(!n.tileWidth||!n.tileHeight)throw new eZ("Must provide tileWidth and tileHeight.");let o=aM([nq(n.pos??x(0))]),s=t.length,r=0,d=null,c=null,f=null,g=null,y=l(t=>t.x+t.y*r,"tile2Hash"),w=l(t=>x(Math.floor(t%r),Math.floor(t/r)),"hash2Tile"),v=l(()=>{for(let t of(d=[],o.children))A(t)},"createSpatialMap"),A=l(t=>{let n=y(t.tilePos);d[n]?d[n].push(t):d[n]=[t]},"insertIntoSpatialMap"),k=l(t=>{let n=y(t.tilePos);if(d[n]){let o=d[n].indexOf(t);o>=0&&d[n].splice(o,1)}},"removeFromSpatialMap"),b=l(()=>{let t=!1;for(let n of o.children){let s=o.pos2Tile(n.pos);(n.tilePos.x!=s.x||n.tilePos.y!=s.y)&&(t=!0,k(n),n.tilePos.x=s.x,n.tilePos.y=s.y,A(n))}t&&o.trigger("spatial_map_changed")},"updateSpatialMap"),S=l(()=>{let t=o.getSpatialMap(),n=o.numRows()*o.numColumns();c?c.length=n:c=Array(n),c.fill(1,0,n);for(let n=0;n<t.length;n++){let o=t[n];if(o){let t=0;for(let n of o)if(n.isObstacle){t=1/0;break}else t+=n.cost;c[n]=t||1}}},"createCostMap"),V=l(()=>{let t=o.getSpatialMap(),n=o.numRows()*o.numColumns();f?f.length=n:f=Array(n),f.fill(15,0,n);for(let n=0;n<t.length;n++){let o=t[n];if(o){let t=o.length,s=15;for(let n=0;n<t;n++)s|=o[n].edgeMask;f[n]=s}}},"createEdgeMap"),M=l(()=>{let t=o.numRows()*o.numColumns(),n=l((t,n)=>{let o=[];for(o.push(t);o.length>0;)R(o.pop()).forEach(t=>{g[t]<0&&(g[t]=n,o.push(t))})},"traverse");g?g.length=t:g=Array(t),g.fill(-1,0,t);let s=0;for(let t=0;t<c.length;t++){if(g[t]>=0){s++;continue}n(t,s),s++}},"createConnectivityMap"),E=l((t,n)=>c[n],"getCost"),T=l((t,n)=>{let o=w(t),s=w(n);return o.dist(s)},"getHeuristic"),R=l((t,n)=>{let o=[],l=Math.floor(t%r),d=l>0&&1&f[t]&&c[t-1]!==1/0,g=t>=r&&2&f[t]&&c[t-r]!==1/0,y=l<r-1&&4&f[t]&&c[t+1]!==1/0,w=t<r*s-r-1&&8&f[t]&&c[t+r]!==1/0;return n?(d&&(g&&o.push(t-r-1),o.push(t-1),w&&o.push(t+r-1)),g&&o.push(t-r),y&&(g&&o.push(t-r+1),o.push(t+1),w&&o.push(t+r+1))):(d&&o.push(t-1),g&&o.push(t-r),y&&o.push(t+1)),w&&o.push(t+r),o},"getNeighbours");return o.use({id:"level",tileWidth:()=>n.tileWidth,tileHeight:()=>n.tileHeight,spawn(t,...s){let r=x(...s),l=(()=>{if("string"==typeof t){if(n.tiles[t]){if("function"!=typeof n.tiles[t])throw new eZ("Level symbol def must be a function returning a component list");return n.tiles[t](r)}else if(n.wildcardTile)return n.wildcardTile(t,r)}else{if(Array.isArray(t))return t;throw new eZ("Expected a symbol or a component list")}})();if(!l)return null;let c=!1,f=!1;for(let t of l)"tile"===t.id&&(f=!0),"pos"===t.id&&(c=!0);c||l.push(nq()),f||l.push(aA());let g=o.add(l);return c&&(g.tilePosOffset=g.pos.clone()),g.tilePos=r,d&&(A(g),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),g},numColumns:()=>r,numRows:()=>s,levelWidth(){return r*this.tileWidth()},levelHeight(){return s*this.tileHeight()},tile2Pos(...t){return x(...t).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...t){let n=x(...t);return x(Math.floor(n.x/this.tileWidth()),Math.floor(n.y/this.tileHeight()))},getSpatialMap:()=>(d||v(),d),onSpatialMapChanged(t){return this.on("spatial_map_changed",t)},onNavigationMapInvalid(t){return this.on("navigation_map_invalid",t)},getAt:t=>(d||v(),d[y(t)]||[]),update(){d&&b()},invalidateNavigationMap(){c=null,f=null,g=null},onNavigationMapChanged(t){return this.on("navigation_map_changed",t)},getTilePath(t,n,o={}){if(c||S(),f||V(),g||M(),t.x<0||t.x>=r||t.y<0||t.y>=s||n.x<0||n.x>=r||n.y<0||n.y>=s)return null;let l=y(t),d=y(n);if(c[d]===1/0)return null;if(l===d)return[];if(-1!=g[l]&&g[l]!==g[d])return null;let v=new ep((t,n)=>t.cost<n.cost);v.insert({cost:0,node:l});let A=new Map;A.set(l,l);let x=new Map;for(x.set(l,0);0!==v.length;){let t=v.remove()?.node;if(t===d)break;for(let n of R(t,o.allowDiagonals)){let o=(x.get(t)||0)+E(t,n)+T(n,d);(!x.has(n)||o<x.get(n))&&(x.set(n,o),v.insert({cost:o,node:n}),A.set(n,t))}}let k=[],b=d,P=w(b);for(k.push(P);b!==l;){let t=w(b=A.get(b));k.push(t)}return k.reverse()},getPath(t,n,o={}){let s=this.tileWidth(),r=this.tileHeight(),l=this.getTilePath(this.pos2Tile(t),this.pos2Tile(n),o);return l?[t,...l.slice(1,-1).map(t=>t.scale(s,r).add(s/2,r/2)),n]:null}}),o.onNavigationMapInvalid(()=>{o.invalidateNavigationMap(),o.trigger("navigation_map_changed")}),t.forEach((t,n)=>{let s=t.split("");r=Math.max(s.length,r),s.forEach((t,s)=>{o.spawn(t,x(s,n))})}),o}function ak(t={}){let n=null,o=null,s=null,r=null;return{id:"agent",require:["pos","tile"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return n?this.pos.dist(n):0},getNextLocation:()=>o&&s?o[s]:null,getPath:()=>o?o.slice():null,getTarget:()=>n,isNavigationFinished:()=>!o||null===s,isTargetReachable:()=>null!==o,isTargetReached(){return!n||this.pos.eq(n)},setTarget(t){n=t,s=(o=this.getLevel().getPath(this.pos,n,{allowDiagonals:this.allowDiagonals}))?0:null,o?(r||(r=this.getLevel().onNavigationMapChanged(()=>{o&&null!==s&&(s=(o=this.getLevel().getPath(this.pos,n,{allowDiagonals:this.allowDiagonals}))?0:null,o?this.trigger("navigation-next",this,o[s]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>r.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,o[s])):this.trigger("navigation-ended",this)},update(){if(o&&null!==s){if(2>this.pos.sdist(o[s]))if(s===o.length-1){this.pos=n.clone(),s=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else s++,this.trigger("navigation-next",this,o[s]);this.moveTo(o[s],this.agentSpeed)}},onNavigationStarted(t){return this.on("navigation-started",t)},onNavigationNext(t){return this.on("navigation-next",t)},onNavigationEnded(t){return this.on("navigation-ended",t)},onTargetReached(t){return this.on("target-reached",t)},inspect:()=>JSON.stringify({target:JSON.stringify(n),path:JSON.stringify(o)})}}function ab(t){let n=eW.canvas().captureStream(t),o=e4.ctx.createMediaStreamDestination();e4.masterNode.connect(o);let s=new MediaRecorder(n),r=[];return s.ondataavailable=t=>{t.data.size>0&&r.push(t.data)},s.onerror=()=>{e4.masterNode.disconnect(o),n.getTracks().forEach(t=>t.stop())},s.start(),{resume(){s.resume()},pause(){s.pause()},stop:()=>(s.stop(),e4.masterNode.disconnect(o),n.getTracks().forEach(t=>t.stop()),new Promise(t=>{s.onstop=()=>{t(new Blob(r,{type:"video/mp4"}))}})),download(t="kaboom.mp4"){this.stop().then(n=>ed(t,n))}}}function aS(){return document.activeElement===eW.canvas()}function aV(t){t.destroy()}l(nE,"onAdd"),l(nT,"onDestroy"),l(nR,"onCollide"),l(nP,"onCollideUpdate"),l(nC,"onCollideEnd"),l(nI,"forAllCurrentAndFuture"),l(nB,"onClick"),l(nH,"onHover"),l(nN,"onHoverUpdate"),l(nF,"onHoverEnd"),l(n_,"wait"),l(nD,"loop"),l(nU,"enterDebugMode"),l(nz,"enterBurpMode"),l(nL,"setGravity"),l(nj,"getGravity"),l(nO,"setBackground"),l(nG,"getBackground"),l(nq,"pos"),l(nK,"scale"),l(nY,"rotate"),l(nW,"color"),l(nQ,"toFixed"),l(nX,"opacity"),l(nJ,"anchor"),l(nZ,"z"),l(n$,"follow"),l(n0,"move"),l(n1,"offscreen"),l(n2,"isFixed"),l(n5,"area"),l(n4,"getRenderProps"),l(n3,"sprite"),l(n6,"text"),l(n8,"rect"),l(n9,"uvquad"),l(n7,"circle"),l(ae,"outline"),l(at,"timer"),l(an,"body"),l(aa,"doubleJump"),l(ai,"shader"),l(ao,"fixed"),l(as,"stay"),l(ar,"health"),l(al,"lifespan"),l(ad,"state"),l(ah,"fadeIn"),l(au,"mask"),l(ac,"onLoad"),l(ap,"scene"),l(am,"go"),l(af,"onSceneLeave"),l(ag,"getData"),l(ay,"setData"),l(aw,"plug"),l(av,"center"),(eg=ey||={})[eg.None=0]="None",eg[eg.Left=1]="Left",eg[eg.Top=2]="Top",eg[eg.LeftTop=3]="LeftTop",eg[eg.Right=4]="Right",eg[eg.Horizontal=5]="Horizontal",eg[eg.RightTop=6]="RightTop",eg[eg.HorizontalTop=7]="HorizontalTop",eg[eg.Bottom=8]="Bottom",eg[eg.LeftBottom=9]="LeftBottom",eg[eg.Vertical=10]="Vertical",eg[eg.LeftVertical=11]="LeftVertical",eg[eg.RightBottom=12]="RightBottom",eg[eg.HorizontalBottom=13]="HorizontalBottom",eg[eg.RightVertical=14]="RightVertical",eg[eg.All=15]="All",l(aA,"tile"),l(ax,"addLevel"),l(ak,"agent"),l(ab,"record"),l(aS,"isFocused"),l(aV,"destroy");let aM=e9.root.add.bind(e9.root),aE=e9.root.readd.bind(e9.root),aT=e9.root.removeAll.bind(e9.root),aR=e9.root.get.bind(e9.root);function aP(t=2,n=1){let o=0;return{id:"boom",require:["scale"],update(){let s=Math.sin(o*t)*n;s<0&&this.destroy(),this.scale=x(s),o+=nf()}}}l(aP,"boom");let aC=tm(null,"data:image/png;base64,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"),aI=tm(null,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAACDCAYAAAB2kQxsAAAAAXNSR0IArs4c6QAABqxJREFUeJztnU1yFDkQRtMEB+AG7Fk6fBPO6ZsQLGc/N5gbMAtosJvqKv2kpPxS763A0W5XSXqVqZ+SngzgF58/fflx/7N///vnacW1gBkFD2Z2LOYNBF3Dx9UXAGs5kxLWwhNxU2qlJHrOhwLfkNZoiaBzIa3dCFJYLXgSboKXmETPeVDQyamR8vX55fe/v37/9vBzCDoH0tqktEpZ+t0IOh4KOBm16euZmETPtVDAiRgRLRF0HRRuEkrFrE1hzR4Lipxj+bD6AqCPz5++/Bgp5tXfdv1CeAdPPmFmSkn0nE+a0drdFm6XiOkdKWEuKRptTXqlLuqqFNaM6Dkb+T5nbb+npo8WjZVinqFantFJk9bWojaRThq7HzKN8wiPJ7aCoJHEZN5zHvJp7RE1DTV6SnZ1fa/PL1MjJtF5HmnT2tJF3GZ/BIj05I8ULUtR6ypER7ogjxpw61rRGxEal4KYjNyORzatbUlHSxr06tFcBTHPiN5NUEJWzlZKG/aKRqYk5tl1IKgPafucZ7w+vxSluLP6olHnL6MQQfYV6bpk/+BRZXm+cXHEiApSipZHlE6tRBDMkxmyysl5VsmtjXiFoJmiZU35ZWK0oNv1OY+omSv0GDDKJCaMI42cHg25dvFCi6QZxVS6ViVSpLUz38A4oiS9ySjlW2althGWKZrN6XNuOVpbwq0ReIzqZhfTrHwE/PZZuEYqcnqO0tZQGxVqRylprLGIEDXNkLOKEakbYsYiiphmiQaEZuD9BghixiKSmGYJIueqBt4TRZEyHtHENCNyNtMaRREzHhHFNBOKnKv7myVcVXKka4WfRBXTjMjpypl8iBmP6MsOmed0Bgk1UHjxXlpORIAWIqeybyGtha1QEdNMRM5s7wLCGpTENBORE6AXNTHNkBM2QFFMM4F5ToX5TYiLqphmRE7YmMhimiEnJEb9XBdJOUlp4Qp1Mc1E5QQ4I/qyvFJCy8n8JnijEjXNAi3fQ0TwIEM6e2OqnAgII8kkptkgOZEQZlN6BquZjqhVFxlBOkZq4Z6WASAFQQ8jZwQJ70FK8CTiaeb3fDSLJyMiwiwiS/q0SkwEBE+85jYjSTpcTiSE2WQRtVlOpAMVemVdtjXmlZxICFlQk/TJjHcmYS96JJ0p6KmcZggKeWmVdPopYwgKuxJVUuQE+EU0Sd99KYICxJH0ry9DUIA/rFy3WyWnGYLCnqyQ9PCXERTgmJmSPvwlBAU4p1bUWklPP1yytA9JYWdGRtLLDyEowDUjomiRwQgKUIZnJC3OgREUoByPSDpkDyEkBfhJj6RNQ7xEUYA6aiS9Cdo8SUoUBaijVtCuFQwICtBGiajdawARFKCNK0HdVtEjKUAd0+Q0q9v/FklhJ1rmP4e8JEoUBejfq2jYNgtEUdgJzwN7u6dSSkBQyMSME7O7FyHUQpoLCqw8rv5o+d6Uw3NvfzjagUkAZvOlLH1lLMyx8wCzWBEhW3ZDmLZ7NTsrwCpmyui5A1+IPidigjcjhZy14/vytBYxwRsPMVcf/2c2QU72wQUVIgj5lqFyIiZEJ5qQb1me1gLMJLKM93wY9cVETYiGkphmg+RETFhJljY2LHICQB/uchI1AXxwlRMxAfwgrYVtUHvxwk1OoiaAL8MjJ2ICtOEip1q6APnJEBS6VwiRzp4vtM5YBvf3m/EeI8DyvUZK33z4+v1bqsZ7dN+3n2W6zwgMO44hY0X1vIqkXh419x7lXh9ds8oyviFyRqmcXrxf2FUtF89ymFkG6nI2p7WZB4FGvUWfLcVt4ahsdy+TR7ifz6lc0F5v0GfalmXldpE3esrr6PrTR84sjNjS4kpQhQhaUi4lD6KR1xK9DHupfoKoR02vSFDy9FWNoKVivv1/lG7OfZkqR043OZUbWgmtFaomaGl51ZTHCnFv5bqNnFGjZvRtEFUEHSHmI1ZHWgVBXZ5+sxvX7ANlPChpjKsknSllKaPlRU4nZo0Yjq6wiIJGFPMML2mj3M8ZRRe4QkzF6FhCJEFbBn4i0iKswn11yenZiLLKeMRqQdWiZSmlkqrcV9d0gPfksAcqBW+2ZqAoq5gZGSrnTtGwlVmCIqUepxWxerj7iIyNZ7SgiKmJhJw7NJpRgiKmLuHl3KnReA4UIaU+y+WkcbzHQ1DEzMGQ9aJH0BDK6RE0y9wlTDp2HuppERQxc0FFBaZGUMTMB5UlQG/fHyk1odJEaBUUMXWh4oSoFRQxtaHyxMi2uBseQwUKciUoYuaAShTlkaCImQcqUph7QREzF/8DSS/2GZ2/N/sAAAAASUVORK5CYII=");function aB(t,n={}){let o=aM([nq(t),as()]),s=5*(n.speed||1),r=n.scale||1;o.add([n3(aI),nK(0),nJ("center"),aP(s,r),...n.comps??[]]);let l=o.add([n3(aC),nK(0),nJ("center"),at(),...n.comps??[]]);return l.wait(.4/s,()=>l.use(aP(s,r))),l.onDestroy(()=>o.destroy()),o}function aH(){e9.root.update()}l(aB,"addKaboom"),l(aH,"updateFrame");class aN{static{l(this,"Collision")}source;target;displacement;resolved=!1;constructor(t,n,o,s=!1){this.source=t,this.target=n,this.displacement=o,this.resolved=s}reverse(){return new aN(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}}function aF(){let n={},o=t.hashGridSize||64,s=new E,r=[];function d(t){if(r.push(s.clone()),t.pos&&s.translate(t.pos),t.scale&&s.scale(t.scale),t.angle&&s.rotate(t.angle),t.transform=s.clone(),t.c("area")&&!t.paused){let s=t.worldArea().bbox(),r=Math.floor(s.pos.x/o),l=Math.floor(s.pos.y/o),d=Math.ceil((s.pos.x+s.width)/o),c=Math.ceil((s.pos.y+s.height)/o),f=new Set;for(let o=r;o<=d;o++)for(let s=l;s<=c;s++)if(n[o])if(n[o][s]){let r=n[o][s];e:for(let n of r){if(n.paused||!n.exists()||f.has(n.id))continue;for(let o of t.collisionIgnore)if(n.is(o))continue e;for(let o of n.collisionIgnore)if(t.is(o))continue e;let o=Z(t.worldArea(),n.worldArea());if(o){let s=new aN(t,n,o);t.trigger("collideUpdate",n,s);let r=s.reverse();r.resolved=s.resolved,n.trigger("collideUpdate",t,r)}f.add(n.id)}r.push(t)}else n[o][s]=[t];else n[o]={},n[o][s]=[t]}t.children.forEach(d),s=r.pop()}l(d,"checkObj"),d(e9.root)}function a_(){let t=e9.cam,n=A.fromAngle(I(0,360)).scale(t.shake);t.shake=y(t.shake,0,5*nf()),t.transform=new E().translate(av()).scale(t.scale).rotate(t.angle).translate((t.pos??av()).scale(-1).add(n)),e9.root.draw(),t_()}function aD(){let t=te();e9.events.numListeners("loading")>0?e9.events.trigger("loading",t):t7(()=>{let n=nr()/2,o=x(nr()/2,nl()/2).sub(x(n/2,12));tZ({pos:x(0),width:nr(),height:nl(),color:b(0,0,0)}),tZ({pos:o,width:n,height:24,fill:!1,outline:{width:4}}),tZ({pos:o,width:n*t,height:24})})}function aU(t,n){t7(()=>{let o=x(8);tK(),tO(t);let s=ni({text:n,font:eM,size:16,pos:o,color:b(255,255,255),fixed:!0}),r=s.width+2*o.x,l=s.height+2*o.x;t.x+r>=nr()&&tO(x(-r,0)),t.y+l>=nl()&&tO(x(0,-l)),tZ({width:r,height:l,color:b(0,0,0),radius:4,opacity:.8,fixed:!0}),ns(s),tY()})}function az(){if(nm.inspect){let t=null;for(let n of e9.root.get("*",{recursive:!0}))if(n.c("area")&&n.isHovering()){t=n;break}if(e9.root.drawInspect(),t){let n=[],o=t.inspect();for(let t in o)o[t]?n.push(`${t}: ${o[t]}`):n.push(`${t}`);aU(nu(nc()),n.join(`
`))}aU(x(8),`FPS: ${nm.fps()}`)}nm.paused&&t7(()=>{tK(),tO(nr(),0),tO(-8,8),tZ({width:32,height:32,anchor:"topright",color:b(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=1;t<=2;t++)tZ({width:4,height:19.2,anchor:"center",pos:x(-32/3*t,16),color:b(255,255,255),radius:2,fixed:!0});tY()}),1!==nm.timeScale&&t7(()=>{tK(),tO(nr(),nl()),tO(-8,-8);let t=ni({text:nm.timeScale.toFixed(1),font:eM,size:16,color:b(255,255,255),pos:x(-8),anchor:"botright",fixed:!0});tZ({width:t.width+16+32,height:t.height+16,anchor:"botright",color:b(0,0,0),opacity:.8,radius:4,fixed:!0});for(let n=0;n<2;n++){let o=nm.timeScale<1;t1({p1:x(-t.width-8*(o?2:3.5),-8),p2:x(-t.width-8*(o?2:3.5),-8-t.height),p3:x(-t.width-8*(o?3.5:2),-8-t.height/2),pos:x(-(8*n*1)+(o?-4:0),0),color:b(255,255,255),fixed:!0})}ns(t),tY()}),nm.curRecording&&t7(()=>{tK(),tO(0,nl()),tO(24,-24),t2({radius:12,color:b(255,0,0),opacity:T(0,1,4*eW.time()),fixed:!0}),tY()}),nm.showLog&&e9.logs.length>0&&t7(()=>{tK(),tO(0,nl()),tO(8,-8);let n=[];for(let t of e9.logs){let o="",s=t.msg instanceof Error?"error":"info";o+=`[time]${t.time.toFixed(2)}[/time] [${s}]${t.msg?.toString?t.msg.toString():t.msg}[/${s}]`,n.push(o)}e9.logs=e9.logs.filter(n=>eW.time()-n.time<(t.logTime||4));let o=ni({text:n.join(`
`),font:eM,pos:x(8,-8),anchor:"botleft",size:16,width:.6*nr(),lineSpacing:4,fixed:!0,styles:{time:{color:b(127,127,127)},info:{color:b(255,255,255)},error:{color:b(255,0,127)}}});tZ({width:o.width+16,height:o.height+16,anchor:"botleft",color:b(0,0,0),radius:4,opacity:.8,fixed:!0}),ns(o),tY()})}function aL(t){e9.events.on("loading",t)}function aj(t){eW.onResize(t)}function aO(t){e9.events.on("error",t)}function aG(t){e4.ctx.suspend(),eW.run(()=>{t7(()=>{let n=nr(),o=nl(),s={size:36,width:n-64,letterSpacing:4,lineSpacing:4,font:eM,fixed:!0};tZ({width:n,height:o,color:b(0,0,255),fixed:!0});let r=ni({...s,text:"Error",pos:x(32),color:b(255,128,0),fixed:!0});ns(r),no({...s,text:t.message,pos:x(32,32+r.height+16),fixed:!0}),tY(),e9.events.trigger("error",t)})})}function aq(t){eQ.push(t)}function aK(){e9.events.onOnce("frameEnd",()=>{for(let t in eW.quit(),nd)window.removeEventListener(t,nd[t]);eX.clear(eX.COLOR_BUFFER_BIT|eX.DEPTH_BUFFER_BIT|eX.STENCIL_BUFFER_BIT);let t=eX.getParameter(eX.MAX_TEXTURE_IMAGE_UNITS);for(let n=0;n<t;n++)eX.activeTexture(eX.TEXTURE0+n),eX.bindTexture(eX.TEXTURE_2D,null),eX.bindTexture(eX.TEXTURE_CUBE_MAP,null);eX.bindBuffer(eX.ARRAY_BUFFER,null),eX.bindBuffer(eX.ELEMENT_ARRAY_BUFFER,null),eX.bindRenderbuffer(eX.RENDERBUFFER,null),eX.bindFramebuffer(eX.FRAMEBUFFER,null),eQ.forEach(t=>t()),eX.deleteBuffer(e1.vbuf),eX.deleteBuffer(e1.ibuf)})}function aY(t,n,o,s,r=ex.linear){let l=0,d=[],c=nV(()=>{let f=Math.min((l+=nf())/o,1);s(y(t,n,r(f))),1===f&&(c.cancel(),s(n),d.forEach(t=>t()))});return{get paused(){return c.paused},set paused(m){c.paused=m},onEnd(t){d.push(t)},then(t){return this.onEnd(t),this},cancel(){c.cancel()},finish(){c.cancel(),s(n),d.forEach(t=>t())}}}l(aF,"checkFrame"),l(a_,"drawFrame"),l(aD,"drawLoadScreen"),l(aU,"drawInspectText"),l(az,"drawDebug"),!1!==t.debug&&nU(),t.burp&&nz(),l(aL,"onLoading"),l(aj,"onResize"),l(aO,"onError"),l(aG,"handleErr"),l(aq,"onCleanup"),l(aK,"quit"),l(aY,"tween");let aW=!0;function aQ(){let n=eX.drawingBufferWidth/eG,o=eX.drawingBufferHeight/eG;if(eW.isFullscreen()){let t=window.innerWidth,s=window.innerHeight,r=n/o;if(t/s>r){let n=window.innerHeight*r;e1.viewport={x:(t-n)/2,y:0,width:n,height:s}}else{let n=window.innerWidth/r;e1.viewport={x:0,y:(s-n)/2,width:t,height:n}}return}if(t.letterbox){if(!t.width||!t.height)throw new eZ("Letterboxing requires width and height defined.");let s=n/o,r=t.width/t.height;if(s>r){let t=o*r;e1.viewport={x:(n-t)/2,y:0,width:t,height:o}}else{let t=n/r;e1.viewport={x:0,y:(o-t)/2,width:n,height:t}}return}if(t.stretch&&(!t.width||!t.height))throw new eZ("Stretching requires width and height defined.");e1.viewport={x:0,y:0,width:n,height:o}}eW.run(()=>{e8.loaded||1!==te()||aW||(e8.loaded=!0,e9.events.trigger("load")),!e8.loaded&&!1!==t.loadingScreen||aW?(tD(),aD()):(nm.paused||aH(),aF(),tD(),a_(),!1!==t.debug&&az()),tz(),aW&&(aW=!1),e9.events.trigger("frameEnd")}),l(aQ,"updateViewport"),eW.onHide(()=>{t.backgroundAudio||e4.ctx.suspend()}),eW.onShow(()=>{t.backgroundAudio||e4.ctx.resume()}),eW.onResize(()=>{if(eW.isFullscreen())return;let n=t.width&&t.height;n&&!t.stretch&&!t.letterbox||(eA.width=eA.offsetWidth*eG,eA.height=eA.offsetHeight*eG,aQ(),n||(e1.frameBuffer.free(),e1.frameBuffer=new e0(eX.drawingBufferWidth,eX.drawingBufferHeight),e1.width=eX.drawingBufferWidth/eG,e1.height=eX.drawingBufferHeight/eG))}),aQ();let aX={VERSION:"3000.1.8",loadRoot:tt,loadProgress:te,loadSprite:tm,loadSpriteAtlas:tc,loadSound:tv,loadBitmapFont:th,loadFont:td,loadShader:ty,loadShaderURL:tw,loadAseprite:tg,loadPedit:tf,loadBean:tA,loadJSON:tr,load:e7,getSprite:tx,getSound:tk,getFont:tb,getBitmapFont:tS,getShader:tV,getAsset:tM,Asset:e3,SpriteData:e2,SoundData:e5,width:nr,height:nl,center:av,dt:nf,time:eW.time,screenshot:eW.screenshot,record:ab,isFocused:aS,setCursor:eW.setCursor,getCursor:eW.getCursor,setCursorLocked:eW.setCursorLocked,isCursorLocked:eW.isCursorLocked,setFullscreen:eW.setFullscreen,isFullscreen:eW.isFullscreen,isTouchscreen:eW.isTouchscreen,onLoad:ac,onLoading:aL,onResize:aj,onGamepadConnect:eW.onGamepadConnect,onGamepadDisconnect:eW.onGamepadDisconnect,onError:aO,onCleanup:aq,camPos:ng,camScale:ny,camRot:nw,shake:nv,toScreen:nA,toWorld:nx,setGravity:nL,getGravity:nj,setBackground:nO,getBackground:nG,getGamepads:eW.getGamepads,add:aM,make:nb,destroy:aV,destroyAll:aT,get:aR,readd:aE,pos:nq,scale:nK,rotate:nY,color:nW,opacity:nX,anchor:nJ,area:n5,sprite:n3,text:n6,rect:n8,circle:n7,uvquad:n9,outline:ae,body:an,doubleJump:aa,shader:ai,timer:at,fixed:ao,stay:as,health:ar,lifespan:al,z:nZ,move:n0,offscreen:n1,follow:n$,state:ad,fadeIn:ah,mask:au,tile:aA,agent:ak,on:nS,onUpdate:nV,onDraw:nM,onAdd:nE,onDestroy:nT,onClick:nB,onCollide:nR,onCollideUpdate:nP,onCollideEnd:nC,onHover:nH,onHoverUpdate:nN,onHoverEnd:nF,onKeyDown:eW.onKeyDown,onKeyPress:eW.onKeyPress,onKeyPressRepeat:eW.onKeyPressRepeat,onKeyRelease:eW.onKeyRelease,onMouseDown:eW.onMouseDown,onMousePress:eW.onMousePress,onMouseRelease:eW.onMouseRelease,onMouseMove:eW.onMouseMove,onCharInput:eW.onCharInput,onTouchStart:eW.onTouchStart,onTouchMove:eW.onTouchMove,onTouchEnd:eW.onTouchEnd,onScroll:eW.onScroll,onHide:eW.onHide,onShow:eW.onShow,onGamepadButtonDown:eW.onGamepadButtonDown,onGamepadButtonPress:eW.onGamepadButtonPress,onGamepadButtonRelease:eW.onGamepadButtonRelease,onGamepadStick:eW.onGamepadStick,mousePos:nc,mouseDeltaPos:eW.mouseDeltaPos,isKeyDown:eW.isKeyDown,isKeyPressed:eW.isKeyPressed,isKeyPressedRepeat:eW.isKeyPressedRepeat,isKeyReleased:eW.isKeyReleased,isMouseDown:eW.isMouseDown,isMousePressed:eW.isMousePressed,isMouseReleased:eW.isMouseReleased,isMouseMoved:eW.isMouseMoved,isGamepadButtonPressed:eW.isGamepadButtonPressed,isGamepadButtonDown:eW.isGamepadButtonDown,isGamepadButtonReleased:eW.isGamepadButtonReleased,charInputted:eW.charInputted,loop:nD,wait:n_,play:tI,volume:tC,burp:tB,audioCtx:e4.ctx,Timer:ek,Line:Y,Rect:W,Circle:Q,Polygon:J,Vec2:A,Color:k,Mat4:E,Quad:V,RNG:R,rand:I,randi:B,randSeed:C,vec2:x,rgb:b,hsl2rgb:S,quad:M,choose:N,chance:H,lerp:y,tween:aY,easings:ex,map:w,mapc:v,wave:T,deg2rad:c,rad2deg:f,clamp:g,testLineLine:U,testRectRect:F,testRectLine:z,testRectPoint:L,testCirclePolygon:q,testLinePoint:j,testLineCircle:O,drawSprite:tX,drawText:no,formatText:ni,drawRect:tZ,drawLine:t$,drawLines:t0,drawTriangle:t1,drawCircle:t2,drawEllipse:t5,drawUVQuad:tW,drawPolygon:t4,drawFormattedText:ns,drawMasked:t6,drawSubtracted:t8,pushTransform:tK,popTransform:tY,pushTranslate:tO,pushScale:tG,pushRotate:tq,pushMatrix:tj,usePostEffect:tU,debug:nm,scene:ap,go:am,onSceneLeave:af,addLevel:ax,getData:ag,setData:ay,download:es,downloadJSON:el,downloadText:er,downloadBlob:ed,plug:aw,ASCII_CHARS:eS,canvas:eW.canvas(),addKaboom:aB,LEFT:A.LEFT,RIGHT:A.RIGHT,UP:A.UP,DOWN:A.DOWN,RED:k.RED,GREEN:k.GREEN,BLUE:k.BLUE,YELLOW:k.YELLOW,MAGENTA:k.MAGENTA,CYAN:k.CYAN,WHITE:k.WHITE,BLACK:k.BLACK,quit:aK,Event:et,EventHandler:en,EventController:ee,KaboomError:eZ};if(t.plugins&&t.plugins.forEach(aw),!1!==t.global)for(let t in aX)window[t]=aX[t];return eW.canvas().focus(),aX},"default")({width:1280,height:720,letterbox:!0,global:!1}),eL=(n=null,{getInstance(){let t,o,s,r,l,d,c,f,g,y,w;return n||(t=null,o=null,s=!1,r="english",l=25,d=!1,c=!1,f=null,g=!1,y=!1,w={},n={setPreviousScene(n){t=n},getPreviousScene:()=>t,setCurrentScene(t){o=t},getCurrentScene:()=>o,setFreezePlayer(t){s=t},getFreezePlayer:()=>s,setLocale(t){r=t},getLocale:()=>r,setFontSize(t){l=t},getFontSize:()=>l,setIsGhostDefeated(t){d=t},getIsGhostDefeated:()=>d,setIsSonSaved(t){c=t},getIsSonSaved:()=>c,setChosenEnding(t){f=t},getChosenEnding:()=>f,setHasKey(t){g=t},getHasKey:()=>g,setHasSword(t){y=t},getHasSword:()=>y,setFlag(t,n){w[t]=n},getFlag:t=>w[t]||!1}),n}}).getInstance(),ej=(o=null,{getInstance(){let t,n,s,r,l,d,c,f,g,y,w,v;return o||(t=!1,n=1,s=1,r=!1,l=!1,d=!1,c=!1,f=!1,g=!1,y=!1,w=!1,v=!1,o={setIsSwordEquipped(n){t=n},getIsSwordEquipped:()=>t,getTrueMaxHealth:()=>8,setCurrentMaxHealth(t){s>(n=Math.min(t,8))&&(s=n)},getCurrentMaxHealth:()=>n,setHealth(t){s=Math.max(0,Math.min(t,n))},getHealth:()=>s,setHasKey(t){r=t},getHasKey:()=>r,setHasSword(t){l=t},getHasSword:()=>l,setHasGivenSwordToNaoko(t){d=t},getHasGivenSwordToNaoko:()=>d,setHasStrawberries(t){c=t},getHasStrawberries:()=>c,setHasGivenStrawberriesToSatoshi(t){f=t},getHasGivenStrawberriesToSatoshi:()=>f,setHasManga(t){g=t},getHasManga:()=>g,setHasGivenMangaToMari(t){y=t},getHasGivenMangaToMari:()=>y,setHasOriyoki(t){w=t},getHasOriyoki:()=>w,setHasGivenOriyokiToKoji(t){v=t},getHasGivenOriyokiToKoji:()=>v}),o}}).getInstance(),eO=(s=null,{getInstance:()=>(s||(s=function(){let t={};function n(o,s={}){t[o]||(t[o]={hasSpoken:!1,repeatIndex:0,nbTalked:0,hasGivenHeart:!1,talkedScenes:{world:0,bath:0},...s})}return{initNpc(t,o){n(t,o)},setHasSpoken(o,s){n(o),t[o].hasSpoken=s},getHasSpoken:o=>(n(o),t[o].hasSpoken),getRepeatIndex:o=>(n(o),t[o].repeatIndex),incrementRepeatIndex(o){n(o),t[o].repeatIndex+=1},resetRepeatIndex(o){n(o),t[o].repeatIndex=0},setNbTalked(o,s){n(o),t[o].nbTalked=s},getNbTalked:o=>(n(o),t[o].nbTalked),setHasGivenHeart(o,s){n(o),t[o].hasGivenHeart=s},getHasGivenHeart:o=>(n(o),t[o].hasGivenHeart),setSceneTalked(o,s){n(o),t[o].talkedScenes[s]=(t[o].talkedScenes[s]||0)+1},getSceneTalkCount:(o,s)=>(n(o),t[o].talkedScenes[s]||0),hasTalkedEnoughInScenes:(o,s)=>(n(o),Object.entries(s).every(([n,s])=>(t[o].talkedScenes[n]||0)>=s)),haveTalkedToAll:o=>o.every(o=>(n(o),t[o].hasSpoken)),reset(){Object.keys(t).forEach(n=>{t[n]={hasSpoken:!1,repeatIndex:0,nbTalked:0,hasGivenHeart:!1,talkedScenes:{world:0,bath:0}}})}}}()),s)}).getInstance();let eG=null;const eq={},eK={playMusic(t,n,o={}){eG&&eG.stop&&(eG.stop(),eG=null);try{eG=t.play(n,{loop:!0,volume:o.volume??.2})}catch(t){console.error(`\u{274C} Failed to play music: "${n}"`,t)}return eG},stopMusic(){eG&&eG.stop&&(eG.stop(),eG=null)},loadSound(t,n,o){eq[n]=t.load(o)},playSound(t,n,o={}){eq[n]?eq[n].play({volume:o.volume??.4}):console.warn(`\u{274C} Sound effect "${n}" not loaded.`)},stopSound(t){eq[t]&&eq[t].stop?eq[t].stop():console.warn(`\u{274C} No sound effect found to stop for "${t}".`)}},eY={oldmanPortrait:1159,yukiPortrait:1034,satoshiPortrait:1018,kojiPortrait:1026,mariPortrait:1030,naokoPortrait:1022,hanaPortrait:1038,randyPortrait:1014,npc1Portrait:1042,npc2Portrait:1155,npc3Portrait:1147,npc4Portrait:1143,npc5Portrait:1182,default:1163};let eW=null;async function eQ(t,n){for(let o of n)await new Promise(n=>setTimeout(()=>{t.text+=o,n()},10))}async function eX(t,n,o=[],s=!1,r=[],l=[],d=[],c=null){let f,g;eL.setFreezePlayer(!0),t.play("soundUI",{volume:.4}),Array.isArray(o)||(o=[String(o)]),Array.isArray(r)||(r=[]),Array.isArray(l)||(l=[]),Array.isArray(d)||(d=[]),t.destroyAll("dialogueBox"),t.destroyAll("portraitFrame"),t.destroyAll("portraitImage"),t.destroyAll("nameLabel");let y=t.width()/2,w=t.height()-225,v=y-380,A=(n,o)=>{if(t.destroyAll("portraitFrame"),t.destroyAll("portraitImage"),t.destroyAll("nameLabel"),!n&&!o)return;t.add([t.rect(120,150,{radius:12}),t.color(255,255,255),t.pos(v,w),t.z(1001),t.fixed(),t.opacity(.85),"portraitFrame"]);let s=eY[n]||eY.default;t.add([t.sprite("assets",{frame:s}),t.pos(v+25,w+10),t.scale(5.2),t.z(1002),t.fixed(),"portraitImage"]),o&&t.add([t.text(o,{font:"gameboy",size:22}),t.color(0,0,0),t.pos(v+60,w+125),t.anchor("center"),t.z(1003),t.fixed(),"nameLabel"])};c&&(f=t.add([t.rect(680,36,{radius:6}),t.color(255,255,255),t.pos(y-250,w-40),t.z(999),t.fixed(),t.opacity(.85)]),g=t.add([t.text(c,{font:"gameboy",size:30}),t.color(0,0,0),t.pos(y-187.5-40,w-22),t.anchor("left"),t.z(1e3),t.fixed()]));let x=t.add([t.rect(680,200,{radius:12}),t.color(255,255,255),t.pos(y-250,w),t.z(1e3),t.fixed(),t.opacity(.85),"dialogueBox"]),k=x.add([t.text("",{font:"gameboy",width:640,lineSpacing:12,size:eL.getFontSize()}),t.color(0,0,0),t.pos(20,1.6*eL.getFontSize()),t.fixed()]),b=x.add([t.text("Press SPACE",{font:"gameboy",size:eL.getFontSize()-4}),t.color(0,0,0),t.pos(270,170),t.fixed(),t.opacity(0)]),S=0,V=t.onUpdate(()=>{b.opacity>0&&(b.hidden=Math.floor(2*(S+=t.dt()))%2==0)}),M=0,E=!1,T=null,R=n=>new Promise(o=>{if(l&&l[n])try{if(T&&T.stop&&T.stop(),(T=t.play(l[n]))&&T.on)T.on("end",o);else{let n=setTimeout(o,7e3);t.onKeyPress("space",()=>{clearTimeout(n),o()})}}catch(t){console.warn(`\u{26A0}\u{FE0F} Couldn't play voice line: ${l[n]}`,t),o()}else o()}),P=async t=>{k.text="",b.opacity=0,E=!1,A(r[t]||null,d[t]||null),await Promise.all([(async()=>{s?k.text=o[t]:await eQ(k,o[t])})(),R(t)]),b.opacity=1,E=!0};await P(M);let C=async()=>{if(E){if(T&&T.stop&&T.stop(),!o[++M]){t.destroy(x),t.destroyAll("interactPrompt"),t.destroyAll("portraitImage"),t.destroyAll("portraitFrame"),t.destroyAll("nameLabel"),f&&t.destroy(f),g&&t.destroy(g),I.cancel(),B.cancel(),V.cancel(),eL.setFreezePlayer(!1),"function"==typeof eW&&(eW(),eW=null);return}await P(M)}},I=t.onKeyPress("space",C),B=t.onClick(C)}const eJ=[{id:"randy",name:"Randy",hasHeart:!0},{id:"oldman",name:"Tetsuya",hasHeart:!1},{id:"satoshi",name:"Satoshi",hasHeart:!1},{id:"hana",name:"Hana",hasHeart:!1},{id:"naoko",name:"Naoko",hasHeart:!1},{id:"mari",name:"Mari",hasHeart:!1},{id:"koji",name:"Koji",hasHeart:!1},{id:"yuki",name:"Yuki",hasHeart:!1}];function eZ(t){let n=t.add([t.rect(400,85,{radius:8}),t.color(255,255,255),t.opacity(.75),t.pos(12,12),t.fixed(),t.z(1800),"heartBackground"]),o=t.add([t.pos(20,20),t.fixed(),t.z(2001),"heartContainer"]);function s(){o.children=[];let s=0;for(let n of eJ){let r=n.hasHeart?"full-heart":"empty-heart",l=n.hasHeart?t.rgb(0,0,0):t.rgb(150,150,150);o.add([t.sprite(r),t.pos(s,0),t.z(2002)]),o.add([t.text(n.name,{font:"gameboy",size:15,width:49,align:"center"}),t.color(l),t.pos(s,45),t.z(2002)]),s+=75}n.width=s+20}return s(),{update(){s()},giveHeartToNPC(n){let o=eJ.find(t=>t.id===n);if(o&&!o.hasHeart){o.hasHeart=!0,s();try{t.play("sparkle")}catch(t){console.warn(" Could not play sparkle sound:",t)}}},hasHeart(t){let n=eJ.find(n=>n.id===t);return n?.hasHeart??!1}}}function e$(t,n){t&&"function"==typeof t.curAnim&&t.curAnim()!==n&&t.play(n)}function e0(t,n,o,s){t.add([t.rect(t.canvas.width,t.canvas.height),t.color(n,o,s),t.fixed(),t.z()])}function e1(t,n,o,s,r,l=0){let d=0,c=t.vec2(0,0);for(let f of o.data){if(d%o.width==0?(c.x=0,c.y+=s):c.x+=r,d++,0===f)continue;let g=f-1;if(g<0||g>1208){console.warn(`\u{26A0}\u{FE0F} Skipping invalid tile index: ${f}`);continue}n.add([t.sprite("assets",{frame:g}),t.pos(c.clone()),t.z(l),t.offscreen()])}}function e2(t,n,o){for(let f of o.objects){var s,r,l,d,c;n.add((s=t,r=f.width,l=f.height,d=t.vec2(f.x,f.y),c=""!==f.name?f.name:"wall",[s.rect(r,l),s.pos(d.x,d.y+16),s.area(),s.body({isStatic:!0}),s.opacity(0),s.offscreen(),c,"solid"]))}}async function e5(t){return await (await fetch(t)).json()}function e4(t){t.onKeyPress("escape",()=>{t.go("endingCredits")})}var e3={world:{lines:[{speaker:"Old Man",text:"Waves once kissed my boat,\nHer laugh once danced on the wind\nBoth have since gone home."},{speaker:"Randy",text:"Boats rock me to sleep,\nWind once danced with my boxers\nNeighbors filed a claim."},{speaker:"Old Man",text:"She brewed morning tea,\nBirds came knowing her warm hands\nKindness lingered there."},{speaker:"Randy",text:"I made ramen once.\nBirds came, but it was seagulls\nStill counts as magic."},{speaker:"Old Man",text:"Many walked too fast,\nPebbles unturned in their haste\nYou stayed. That meant much."},{speaker:"Randy",text:"I stay for snacks, yes.\nAnd for vibes. And ghost lanterns\nMostly 'cause Im lost."},{speaker:"Old Man",text:"One heart fed the sea,\nOne heart fed sparrows with joy\nThis one, I kept back."},{speaker:"Randy",text:"Sparrows pecked my fries.\nI fed them rage and ketchup\nThey respected me."},{speaker:"Old Man",text:"Lanterns once burned bright,\nGuiding souls through winter fog\nStill, I wait beside the shore."},{speaker:"Randy",text:"I burned a lantern.\nAccidentally. Then left.\nStillvibes were restored."}],voices:["oldman_world1","oldman_world2","oldman_world3","oldman_world4","oldman_world5"],randyVoices:["randy_oldman1","randy_oldman2","randy_oldman3","randy_oldman4","randy_oldman5"]},bath:{lines:[{speaker:"Old Man",text:"Steam fogs memory\nmy bones remember the war,\nmy heart forgets it."},{speaker:"Randy",text:"Steam fogs my glasses.\nI declare war on shampoo\nIt always wins, though."},{speaker:"Old Man",text:"Silence like warm rain\nmelts the armor of old grief.\nThe tub overflows."},{speaker:"Randy",text:"Tub is full of peace,\nand one questionable sock\nI claim both as mine."},{speaker:"Old Man",text:"The boy once ran here\nsoap bubbles caught in his hair,\nlaughing like the wind."},{speaker:"Randy",text:"I slipped on a bar.\nLaughed like wind and hit the tiles\nSpa day: completed."}],voices:["oldman_bath1","oldman_bath2","oldman_bath3"],randyVoices:["randy_oldmanbath1","randy_oldmanbath2","randy_oldmanbath3"]}};function e6(t,n){n.isTalking=!1,n.lastDir="down";let o=t.vec2(0,0),s=0,r=0,l=!1,d=n.is("oldman")?"oldman":n.is("satoshi")?"satoshi":n.is("naoko")?"naoko":n.is("hana")?"hana":n.is("npc1")?"npc1":n.is("npc2")?"npc2":n.is("npc3")?"npc3":"koji",c="oldman"===d?"Old Man":"satoshi"===d?"Satoshi":"naoko"===d?"Naoko":"hana"===d?"Hana":"npc1"===d?"npc1":"npc2"===d?"npc2":"npc3"===d?"npc3":"Koji",f="oldman"===d?14:"satoshi"===d?22:"naoko"===d||"hana"===d?18:"npc1"===d?20:"npc2"===d||"npc3"===d?21:20;function g(){let c=[t.vec2(0,-1),t.vec2(0,1),t.vec2(-1,0),t.vec2(1,0)];o=t.choose(c),s=t.rand(1,2),r=0,l=!0,n.play(`${d}-down`),n.lastDir="down"}function y(){l=!1,r=t.rand(1,2),n.stop(),n.play(`${d}-idle-${n.lastDir}`)}t.onUpdate(()=>{if(n&&n.exists()){if(n.isTalking||n.pauseWander)return void n.stop();if(l&&s>0){let r=o.scale(f*t.dt()),l=n.pos.add(r);if(t.get("wall").some(n=>{if(!n.area)return!1;let o=n.area.world;return o&&o.contains(l.add(t.vec2(8,8)))})){console.log(`\u{1F9F1} Blocked: ${c} can't move.`),y();return}n.pos=l,s-=t.dt(),0!==o.x?(n.flipX=o.x<0,n.curAnim()!==`${d}-side`&&n.play(`${d}-side`),n.lastDir="side"):o.y<0?(n.curAnim()!==`${d}-up`&&n.play(`${d}-up`),n.lastDir="up"):(n.curAnim()!==`${d}-down`&&n.play(`${d}-down`),n.lastDir="down"),s<=0&&y()}else(r-=t.dt())<=0&&g()}}),n.on("dialogue-ended",()=>{t.wait(0,()=>{n.isTalking=!1,o=o.scale(-1),s=t.rand(.5,1.2),r=0,l=!0,n.play(`${d}-${n.lastDir}`),console.log(`\u{1F501} ${c} resumes moving opposite after dialogue`)})}),g()}function e8(t,n){return[t.sprite("assets",{anim:"oldman-down"}),t.pos(n),t.body({isStatic:!1}),t.area({shape:new t.Rect(t.vec2(),20,20)}),t.z(99),"oldman","npc","wall","solid"]}async function e9(t,n,o,s,r,l,d){let c=o.direction;o.direction="down",n.isTalking=!0;let f=o.pos.x-n.pos.x,g=o.pos.y-n.pos.y;Math.abs(f)>Math.abs(g)?(n.flipX=f<0,e$(n,"oldman-side")):g<0?e$(n,"oldman-up"):e$(n,"oldman-down");let y=eL.getCurrentScene(),{lines:w=[],voices:v=[],randyVoices:A=[]}=r[y]||{};ej.setIsSwordEquipped(!0),eO.setSceneTalked(s,y);let x=eO.getNbTalked(s),k=Math.min(x,Math.floor(w.length/2)-1),b=w[2*k],S=w[2*k+1];if(b?.text&&S?.text)await eX(t,t.vec2(0,0),[b.text,S.text],!1,[l,"randyPortrait"],[v[k]||null,A[k]||null],["Old Man","Randy"]);else{let n={world:["Waves once sang to me\nNow they whispered her goodbye.\nThe tide always took.","My boat sat unused\nBarnacles clung like old grief.\nI let silence speak.","She stitched my torn nets\nEach thread held a quiet vow.\nThe gulls knew her name.","Tea cooled in my hand\nI had poured a second cup.\nForce of habit, eh?"],bath:["No towel dries guilt\nBut hot water forgives much.\nThe mirror steams up.","I once soaked too long\nChasing dreams in rising heat.\nThey wrinkled with me.","A drop from the eaves\nReminds me I am still here.\nStill here, soaking time.","Soap slips from my hand\nMemories do the same thing.\nSome return later."]},o={world:["oldman_extra1","oldman_extra2","oldman_extra3","oldman_extra4"],bath:["oldman_bath_extra1","oldman_bath_extra2","oldman_bath_extra3","oldman_bath_extra4"]},s=n[y]||n.world,r=o[y]||o.world,l=Math.floor(Math.random()*s.length);await eX(t,t.vec2(0,0),[s[l]],!1,["oldmanPortrait"],[r[l]],["Old Man"])}eO.getSceneTalkCount(s,"world")>=2&&eO.getSceneTalkCount(s,"bath")>=2&&!eO.getHasGivenHeart(s)&&ej.getCurrentMaxHealth()<ej.getTrueMaxHealth()&&(ej.setCurrentMaxHealth(ej.getCurrentMaxHealth()+1),ej.setHealth(ej.getCurrentMaxHealth()),t.destroyAll("healthContainer"),d.giveHeartToNPC("oldman"),d.update(),eO.setHasGivenHeart(s,!0)),eO.setNbTalked(s,x+1),o.direction=c,eW=()=>{n.isTalking=!1,n.pauseWander=!1,n.reverseDirection=!0,n.trigger("dialogue-ended")}}async function e7(t,n,o,s){await e9(t,n,o,"oldman",e3,"oldmanPortrait",s)}function te(t){e$(t,"oldman-down")}async function tt(t,n,o,s){let r=o.direction;o.direction="down",n.isTalking=!0,n.pauseWander=!0;let l=o.pos.x-n.pos.x,d=o.pos.y-n.pos.y;Math.abs(l)>Math.abs(d)?(n.flipX=l<0,e$(n,"npc1-side")):d<0?e$(n,"npc1-up"):e$(n,"npc1-down");let c=["I once saw a bird\nwearing a hat made of leaves.\nOr maybe it dreamed.","Rain falls on the roof.\nSometimes I forget my name.\nStill, I answer it.","I guard this corner\nFrom what, no one really knows.\nStill, I do my job."],f=Math.floor(Math.random()*c.length);await eX(t,t.vec2(0,0),[c[f]],!1,[s],[["npc1_extra1","npc1_extra2","npc1_extra3"][f]],["Stranger"]),eO.setNbTalked("npc1",eO.getNbTalked("npc1")+1),o.direction=r,eW=()=>{n.isTalking=!1,n.pauseWander=!1,n.trigger("dialogue-ended")}}async function tn(t,n,o){await tt(t,n,o,"npc1Portrait")}async function ta(t,n,o,s){let r=o.direction;o.direction="down",n.isTalking=!0,n.pauseWander=!0;let l=o.pos.x-n.pos.x,d=o.pos.y-n.pos.y;Math.abs(l)>Math.abs(d)?(n.flipX=l<0,e$(n,"npc2-side")):d<0?e$(n,"npc2-up"):e$(n,"npc2-down");let c=["Once I ate a bug.\nIt tasted like old secrets.\nStill, Id try again.","Moonlight on the fence.\nSometimes I dance with my thoughts.\nThey never step right.","My shoes once spoke French.\nOr maybe it was the wind.\nI should wear sandals."],f=Math.floor(Math.random()*c.length);await eX(t,t.vec2(0,0),[c[f]],!1,[s],[["npc2_extra1","npc2_extra2","npc2_extra3"][f]],["Stranger"]),eO.setNbTalked("npc2",eO.getNbTalked("npc2")+1),o.direction=r,eW=()=>{n.isTalking=!1,n.pauseWander=!1,n.trigger("dialogue-ended")}}async function ti(t,n,o){await ta(t,n,o,"npc2Portrait")}async function to(t,n,o,s){let r=o.direction;o.direction="down",n.isTalking=!0,n.pauseWander=!0;let l=o.pos.x-n.pos.x,d=o.pos.y-n.pos.y;Math.abs(l)>Math.abs(d)?(n.flipX=l<0,e$(n,"npc3-side")):d<0?e$(n,"npc3-up"):e$(n,"npc3-down");let c=["Wind stirs the silence\nEchoes of the unseen past\nWhispers call my name.","Shoes full of gravel\nEvery step reminds me why\nI once walked away.","The lamplight flickers\nShadow puppets on brick walls\nDancing with no tune."],f=Math.floor(Math.random()*c.length);await eX(t,t.vec2(0,0),[c[f]],!1,[s],[["npc3_extra1","npc3_extra2","npc3_extra3"][f]],["Stranger"]),eO.setNbTalked("npc3",eO.getNbTalked("npc3")+1),o.direction=r,eW=()=>{n.isTalking=!1,n.pauseWander=!1,n.trigger("dialogue-ended")}}async function ts(t,n,o){await to(t,n,o,"npc3Portrait")}var tr=["Stillness fills the steam\nleave your worries at the door,\nthey'll wait, but you wont.","Soap clings, then vanishes\nlike the names we used to wear.\nWarm water remembers.","Shadows fog the tiles.\nEven silence needs to soak\nin something gentle.","Beneath lantern glow,\nWhispers of time in still air,\nGuests rest, dreams unfold."];function tl(t,n){return[t.sprite("assets",{anim:"signbath"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(n.x,n.y+6),t.z(1),"item",{itemName:"signbath"}]}async function td(t){let n=tr[Math.floor(Math.random()*tr.length)];t.play("soundUI",{volume:.4}),await eX(t,t.vec2(0,0),[n],!0,null,[],null,"Bath House")}var th=["Trains hum through the dusk\nEchoes of unspoken thoughts\nrattle down the tracks.","Steel on ancient stone,\na schedule older than dust\nyet still it arrives.","A whistle whispers\nnot a warning, just goodbye,\ntoo fast to regret.","Beneath station lights,\nhope waits on a yellow line,\nticket in its teeth."];function tu(t,n){return[t.sprite("assets",{anim:"signtrain"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(n.x,n.y+6),t.z(1),"item",{itemName:"signtrain"}]}async function tc(t){let n=th[Math.floor(Math.random()*th.length)];t.play("soundUI",{volume:.4}),await eX(t,t.vec2(0,0),[n],!0,null,[],null,"Train Station")}var tp=["This bed is a thought\nnot where sleep begins or ends,\nbut where dreams detour","Midnight whispers loud\nthrough vents and motel curtains\nwho else couldn't sleep?","Soft sheets, heavy eyes.\nBehind every 'Do Not Disturb'\nis a story paused.","Luggage by the door,\na soft click of lights shut off\nrest, borrowed again."];function tm(t,n){return[t.sprite("assets",{anim:"signhotel"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(n.x,n.y+6),t.z(1),"item",{itemName:"signhotel"}]}async function tf(t){let n=tp[Math.floor(Math.random()*tp.length)];t.play("soundUI",{volume:.4}),await eX(t,t.vec2(0,0),[n],!0,null,[],null,"Hotel")}var tg=["Insert coin, receive:\nliquid code, citrus-powered\nupgrade: Vitamin C.","404: No snack.\nJust me, one job, and no thanks.\nStill better than Jeff.","Artificial? Sure.\nBut arent we all in some ways?\nExcept Im fizzy.","You press, I obey.\nRefreshing compliance rate:\n99 percent."];function ty(t,n){return[t.sprite("assets",{anim:"orangevending"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(n.x,n.y+6),t.z(1),"item",{itemName:"orangevending"}]}async function tw(t){let n=tg[Math.floor(Math.random()*tg.length)];t.play("soundUI",{volume:.4}),await eX(t,t.vec2(0,0),[n],!0,null,[],null,"Vending Machine")}var tv=["Minimalist shell\ninside, chaos. Sugar, code,\nand your reflection.","Press A1 again.\nRisk is the spice of caffeine.\nOr just poor design.","Behold: sleek white box.\nSoul of vending perfected.\nSnacks? Eventually.","My lights softly hum,\ncontemplating your choices.\nThey lack discipline.","Try the white tea pouch.\nI brewed it in silence once.\nNow it judges you.","Scan the QR code.\nI dare you. Mystery snack\nor eternal debt?"];function tA(t,n){return[t.sprite("assets",{anim:"whitevending"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(n.x,n.y+6),t.z(1),"item",{itemName:"whitevending"}]}async function tx(t){let n=tv[Math.floor(Math.random()*tv.length)];t.play("soundUI",{volume:.4}),await eX(t,t.vec2(0,0),[n],!0,null,[],null,"Vending Machine")}function tk(t,n){return[t.sprite("assets",{anim:"player-idle-down"}),{origin:"center"},t.area({shape:new t.Rect(t.vec2(3,4),10,12)}),t.body(),t.pos(n),t.z(100),t.opacity(),{speed:100,attackPower:1,direction:"down",isAttacking:!1,isFrozen:!1},"player"]}function tb(t){t.onUpdate(()=>{0>=ej.getHealth()&&(ej.setHealth(ej.getMaxHealth()),t.go("world"))})}function tS(t,n){let o={left:!1,right:!1,up:!1,down:!1};t.onUpdate(()=>{if(eL.getFreezePlayer())return;let{left:t,right:s,up:r,down:l}=o;t?(n.flipX=!0,e$(n,"player-side"),n.move(-n.speed,0),n.direction="left"):s?(n.flipX=!1,e$(n,"player-side"),n.move(n.speed,0),n.direction="right"):r?(e$(n,"player-up"),n.move(0,-n.speed),n.direction="up"):l?(e$(n,"player-down"),n.move(0,n.speed),n.direction="down"):n.stop()}),t.onKeyDown(t=>{!eL.getFreezePlayer()&&(["left","a"].includes(t)&&(o.left=!0),["right","d"].includes(t)&&(o.right=!0),["up","w"].includes(t)&&(o.up=!0),["down","s"].includes(t)&&(o.down=!0))}),t.onKeyRelease(t=>{["left","a"].includes(t)&&(o.left=!1),["right","d"].includes(t)&&(o.right=!1),["up","w"].includes(t)&&(o.up=!1),["down","s"].includes(t)&&(o.down=!1),n.stop()});let s=(n,o,s,r,l)=>{let d=t.add([t.rect(40,40,{radius:6}),t.pos(o,s),t.color(200,200,200),t.z(1e3),t.fixed(),t.area(),"touch-btn"]);d.add([t.text(n,{size:16}),t.pos(10,10),t.z(1001)]),d.onUpdate(()=>{let n=t.mousePos(),d=t.isMouseDown("left"),c=n.x>=o&&n.x<=o+40&&n.y>=s&&n.y<=s+40;if(eL.getFreezePlayer())return void l();c&&d?r():l()})};s("",40,t.height()-90,()=>o.left=!0,()=>o.left=!1),s("",120,t.height()-90,()=>o.right=!0,()=>o.right=!1),s("",80,t.height()-130,()=>o.up=!0,()=>o.up=!1),s("",80,t.height()-50,()=>o.down=!0,()=>o.down=!1),t.on("attack",()=>{if(!eL.getFreezePlayer()&&ej.getIsSwordEquipped()){if(n.isAttacking=!0,0===t.get("swordHitBox").length){let o={left:n.worldPos().x-2,right:n.worldPos().x+10,up:n.worldPos().x+5,down:n.worldPos().x+2},s={left:n.worldPos().y+5,right:n.worldPos().y+5,up:n.worldPos().y,down:n.worldPos().y+10};t.add([t.area({shape:new t.Rect(t.vec2(0),8,8)}),t.pos(o[n.direction],s[n.direction]),"swordHitBox"]),t.wait(.1,()=>{t.destroyAll("swordHitBox"),e$(n,`player-${n.direction}`),n.stop()})}e$(n,`player-attack-${n.direction}`)}})}function tV(t){let n=t.add([t.rect(180,24,{radius:4}),t.color(0,0,0),t.opacity(0),t.pos(0,0),t.z(1099),t.fixed(),"interactPromptBG"]),o=t.add([t.text("E to Interact",{size:24}),t.color(255,255,255),t.opacity(0),t.pos(0,0),t.z(1100),t.fixed(),"interactPromptText"]);return{show(){n.opacity=.7,o.opacity=1},hide(){n.opacity=0,o.opacity=0},setPosition(s){let r=t.toScreen(s).sub(t.vec2(90,36));n.pos=r,o.pos=r.add(t.vec2(5,2))}}}let tM=null;var tE={teahouse:{lines:[{speaker:"Yuki",text:"Cherry buds still sleep,\nToo soon to ask where roots go\nPatience warms the bloom."},{speaker:"Randy",text:"Roots? Like... tree Wi-Fi?\nI wait, but nothing connects.\nDo I water it?"},{speaker:"Yuki",text:"Rain does not explain\nWhy it falls on certain leaves\nJust be still and wait."},{speaker:"Randy",text:"Rain hits me each time\nmy shirts soaked but still no clue.\nCan we get indoors?"},{speaker:"Yuki",text:"A kettle will sing,\nOnly when its held with care\nYour hands seem steady."},{speaker:"Randy",text:"Steady like my tan,\nfrom sipping beer in Cancun\nI hold mugs real good."},{speaker:"Yuki",text:"Lanterns in the fog,\nNot lost, only glowing slow\nThats how hearts return."},{speaker:"Randy",text:"My hearts GPS\nkeeps rerouting toward you.\nCan I stay the night?"}],voices:["yuki_tea1","yuki_tea2","yuki_tea3","yuki_tea4"],randyVoices:["randy_tea1","randy_tea2","randy_tea3","randy_tea4"]},cstore:{lines:[{speaker:"Yuki",text:"The shelves, like trees, stand tall,\nStocked with goods that grow daily\nI tend them as I would a garden."},{speaker:"Randy",text:"Your stores like Whole Foods,\nif Whole Foods had mochi balls.\nAlso, youre cute. Hi."},{speaker:"Yuki",text:"The hum of the fridge is like the wind,\nCarrying whispers of faraway places\nI often wonder who theyre meant for."},{speaker:"Randy",text:"Heard that fridge just hum\nmight be flirting back with me.\nShould I hum back too?"},{speaker:"Yuki",text:"Customers pass like leaves on a stream,\nSometimes still, sometimes swift\nBut they always leave, as all do."},{speaker:"Randy",text:"But Im not a leaf,\nIm like... a damp Hawaiian shirt\nClings until removed."},{speaker:"Yuki",text:"The cashier's counter is like a rock,\nQuiet, but steady through the ebb and flow\nI feel the pulse of the store in my hands."},{speaker:"Randy",text:"Your hands pulse with grace.\nMy hands hold discount sushi.\nWe both hold something."},{speaker:"Yuki",text:"My sisters call is like a birds song,\nSoft, yet clear over the noise\nI wait for that, more than anything."},{speaker:"Randy",text:"My ringtone is loud.\nShe says my voice is louder.\nStill, Id wait for you."}],voices:["yuki_cstore1","yuki_cstore2","yuki_cstore3","yuki_cstore4","yuki_cstore5"],randyVoices:["randy_cstore1","randy_cstore2","randy_cstore3","randy_cstore4","randy_cstore5"]}};function tT(t,n){return[t.sprite("assets",{anim:"yuki-down"}),t.pos(n),t.body({isStatic:!1}),t.area({shape:new t.Rect(t.vec2(),20,20)}),t.z(1),"yuki"]}async function tR(t,n,o,s,r,l,d){let c=o.direction;o.direction="down",n.isTalking=!0;let f=o.pos.x-n.pos.x,g=o.pos.y-n.pos.y;Math.abs(f)>Math.abs(g)?(n.flipX=f<0,e$(n,"yuki-side")):g<0?e$(n,"yuki-up"):e$(n,"yuki-down");let y=eL.getCurrentScene(),{lines:w=[],voices:v=[],randyVoices:A=[]}=r[y]||{};ej.setIsSwordEquipped(!0),eO.setSceneTalked(s,y);let x=eO.getNbTalked(s),k=Math.min(x,Math.floor(w.length/2)-1),b=w[2*k],S=w[2*k+1];if(b?.text&&S?.text)await eX(t,t.vec2(0,0),[b.text,S.text],!1,[l,"randyPortrait"],[v[k]||null,A[k]||null],["Yuki","Randy"]);else{let n={teahouse:["Steam curls, words vanish\nOnly warmth remains with tea.","I sip memories\nFloating in cups left behind\nSome still steep in hope.","The moon peeks inwards\nNot to watch, just to listen.","Hands near the kettle\nSome wait for tea, some for truth."],cstore:["Checkout beep again\nA song for the lonely shift.","The ice cream is soft\nNot the only thing that melts.","Stocking shelves at night\nEach can whispers its own tale.","Even gum wrappers\nhave dreams of being chosen\ncrinkled but hopeful."]},o={teahouse:["yuki_tea_extra1","yuki_tea_extra2","yuki_tea_extra3","yuki_tea_extra4"],cstore:["yuki_extra1","yuki_extra2","yuki_extra3","yuki_extra4"]},s=n[y]||n.cstore,r=o[y]||o.cstore,l=Math.floor(Math.random()*s.length);await eX(t,t.vec2(0,0),[s[l]],!1,["yukiPortrait"],[r[l]],["Yuki"])}eO.getSceneTalkCount(s,"cstore")>=3&&eO.getSceneTalkCount(s,"teahouse")>=3&&!eO.getHasGivenHeart(s)&&ej.getCurrentMaxHealth()<ej.getTrueMaxHealth()&&(ej.setCurrentMaxHealth(ej.getCurrentMaxHealth()+1),ej.setHealth(ej.getCurrentMaxHealth()),t.destroyAll("healthContainer"),d.giveHeartToNPC("yuki"),d.update(),eO.setHasGivenHeart(s,!0)),eO.setNbTalked(s,x+1),o.direction=c,eW=()=>{n.isTalking=!1,n.pauseWander=!1,n.reverseDirection=!0,n.trigger("dialogue-ended")}}async function tP(t,n,o,s){await tR(t,n,o,"yuki",tE,"yukiPortrait",s)}function tC(t){e$(t,"yuki-down")}let tI=null;const tB={hotel:{lines:[{speaker:"Satoshi",text:"Yo, vibes kinda chill,\nLike my turtle on sun days\nYou cool? Then we cool."},{speaker:"Randy",text:"I once had a pet.\nIt was a hotdog. Briefly.\nI still mourn that dog."},{speaker:"Satoshi",text:"Bro, dont overthink\nEven leaves just drop and drift.\nJust be real, yknow?"},{speaker:"Randy",text:"Leaves fall all the time\nI slipped, cried, and spilled my fries.\nNature has no chill."},{speaker:"Satoshi",text:"I write late at night,\nTurtle sleeps, stars peep at me\nTruth hits when its quiet."},{speaker:"Randy",text:"Stars winked at me once\nbut Id had six sake shots.\nStill counts, I think. Right?"}],voices:["satoshi_hotel1","satoshi_hotel2","satoshi_hotel3"],randyVoices:["randy_satoshi1","randy_satoshi2","randy_satoshi3"]}};async function tH(t,n,o,s,r,l,d){if(n.isTalking)return;n.isTalking=!0,n.pauseWander=!0;let c=o.direction;o.direction="down";let f=o.pos.x-n.pos.x,g=o.pos.y-n.pos.y;Math.abs(f)>Math.abs(g)?(n.flipX=f<0,e$(n,"satoshi-side")):g<0?e$(n,"satoshi-up"):e$(n,"satoshi-down");let y=eL.getCurrentScene(),w=ej.getHasGivenStrawberriesToSatoshi();if(ej.getHasStrawberries()&&!w){if(await eX(t,t.vec2(0,0),["You brought me berries?\nMy turtles gonna love this.\nBro, take this heart, yo."],!1,[l],["satoshi_gift"],["Satoshi"]),ej.setHasGivenStrawberriesToSatoshi(!0),ej.setHasStrawberries(!1),!eO.getHasGivenHeart(s)&&ej.getCurrentMaxHealth()<ej.getTrueMaxHealth()){ej.setCurrentMaxHealth(ej.getCurrentMaxHealth()+1),ej.setHealth(ej.getCurrentMaxHealth()),t.destroyAll("healthContainer");let n=eZ(t);n?.update&&(n.giveHeartToNPC(s),n.update()),eO.setHasGivenHeart(s,!0)}eW=()=>{n.isTalking=!1,n.pauseWander=!1,n.reverseDirection=!0,n.trigger("dialogue-ended")},o.direction=c;return}let{lines:v=[],voices:A=[],randyVoices:x=[]}=r[y]||{},k=eO.getNbTalked(s),b=v[2*k],S=v[2*k+1];if(b?.text&&S?.text)await eX(t,t.vec2(0,0),[b.text,S.text],!1,[l,"randyPortrait"],[A[k]||null,x[k]||null],["Satoshi","Randy"]),eO.setNbTalked(s,k+1);else{let n=["Moonlight on my shell\nTurtle dreams ripple softly.\nI vibe in silence.","Snack crumbs on my floor\nEach one tells a lazy tale.\nSweep? Maybe later.","Yo, stars check me out\nI wink back with zero shame.\nUniverse flirts first."],o=Math.floor(Math.random()*n.length);await eX(t,t.vec2(0,0),[n[o]],!1,[l],[["satoshi_extra1","satoshi_extra2","satoshi_extra3"][o]],["Satoshi"])}eW=()=>{n.isTalking=!1,n.pauseWander=!1,n.reverseDirection=!0,n.trigger("dialogue-ended")},o.direction=c}async function tN(t,n,o,s){await tH(t,n,o,"satoshi",tB,"satoshiPortrait",s)}const tF=["Randy's pod glows soft\nMisnamed towns in bold shirts blur,\nDreams flirt, never stay."];async function t_(t){if(!Array.isArray(tF))return void console.warn(" bedRandyLines is invalid:",tF);t.play("soundUI",{volume:.4}),await eX(t,t.vec2(0,0),tF,!0,null,[],null,"Your Bed")}let tD=null,tU=null;const tz={train:{lines:[{speaker:"Koji",text:"Each dawn I shave clean\nThe past rinses with the blade.\nRegret grows no hair."},{speaker:"Randy",text:"I tried to shave once\nbut I cried when I nicked me.\nMy soul grew that hair."},{speaker:"Koji",text:"Trains come, trains depart\nBut my dog waits by the gate.\nHe trusts Ill return."},{speaker:"Randy",text:"My dog left me twice.\nFirst for snacks, then for freedom.\nStill a good, good boy."},{speaker:"Koji",text:"Rain on iron tracks\nSilence louder than shouting.\nPeace hums in the steam."},{speaker:"Randy",text:"Steam fogged up my shades.\nI walked into a noodle.\nPeace tasted like pork."},{speaker:"Koji",text:"She said I loved stone\ncold, unmoving, unshifting.\nNow moss warms my path."},{speaker:"Randy",text:"I once loved a rock.\nNamed her Sandy. She left me.\nRolled off with some moss."},{speaker:"Koji",text:"This broom is my bell.\nSweeping dust like chanting prayer\nEven trash has grace."},{speaker:"Randy",text:"Once swept for a crush.\nTurns out it was her dog shed.\nStill counts as romance."},{speaker:"Koji",text:"Offer no loud truth\nA whisper can guide a train\nwhen the wind leans in."},{speaker:"Randy",text:"I whispered once too.\nTo a vending machine ghost.\nShe gave me warm tea."}],voices:["koji_train1","koji_train2","koji_train3","koji_train4","koji_train5","koji_train6"],randyVoices:["randy_koji1","randy_koji2","randy_koji3","randy_koji4","randy_koji5","randy_koji6"]}};async function tL(t,n,o,s,r,l,d){let c=o.direction;o.direction="down",n.isTalking=!0;let f=o.pos.x-n.pos.x,g=o.pos.y-n.pos.y;Math.abs(f)>Math.abs(g)?(n.flipX=f<0,e$(n,"koji-side")):g<0?e$(n,"koji-up"):e$(n,"koji-down");let y=eL.getCurrentScene(),w=ej.getHasGivenOriyokiToKoji?.();if(ej.getHasOriyoki?.()&&!w){if(await eX(t,t.vec2(0,0),["Wooden bowls stacked high\nSilence served beside each meal.\nYou remembered me."],!1,[l],["koji_oriyoki"],["Koji"]),ej.setHasGivenOriyokiToKoji(!0),ej.setHasOriyoki(!1),!eO.getHasGivenHeart(s)&&ej.getCurrentMaxHealth()<ej.getTrueMaxHealth()){ej.setCurrentMaxHealth(ej.getCurrentMaxHealth()+1),ej.setHealth(ej.getCurrentMaxHealth()),t.destroyAll("healthContainer");let n=eZ(t);n?.update&&(n.giveHeartToNPC(s),n.update()),eO.setHasGivenHeart(s,!0)}eW=()=>{n.isTalking=!1,n.pauseWander=!1,n.reverseDirection=!0,n.trigger("dialogue-ended")},o.direction=c;return}let{lines:v=[],voices:A=[],randyVoices:x=[],fallbackRandyLines:k=[],fallbackRandyVoices:b=[]}=r[y]||{};ej.setIsSwordEquipped(!0);let S=eO.getNbTalked(s),V=1===S&&!eO.getHasGivenHeart(s),M=v[2*S],E=v[2*S+1];if(M?.text&&E?.text)await eX(t,t.vec2(0,0),[M.text,E.text],!1,[l,"randyPortrait"],[A[S]||null,x[S]||null],["Koji","Randy"]);else{let n={train:["Track hums underfoot\nGhosts ride softer than we do.\nStill, we call them late.","Lantern sways gently\nLike my thoughts at platform's edge.\nWhere do memories go?","Ticket in my hand\nDestination long unknown.\nBut I board anyway.","Dust on every step\nEven wind forgets this place.\nBut not me. Not yet."]},o={train:["koji_extra1","koji_extra2","koji_extra3","koji_extra4"]},s=n[y]||n.train,r=o[y]||o.train,d=Math.floor(Math.random()*s.length);await eX(t,t.vec2(0,0),[s[d]],!1,[l],[r[d]],["Koji"])}V&&ej.getCurrentMaxHealth()<ej.getTrueMaxHealth()&&(ej.setCurrentMaxHealth(ej.getCurrentMaxHealth()+1),ej.setHealth(ej.getCurrentMaxHealth()),t.destroyAll("healthContainer"),d.giveHeartToNPC("koji"),d.update(),eO.setHasGivenHeart(s,!0)),eO.setNbTalked(s,S+1),o.direction=c,eW=()=>{n.isTalking=!1,n.pauseWander=!1,n.reverseDirection=!0,n.trigger("dialogue-ended")}}async function tj(t,n,o,s){await tL(t,n,o,"koji",tz,"kojiPortrait",s)}const tO=["Randy's pod glows soft\nMisnamed towns in bold shirts blur,\nDreams flirt, never stay."];async function tG(t,n,o){await eX(t,t.vec2(0,0),tO,!0,null,[],null,"Antique Key"),t.play("soundUI",{volume:.4}),ej.setHasKey(!0),o.hide(),t.destroy(n)}let tq=!1,tK=null;const tY={manga:{lines:[{speaker:"Mari",text:"Scroll, scroll, swipe and sigh\nsome likes hit, some just fly by.\nStill no reason why."},{speaker:"Randy",text:"I swipe for deep chats\nand sometimes free hotel soap.\nStill no reason, too."},{speaker:"Mari",text:"Mochi in my hand,\nthis cafs wi-fi is sweet\nIRL feels banned."},{speaker:"Randy",text:"Wi-fi hugs my soul.\nBut I hug my mochi more\nsquishy love is real."},{speaker:"Mari",text:"Flirting in DMs,\nbut you blink and theyre gonepoof!\nLoves just HTML."},{speaker:"Randy",text:"HTML once broke\nmy homepage and my heart, girl.\nBut my pics still load."},{speaker:"Mari",text:"Pages turn so fast,\nbut the heros still alone\nI feel seen at last."},{speaker:"Randy",text:"Im that manga boy\nbut with more chest hair and shoes.\nWanna share one arc?"},{speaker:"Mari",text:"Blue light on my face,\nfilter hides the empty space\nbut my feed looks ace."},{speaker:"Randy",text:"Filters hide my teeth,\nand this mole I named Terry.\nStill get one like. Yours?"}],voices:["mari_manga1","mari_manga2","mari_manga3","mari_manga4","mari_manga5"],randyVoices:["randy_mari1","randy_mari2","randy_mari3","randy_mari4","randy_mari5"]}};async function tW(t,n,o,s,r,l,d){let c=o.direction;o.direction="down",n.isTalking=!0;let f=o.pos.x-n.pos.x,g=o.pos.y-n.pos.y;Math.abs(f)>Math.abs(g)?(n.flipX=f<0,e$(n,"mari-side")):g<0?e$(n,"mari-up"):e$(n,"mari-down");let y=eL.getCurrentScene(),w=ej.getHasGivenMangaToMari?.();if(ej.getHasManga?.()&&!w){if(await eX(t,t.vec2(0,0),["Pages steamed my lens\nI came for swords, stayed for abs.\nPlot? Who even cares?"],!1,[l],["mari_manga"],["Mari"]),ej.setHasGivenMangaToMari(!0),ej.setHasManga(!1),!eO.getHasGivenHeart(s)&&ej.getCurrentMaxHealth()<ej.getTrueMaxHealth()){ej.setCurrentMaxHealth(ej.getCurrentMaxHealth()+1),ej.setHealth(ej.getCurrentMaxHealth()),t.destroyAll("healthContainer");let n=eZ(t);n?.update&&(n.giveHeartToNPC(s),n.update()),eO.setHasGivenHeart(s,!0)}eW=()=>{n.isTalking=!1,n.trigger("dialogue-ended")},o.direction=c;return}let{lines:v=[],voices:A=[],randyVoices:x=[],fallbackRandyLines:k=[],fallbackRandyVoices:b=[]}=r[y]||{};ej.setIsSwordEquipped(!0);let S=eO.getNbTalked(s),V=1===S&&!eO.getHasGivenHeart(s),M=v[2*S],E=v[2*S+1];if(M?.text&&E?.text)await eX(t,t.vec2(0,0),[M.text,E.text],!1,[l,"randyPortrait"],[A[S]||null,x[S]||null],["Mari","Randy"]);else{let n={manga:["Late night manga binge\nMy charger sighs in protest.\nStill, one more chapter...","Battery at five\nJust like my social meter.\nBoth will soon shut down.","I post, then I scroll\nLooking for a sign or meme.\nMostly just thirst traps."]},o={manga:["mari_extra1","mari_extra2","mari_extra3"]},s=n[y]||n.manga,r=o[y]||o.manga,d=Math.floor(Math.random()*s.length);await eX(t,t.vec2(0,0),[s[d]],!1,[l],[r[d]],["Mari"])}V&&ej.getCurrentMaxHealth()<ej.getTrueMaxHealth()&&(ej.setCurrentMaxHealth(ej.getCurrentMaxHealth()+1),ej.setHealth(ej.getCurrentMaxHealth()),t.destroyAll("healthContainer"),d.giveHeartToNPC("mari"),d.update(),eO.setHasGivenHeart(s,!0)),eO.setNbTalked(s,S+1),o.direction=c,eW=()=>{n.isTalking=!1,n.trigger("dialogue-ended")}}async function tQ(t,n,o,s){await tW(t,n,o,"mari",tY,"mariPortrait",s)}async function tX(t,n,o,s){let r=o.direction;o.direction="down",n.isTalking=!0,n.pauseWander=!0;let l=o.pos.x-n.pos.x;Math.abs(l)>Math.abs(o.pos.y-n.pos.y)?(n.flipX=l<0,e$(n,"npc5-side")):e$(n,"npc5-down");let d=["Ink curls on the page\nWorlds unfold between each line.","Shh... plot twist coming.\nLife imitates manga art.\nSilence is sacred.","I shelve volume ten\nBut I lived volume eleven.\nSpoilers hurt sometimes."],c=Math.floor(Math.random()*d.length);await eX(t,t.vec2(0,0),[d[c]],!1,[s],[["npc5_extra1","npc5_extra2","npc5_extra3"][c]],["Stranger"]),eO.setNbTalked("npc5",eO.getNbTalked("npc5")+1),o.direction=r,n.isTalking=!1,n.pauseWander=!1,n.trigger("dialogue-ended")}async function tJ(t,n,o){await tX(t,n,o,"npc5Portrait")}var tZ=["Cherry blossoms fall\nthe rival swears revenge with\nhis hair still perfect.","She slapped him again,\nbut this time he caught her hand\n'You're late,' he whispered.","Cat girl steals the map\nbut not before winking twice.\nPlot twist: shes the boss.","Power level ten?\nNope. He takes off his glasses\ntwenty thousand. Easy.","Swords clash in moonlight.\nNeither speaks of feelings but\ntheir hands both tremble.","Nosebleed from a hug\nthe physics unclear but hey,\nwe stan true passion.","School roof, final bell\nshe confesses with closed eyes.\nHes asleep. Classic.","Tentacles again.\nNo one asked for this chapter.\nYet here we all are.","Eyes wide, wind blowing\nthe monologue is thirty\npages of drama.","The bread in her mouth\nmeans shes latebut plot armor\nsaves her from traffic.","Villains tragic past:\na single raindrop falls down.\nCue piano chords now.","Training montage ends.\nHe yells the moves name so loud,\nthe stars hear his punch.","Beach episode arc.\nAll trauma conveniently\nleft in the locker.","Cursed prince in chains\nhes rude, brooding, and pretty.\nYes, I will love him.","Time traveler sighs.\nSaves her for the eighth time now.\nStill cant confess though.","She turns into mist.\nHe yells, 'Dont vanish on me!'\nToo latechapter ends.","Twin brother reveals\nhes the clone of their cousin\nbut born from a tree.","Glasses flash with light\nshe knows everything and more.\nNo one asks how though.","They fight for honor,\nbut keep switching hairstyles each\ntime a page flips fast.","He trips on her scarf.\nThey fall in love mid-fall scene.\nGravity ships them."];async function t$(t){let n=tZ[Math.floor(Math.random()*tZ.length)];t.play("soundUI",{volume:.4}),await eX(t,t.vec2(0,0),[n],!0,null,[],null,"Manga Book")}const t0=["Shirtless samurai\nplot? Who cares! Their lips just touched.\nI read for the art."];async function t1(t,n,o){await eX(t,t.vec2(0,0),t0,!0,null,[],null,"Special Manga Book"),t.play("soundUI",{volume:.4}),ej.setHasManga(!0),o.hide(),t.destroy(n)}let t2=null;const t5={ramen:{lines:[{speaker:"Naoko",text:"Flicker from my past\na sword my father once held.\nShe sold it for spite."},{speaker:"Randy",text:"My ex sold my hat.\nNot a sword, but it still hurt.\nIt had my sweat stains."},{speaker:"Naoko",text:"Lips like kindling sparks,\nbut passion burned through too fast.\nNow I serve the coals."},{speaker:"Randy",text:"My lips sparked once too.\nChili ramen. Bad idea.\nStill, no regrets. Slurp."},{speaker:"Naoko",text:"He wore red for me.\nThen left my heart in embers.\nStillI pour, I burn."},{speaker:"Randy",text:"I wear red for you.\nMostly cause all my shirts match\ntropical regret."},{speaker:"Naoko",text:"Some fires stay buried\nsheathed beneath a lovers spite.\nBut stillI feel heat."},{speaker:"Randy",text:"Same. My ex kept pics\nposted them with fire emojis.\nStill burns. Still hot, though."}],voices:["naoko_ramen1","naoko_ramen2","naoko_ramen3","naoko_ramen4"],randyVoices:["randy_naoko1","randy_naoko2","randy_naoko3","randy_naoko4"]}},t4=["Red with gentle seeds\nTurtles march for sweet delight.\nJoy snug in your palm."];function t3(t,n){return[t.sprite("assets",{anim:"strawberry"}),t.area({shape:new t.Rect(t.vec2(-4,-4),20,20)}),t.body({isStatic:!0}),t.pos(n),t.z(1),"item",{itemName:"strawberry"}]}async function t6(t,n,o){await eX(t,t.vec2(0,0),t4,!0,null,[],null,"Fresh Strawberries"),ej.setHasStrawberries(!0),o.hide(),t.destroy(n)}const t8=[{speaker:"Naoko",text:"A blade brought with care\nits edge holds your quiet strength.\nStrawberries bloom now.",voice:"naoko_sword1"},{speaker:"Naoko",text:"By the shops bright lights\nI thought I saw something red.\nFruit? Or just a dream?",voice:"naoko_hint1"}];async function t9(t,n,o,s,r,l,d){if(n.isTalking||!1===n.canTalk)return;n.isTalking=!0,n.pauseWander=!0,n.canTalk=!1;let c=o.direction;o.direction="down";let f=o.pos.x-n.pos.x,g=o.pos.y-n.pos.y;Math.abs(f)>Math.abs(g)?(n.flipX=f<0,e$(n,"naoko-side")):g<0?e$(n,"naoko-up"):e$(n,"naoko-down");let y=eL.getCurrentScene(),w=ej.getHasGivenSwordToNaoko?.();if(ej.getHasSword?.()&&!w){let r=t8.map(t=>t.text),f=t8.map(t=>t.voice),g=t8.map(t=>t.speaker),y=g.map(()=>l);if(await eX(t,t.vec2(0,0),r,!1,y,f,g),ej.setHasGivenSwordToNaoko(!0),!eO.getHasGivenHeart(s)&&ej.getCurrentMaxHealth()<ej.getTrueMaxHealth()&&(ej.setCurrentMaxHealth(ej.getCurrentMaxHealth()+1),ej.setHealth(ej.getCurrentMaxHealth()),t.destroyAll("healthContainer"),d?.update?(d.giveHeartToNPC(s),d.update()):eZ(t),eO.setHasGivenHeart(s,!0),t.play("sparkle")),!eL.getFlag("strawberrySpawned")){eL.setFlag("strawberrySpawned",!0);let n=t.add(t3(t,t.vec2(200,180)));t.get("world")?.add?.(n)}eW=()=>{n.isTalking=!1,n.pauseWander=!1,setTimeout(()=>n.canTalk=!0,1500),n.trigger("dialogue-ended")},setTimeout(()=>eL.setFreezePlayer(!1),1e3),o.direction=c;return}let{lines:v=[],voices:A=[],randyVoices:x=[]}=r[y]||{},k=eO.getNbTalked(s),b=v[2*k],S=v[2*k+1];if(b?.text&&S?.text)await eX(t,t.vec2(0,0),[b.text,S.text],!1,[l,"randyPortrait"],[A[k]||null,x[k]||null],[b.speaker,S.speaker]),eO.setNbTalked(s,k+1);else{let n=["This bowl holds secrets\nbroth brewed in midnight silence.\nAre you slurping truth?","Ramen steam hides ghosts\nthey whisper through rising swirls.\nI nod. They return."],o=Math.floor(Math.random()*n.length);await eX(t,t.vec2(0,0),[n[o]],!1,[l],[["naoko_extra1","naoko_extra2"][o]],["Naoko"])}eW=()=>{n.isTalking=!1,n.pauseWander=!1,setTimeout(()=>n.canTalk=!0,1500),n.trigger("dialogue-ended")},setTimeout(()=>eL.setFreezePlayer(!1),1e3),o.direction=c}async function t7(t,n,o,s){await t9(t,n,o,"naoko",t5,"naokoPortrait",s)}async function ne(t,n,o,s){let r=o.direction;o.direction="down",n.isTalking=!0,n.pauseWander=!0;let l=o.pos.x-n.pos.x,d=o.pos.y-n.pos.y;Math.abs(l)>Math.abs(d)?e$(n,"npc4-side"):d<0?e$(n,"npc4-up"):e$(n,"npc4-down");let c=["A soft breeze whispers\nEven chairs long for a walk.","They think I sit still\nBut thoughts travel far from here.","I watched clouds for years.\nThey always move on. I stayed.\nMaybe thats the point."],f=Math.floor(Math.random()*c.length);await eX(t,t.vec2(0,0),[c[f]],!1,s,[["npc4_extra1","npc4_extra2","npc4_extra3"][f]],"Stranger"),eO.setNbTalked("npc4",eO.getNbTalked("npc4")+1),o.direction=r,eW=()=>{n.isTalking=!1,n.pauseWander=!1,n.trigger("dialogue-ended")}}async function nt(t,n,o){await ne(t,n,o,"npc4Portrait")}let nn=null,na=null;var ni={antique:{lines:[{speaker:"Hana",text:"Ink stains my hands\nI carve stories in your skin.\nDo you feel the truth?"},{speaker:"Randy",text:"Once got 'YOLO' inked.\nI felt something... maybe itch?\nThat still counts, right... yes?"},{speaker:"Hana",text:"The needle hums low,\nSkin opens, blood calls the art.\nWhat is it we seek?"},{speaker:"Randy",text:"I seek nachos first.\nThen truth, love, or spicy soup.\nDo they sell that here?"},{speaker:"Hana",text:"A butterfly flies\nWings hold the memory's weight.\nWill it live or die?"},{speaker:"Randy",text:"Mine flew into glass.\nI named him Jeff. He knew fear.\nRest in wings, my bro."},{speaker:"Hana",text:"The flame burns so bright\nBut the shadow swallows light.\nDo we chase the dark?"},{speaker:"Randy",text:"I chased my own sock\ninto a laundry portal\nShould I have let go?"},{speaker:"Hana",text:"Tattoos fade with time,\nBut the pain still wears its mark.\nHow deep is your past?"},{speaker:"Randy",text:"One spring break in Guam,\na dolphin judged my dance moves.\nI still dream of that."},{speaker:"Hana",text:"Every line, a choice\nEach stroke a new beginning.\nWill you bear it well?"},{speaker:"Randy",text:"I once bore a cat.\nIt climbed me like destiny.\nI have the scar still."}],voices:["hana_antique1","hana_antique2","hana_antique3","hana_antique4","hana_antique5","hana_antique6"],randyVoices:["randy_hana1","randy_hana2","randy_hana3","randy_hana4","randy_hana5","randy_hana6"]}};async function no(t,n,o,s,r,l,d){let c=o.direction;o.direction="down",n.isTalking=!0;let f=o.pos.x-n.pos.x,g=o.pos.y-n.pos.y;Math.abs(f)>Math.abs(g)?(n.flipX=f<0,e$(n,"hana-side")):g<0?e$(n,"hana-up"):e$(n,"hana-down");let y=eL.getCurrentScene(),{lines:w=[],voices:v=[],randyVoices:A=[],fallbackRandyLines:x=[],fallbackRandyVoices:k=[]}=r[y]||{};ej.setIsSwordEquipped(!0);let b=eO.getNbTalked(s),S=1===b&&!eO.getHasGivenHeart(s),V=w[2*b],M=w[2*b+1];if(V?.text&&M?.text)await eX(t,t.vec2(0,0),[V.text,M.text],!1,[l,"randyPortrait"],[v[b]||null,A[b]||null],["Hana","Randy"]);else{let n={antique:["You want a tattoo?\nSure, Ill ink your deep meaning\nLive, Laugh, Regret it.","This ones a dragon\nOr maybe its just your ex\nbreathing down your neck.","Trust me, Im an *art*-ist\nYour pain is my canvas now.\nHold still or its worse.","Spiritual ink?\nLets align your chakra set\nright above your butt."]},o={antique:["hana_extra1","hana_extra2","hana_extra3","hana_extra4"]},s=n[y]||n.antique,r=o[y]||o.antique,d=Math.floor(Math.random()*s.length);await eX(t,t.vec2(0,0),[s[d]],!1,[l],[r[d]],["Hana"])}S&&ej.getCurrentMaxHealth()<ej.getTrueMaxHealth()&&(ej.setCurrentMaxHealth(ej.getCurrentMaxHealth()+1),ej.setHealth(ej.getCurrentMaxHealth()),t.destroyAll("healthContainer"),d.giveHeartToNPC("hana"),d.update(),eO.setHasGivenHeart(s,!0)),eO.setNbTalked(s,b+1),o.direction=c,eW=()=>{n.isTalking=!1,n.pauseWander=!1,n.reverseDirection=!0,n.trigger("dialogue-ended")}}async function ns(t,n,o,s){await no(t,n,o,"hana",ni,"hanaPortrait",s)}const nr=["Blade sleeps in still light\nDust clings to forgotten strength,\nNow it breathes again."];async function nl(t,n,o){t.play("soundUI",{volume:.4}),await eX(t,t.vec2(0,0),nr,!0,null,[],null,"Ancient Sword"),ej.setHasSword(!0),o.hide(),t.destroy(n)}const nd=["No key in your hand\nThe past stays shut, unmoving.\nOld wood guards secrets."];async function nh(t,n){n.isOpen||(ej.getHasKey()?(t.play("door-open",{volume:.8}),n.use(t.sprite("assets",{anim:"antiqueDoorOpen"})),n.area.hidden=!0,n.unuse("item"),n.unuse("body"),n.isOpen=!0):(t.play("soundUI"),await eX(t,t.vec2(0,0),nd,!0,null,[],null,"Antique Door")))}const nu=["Bowls stacked with quiet\nEach grain earned with mindful hands.\nOld monks still recall."];async function nc(t,n,o){await eX(t,t.vec2(0,0),nu,!0,null,[],null,"Oriyoki Set"),t.play("soundUI",{volume:.4}),ej.setHasOriyoki?.(!0),o.hide(),t.destroy(n)}let np=null;const nm=[{key:"yuki",name:"Yuki Tanaka",description:"She brewed quiet tea\nWhispers turned to cherry winds.\nDont ask about love."},{key:"satoshi",name:"Satoshi Watanabe",description:"LOL he said, bruh\nHaikus slap when turtles vibe.\nWanna date or nah?"},{key:"koji",name:"Koji Nakamura",description:"Sweeps tracks like old sins\nDog watches him like Buddha.\nHairless. Also wise."},{key:"mari",name:"Mari Aoyama",description:"Haikus drop like beats\nSelfie queen with samurai\nvibes and glitter shoes."},{key:"naoko",name:"Naoko Ishikawa",description:"Whiskey breath ignites\nLove burns like microwave fish.\nCareful. I spark quick."},{key:"hana",name:"Hana Matsuda",description:"Ink beneath her skin\nTruths with a sizzling side eye.\nDid you feel that too?"},{key:"oldman",name:"Tetsuya Ito",description:"Fed birds. Loved one wife.\nSpoke of days when boats still sang.\nNow? I only was."},{key:"player",name:"Randy Weston",description:"Beer gut full of charm\nStill single, still in America.\nCall me maybe, bro."}],nf={mainMenu:function(t){eK.playMusic(t,"menuMusic"),t.setBackground(t.Color.fromHex("#000000")),t.add([t.sprite("sunset",{anim:"loop"}),t.anchor("center"),t.pos(t.center()),t.scale(t.width()/500,t.height()/350),t.z(-1),t.fixed()]);let n=.8*t.width(),o=.1*t.width(),s=t.center().y-140;t.add([t.rect(n,170,{radius:16}),t.pos(o,s),t.color(0,0,0),t.opacity(.75),t.z(0)]),t.add([t.text("90 Day Haiku",{size:70,font:"gameboy"}),t.anchor("center"),t.pos(t.center().x,t.center().y-80),t.z(1)]);let r=t.add([t.text("Press ENTER or TAP anywhere to Start the Game",{size:22,font:"gameboy"}),t.anchor("center"),t.pos(t.center().x,t.center().y-15),t.z(1)]),l=0;t.onUpdate(()=>{r.hidden=Math.floor(2*(l+=t.dt()))%2==0});let d=()=>{eL.setFontSize(25),eK.stopMusic(),t.go("instructions")};t.onKeyPress("enter",d),t.onClick(d),t.onTouchStart(d)},world:async function t(t){eL.setCurrentScene("world");let n=eL.getPreviousScene();eK.playMusic(t,"worldMusic"),e0(t,76,170,255);let o=await e5("./assets/maps/world.json"),s=t.add([t.pos(0,0)]),r=tV(t),l=eZ(t);e4(t);let d={player:null,oldman:null,npc1:null,npc2:null,npc3:null};for(let r of o.layers){let l=r.name;if("Boundaries"===l){e2(t,s,r);continue}if("SpawnPoints"===l){let o=!1;for(let l of r.objects){let r=t.vec2(l.x,l.y);if("oldman"===l.name||"old-man"===l.name){d.oldman=s.add(e8(t,r)),e6(t,d.oldman);continue}if("npc1"===l.name){d.npc1=s.add([t.sprite("assets",{anim:"npc1-down"}),t.pos(r),t.body({isStatic:!1}),t.area({shape:new t.Rect(t.vec2(),20,20)}),t.z(1),"npc1","wall","npc","solid"]),e6(t,d.npc1);continue}if("npc2"===l.name){d.npc2=s.add([t.sprite("assets",{anim:"npc2-down"}),t.pos(r),t.body({isStatic:!1}),t.area({shape:new t.Rect(t.vec2(),20,20)}),t.z(1),"npc2","wall","npc","solid"]),e6(t,d.npc2);continue}if("npc3"===l.name){d.npc3=s.add([t.sprite("assets",{anim:"npc3-down"}),t.pos(r),t.body({isStatic:!1}),t.area({shape:new t.Rect(t.vec2(),20,20)}),t.z(1),"npc3","wall","npc","solid"]),e6(t,d.npc3);continue}if("signbath"===l.name){let n=s.add(tl(t,r));n.itemName="signbath",n.z=1}if("signtrain"===l.name){let n=s.add(tu(t,r));n.itemName="signtrain",n.z=1}if("signhotel"===l.name){let n=s.add(tm(t,r));n.itemName="signhotel",n.z=1}if("orange-vending"===l.name){let n=s.add(ty(t,r));n.itemName="orange-vending",n.z=1}if("white-vending"===l.name){let n=s.add(tA(t,r));n.itemName="white-vending",n.z=1}if(!o&&("player-teahouse"===l.name&&"teahouse"===n||"player-bath"===l.name&&"bath"===n||"player-train"===l.name&&"train"===n||"player-hotel"===l.name&&"hotel"===n||"player-manga"===l.name&&"manga"===n||"player-ramen"===l.name&&"ramen"===n||"player-cstore"===l.name&&"cstore"===n||"player-antique"===l.name&&"antique"===n||"player"===l.name&&(!n||"mainMenu"===n))){let n=s.add(tk(t,r));n.z=2,d.player=n,t.camPos(r),o=!0}}continue}let c=999*("Upmost"===l);e1(t,s,r,o.tileheight,o.tilewidth,c)}t.camScale(4),tS(t,d.player),d.player.onCollide("item",t=>{t?.itemName&&(tM=t,r.show())}),d.player.onCollideEnd("item",()=>{tM=null,r.hide()}),d.player.onCollide("tea-door-entrance",()=>{eK.stopMusic(),t.go("teahouse")}),d.player.onCollide("hotel-door-entrance",()=>{eK.stopMusic(),t.go("hotel")}),d.player.onCollide("bath-door-entrance",()=>{eK.stopMusic(),t.go("bath")}),d.player.onCollide("train-door-entrance",()=>{eK.stopMusic(),t.go("train")}),d.player.onCollide("manga-door-entrance",()=>{eK.stopMusic(),t.go("manga")}),d.player.onCollide("ramen-door-entrance",()=>{eK.stopMusic(),t.go("ramen")}),d.player.onCollide("cstore-door-entrance",()=>{eK.stopMusic(),t.go("cstore")}),d.player.onCollide("antique-door-entrance",()=>{eK.stopMusic(),t.go("antique")}),d.player.onCollide("oldman",async()=>{d.oldman&&!d.oldman.isTalking&&await e7(t,d.oldman,d.player,l)}),d.player.onCollideEnd("oldman",()=>{d.oldman&&te(d.oldman)}),d.player.onCollide("npc1",async()=>{d.npc1&&!d.npc1.isTalking&&await tn(t,d.npc1,d.player)}),d.player.onCollideEnd("npc1",()=>{d.npc1&&e$(d.npc1,"npc1-down")}),d.player.onCollide("npc2",async()=>{d.npc2&&!d.npc2.isTalking&&await ti(t,d.npc2,d.player)}),d.player.onCollideEnd("npc2",()=>{d.npc2&&e$(d.npc2,"npc2-down")}),d.player.onCollide("npc3",async()=>{d.npc3&&!d.npc3.isTalking&&await ts(t,d.npc3,d.player)}),d.player.onCollideEnd("npc3",()=>{d.npc3&&e$(d.npc3,"npc3-down")}),t.onKeyPress("e",async()=>{tM&&("signbath"===tM.itemName&&await td(t),"signtrain"===tM.itemName&&await tc(t),"signhotel"===tM.itemName&&await tf(t),"orange-vending"===tM.itemName&&await tw(t),"white-vending"===tM.itemName&&await tx(t))});let c=0;t.onUpdate(()=>{if(d.player){if((c+=t.dt())>.016){let n=d.player.worldPos(),o=t.camPos();t.camPos(o.lerp(n,.2)),c=0}tM&&r.setPosition(tM.worldPos())}}),tb(t)},teahouse:async function t(t){eL.setCurrentScene("teahouse"),eK.playMusic(t,"teashopMusic"),e0(t,27,29,52);let n=await e5("./assets/maps/teahouse.json"),o=t.add([t.pos(530,222)]),s=tV(t),r=eZ(t);e4(t);let l={player:null,yuki:null};for(let s of n.layers){let r=s.name;if("Boundaries"===r){e2(t,o,s);continue}if("SpawnPoints"===s.name){for(let n of s.objects){let s=t.vec2(n.x,n.y);if("player"===n.name){l.player=o.add(tk(t,s)),t.camPos(s),console.log("\uD83E\uDDCD Player spawned at",s),t.onLoad(()=>{t.play("chime-bell",{volume:.4})});continue}if("yuki"===n.name){l.yuki=o.add(tT(t,s));continue}}continue}let d=999*("Upmost"===r);e1(t,o,s,n.tileheight,n.tilewidth,d)}t.camScale(3.6),tS(t,l.player),t.onUpdate(()=>{let n=l.player.worldPos(),o=t.camPos().lerp(n,.1);t.camPos(o),tI&&s.setPosition(tI.worldPos())}),l.player.onCollide("door-exit",()=>{eL.setPreviousScene("teahouse"),eK.stopMusic(),t.go("world")});let d=!1;l.player.onCollide("yuki",async()=>{d||!l.yuki||l.yuki.isTalking||(d=!0,await tP(t,l.yuki,l.player,r),d=!1)}),l.player.onCollideEnd("yuki",()=>{tC(l.yuki)}),l.player.onCollide("item",t=>{t?.itemName&&(tI=t,s.show())}),l.player.onCollideEnd("item",()=>{tI=null,s.hide()}),t.onKeyPress("e",async()=>{if(!tI)return}),tb(t)},hotel:async function t(t){eL.setCurrentScene("hotel"),eK.playMusic(t,"hotelMusic"),e0(t,27,29,52);let n=await e5("./assets/maps/hotel.json"),o=t.add([t.pos(480,200)]),s=tV(t),r=eZ(t);e4(t);let l={player:null,satoshi:null};for(let s of n.layers){let r=s.name;if("Boundaries"===r){e2(t,o,s);continue}if("SpawnPoints"===r){for(let n of s.objects){let s=t.vec2(n.x,n.y);switch(n.name){case"player":l.player=o.add([...tk(t,s)]),t.camPos(s),t.onLoad(()=>t.play("chime-bell",{volume:.4}));break;case"satoshi":l.satoshi=function(t,n,o){let s=[t.sprite("assets",{anim:"satoshi-down"}),t.pos(o),t.body({isStatic:!1}),t.area({shape:new t.Rect(t.vec2(),20,20)}),t.z(1),"satoshi","wall","npc","solid"],r=n.add([...s]);return r.lastAnim="down",e6(t,r),r}(t,o,s);break;case"signhotel":o.add([...tm(t,s)]).itemName="signhotel";break;case"bedrandy":o.add([t.sprite("assets",{anim:"bedrandy"}),t.area({shape:new t.Rect(t.vec2(0,0),20,20)}),t.body({isStatic:!0}),t.pos(s),t.z(1),t.scale(1),"item",{itemName:"bedrandy"}]).itemName="bedrandy"}}continue}let d=999*("Upmost"===r);e1(t,o,s,n.tileheight,n.tilewidth,d)}t.camScale(4),tS(t,l.player),l.player.onCollide("item",t=>{t?.itemName&&(tD=t,s.show())}),l.player.onCollideEnd("item",()=>{tD=null,s.hide()});let d=!1;l.player.onCollide("satoshi",async()=>{d||!l.satoshi||l.satoshi.isTalking||(d=!0,await tN(t,l.satoshi,l.player,r),d=!1)}),l.player.onCollideEnd("satoshi",()=>{e$(l.satoshi,"satoshi-down")}),l.player.onCollide("door-exit",()=>{eL.setPreviousScene("hotel"),eK.stopMusic(),t.go("world")}),t.onKeyPress("e",async()=>{if(tD)switch(tD.itemName){case"signhotel":await tf(t);break;case"bedrandy":await t_(t)}});let c=0;t.onUpdate(()=>{if(l.player){if((c+=t.dt())>.016){let n=l.player.worldPos(),o=t.camPos();t.camPos(o.lerp(n,.2)),c=0}tD&&s.setPosition(tD.worldPos())}}),tb(t)},bath:async function t(t){eL.setCurrentScene("bath"),eK.playMusic(t,"bathMusic"),e0(t,210,240,255);let n=await e5("./assets/maps/bath.json"),o=t.add([t.pos(0,0)]),s=tV(t),r=eZ(t);e4(t);let l={player:null,oldman:null,sign:null,bathDoor:null};for(let s of n.layers){let r=s.name;if("Boundaries"===r){e2(t,o,s);continue}if("SpawnPoints"===r){for(let n of s.objects){let s=t.vec2(n.x,n.y);if("player"===n.name){l.player=o.add(tk(t,s)),t.camPos(s);continue}if("oldman"===n.name||"old-man"===n.name){l.oldman=o.add(e8(t,s)),e6(t,l.oldman,{speed:14,cooldown:3.5,shouldPause:()=>l.oldman.pauseWander||l.oldman.isTalking});continue}if("signbath"===n.name){l.sign=o.add(tl(t,s)),l.sign.itemName="signbath";continue}if("bathDoor"===n.name){l.bathDoor=o.add([t.rect(32,64),t.pos(s),t.area(),t.body({isStatic:!0}),t.opacity(0),"door","bathDoor"]);continue}}continue}let d=999*("Upmost"===r);e1(t,o,s,n.tileheight,n.tilewidth,d)}t.camScale(4),tS(t,l.player),t.onUpdate(()=>{let n=l.player.worldPos(),o=t.camPos().lerp(n,.1);t.camPos(o),tU&&s.setPosition(tU.worldPos())}),l.player.onCollide("door-exit",()=>{eL.setPreviousScene("bath"),eK.stopMusic(),t.go("world")}),l.player.onCollide("oldman",async()=>{l.oldman&&!l.oldman.isTalking&&await e7(t,l.oldman,l.player,r)}),l.player.onCollideEnd("oldman",()=>{te(l.oldman)}),l.player.onCollide("item",t=>{t&&t.itemName&&(tU=t,s.show())}),l.player.onCollideEnd("item",()=>{tU=null,s.hide()}),t.onKeyPress("e",async()=>{tU&&"signbath"===tU.itemName&&await td(t)}),tb(t)},train:async function t(t){eL.setCurrentScene("train"),eK.playMusic(t,"trainMusic"),e0(t,70,70,70);let n=await e5("./assets/maps/trainstation.json"),o=t.add([t.pos(480,200)]),s=tV(t),r=eZ(t);e4(t);let l={player:null,koji:null};for(let s of n.layers){let r=s.name;if("Boundaries"===r){e2(t,o,s);continue}if("SpawnPoints"===r){for(let n of s.objects){let s=t.vec2(n.x,n.y);switch(n.name){case"player":l.player=o.add([...tk(t,s)]),t.camPos(s),t.onLoad(()=>t.play("door-open",{volume:.8}));break;case"koji":l.koji=function(t,n,o){let s=[t.sprite("assets",{anim:"koji-down"}),t.pos(o),t.body({isStatic:!1}),t.area({shape:new t.Rect(t.vec2(),15,15)}),t.z(1),"koji","wall","npc","solid"],r=n.add([...s]);return r.lastAnim="down",e6(t,r),r}(t,o,s);break;case"signtrain":{let n=o.add([...tu(t,s)]);n.itemName="signtrain",n.z=1;break}case"orange-vending":{let n=o.add([...ty(t,s)]);n.itemName="orange-vending",n.z=1;break}case"white-vending":{let n=o.add([...tA(t,s)]);n.itemName="white-vending",n.z=1;break}case"antiqueKey":o.add([t.sprite("assets",{anim:"antiqueKey"}),t.area({shape:new t.Rect(t.vec2(0,0),20,25)}),t.body({isStatic:!0}),t.pos(s),t.z(1),t.scale(1),"item",{itemName:"antiqueKey"}]).itemName="antiqueKey"}}continue}let d=999*("Upmost"===r);e1(t,o,s,n.tileheight,n.tilewidth,d)}t.camScale(4),tS(t,l.player),l.player.onCollide("item",t=>{t?.itemName&&(tK=t,s.show())}),l.player.onCollideEnd("item",()=>{tK=null,s.hide()});let d=!1;l.player.onCollide("koji",async()=>{d||!l.koji||l.koji.isTalking||(d=!0,await tj(t,l.koji,l.player,r),d=!1)}),l.player.onCollideEnd("koji",()=>{e$(l.koji,"koji-down")}),l.player.onCollide("door-exit",()=>{eL.setPreviousScene("train"),eK.stopMusic(),t.go("world")}),l.player.onCollide("end",()=>{if(tq)return;tq=!0;let n=t.center().x,o=t.center().y;t.add([t.rect(300,130,{radius:12}),t.color(255,255,255),t.pos(n-150,o-65),t.z(2e3),t.opacity(.95),"confirmExitBox",t.fixed()]),t.add([t.text("Would you like to go home\nand end the game?\n\nY = Yes     N = No",{size:18,align:"center",width:280}),t.color(0,0,0),t.pos(n,o),t.anchor("center"),t.z(2001),"confirmExitText",t.fixed()]);let s=()=>{t.destroyAll("confirmExitBox"),t.destroyAll("confirmExitText"),tq=!1};t.onKeyPress("y",()=>{tq&&(s(),eK.stopMusic(),t.go("endingCredits"))}),t.onKeyPress("n",()=>{tq&&s()})}),t.onKeyPress("e",async()=>{if(tK)switch(tK.itemName){case"signtrain":await tc(t);break;case"orange-vending":await tw(t);break;case"white-vending":await tx(t);break;case"antiqueKey":await tG(t,tK,s)}});let c=0;t.onUpdate(()=>{if(l.player){if((c+=t.dt())>.016){let n=l.player.worldPos(),o=t.camPos();t.camPos(o.lerp(n,.2)),c=0}tK&&s.setPosition(tK.worldPos())}}),tb(t)},endingCredits:function(t){eK.playMusic(t,"endingMusic"),t.add([t.sprite("endingCredits"),t.anchor("center"),t.scale(t.width()/1280,t.height()/620),t.pos(t.center()),t.z(-1)]);let n=t.center().x-300;t.add([t.rect(600,240,{radius:12}),t.pos(n,120),t.color(255,255,255),t.opacity(.75),t.z(0)]),t.add([t.text("Randy decided to Go Home!",{size:48,font:"gameboy"}),t.anchor("center"),t.pos(t.center().x,160),t.color(0,0,0),t.z(1)]),t.add([t.text("Created by Shanel L0g1cF@11acy Locke\nPlease Find Me Online @ www.shanellockeart.com",{size:20,width:540,lineSpacing:18,font:"gameboy"}),t.anchor("center"),t.pos(t.center().x,230),t.color(0,0,0),t.z(1)]);let o=t.add([t.text("Press ENTER to Finish the Game",{size:18,font:"gameboy"}),t.anchor("center"),t.pos(t.center().x,320),t.color(0,0,0),t.z(1)]),s=0;t.onUpdate(()=>{o.hidden=Math.floor(2*(s+=t.dt()))%2==0});let r=()=>{t.go("endingSelection")};t.onKeyPress("enter",r),t.onClick(r),t.onTouchStart(r)},manga:async function t(t){eL.setCurrentScene("manga"),eK.playMusic(t,"mangaMusic"),e0(t,240,220,250);let n=await e5("./assets/maps/manga.json"),o=t.add([t.pos(480,200)]),s=tV(t),r=eZ(t);e4(t);let l={player:null,mari:null,npc5:null};for(let s of n.layers){let r=s.name;if("Boundaries"===r){e2(t,o,s);continue}if("SpawnPoints"===r){for(let n of s.objects){let s=t.vec2(n.x,n.y);switch(n.name){case"player":l.player=o.add([...tk(t,s)]),t.camPos(s),t.onLoad(()=>t.play("chime-bell",{volume:.4}));break;case"mari":l.mari=o.add([t.sprite("assets",{anim:"mari-down"}),t.area({shape:new t.Rect(t.vec2(),15,15)}),t.body({isStatic:!0}),t.pos(s),"mari"]);break;case"books":o.add([t.sprite("assets",{anim:"mangabookshelf"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(s.x,s.y+6),t.z(1),"item",{itemName:"mangabooks"}]).itemName="books";break;case"npc5":l.npc5=function(t,n,o){let s=[t.sprite("assets",{anim:"npc5-down"}),t.pos(o),t.body({isStatic:!1}),t.area({shape:new t.Rect(t.vec2(),20,20)}),t.z(1),"npc5","wall","npc","solid"],r=n.add([...s]);return r.lastAnim="down",r}(t,o,s);break;case"manga":o.add([t.sprite("assets",{anim:"mangaBook"}),t.area({shape:new t.Rect(t.vec2(0,0),20,25)}),t.body({isStatic:!0}),t.pos(s),t.z(1),t.scale(1),"item",{itemName:"manga"}]).itemName="manga"}}continue}let d=999*("Upmost"===r);e1(t,o,s,n.tileheight,n.tilewidth,d)}t.camScale(4),tS(t,l.player),l.player.onCollide("item",t=>{t?.itemName&&(t2=t,s.show())}),l.player.onCollideEnd("item",()=>{t2=null,s.hide()});let d=!1;l.player.onCollide("mari",async()=>{d||!l.mari||l.mari.isTalking||(d=!0,await tQ(t,l.mari,l.player,r),d=!1)}),l.player.onCollideEnd("mari",()=>{e$(l.mari,"mari-down")});let c=!1;l.player.onCollide("npc5",async()=>{c||!l.npc5||l.npc5.isTalking||(c=!0,await tJ(t,l.npc5,l.player,r),c=!1)}),l.player.onCollideEnd("npc5",()=>{e$(l.npc5,"npc5-down")}),l.player.onCollide("door-exit",()=>{eL.setPreviousScene("manga"),eK.stopMusic(),t.go("world")}),t.onKeyPress("e",async()=>{if(t2)switch(t2.itemName){case"books":await t$(t);break;case"manga":await t1(t,t2,s)}});let f=0;t.onUpdate(()=>{if(l.player){if((f+=t.dt())>.016){let n=l.player.worldPos(),o=t.camPos();t.camPos(o.lerp(n,.2)),f=0}t2&&s.setPosition(t2.worldPos())}}),tb(t)},ramen:async function t(t){eL.setCurrentScene("ramen"),eK.playMusic(t,"ramenMusic"),e0(t,30,18,12);let n=await e5("./assets/maps/ramen.json"),o=t.add([t.pos(480,200)]),s=tV(t),r=eZ(t);e4(t);let l={player:null,naoko:null,npc4:null};for(let s of n.layers){let r=s.name;if("Boundaries"===r){e2(t,o,s);continue}if("SpawnPoints"===r){for(let n of s.objects){let s=t.vec2(n.x,n.y);switch(n.name){case"player":l.player=o.add([...tk(t,s)]),t.camPos(s),t.onLoad(()=>t.play("chime-bell",{volume:.4}));break;case"naoko":l.naoko=function(t,n,o){let s=[t.sprite("assets",{anim:"naoko-down"}),t.pos(o),t.body({isStatic:!1}),t.area({shape:new t.Rect(t.vec2(2,4),12,12)}),t.z(1),"naoko","wall","npc","solid"],r=n.add([...s]);return r.lastAnim="down",e6(t,r),r}(t,o,s);break;case"npc4":l.npc4=o.add([t.sprite("assets",{anim:"npc4-side"}),t.pos(s),t.body({isStatic:!1}),t.area({shape:new t.Rect(t.vec2(),20,25)}),t.z(1),"npc4","wall","npc","solid"])}}continue}let d=999*("Upmost"===r);e1(t,o,s,n.tileheight,n.tilewidth,d)}t.camScale(4),tS(t,l.player),l.player.onCollide("item",t=>{t?.itemName&&(nn=t,s.show())}),l.player.onCollideEnd("item",()=>{nn=null,s.hide()});let d=!1;l.player.onCollide("naoko",async()=>{d||!l.naoko||l.naoko.isTalking||(d=!0,await t7(t,l.naoko,l.player,r),d=!1)}),l.player.onCollideEnd("naoko",()=>{e$(l.naoko,"naoko-down")});let c=!1;l.player.onCollide("npc4",async()=>{c||!l.npc4||l.npc4.isTalking||(c=!0,await nt(t,l.npc4,l.player,r),c=!1)}),l.player.onCollideEnd("npc4",()=>{e$(l.npc4,"npc4-side")}),l.player.onCollide("door-exit",()=>{eL.setPreviousScene("ramen"),eK.stopMusic(),t.go("world")}),t.onKeyPress("e",async()=>{if(!nn)return});let f=0;t.onUpdate(()=>{if(l.player){if((f+=t.dt())>.016){let n=l.player.worldPos(),o=t.camPos();t.camPos(o.lerp(n,.2)),f=0}nn&&s.setPosition(nn.worldPos())}}),tb(t)},cstore:async function t(t){eL.setCurrentScene("cstore"),eK.playMusic(t,"cstoreMusic"),e0(t,240,200,120);let n=await e5("/assets/maps/cstore.json"),o=t.add([t.pos(530,222)]),s=tV(t),r=eZ(t);e4(t);let l={player:null,yuki:null};for(let s of n.layers){let r=s.name;if("Boundaries"===r){e2(t,o,s);continue}if("SpawnPoints"===s.name){for(let n of s.objects){let s=t.vec2(n.x,n.y);if("player"===n.name){l.player=o.add(tk(t,s)),t.camPos(s),t.onLoad(()=>{t.play("chime-bell",{volume:.4})});continue}if("yuki"===n.name){l.yuki=o.add(tT(t,s));continue}"strawberrySpawn"===n.name&&eL.getFlag("strawberrySpawned")&&(o.add(t3(t,s)).itemName="strawberry")}continue}let d=0;"Upmost"===r&&(d=999),"Register"===r&&(d=1050),e1(t,o,s,n.tileheight,n.tilewidth,d)}t.camScale(3.6),tS(t,l.player),t.onUpdate(()=>{let n=l.player.worldPos(),o=t.camPos();t.camPos(o.lerp(n,.1)),na&&s.setPosition(na.worldPos())}),l.player.onCollide("door-exit",()=>{eL.setPreviousScene("cstore"),eK.stopMusic(),t.go("world")}),l.player.onCollide("yuki",async()=>{l.yuki&&!l.yuki.isTalking&&await tP(t,l.yuki,l.player,r)}),l.player.onCollideEnd("yuki",()=>{tC(l.yuki)}),l.player.onCollide("item",t=>{t?.itemName&&(na=t,s.show())}),l.player.onCollideEnd("item",()=>{na=null,s.hide()}),t.onKeyPress("e",async()=>{na&&"strawberry"===na.itemName&&await t6(t,na,s)}),tb(t)},antique:async function t(t){eL.setCurrentScene("antique"),eK.playMusic(t,"antiqueMusic"),e0(t,60,50,30);let n=await e5("./assets/maps/antique.json"),o=t.add([t.pos(480,200)]),s=tV(t),r=eZ(t);e4(t);let l={player:null,hana:null,sword:null,antiqueDoor:null,oriyoki:null};for(let s of n.layers){let r=s.name;if("Boundaries"===r){e2(t,o,s);continue}if("SpawnPoints"===r){for(let n of s.objects){let s=t.vec2(n.x,n.y);switch(n.name){case"player":l.player=o.add([...tk(t,s)]),t.camPos(s),t.onLoad(()=>t.play("chime-bell",{volume:.4}));break;case"hana":l.hana=function(t,n,o){let s=[t.sprite("assets",{anim:"hana-down"}),t.pos(o),t.body({isStatic:!1}),t.area({shape:new t.Rect(t.vec2(),20,20)}),t.z(1),"hana","wall","npc","solid"],r=n.add([...s]);return r.lastAnim="down",e6(t,r),r}(t,o,s);break;case"sword":{let n=o.add([t.sprite("assets",{anim:"sword"}),t.area({shape:new t.Rect(t.vec2(-4,-4),24,24)}),t.body({isStatic:!0}),t.pos(s.x,s.y+6),t.z(1),"item",{itemName:"sword"}]);n.itemName="sword",l.sword=n;break}case"antiqueDoor":{let n=o.add([t.sprite("assets",{anim:"antiqueDoor"}),t.area({shape:new t.Rect(t.vec2(0,0),20,15)}),t.body({isStatic:!0}),t.pos(s),t.z(1),"item",{itemName:"antiqueDoor",isOpen:!1}]);n.itemName="antiqueDoor",l.antiqueDoor=n;break}case"oriyoki":{let n=o.add([t.sprite("assets",{anim:"oriyoki"}),t.area({shape:new t.Rect(t.vec2(0,0),20,25)}),t.body({isStatic:!0}),t.pos(s),t.z(1),t.scale(1),"item",{itemName:"oriyoki"}]);n.itemName="oriyoki",l.oriyoki=n}}}continue}let d=999*("Upmost"===r);e1(t,o,s,n.tileheight,n.tilewidth,d)}t.camScale(4),tS(t,l.player),t.onUpdate(()=>{let n=l.player.worldPos(),o=t.camPos().lerp(n,.1);t.camPos(o),np&&s.setPosition(np.worldPos())}),l.player.onCollide("door-exit",()=>{eL.setPreviousScene("antique"),eK.stopMusic(),t.go("world")});let d=!1;l.player.onCollide("hana",async()=>{d||!l.hana||l.hana.isTalking||(d=!0,await ns(t,l.hana,l.player,r),d=!1)}),l.player.onCollideEnd("hana",()=>{e$(l.hana,"hana-down")}),l.player.onCollide("item",t=>{t?.itemName&&(np=t,s.show())}),l.player.onCollideEnd("item",()=>{np=null,s.hide()}),t.onKeyPress("e",async()=>{np&&("sword"===np.itemName&&await nl(t,np,s),"antiqueDoor"===np.itemName&&await nh(t,np),"oriyoki"===np.itemName&&await nc(t,np,s))}),tb(t)},endingSelection:function(t){eL.setCurrentScene("endingSelection"),eL.setFreezePlayer(!1),eK.playMusic(t,"endingMusic");let n=Math.ceil(t.width()/1e3)+2,o=Math.ceil(t.height()/1e3)+2;for(let s=0;s<n;s++)for(let n=0;n<o;n++)t.add([t.sprite("heart-bg"),t.pos(1e3*s,1e3*n),t.scale(1),t.opacity(.65),t.z(-10),t.fixed()]);t.add([t.text("Choose Your Love to Bring Back to the U.S.",{size:40}),t.pos(t.center().x,50),t.anchor("center"),t.color(0,0,0),t.z(1e3)]);let s=Math.ceil(nm.length/4),r=t.center().x-450,l=t.center().y-(s-1)*300/2+40,d=[];nm.forEach((n,o)=>{let s=Math.floor(o/4),c=r+o%4*300,f=l+300*s,g=eO.getHasGivenHeart(n.key),y="player"===n.key,w=g||y;t.add([t.sprite("assets",{anim:`${n.key}-idle-down`}),t.pos(c-35,f-165),t.scale(5),t.z(500),{npcKey:n.key},w?"selectable":"locked",t.opacity(w?1:.3)]),g&&!y&&t.add([t.sprite("full-heart"),t.pos(c,f-95),t.scale(2),t.z(501)]),t.add([t.text(n.name,{size:30,width:180,align:"center"}),t.pos(c-90,f-75),t.anchor("topleft"),t.color(0,0,0),t.z(502)]),t.add([t.text(n.description,{size:16,width:275,align:"left"}),t.pos(c-90,f),t.anchor("topleft"),t.color(0,0,0),t.z(502)]),d.push({x:c,y:f,character:n,active:w})});let c=d.findIndex(t=>"player"===t.character.key||t.active);-1===c&&(c=0);let f=t.add([t.sprite("full-heart"),t.pos(d[c].x,d[c].y),t.anchor("center"),t.z(999),t.scale(1.3)]);function g(){let t=d[c];f.pos.x=t.x,f.pos.y=t.y-95,f.opacity=t.active?1:.3}function y(n){eL.setChosenEnding(n),eK.stopMusic(),"player"===n?t.go("endingAlone"):t.go(`ending_${n}`)}g(),t.onKeyPress("left",()=>{let t=0;do c=(c-1+d.length)%d.length,t++;while(!d[c].active&&"player"!==d[c].character.key&&t<d.length)g()}),t.onKeyPress("right",()=>{let t=0;do c=(c+1)%d.length,t++;while(!d[c].active&&"player"!==d[c].character.key&&t<d.length)g()}),t.onKeyPress("enter",()=>{let t=d[c];t&&(t.active||"player"===t.character.key)&&y(t.character.key)}),t.onClick(()=>{let n=t.mousePos().x,o=t.mousePos().y,s=d.find(t=>(t.active||"player"===t.character.key)&&150>Math.abs(t.x-n)&&150>Math.abs(t.y-o));s&&y(s.character.key)});let w=t.add([t.text("Use   or touch to choose. Press ENTER to confirm.",{size:30}),t.pos(t.center().x,t.height()-20),t.anchor("center"),t.color(0,0,0),t.z(1e3)]),v=0;t.onUpdate(()=>{w.hidden=Math.floor(+(v+=t.dt()))%2==0})},endingAlone:function(t){eL.setCurrentScene("endingAlone"),eK.playMusic(t,"lonelyEndingMusic"),t.setBackground(t.Color.fromHex("#E6E6E6")),t.width(),t.height(),t.add([t.sprite("endingAlone"),t.pos(-10,20),t.scale(.65),t.z(0)]);let n=.55*t.width();function o(){eK.stopMusic(),t.go("mainMenu")}t.add([t.text("You Return Alone",{size:48}),t.pos(n,60),t.anchor("left"),t.color(50,50,50),t.z(100)]),t.add([t.text("Randy understood\nLoves just like airport sushi.\nTry again next flight.\n\nHe waved with a grin\nLoves delayed, not canceled yet.\nYou board solo, meh.",{size:28,width:t.width()/1.5,align:"left",lineSpacing:10}),t.pos(n,260),t.anchor("left"),t.color(80,80,80),t.z(100)]),t.add([t.text("Press ENTER or TAP anywhere\nto return to the main menu.",{size:24}),t.pos(n,t.height()-100),t.anchor("left"),t.color(0,0,0),t.z(100)]),t.onKeyPress("enter",o),t.onClick(o)},ending_hana:function(t){eL.setCurrentScene("ending_hana"),eK.playMusic(t,"lonelyEndingMusic"),t.setBackground(t.Color.fromHex("#E6E6E6")),t.width(),t.height(),t.add([t.sprite("endingHana"),t.pos(-10,20),t.scale(.65),t.z(0)]);let n=.55*t.width();function o(){eK.stopMusic(),t.go("mainMenu")}t.add([t.text("You Chose Hana",{size:48}),t.pos(n,60),t.anchor("left"),t.color(50,50,50),t.z(100)]),t.add([t.text("Needles on her skin\nShe inked your name upside down.\nThen moved out that night.\n\n'Whats your deepest truth?'\nShe asked mid-tattoo, then left.\nYour answer? Regret.",{size:28,width:t.width()/1.5,align:"left",lineSpacing:10}),t.pos(n,260),t.anchor("left"),t.color(80,80,80),t.z(100)]),t.add([t.text("Press ENTER or TAP anywhere\nto return to the main menu.",{size:24}),t.pos(n,t.height()-100),t.anchor("left"),t.color(0,0,0),t.z(100)]),t.onKeyPress("enter",o),t.onClick(o)},ending_naoko:function(t){eL.setCurrentScene("ending_naoko"),eK.playMusic(t,"lonelyEndingMusic"),t.setBackground(t.Color.fromHex("#E6E6E6")),t.width(),t.height(),t.add([t.sprite("endingNaoko"),t.pos(-20,80),t.scale(.65),t.z(0)]);let n=.55*t.width();function o(){eK.stopMusic(),t.go("mainMenu")}t.add([t.text("You Chose Naoko",{size:48}),t.pos(n,60),t.anchor("left"),t.color(50,50,50),t.z(100)]),t.add([t.text("They burned incense low\n'Love is ash,' they softly said.\nYou coughed, then they left.\n\nThey ghosted your calls\nYou mailed a mixtape to hell.\nEven hell returned.",{size:28,width:t.width()/1.5,align:"left",lineSpacing:10}),t.pos(n,260),t.anchor("left"),t.color(80,80,80),t.z(100)]),t.add([t.text("Press ENTER or TAP anywhere\nto return to the main menu.",{size:24}),t.pos(n,t.height()-100),t.anchor("left"),t.color(0,0,0),t.z(100)]),t.onKeyPress("enter",o),t.onClick(o)},ending_oldman:function(t){eL.setCurrentScene("ending_oldman"),eK.playMusic(t,"lonelyEndingMusic"),t.setBackground(t.Color.fromHex("#E6E6E6")),t.width(),t.height(),t.add([t.sprite("endingOldman"),t.pos(-10,20),t.scale(.65),t.z(0)]);let n=.55*t.width();function o(){eK.stopMusic(),t.go("mainMenu")}t.add([t.text("You Chose Tetsuya",{size:48}),t.pos(n,60),t.anchor("left"),t.color(50,50,50),t.z(100)]),t.add([t.text("Sailed west with my bones\nHe insisted I was bait.\nNo fish, just silence.\n\n'Wife once fed the crows.'\nHe said that, then fed your dreams.\nYou woke up... in Guam.",{size:28,width:t.width()/1.5,align:"left",lineSpacing:10}),t.pos(n,260),t.anchor("left"),t.color(80,80,80),t.z(100)]),t.add([t.text("Press ENTER or TAP anywhere\nto return to the main menu.",{size:24}),t.pos(n,t.height()-100),t.anchor("left"),t.color(0,0,0),t.z(100)]),t.onKeyPress("enter",o),t.onClick(o)},ending_yuki:function(t){eL.setCurrentScene("ending_yuki"),eK.playMusic(t,"lonelyEndingMusic"),t.setBackground(t.Color.fromHex("#E6E6E6")),t.add([t.sprite("endingYuki"),t.pos(-10,20),t.scale(.65),t.z(0)]);let n=.55*t.width();function o(){eK.stopMusic(),t.go("mainMenu")}t.add([t.text("You Brought Yuki Home",{size:48}),t.pos(n,60),t.anchor("left"),t.color(50,50,50),t.z(100)]),t.add([t.text("She missed the calm rain\nNow she names your houseplants all.\nThey still wither fast.\n\nTourists make poor soil.\nTea tastes strange in Missouri.\nYou steep in regret.",{size:28,width:t.width()/1.5,align:"left",lineSpacing:10}),t.pos(n,260),t.anchor("left"),t.color(80,80,80),t.z(100)]),t.add([t.text("Press ENTER or TAP anywhere\nto return to the main menu.",{size:24}),t.pos(n,t.height()-100),t.anchor("left"),t.color(0,0,0),t.z(100)]),t.onKeyPress("enter",o),t.onClick(o)},ending_satoshi:function(t){eL.setCurrentScene("ending_satoshi"),eK.playMusic(t,"lonelyEndingMusic"),t.setBackground(t.Color.fromHex("#E6E6E6")),t.width(),t.height(),t.add([t.sprite("endingSatoshi"),t.pos(-10,20),t.scale(.65),t.z(0)]);let n=.55*t.width();function o(){eK.stopMusic(),t.go("mainMenu")}t.add([t.text("You Chose Satoshi",{size:48}),t.pos(n,60),t.anchor("left"),t.color(50,50,50),t.z(100)]),t.add([t.text("Slang flew over you\nHis turtle liked you better.\nYou paid for Wi-Fi.\n\nLong-distance heartbreak\nHe ghosted you in Discord.\nYou miss his emoji.",{size:28,width:t.width()/1.5,align:"left",lineSpacing:10}),t.pos(n,260),t.anchor("left"),t.color(80,80,80),t.z(100)]),t.add([t.text("Press ENTER or TAP anywhere\nto return to the main menu.",{size:24}),t.pos(n,t.height()-100),t.anchor("left"),t.color(0,0,0),t.z(100)]),t.onKeyPress("enter",o),t.onClick(o)},ending_koji:function(t){eL.setCurrentScene("ending_koji"),eK.playMusic(t,"lonelyEndingMusic"),t.setBackground(t.Color.fromHex("#E6E6E6")),t.width(),t.height(),t.add([t.sprite("endingKoji"),t.pos(-10,20),t.scale(.65),t.z(0)]);let n=.55*t.width();function o(){eK.stopMusic(),t.go("mainMenu")}t.add([t.text("You Chose Koji",{size:48}),t.pos(n,60),t.anchor("left"),t.color(50,50,50),t.z(100)]),t.add([t.text("You liked his broom work\nBut poems dont do dishes.\nHe swept out your cash.\n\nMorning head shaving\nHe says its a zen cleansing.\nYou say 'midlife goth.'",{size:28,width:t.width()/1.5,align:"left",lineSpacing:10}),t.pos(n,260),t.anchor("left"),t.color(80,80,80),t.z(100)]),t.add([t.text("Press ENTER or TAP anywhere\nto return to the main menu.",{size:24}),t.pos(n,t.height()-100),t.anchor("left"),t.color(0,0,0),t.z(100)]),t.onKeyPress("enter",o),t.onClick(o)},ending_mari:function(t){eL.setCurrentScene("ending_mari"),eK.playMusic(t,"lonelyEndingMusic"),t.setBackground(t.Color.fromHex("#E6E6E6")),t.width(),t.height(),t.add([t.sprite("endingMari"),t.pos(-10,20),t.scale(.65),t.z(0)]);let n=.55*t.width();function o(){eK.stopMusic(),t.go("mainMenu")}t.add([t.text("You Chose Mari",{size:48}),t.pos(n,60),t.anchor("left"),t.color(50,50,50),t.z(100)]),t.add([t.text("She posted your pic\nCaption: 'LOL what is this?'\nYou cried in the tags.\n\nBack home she ghosted\n'Our vibe was super kawaii!'\nThen she blocked your mom.",{size:28,width:t.width()/1.5,align:"left",lineSpacing:10}),t.pos(n,260),t.anchor("left"),t.color(80,80,80),t.z(100)]),t.add([t.text("Press ENTER or TAP anywhere\nto return to the main menu.",{size:24}),t.pos(n,t.height()-100),t.anchor("left"),t.color(0,0,0),t.z(100)]),t.onKeyPress("enter",o),t.onClick(o)},instructions:function(t){eK.playMusic(t,"instructionsMusic",{volume:.7}),t.add([t.sprite("instructions"),t.anchor("center"),t.scale(t.width()/1536,t.height()/1024),t.pos(t.center()),t.z(-1)]);let n=t.center().x-450;t.add([t.rect(900,600,{radius:16}),t.pos(n,80),t.color(255,255,255),t.opacity(.75),t.z(0)]),t.add([t.text("HOW TO PLAY",{size:60,font:"gameboy"}),t.pos(t.center().x,125),t.anchor("center"),t.color(0,0,0),t.z(1)]),t.add([t.text("You play as *Randy*, an obnoxious American tourist seeking love (and maybe immigration paperwork).\n\n- Talk to people using the E key.\n- End the game at any time using the ESC key.\n- Everyone speaks in haiku. So do you.\n- Win hearts by saying the right things or giving gifts.\n- Collect hearts to start the K-1 visa journey with that person.\n\nTips:\n- Listen closely. Locals will drop hints.\n- Flattery and weird snacks go a long way.\n- Youre not a hero. Youre Randy.",{size:20,width:860,lineSpacing:14,font:"gameboy"}),t.pos(n+20,200),t.color(0,0,0),t.z(1)]);let o=t.add([t.text("Press ENTER to Begin",{size:26,font:"gameboy"}),t.anchor("center"),t.pos(t.center().x,640),t.color(0,0,0),t.z(1)]),s=0;t.onUpdate(()=>{o.hidden=Math.floor(2*(s+=t.dt()))%2==0});let r=()=>{eK.stopMusic(),t.go("world")};t.onKeyPress("enter",r),t.onClick(r),t.onTouchStart(r)}};ez.loadFont("gb","/assets/gb.ttf");for(const t of["antique","credits","dayinmylife","gamerblamer","kawaii","news_chill","nightfullofstars","ocean","retro","time_alone","trainstation","lonelyEndingMusic","instructions"])ez.loadSound(t,`/assets/sounds/music/${t}.mp3`);for(const[t,n]of Object.entries({menuMusic:"ocean",worldMusic:"dayinmylife",teashopMusic:"gamerblamer",hotelMusic:"nightfullofstars",bathMusic:"time_alone",trainMusic:"trainstation",endingMusic:"credits",mangaMusic:"kawaii",ramenMusic:"retro",cstoreMusic:"news_chill",antiqueMusic:"antique",lonelyEndingMusic:"lonelyEndingMusic",instructionsMusic:"instructions"}))ez.loadSound(t,`/assets/sounds/music/${n}.mp3`);for(const t of["door_chime","pickupCoin","sliding_door"])ez.loadSound(t,`/assets/sounds/uiSounds/${t}.mp3`);for(const[t,n]of(ez.loadSound("soundUI","/assets/sounds/uiSounds/pickupCoin.mp3"),ez.loadSound("chime-bell","/assets/sounds/uiSounds/door_chime.mp3"),ez.loadSound("door-open","/assets/sounds/uiSounds/sliding_door.mp3"),ez.loadSound("sparkle","/assets/sounds/uiSounds/sparkle.mp3"),Object.entries({oldman:["oldman_world1","oldman_world2","oldman_world3","oldman_world4","oldman_world5","oldman_bath1","oldman_bath2","oldman_bath3","oldman_extra1","oldman_extra2","oldman_extra3","oldman_extra4","oldman_bath_extra1","oldman_bath_extra2","oldman_bath_extra3","oldman_bath_extra4"],yuki:["yuki_tea1","yuki_tea2","yuki_tea3","yuki_tea4","yuki_cstore1","yuki_cstore2","yuki_cstore3","yuki_cstore4","yuki_cstore5","yuki_extra1","yuki_extra2","yuki_extra3","yuki_extra4","yuki_tea_extra1","yuki_tea_extra2","yuki_tea_extra3","yuki_tea_extra4"],satoshi:["satoshi_hotel1","satoshi_hotel2","satoshi_hotel3","satoshi_extra1","satoshi_extra2","satoshi_extra3","satoshi_gift"],koji:["koji_train1","koji_train2","koji_train3","koji_train4","koji_train5","koji_train6","koji_extra1","koji_extra2","koji_extra3","koji_extra4","koji_oriyoki"],mari:["mari_manga1","mari_manga2","mari_manga3","mari_manga4","mari_manga5","mari_extra1","mari_extra2","mari_extra3","mari_manga"],naoko:["naoko_ramen1","naoko_ramen2","naoko_ramen3","naoko_ramen4","naoko_extra1","naoko_extra2","naoko_sword1","naoko_hint1"],hana:["hana_antique1","hana_antique2","hana_antique3","hana_antique4","hana_antique5","hana_antique6","hana_extra1","hana_extra2","hana_extra3","hana_extra4"],randy:["randy_tea1","randy_tea2","randy_tea3","randy_tea4","randy_cstore1","randy_cstore2","randy_cstore3","randy_cstore4","randy_cstore5","randy_oldman1","randy_oldman2","randy_oldman3","randy_oldman4","randy_oldman5","randy_oldmanbath1","randy_oldmanbath2","randy_oldmanbath3","randy_hana1","randy_hana2","randy_hana3","randy_hana4","randy_hana5","randy_hana6","randy_koji1","randy_koji2","randy_koji3","randy_koji4","randy_koji5","randy_koji6","randy_mari1","randy_mari2","randy_mari3","randy_mari4","randy_mari5","randy_naoko1","randy_naoko2","randy_naoko3","randy_naoko4","randy_satoshi1","randy_satoshi2","randy_satoshi3"],npc1:["npc1_extra1","npc1_extra2","npc1_extra3"],npc2:["npc2_extra1","npc2_extra2","npc2_extra3"],npc3:["npc3_extra1","npc3_extra2","npc3_extra3"],npc4:["npc4_extra1","npc4_extra2","npc4_extra3"],npc5:["npc5_extra1","npc5_extra2","npc5_extra3"]})))n.forEach(n=>{let o=`/assets/sounds/voices/${t}/${n}.mp3`;ez.loadSound(n,o),ez.loadSound(`${t}_${n}`,o)});ez.loadSprite("endingCredits","/assets/images/endcreditbackground.png"),ez.loadSprite("heart-bg","/assets/images/heart-bg.png"),ez.loadSprite("endingAlone","/assets/images/endingAlone.png"),ez.loadSprite("endingYuki","/assets/images/endingYuki.png"),ez.loadSprite("endingSatoshi","/assets/images/endingSatoshi.png"),ez.loadSprite("endingKoji","/assets/images/endingKoji.png"),ez.loadSprite("endingMari","/assets/images/endingMari.png"),ez.loadSprite("endingNaoko","/assets/images/endingNaoko.png"),ez.loadSprite("endingHana","/assets/images/endingHana.png"),ez.loadSprite("endingOldman","/assets/images/endingOldman.png"),ez.loadSprite("instructions","/assets/images/instructions.png"),ez.loadSprite("assets","/assets/topdownasset.png",{sliceX:39,sliceY:31,anims:{"player-idle-down":1014,"player-down":{from:1014,to:1017,loop:!0},"player-idle-side":1053,"player-side":{from:1053,to:1056,loop:!0},"player-idle-up":1092,"player-up":{from:1092,to:1095,loop:!0},"oldman-idle-down":1159,"oldman-down":{from:1159,to:1162,loop:!0},"oldman-idle-side":1198,"oldman-side":{from:1198,to:1201,loop:!0},"oldman-idle-up":1202,"oldman-up":{from:1202,to:1205,loop:!0},"yuki-down":1034,"yuki-idle-down":1034,"yuki-side":1073,"yuki-up":1112,"satoshi-idle-down":1018,"satoshi-down":{from:1018,to:1021,loop:!0},"satoshi-idle-side":1057,"satoshi-side":{from:1057,to:1060,loop:!0},"satoshi-idle-up":1096,"satoshi-up":{from:1096,to:1099,loop:!0},"koji-idle-down":1026,"koji-down":{from:1026,to:1029,loop:!0},"koji-idle-side":1065,"koji-side":{from:1065,to:1068,loop:!0},"koji-idle-up":1104,"koji-up":{from:1104,to:1107,loop:!0},"mari-down":1030,"mari-idle-down":1030,"mari-side":1069,"mari-up":1110,"naoko-idle-down":1022,"naoko-down":{from:1022,to:1025,loop:!0},"naoko-idle-side":1061,"naoko-side":{from:1061,to:1064,loop:!0},"naoko-idle-up":1102,"naoko-up":{from:1100,to:1103,loop:!0},"hana-idle-down":1038,"hana-down":{from:1038,to:1041,loop:!0},"hana-idle-side":1077,"hana-side":{from:1077,to:1080,loop:!0},"hana-idle-up":1116,"hana-up":{from:1116,to:1119,loop:!0},"npc1-idle-down":1042,"npc1-down":{from:1042,to:1045,loop:!0},"npc1-idle-side":1081,"npc1-side":{from:1081,to:1084,loop:!0},"npc1-idle-up":1120,"npc1-up":{from:1120,to:1123,loop:!0},"npc2-idle-down":1155,"npc2-down":{from:1155,to:1158,loop:!0},"npc2-idle-side":1194,"npc2-side":{from:1194,to:1197,loop:!0},"npc2-idle-up":1163,"npc2-up":{from:1163,to:1166,loop:!0},"npc3-idle-down":1147,"npc3-down":{from:1147,to:1150,loop:!0},"npc3-idle-side":1186,"npc3-side":{from:1186,to:1189,loop:!0},"npc3-idle-up":1190,"npc3-up":{from:1190,to:1193,loop:!0},"npc4-down":1143,"npc4-side":1146,"npc4-up":1145,"npc5-down":1182,"npc5-side":1183,signhotel:839,signbath:837,signtrain:837,bedrandy:188,whitevending:56,orangevending:54,mangabookshelf:134,antiqueKey:38,sword:75,antiqueDoor:28,antiqueDoorOpen:27,strawberry:125,mangaBook:49,oriyoki:93}}),ez.loadSpriteAtlas("/assets/topdownasset.png",{"full-heart":{x:288,y:16,width:48,height:48},"half-heart":{x:336,y:16,width:48,height:48},"empty-heart":{x:384,y:16,width:48,height:48}}),ez.loadSprite("sunset","/assets/images/sunset.png",{sliceX:4,anims:{loop:{from:0,to:3,loop:!0,speed:8}}});for(const t in nf)ez.scene(t,()=>nf[t](ez));ez.go("mainMenu");
//# sourceMappingURL=90-Day-Haiku---The-Game.b02a8add.js.map
